(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["tilt-rotate-control"],{1105:function(t,e,o){"use strict";o.r(e);var n=o(6),a=o(2510),i=o.n(a),r=o(4),s=o.n(r),l=o(7),c=o(55),p=o(60),m=o(11),u=o(593),_=o(9),v=o(20),d=o(8),f=o(232),h=o(2512),E=o.n(h),R=Object(v.a)({resolved:{},chunkName:function(){return"base"},isReady:function(t){var e=this.resolve(t);return!1!==this.resolved[e]&&!!o.m[e]},importAsync:function(){return Promise.resolve().then(o.bind(null,1135))},requireAsync:function(t){var e=this,o=this.resolve(t);return this.resolved[o]=!1,Promise.resolve(this.importAsync(t)).then(function(t){return e.resolved[o]=!0,t})},requireSync:function t(e){var n=this.resolve(e);return o(n)},resolve:function t(){return 1135}}),b=Object(l.a)("map-geolocation-rotate-control"),y=function(t){function e(e){var o;return(o=t.call(this,e)||this)._analyticsRef=r.createRef(),o._onMapUpdate=function(){o.setState({azimuth:o.props.map.azimuth})},o._onResetMapRotate=function(){var t=o.state.azimuth;Object(u.c)(o.props.map,function(){var e;null===(e=o._analyticsRef.current)||void 0===e||e.logEvent("reset",{start_zimuth:Object(f.a)(t)})})},o.state={azimuth:e.map.azimuth},o}return Object(n.a)(e,t),e.prototype.render=function(){var t=this.props;if(!("vector"===t.map.getMode()&&t.config.uatraits.isTouch&&Boolean(t.config.experiments.ui.ymaps3MapRotate)))return r.createElement(R,null);var e=this.state.azimuth;return r.createElement(r.Fragment,null,r.createElement(d.a,{name:"compass",nodeRef:this._analyticsRef},0!==e?r.createElement("div",{className:b(),onClick:this._onResetMapRotate,style:{transform:"rotate("+e+"rad)"}},r.createElement(m.a,{url:E.a})):null),r.createElement(R,{hideControl:0!==e}),r.createElement(c.b,{onUpdate:this._onMapUpdate}))},e}(r.Component);e.default=Object(_.b)(Object(p.b)({shouldWait:!0})(y))},1106:function(t,e,o){"use strict";o.r(e);var n=o(6),a=o(2518),i=o.n(a),r=o(4),s=o.n(r),l=o(7),c=o(20),p=o(55),m=o(60),u=o(184),_=o(43),v=o(593),d=o(117),f=o(15),h=o(8),E=o(232),R=Object(c.a)({resolved:{},chunkName:function(){return"tooltip"},isReady:function(t){var e=this.resolve(t);return!1!==this.resolved[e]&&!!o.m[e]},importAsync:function(){return o.e("tooltip").then(o.bind(null,271))},requireAsync:function(t){var e=this,o=this.resolve(t);return this.resolved[o]=!1,Promise.resolve(this.importAsync(t)).then(function(t){return e.resolved[o]=!0,t})},requireSync:function t(e){var n=this.resolve(e);return o(n)},resolve:function t(){return 271}}),b=Object(l.a)("map-tilt-rotate-control"),y=function(t){function e(e){var o;return(o=t.call(this,e)||this)._controlRef=r.createRef(),o._tooltipTargetRef=r.createRef(),o._analyticsCompassRef=r.createRef(),o._analyticsTiltRef=r.createRef(),o._startTilt=0,o._isClick=!1,o._tiltBeforeDisabling=0,o._startAzimuth=0,o._recalculateCenter=function(){if(o._controlRef.current){var t=o._controlRef.current.getBoundingClientRect(),e=t.x,n=t.y,a=t.height,i=t.width;o._controlCenterPosition={x:e+i/2,y:n+a/2}}},o._onMapUpdate=function(){var t;o._isClick||o.props.map.tilt===o.state.tilt&&o.props.map.azimuth===o.state.azimuth||(null===(t=o._tooltipTargetRef.current)||void 0===t||t.click());o._recalculateCenter();var e=o._prevZoom,n=o.props.map.zoom,a=o.state.tilt;n<v.a&&e&&e>=v.a&&0!==a&&(o._tiltBeforeDisabling=o.props.map.tilt,Object(v.d)(o.props.map)),n>=v.a&&e&&e<v.a&&Object(v.e)(o.props.map,o._tiltBeforeDisabling),o._prevZoom=o.props.map.zoom,o.setState({azimuth:o.props.map.azimuth,tilt:o.props.map.tilt,isDisabled:o.props.map.zoom<v.a})},o._addRotateEventListeners=function(){window.addEventListener("mousemove",o._onRotateMove),window.addEventListener("mouseup",o._onRotateEnd)},o._removeRotateEventListeners=function(){window.removeEventListener("mousemove",o._onRotateMove),window.removeEventListener("mouseup",o._onRotateEnd)},o._addTiltEventListeners=function(){window.addEventListener("mousemove",o._onTiltMove),window.addEventListener("mouseup",o._onTiltEnd)},o._removeTiltEventListeners=function(){window.removeEventListener("mousemove",o._onTiltMove),window.removeEventListener("mouseup",o._onTiltEnd)},o._onRotateStart=function(t){0===t.button&&(o._isClick=!0,o.setState({isMove:!0}),o._startMovePosition={x:t.clientX,y:t.clientY},o._startAzimuth=o.state.azimuth,o._addRotateEventListeners())},o._onRotateMove=function(t){var e=o._controlCenterPosition,n=e.x,a=e.y,i=o._startMovePosition,r=Math.atan2(t.pageY-a,t.pageX-n)-Math.atan2(i.y-a,i.x-n);o._isClick&&(o._isClick=!1),o.props.map.setCamera({worldCenter:o.props.map.worldCenter,zoom:o.props.map.zoom,azimuth:o._startAzimuth+r,tilt:o.props.map.tilt})},o._onRotateEnd=function(){var t;(o.setState({showTooltip:!0,isMove:!1}),o._removeRotateEventListeners(),o._isClick)||(null===(t=o._analyticsCompassRef.current)||void 0===t||t.changeState({action_type:"drag",rotation_angle_state:Object(E.a)(o.props.map.azimuth),rotation_angle_diff:Object(E.a)(o.props.map.azimuth-o._startAzimuth)}))},o._toggleMapRotate=function(){o._isClick&&Object(v.c)(o.props.map,function(){var t;o._isClick=!1,null===(t=o._analyticsCompassRef.current)||void 0===t||t.changeState({action_type:"click",rotation_angle_state:Object(E.a)(o.props.map.azimuth),rotation_angle_diff:Object(E.a)(o.props.map.azimuth-o._startAzimuth)})})},o._onTiltStart=function(t){0===t.button&&(o._isClick=!0,o.setState({isMove:!0}),o._startMovePosition={x:t.clientX,y:t.clientY},o._startTilt=o.props.map.tilt,o._addTiltEventListeners())},o._onTiltMove=function(t){if(o._startMovePosition){o._isClick&&(o._isClick=!1);var e=o._startMovePosition.y-t.clientY,n=Math.PI*e/o.props.map.size.y;o.props.map.setCamera({worldCenter:o.props.map.worldCenter,zoom:o.props.map.zoom,azimuth:o.props.map.azimuth,tilt:o._startTilt+n})}},o._onTiltEnd=function(){var t;(o.setState({showTooltip:!0,isMove:!1}),o._removeTiltEventListeners(),o._isClick)||(null===(t=o._analyticsTiltRef.current)||void 0===t||t.changeState({action_type:"drag",rotation_angle_state:Object(E.a)(o.props.map.tilt),rotation_angle_diff:Object(E.a)(o.props.map.tilt-o._startTilt)}))},o._toggleMapTilt=function(){o._isClick&&Object(v.d)(o.props.map,function(){var t;null===(t=o._analyticsTiltRef.current)||void 0===t||t.changeState({action_type:"click",rotation_angle_state:Object(E.a)(o.props.map.tilt),rotation_angle_diff:Object(E.a)(o.props.map.tilt-o._startTilt)}),o._isClick=!1})},o.state={azimuth:e.map.azimuth,tilt:e.map.tilt,isMove:!1,showTooltip:!1,isDisabled:e.map.zoom<v.a},o}Object(n.a)(e,t);var o=e.prototype;return o.componentDidMount=function(){this._controlRef.current&&(this._controlRef.current.onselectstart=function(t){t.preventDefault()}),this._recalculateCenter()},o.componentWillUnmount=function(){this._removeRotateEventListeners(),this._removeTiltEventListeners()},o.render=function(){var t,e=this.props,o=this.props.map.getLayers(),n=e.map.getMode(),a=[].concat(o.topRasterLayers,"vector"!==n?o.mainLayers:[]),i="vector"===n&&a.every(function(t){return!u.c.includes(t.split(":")[0])}),s=this.state,l=s.azimuth,c=s.tilt,m=s.isMove,v=s.isDisabled;return t=v?"Увеличьте масштаб, чтобы наклонить карту":0!==c?"Убрать наклон карты":"Наклонить карту",r.createElement(r.Fragment,null,i?r.createElement(r.Fragment,null,r.createElement("div",{className:b({"in-action":m}),ref:this._controlRef},r.createElement(h.a,{name:"compass",nodeRef:this._analyticsCompassRef},r.createElement(_.a,{text:0!==l?"Вернуть север сверху":"Повернуть карту",position:"left",isAir:!0,delay:500,isDisabled:m},r.createElement("div",null,r.createElement("div",{className:b("ring"),style:{transform:"rotate("+l+"rad)"},onClick:this._toggleMapRotate,onMouseDown:this._onRotateStart})))),r.createElement(h.a,{name:"tilt_control",nodeRef:this._analyticsTiltRef},r.createElement(_.a,{text:t,position:"left",isAir:!0,delay:500,isDisabled:m,offset:{main:12,side:0}},r.createElement("div",{className:b("tilt-wrapper")},r.createElement("div",{className:b("tilt",{tilted:0!==c,disabled:v}),style:{transform:"rotateX("+c+"rad)"},onClick:v?void 0:this._toggleMapTilt,onMouseDown:v?void 0:this._onTiltStart},0===c?"3D":"2D"))))),this.state.showTooltip?r.createElement(R,{title:"Чтобы повернуть карту, покрутите компас или зажмите Ctrl с левой кнопкой мыши",id:"tilt-rotate",showArrow:!1,position:"bottom",offset:{main:15,side:-15},renderControls:function(t){return r.createElement(f.a,{view:"secondary-blue",size:"small",onClick:t},"Понятно")},checkTargetVisibility:!1},r.createElement("div",{ref:this._tooltipTargetRef})):null,r.createElement(d.a,{type:"resize",listener:this._recalculateCenter})):null,r.createElement(p.b,{onUpdate:this._onMapUpdate}))},e}(r.Component);e.default=Object(m.b)({shouldWait:!0})(y)},1107:function(t,e,o){"use strict";o.r(e);var n=o(6),a=(o(2520),o(4)),i=o(7),r=o(55),s=o(60),l=o(15),c=o(593),p=o(8),m=o(232),u=Object(i.a)("map-tilt-control"),_=function(t){function e(e){var o;return(o=t.call(this,e)||this)._analyticsRef=a.createRef(),o._onMapUpdate=function(){Boolean(o.props.map.zoom<c.b&&o._prevZoom&&o._prevZoom>=c.b&&0!==o.state.tilt)&&Object(c.d)(o.props.map),o._prevZoom=o.props.map.zoom,o.setState({tilt:o.props.map.tilt})},o._onResetMapTilt=function(){var t=o.state.tilt;Object(c.d)(o.props.map,function(){var e;null===(e=o._analyticsRef.current)||void 0===e||e.logEvent("reset",{start_tilt:Object(m.a)(t)})})},o.state={tilt:e.map.tilt},o}return Object(n.a)(e,t),e.prototype.render=function(){if("vector"!==this.props.map.getMode())return null;var t=this.state.tilt;return a.createElement(a.Fragment,null,a.createElement(p.a,{name:"tilt_control",nodeRef:this._analyticsRef},0!==t?a.createElement("div",{className:u()},a.createElement(l.a,{view:"air",size:"medium",onClick:this._onResetMapTilt},"2D")):null),a.createElement(r.b,{onUpdate:this._onMapUpdate}))},e}(a.Component);e.default=Object(s.b)({shouldWait:!0})(_)},2510:function(t,e,o){},2512:function(t,e,o){t.exports=o.p+"_/d2c114a714e31225540623b8a901aa2a.svg"},2518:function(t,e,o){},2520:function(t,e,o){}}]);