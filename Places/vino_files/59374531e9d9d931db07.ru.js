(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["routes"],{1017:function(e,t,n){"use strict";n.r(t);var r=n(6),o=n(10),i=n(4),a=n.n(i),s=n(12),c=n(2800),u=n(2792),l=n(2809),d=n(956),p=n(20),m=n(17),f=n(9),v=n(319),g=n(147),h=n(23),b=n(115),_=n(69),y=n(55),E=n(948),S=n(1461),R=n(2784),C=n(2753),I=n(109),k=n(1614),P=n(16),O=n(37),T=n(327),x=n(1617),w=n.n(x),N=n(118),M=n(1618),j=n.n(M),A=n(139),D=n(258),F=n(8),L=n(373),B=n(696),z=n(79),U=n(72),W=n(1619),q=n(738),V=n(182),H=n(114),G=n(60),K=n(318),J=n(61),X=n(315),Y=n(676),Z=Object(p.a)({resolved:{},chunkName:function(){return"base"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return Promise.resolve().then(n.bind(null,33))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 33}}),$=Object(p.a)({resolved:{},chunkName:function(){return"mrc"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("mrc").then(n.bind(null,1112))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 1112}},{ssr:!1}),Q=Object(p.a)({resolved:{},chunkName:function(){return"geolocation"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("geolocation").then(n.bind(null,640))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 640}},{ssr:!1}),ee=Object(p.a)({resolved:{},chunkName:function(){return"bookmarks"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("bookmarks").then(n.bind(null,562))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 562}}),te={close:O.a.close,setRoutePoints:b.a.setRoutePoints,changeTravelMode:b.a.changeTravelMode,addPoint:b.a.addPoint,setPoint:b.a.setPoint,removePoint:b.a.removePoint,resetPoints:b.a.resetPoints,movePoint:b.a.movePoint,setActiveComparisonMode:b.a.setActiveComparisonMode,setActiveRouteIndex:b.a.setActiveRouteIndex,setDetailedIndex:b.a.setDetailedIndex,setActivePoint:b.a.setActivePoint,setSkipApplyBounds:b.a.setSkipApplyBounds,setActiveField:b.a.setActiveField,setFocused:b.a.setFocused,processMapObjectClick:b.a.processMapObjectClick,activateMasstransitLinePanel:b.a.activateMasstransitLinePanel,hideMapForm:b.a.hideMapForm,openMapForm:b.a.openMapForm,updateMap:h.a.updateMap,updateSettings:b.a.updateSettings,setMapLocation:h.a.setMapLocation,setFollowingPin:h.a.setFollowingPin,openLoginDialog:h.a.openLoginDialog,checkAuthorization:h.a.checkAuthorization,addPlace:A.a.addPlaceImmediate,setBookmarkSearchResult:A.a.setSearchResult,fetchStopInfo:I.a.fetchStopInfo,updateParkingLayerAvailability:D.a.updateLayerAvailability,updateRoutesComparisonRoute:b.a.updateRoutesComparisonRoute,setActiveMrcIndex:b.a.setActiveMrcIndex,hideMrcMiniPlayer:b.a.hideMrcMiniPlayer,optimizeRoute:b.a.optimizeRoute,setOptimizingStatus:b.a.setOptimizingStatus,showMoreSnippets:b.a.showMoreSnippets,setGeolocationPoint:b.a.setGeolocationPoint,setGeolocationError:b.a.setGeolocationError,updateGeolocationPoints:b.a.updateGeolocationPoints,setRoutePointIsDragging:b.a.setRoutePointIsDragging,loadVehicles:I.a.loadVehicles,resetVehiclesInfo:I.a.resetVehiclesInfo,fetchLineInfo:I.a.fetchLineInfo,setActiveVehicle:I.a.setActiveVehicle,openRouteFeedback:J.a.openRouteFeedback},ne="routes",re=Object(m.a)(s.b(function(e){var t,n=P.g(e,"routes"),r=n[n.length-1],i=r||_.p(e),a=P.h(e,"search-result"),s=Object.entries(e.bookmarks.searchResults).map(function(e){return e[1]}).filter(function(e){return Boolean(e)}),c=P.h(e,"feedback"),u=c&&Object(K.i)(c)?c:null;return Object(o.a)(Object(o.a)(Object(o.a)({isCurrentRouteStack:Boolean(P.h(e,"routes")),urlParams:Object(z.c)(e,{format:"query"}).params,bookmarksSearchResults:s,isActive:P.d(e)===ne,hasData:Boolean(r),mapClickFieldIndex:_.u(e),isBoldRoute:e.panoramas.isLayerEnabled,isRoutesModeInStack:Boolean(r||P.j(e,"routes")),isMapEditing:e.map.isEditing,cursor:_.l(e),selectedResult:(null==a?void 0:null===(t=a.response)||void 0===t?void 0:t.items[0])||void 0,places:e.bookmarks.places,mapLocation:e.map.location,isMapInAction:e.map.isInAction,collapsedSidebar:P.n(e),isTrafficLayerEnabled:e.traffic.isLayerEnabled,isMrcPlaying:e.mrc.isPlaying,mapSize:e.map.size,mapOffset:e.map.offset},i),e.routes),{},{feedback:u,routePoints:_.C(i,e.bookmarks),settings:Object(o.a)(Object(o.a)({},i.settings),{},{auto:Object(o.a)(Object(o.a)({},i.settings.auto),{},{ignoreTrafficJams:i.settings.auto.ignoreTrafficJams&&!i.settings.auto.timeDependent.time})}),hasInterstitial:"interstitial"===e.promoType,vehicles:e.masstransit.vehicles,mapMargin:X.b(e),isMasstransitLayerShown:e.masstransit.isLayerShown})},te),f.b,v.b,Object(G.b)()),oe=15,ie=function(e){function t(t){var n;return(n=e.call(this,t)||this)._waypointsAnalyticsRef=i.createRef(),n._defaultGeolocationAnalyticsRef=i.createRef(),n._routesAnalyticsRef=i.createRef(),n._vehiclePlacemarkAnalyticsRef=i.createRef(),n._homeWorkAnalyticsRef=i.createRef(),n._saveRideHistory=function(){var e,t,r=n.props,o=r.routePoints[0],i=r.routePoints[r.routePoints.length-1],a=null===(e=o.searchResult)||void 0===e?void 0:e.country,s=null===(t=i.searchResult)||void 0===t?void 0:t.country;if(a&&s&&o.coords&&i.coords){var c=o.input||o.value,u=i.input||i.value,l=["car","pedestrian","masstransit","taxi","bicycle"].includes(r.travelMode)?r.travelMode:"auto"===r.travelMode?"car":void 0,d={from:{title:c,description:_.B(o)||c,coordinates:o.coords,country:a,pctx:_.x(o)},to:{title:u,description:_.B(i)||u,coordinates:i.coords,country:s,pctx:_.x(i)},type:l};_.W.addRecord(d,r.config)}},n._onAddActionSubmit=function(e){var t=n.props;n.props.addPlace({placeId:n.state.addingPlaceId,data:e}),n.setState({addingPlaceId:null}),t.setPoint(t.activeField,{coords:e.coords,value:e.title||e.addressLineShort}),t.setActiveField(_.v(t.routePoints,t.activeField))},n._onAddActionCancel=function(){n.setState({addingPlaceId:null})},n._onActionItemClick=function(e,t){var r=n.props,o=null;switch([q.a.HOME,q.a.ADD_HOME].includes(e)?o=V.a.HOME_ID:[q.a.WORK,q.a.ADD_WORK].includes(e)&&(o=V.a.WORK_ID),e){case q.a.HOME:case q.a.WORK:var i=o&&r.places&&r.places[o];if(!i||!H.l(i))break;var a=r.bookmarksSearchResults&&r.bookmarksSearchResults.find(function(e){return"placeId"in e&&e.placeId===i.id});(a?Promise.resolve(a):Y.a.loadPlaceSearchResult(i,n.props.config)).then(function(e){i&&i.coords&&e&&r.setBookmarkSearchResult(i.coords,e),r.setPoint(t,{value:H.j(i.id,n.props.config),coords:i.coords,searchResult:e})}),r.setActiveField(_.v(r.routePoints,t));break;case q.a.ADD_HOME:case q.a.ADD_WORK:r.setActiveField(t),n.setState({addingPlaceId:o});break;case q.a.UNAUTH_HOME:case q.a.UNAUTH_WORK:r.openLoginDialog("favorites");break;case q.a.GEOLOCATION:r.setGeolocationPoint(t,{useError:!0});break;case q.a.SHOW_MAP:r.setPoint(t),r.openMapForm()}},n._onVehicleClick=function(e){var t=n.props;n._vehiclePlacemarkAnalyticsRef.current&&n._vehiclePlacemarkAnalyticsRef.current.logEvent("click",{mark_type:"route",id:e.id,lineId:e.lineId,type:e.type}),t.setActiveVehicle(e.id),t.fetchLineInfo({threadId:e.threadId,lineId:e.lineId,skipApplyBounds:!0})},n._onMapClick=function(e,t,r){if(!(r.target instanceof HTMLElement&&n.props.map&&n.props.map.findMarkerByElement(r.target))){var o=n.props,i=o.mapClickFieldIndex,a=o.routePoints,s=o.setActiveField,c=o.processMapObjectClick,u=(o.config,o.setFocused),l=n.state.skipFirstClick,d=i;if(-1!==d&&(n.props.showMapForm,1)){var p=_.s(i,a);n._waypointsAnalyticsRef.current.logEvent("click",{type:p});var m=a[d],f=Boolean(m.input&&!m.value);if(!!m.input&&l)return n.setState({skipFirstClick:f}),void s(d+1);u(!1),c({point:{value:"",coords:t.coordinates}}),n.setState({skipFirstClick:!0})}}},n._isPointChanged=function(e,t){var r=n.props;return!!r.routePoints[t]&&(Boolean(r.routePoints[t].isEditing)||null!==e&&Boolean(r.routePoints[t].coords)&&!Object(u.a)(e,r.routePoints[t].coords))},n._setScrollDisabled=function(e){n.setState({isScrollDisabled:e})},n._setRoutePoints=function(e,t){var r=t.viaIndexes,o=t.isRough,i=n.props,a=i.routePoints,s=e.findIndex(n._isPointChanged);if(-1!==s){var c=[].concat(a);if(e.length===a.length){var u=e[s];null!==u&&(c[s]={coords:u,value:o?a[s].value:"",input:o?a[s].input:"",isEditing:o})}else e.length>a.length?c.splice(s,0,{coords:e[s],value:""}):c.splice(s,1);i.setRoutePoints(c,r,o)}},n._onRoutePointsChange=function(e,t){var r=t.viaIndexes,o=void 0===r?[]:r,i=t.isRough;i?n._setRoutePointsThrottled(e,{viaIndexes:o,isRough:i}):(n._setRoutePointsThrottled.cancel(),n._setRoutePoints(e,{viaIndexes:o,isRough:i}))},n._onActiveRouteChange=function(e){n.props.setActiveRouteIndex(e)},n._onEditClick=function(){n.props.openRouteFeedback({type:"route/edit"})},n._onDetailedPointClick=function(e){var t=n.props,r=Math.max(oe,t.mapLocation.zoom);t.setMapLocation({center:e,zoom:r,duration:450}),t.setActivePoint(e)},n._onClose=function(){var e=n.props;e.showMapForm?e.hideMapForm():e.close()},n._isDetailed=function(){var e=n.props;return Boolean(e.routerResponse&&e.routerResponse.routes[e.detailedIndex]&&"taxi"!==e.travelMode)},n._isFeedbackEnabled=function(){var e=n.props;return Boolean(e.routerResponse&&e.routerResponse.routes&&"taxi"!==e.routerResponse.type&&e.feedback)},n._setPoint=function(e,t){n.props.setPoint(e,t);var r=n.props.mapLocation.bounds;t&&t.coords&&t.value===t.input&&!Object(l.a)(r,t.coords)&&n.props.setMapLocation({bounds:Object(d.a)([].concat(r,[t.coords])),duration:450})},n._areWaypointsFilled=function(e){return e.routePoints.every(function(e){var t=e.coords;return Boolean(t)})},n._onStopClick=function(e,t){var r=e.id;n.props.fetchStopInfo({tab:"timetable",id:r,hotspotCoordinates:e.coordinates,openedBy:t?{lineId:t,dateTime:n.props.settings.masstransit.timeDependent.time}:void 0,mobileViewState:"expanded"})},n._onMrcClick=function(e){var t=n.props;if(t.mrcFeatures){var r=t.mrcFeatures.findIndex(function(t){return t.properties.id===e});t.setActiveMrcIndex(r)}},n._renderRoutesView=function(){var e=n.props,t=e.detailedIndex,r=e.isMapEditing,o=e.activeRouteIndex,a=e.routePoints,s=e.viaIndexes,c=e.routerResponse,u=-1!==t;return i.createElement(E.default,{routePoints:a,viaIndexes:s,routerResponse:c,activeRouteIndex:o,travelMode:n.props.travelMode,feedback:n.props.feedback,settings:n.props.settings,analyticsRef:n._routesAnalyticsRef,mapLocation:n.props.mapLocation,isDetailed:u,isMapEditing:r,isRoutePointDragging:n.props.isRoutePointDragging,isRouteModeActive:!n._isFeedbackEnabled()&&n.props.isActive,isTrafficLayerEnabled:n.props.isTrafficLayerEnabled,isLoading:n.props.isLoading,isMrcPlayerHidden:n.props.isMrcPlayerHidden,isMrcPlaying:n.props.isMrcPlaying,mrcFeatures:n.props.mrcFeatures||[],activeMrcIndex:n.props.activeMrcIndex,onMrcClick:n._onMrcClick,onStopClick:n._onStopClick,onActiveRouteChange:n._onActiveRouteChange,onRoutePointsChange:n._onRoutePointsChange,setDragging:n.props.setRoutePointIsDragging})},n._renderCursor=function(){var e=n.props,t=n.state,r=e.routePoints[e.mapClickFieldIndex],o=r&&r.input&&!r.value;return r&&!(r&&!o)&&t.skipFirstClick||e.isRoutePointDragging&&"pedestrian"===e.travelMode?null:i.createElement(S.a,{cursor:e.cursor})},n._renderActivePoint=function(){return n.props.activePoint?i.createElement(k.a,{coordinates:n.props.activePoint}):null},n._renderPanelFormView=function(){var e=n.props;return i.createElement(R.a,{travelMode:e.travelMode,activeRouteIndex:e.activeRouteIndex,activeField:e.activeField,isFocused:e.isFocused,routerResponse:e.routerResponse,routePoints:e.routePoints,viaIndexes:e.viaIndexes,error:e.error,collapsedSidebar:e.collapsedSidebar,mapLocation:e.mapLocation,tip:e.routerResponse?e.routerResponse.tip:void 0,settings:e.settings,places:e.places,isLoading:e.isLoading,optimizingStatus:e.optimizingStatus,mrcFeatures:e.mrcFeatures,mapSize:e.mapSize,mapOffset:e.mapOffset,moreSnippetsShown:e.moreSnippetsShown,onClose:n._onClose,onEditClick:n._onEditClick,addPoint:e.addPoint,setPoint:n._setPoint,setGeolocationPoint:e.setGeolocationPoint,removePoint:e.removePoint,changeTravelMode:e.changeTravelMode,resetPoints:e.resetPoints,movePoint:e.movePoint,setActiveComparisonMode:e.setActiveComparisonMode,setActiveRouteIndex:e.setActiveRouteIndex,setDetailedIndex:e.setDetailedIndex,setActiveField:e.setActiveField,setFocused:e.setFocused,updateSettings:e.updateSettings,updateRoutesComparisonRoute:e.updateRoutesComparisonRoute,isRoutePointDragging:n.props.isRoutePointDragging,optimizeRoute:e.optimizeRoute,setScrollDisabled:n._setScrollDisabled,setOptimizingStatus:e.setOptimizingStatus,showMoreSnippets:e.showMoreSnippets,checkAuthorization:e.checkAuthorization,onActionItemClick:n._onActionItemClick})},n._renderPanelDetailedView=function(){var e=n.props,t=e.travelMode,r=e.detailedIndex,o=e.routerResponse,a=e.activateMasstransitLinePanel,s=e.settings,c=o&&o.routes[r];return!o||!c||"auto"!==c.type&&"masstransit"!==c.type?null:i.createElement(C.a,{travelMode:t,settings:s,route:c,waypoints:o.waypoints,onClose:n._onClose,onStopClick:n._onStopClick,onEditClick:n._onEditClick,onDetailedPointClick:n._onDetailedPointClick,onMasstransitLineClick:a})},n._renderMrcMiniPlayer=function(){var e=n.props;if(!(e.isMrcPlayerHidden||!e.mrcFeatures&&!e.mrcThumbnail&&null===e.activeMrcIndex||!e.routerResponse||"auto"!==e.routerResponse.type&&"taxi"!==e.routerResponse.type||e.isRoutePointDragging))return i.createElement($,{features:e.mrcFeatures,index:e.activeMrcIndex,thumbnail:e.mrcThumbnail,changeIndex:e.setActiveMrcIndex,onClose:e.hideMrcMiniPlayer})},n._renderContent=function(){var e=n.props.error;return!n._isDetailed()||e?n._renderPanelFormView():n._renderPanelDetailedView()},n._renderEntrances=function(){var e=n.props,t=e.routePoints.filter(function(t,n){return!e.viaIndexes.includes(n)}).slice(1);return 0===t.length?null:t.map(function(e,t){return e.searchResult&&"entrances"in e.searchResult&&e.searchResult.entrances&&0!==e.searchResult.entrances.length?i.createElement(T.a,{key:t,result:e.searchResult,analyticsName:"routes_entrances",animated:!0}):null})},n._renderCollapsedRoutePanelFormView=function(){var e=n.props,t=n._areWaypointsFilled(e);if(!e.isActive||!t)return i.createElement(U.a,{view:"tall",title:"Маршруты"});var r=e.routerResponse&&e.routerResponse.routes[e.activeRouteIndex]||void 0;return i.createElement(j.a,{route:r,routerResponse:e.routerResponse,routePoints:e.routePoints,settings:e.settings,travelMode:e.travelMode,changeTravelMode:e.changeTravelMode,urlParams:e.urlParams,onDetailedClick:function(){return e.setDetailedIndex(e.activeRouteIndex)},error:e.error,isLoading:e.isLoading})},n._renderGeolocationError=function(){return i.createElement(Q,{isShown:Boolean(n.props.geolocationError),type:n.props.geolocationError,onClose:function(){return n.props.setGeolocationError(null)}})},n._renderMasstransitPlacemarks=function(){var e,t,r=n.props,o=(null===(e=r.routerResponse)||void 0===e?void 0:e.routes[r.activeRouteIndex])||(null===(t=r.routerResponse)||void 0===t?void 0:t.routes[0]);return r.isMapEditing||!o||"masstransit"!==o.type||r.isMasstransitLayerShown||!r.isActive?null:i.createElement(W.a,{masstransitRoute:o,vehicles:r.vehicles,mapLocation:r.mapLocation,mapMargin:r.mapMargin,loadVehicles:r.loadVehicles,resetVehiclesInfo:r.resetVehiclesInfo,onVehicleClick:n._onVehicleClick})},n._renderAddPlaceView=function(){return n.state.addingPlaceId?i.createElement(L.a,null,i.createElement(ee,{placeId:n.state.addingPlaceId,onSubmit:n._onAddActionSubmit,onCancel:n._onAddActionCancel,mapLocation:n.props.mapLocation,updateMap:n.props.updateMap})):null},n._setRoutePointsThrottled=Object(c.a)(n._setRoutePoints,333,{leading:!1,trailing:!0}),n.state={skipFirstClick:!0,isScrollDisabled:!1,addingPlaceId:null},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props},n.componentDidUpdate=function(e){var t=this.props;e.mapClickFieldIndex===t.mapClickFieldIndex&&e.activeField===t.activeField||this.setState({skipFirstClick:!0});var n=t.routePoints[0],r=t.routePoints[t.routePoints.length-1],o=e.routePoints[0],i=e.routePoints[e.routePoints.length-1],a=n.searchResult&&n.searchResult!==o.searchResult,s=r.searchResult&&r.searchResult!==i.searchResult;t.routePoints.length>=2&&!t.error&&(a||s)&&this._saveRideHistory()},n.render=function(){var e=this.props;return e.hasData?i.createElement(i.Fragment,null,i.createElement(g.a,{name:"routes",nodeRef:this._routesAnalyticsRef}),i.createElement(g.a,{name:"waypoints_layer",nodeRef:this._waypointsAnalyticsRef}),i.createElement(F.a,{name:"default_geolocation",nodeRef:this._defaultGeolocationAnalyticsRef}),i.createElement(F.a,{name:"masstransit_transport_mark",nodeRef:this._vehiclePlacemarkAnalyticsRef}),i.createElement(F.a,{name:"home_work_experiment",nodeRef:this._homeWorkAnalyticsRef}),i.createElement(Z,{name:ne,analyticsName:"routes_panel",view:e.showMapForm?"small":"full",scrollDisabled:this.state.isScrollDisabled,renderMiniCard:this._areWaypointsFilled(e)?this._renderCollapsedRoutePanelFormView:void 0,closeOnSwipeDown:!1,miniCardOnly:!0},this._renderContent()),this._renderRoutesView(),this._renderCursor(),this._renderActivePoint(),this._renderEntrances(),e.isActive?this._renderMrcMiniPlayer():null,this._renderAddPlaceView(),this._renderGeolocationError(),this._renderMasstransitPlacemarks(),-1!==e.mapClickFieldIndex?i.createElement(y.b,{layer:"any",onFastClick:this._onMapClick}):null,i.createElement(N.a,{type:"routes_page"})):null},t}(i.Component);ie.displayName="RouteComponent",t.default=re(ie)},1019:function(e,t,n){"use strict";var r=n(10),o=n(6),i=(n(1516),n(4)),a=n(7),s=n(11),c=n(36),u=n(9),l=Object(a.a)("route-waypoint-icon-view"),d=function(e){function t(){return e.apply(this,arguments)||this}return Object(o.a)(t,e),t.prototype.render=function(){var e=this.props,t=!(!e.config.uatraits.BrowserBase||!e.config.uatraits.isMobile)&&"safari"===e.config.uatraits.BrowserBase.toLowerCase(),n=e.isGeolocation&&(0===e.index||e.isLast)?c.d({type:"service",name:"my-location",size:"small"},e.config):void 0,o={index:String(e.index),last:e.isLast};return n?i.createElement(s.a,{url:n,className:l(Object(r.a)(Object(r.a)({},o),{},{geolocation:!0}))}):i.createElement("div",{className:l(Object(r.a)(Object(r.a)({},o),{},{animated:e.focused&&!t,disabled:e.disabled,activated:e.activated}))})},t}(i.Component);t.a=Object(u.b)(d)},1020:function(e,t,n){"use strict";n(1541);var r=n(4),o=n(7),i=Object(o.a)("route-warning-view");t.a=function(e){var t=e.type;return r.createElement("div",{className:i({type:t})})}},1021:function(e,t,n){"use strict";var r=n(6),o=(n(1558),n(4)),i=n(7),a=Object(i.a)("masstransit-route-alert-view"),s=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){var e,t=this.props.alert;return t.closedUntil?e=(function(params){return "Ходит с "+params.time;})({time:t.closedUntil.time.text}):t.lastTrip?e=(function(params){return "Ходит до "+params.time;})({time:t.lastTrip.time.text}):t.closed?e="Сегодня не ходит":t.text&&(e=t.text),o.createElement("div",{className:a()},e)},t}(o.Component);t.a=s},1022:function(e,t,n){"use strict";var r=n(6),o=n(4),i=n(9),a=n(282),s=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._shouldBannerBeRendered=function(){return!t.props.error&&!t.props.config.hideAdverts},t._getBannerId=function(){var e=t.props,n=e.config,r=e.detailed?"detailedRoute":e.travelMode;return n.banner&&n.banner.blockIds[r]||null},t}return Object(r.a)(t,e),t.prototype.render=function(){var e,t=this.props,n=this._getBannerId();return this._shouldBannerBeRendered()&&n?o.createElement(a.a,{bannerId:n,bannerStyle:(e=!1,{borderTop:"8px solid #eee",backgroundColor:"#fff",padding:e?"16px":0})},t.children):t.children},t}(o.Component);t.a=Object(i.b)(s)},103:function(e,t,n){},105:function(e,t,n){},112:function(e,t,n){"use strict";t.a=function(e){return e}},1141:function(e,t,n){"use strict";var r=n(6),o=(n(1535),n(1537),n(4)),i=n(7),a=n(9),s=(n(1539),n(1020)),c=n(43),u=(n(1543),n(11)),l=n(1545),d=n.n(l),p=n(1546),m=n.n(p),f=n(1547),v=n.n(f),g=Object(i.a)("route-informers-view"),h=function(e){var t=e.hasAutoRoad,n=e.hasBicycleRoad;return t||n||e.stairsCount?o.createElement("div",{className:g()},t?o.createElement("div",{className:g("item")},o.createElement(u.a,{url:d.a,className:g("icon")}),o.createElement("div",{className:g("text")},"Автодорога")):null,n?o.createElement("div",{className:g("item")},o.createElement(u.a,{url:m.a,className:g("icon")}),o.createElement("div",{className:g("text")},"Велодорожка")):null,e.stairsCount?o.createElement("div",{className:g("item")},o.createElement(u.a,{url:v.a,className:g("icon")}),o.createElement("div",{className:g("text")},(function(params){return params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "лестница" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "лестницы" : "лестниц"));})({count:e.stairsCount}))):null):null},b=n(605),_=n(69),y=Object(i.a)("bicycle-route-snippet-view"),E=Object(a.b)(function(e){var t=e.route,n=_.q(t.duration,e.config),r=t.distance.text,i=t.flags.requiresAccessPass,a=_.H(t.constructions);return o.createElement("div",{className:y()},o.createElement("div",{className:y("route-title")},o.createElement("div",{className:y("route-title-primary")},n),o.createElement("div",{className:y("route-title-secondary")},r),e.onFeedbackClick?o.createElement("div",{className:y("feedback")},o.createElement(b.a,{route:t,onClick:e.onFeedbackClick})):null,i?o.createElement(c.a,{position:["bottom","right"],text:"Ведёт на закрытую территорию"},o.createElement(s.a,{type:"barrier"})):null),o.createElement(h,{hasAutoRoad:t.flags.hasAutoRoad,hasBicycleRoad:t.flags.hasBicycleRoad,stairsCount:a}))}),S=n(1551),R=n(10),C=(n(1556),n(8)),I=n(257),k=n(32),P=n(47),O=n(48),T=n(1021),x=n(36),w=(n(46),2),N=10,M=3600,j=Object(i.a)("masstransit-route-snippet-view"),A=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onRouteShowDetailsClick=function(e){t.props.onRouteShowDetailsClick&&(e.stopPropagation(),t.props.onRouteShowDetailsClick())},t._getArrivalHint=function(){var e,n,r=t.props,o="metro"!==r.route.type&&r.route.estimation&&r.route.estimation.arrivalTime;if(!o)return null;var i=k.a(new Date(1e3*Number(o.value)),o.tzOffset),a=null===(e=r.route.paths[r.route.paths.length-1].endTime)||void 0===e?void 0:e.tzOffset,s=r.getToday(),c=(null===(n=r.timeDependent)||void 0===n?void 0:n.time)&&new Date(r.timeDependent.time)||s,u=(function(params){return "в "+params.time;})({time:o.text}),l=_.h({text:u,tzOffset:a},r.config,r.route),d=Object(I.a)(s,i)&&Object(I.a)(c,i)?l:Object(P.a)(i,r.config,{isShortMonth:!0})+", "+l;return "Прибытие"+"  "+d},t._getDepartureHint=function(){var e,n=t.props,r="metro"!==n.route.type&&n.route.estimation&&n.route.estimation.departureTime;if(!r)return null;var o=t.props.getToday(),i=(null===(e=n.timeDependent)||void 0===e?void 0:e.time)&&new Date(n.timeDependent.time)||o,a=k.a(new Date(1e3*Number(r.value)),r.tzOffset),s=(function(params){return "в "+params.time;})({time:r.text}),c=Object(I.a)(o,a)&&Object(I.a)(i,a)?s:Object(P.a)(a,n.config,{isShortMonth:!0})+", "+s;return "Выйти"+" "+c},t._getFirstRecommendedTransportAlert=function(e){var t=e.find(function(e){return"collapsed"!==e.type&&"showAlert"in e&&e.showAlert&&e.alert});return t&&"alert"in t&&t.alert||void 0},t._getMetroTransportAlert=function(){var e=t.props.route.paths.reduce(function(e,t){return[].concat(e,t.segments)},[]);return{text:Array.from(new Set(e.map(function(e){var t,n;return[].concat((null===(t=e.firstStopMetroDetails)||void 0===t?void 0:t.metroEvents)||[],(null===(n=e.lastStopMetroDetails)||void 0===n?void 0:n.metroEvents)||[]).map(function(e){return e.title})}).reduce(function(e,t){return[].concat(e,t)}))).join(" • ")}},t._renderSegmentDuration=function(e){return o.createElement("span",{className:j("duration")},_.q(e.duration.value,t.props.config))},t._renderSegmentName=function(e,t){return o.createElement("span",{key:t,className:j("name",{type:e.type}),style:"color"in e?{backgroundColor:e.color,borderColor:e.color}:{}},e.name)},t._renderWaypoint=function(e){var n=t.props;if(!n.waypoints||0===e||e===n.waypoints.length-1)return null;var r=n.waypoints[e];return(null==r?void 0:r.name)?o.createElement(o.Fragment,null,o.createElement("div",{className:j("waypoint")},r.name),o.createElement("div",{className:j("arrow")})):null},t._renderSegment=function(e,n,r){var i,a="underground"===e.type&&"city"in e&&e.city,s=x.d({type:"masstransit",name:e.type+"-"+a,size:"normal"},t.props.config)||x.d({type:"masstransit",name:e.type,size:"normal"},t.props.config),c="showAlert"in e&&e.showAlert;return"collapsed"===e.type?o.createElement("span",{key:n,className:j("segment")},o.createElement("div",{className:j("collapsed")}),o.createElement("div",{className:j("arrow")})):o.createElement(o.Fragment,{key:n},(null===(i=r[n-1])||void 0===i?void 0:i.pathIndex)!==e.pathIndex?t._renderWaypoint(e.pathIndex):null,o.createElement("span",{className:j("segment")},s?o.createElement(u.a,{className:j("icon",{type:e.type,alert:c}),url:s}):null,"walk"===e.type&&0!==e.duration.value?t._renderSegmentDuration(e):null,"name"in e?t._renderSegmentName(e):null,"transports"in e&&e.transports?e.transports.map(t._renderSegmentName):null,"more"in e&&e.more?o.createElement("span",{className:j("more")},"+",e.more):null,o.createElement("div",{className:j("arrow")})))},t._renderAlert=function(e){var n="metro"===t.props.route.type?t._getMetroTransportAlert():B(e)||t._getFirstRecommendedTransportAlert(e);return n?o.createElement("div",{className:j("alert")},o.createElement(T.a,{alert:n})):null},t._renderRouteHint=function(){var e=t.props,n=e.timeDependent&&"departure"===e.timeDependent.type||"masstransit"===e.route.type&&e.route.isIntercityRoute?t._getArrivalHint():t._getDepartureHint();return"metro"===e.route.type&&(n=(function(params){return (params.count?params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "пересадка" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "пересадки" : "пересадок")):"Без пересадок");})({count:e.route.transfersCount})),o.createElement("div",{className:j("route-hint")},n)},t._renderLegend=function(){var e=t.props;if(!("metro"===e.route.type?e.route.transfersCount>0:e.collapsedCard||!e.detailed))return null;var n=F(D(e.route,e.routes));return o.createElement("div",{className:j("legend-wrapper")},o.createElement("div",{className:j("legend")},n.map(t._renderSegment)),t._renderAlert(n),(e.collapsedCard,null))},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props;return o.createElement("div",{className:j({active:e.active,detailed:e.detailed,collapsed:e.collapsedCard})},o.createElement("div",{className:j("route-title")},o.createElement("div",{className:j("route-duration")},_.q(e.route.duration,e.config)),this._renderRouteHint()),this._renderLegend(),o.createElement("div",{className:j("links")},!e.detailed&&"metro"!==e.route.type&&e.active?o.createElement(C.a,{logClick:!0,name:"more",useParentState:!0,nodeState:{active:!0}},o.createElement("div",{onClick:this._onRouteShowDetailsClick,className:j("show-details")},"Посмотреть подробнее")):null,e.onFeedbackClick?o.createElement(b.a,{route:e.route,onClick:e.onFeedbackClick}):null))},t}(o.Component);function D(e,t){var n=_.t(e),r=[];return e.paths.forEach(function(t,o){t.segments.forEach(function(t){var i=t.type;if("walk"===i)r.push({pathIndex:o,type:i,duration:t.duration});else if("transport"===i&&t.transports&&0!==t.transports.length){var a=_.y(t.transports),s=t.transports.every(function(e){var t;return null===(t=e.alert)||void 0===t?void 0:t.closed}),c="metro"===e.type?function(e){return Boolean(e.firstStopMetroDetails&&e.firstStopMetroDetails.metroEvents&&e.firstStopMetroDetails.metroEvents.length>0||e.lastStopMetroDetails&&e.lastStopMetroDetails.metroEvents&&e.lastStopMetroDetails.metroEvents.length>0)}(t):Boolean(a.alert&&n&&n.id===a.id),u=a.type;if("underground"===u)r.push({closed:s,type:u,alert:a.alert,color:a.color,pathIndex:o,name:a.undergroundLineNumber||"",city:a.city,showAlert:c,duration:t.duration});else{var l=t.transports.filter(function(e){return e.id!==a.id}),d=[].concat(l).splice(0,w),p=a.name.length>N||(d||[]).some(function(e){return e.name.length>N});r.push({pathIndex:o,closed:s,alert:a.alert,type:u,name:a.name,color:a.color,showAlert:c,duration:t.duration,transports:p?void 0:d,more:p?l.length:l.length-d.length})}}})}),!("isIntercityRoute"in e&&e.isIntercityRoute)||t&&function(e){for(var t={},n=0;n<e.length;n++){var r=e[n],o="masstransit"===r.type?L(r):r.uuid;if(t[o])return!0;t[o]=!0}return!1}(t)||(r=function(e){if(e.every(function(e){var t,n;return!(null===(t=e.duration)||void 0===t?void 0:t.value)||(null===(n=e.duration)||void 0===n?void 0:n.value)<M}))return e;var t=e.map(function(e){var t,n;return["underground","tramway","funicular"].includes(e.type)||void 0!==(null===(t=e.duration)||void 0===t?void 0:t.value)&&(null===(n=e.duration)||void 0===n?void 0:n.value)<M&&!["train","aero"].includes(e.type)?Object(R.a)(Object(R.a)({},e),{},{type:"collapsed",name:""}):e});return t.some(function(e){return"collapsed"!==e.type})?t:e}(r)),B(r)&&(r=r.map(function(e){return Object(R.a)(Object(R.a)({},e),{},{showAlert:!1})})),r}function F(e){return e.reduce(function(e,t,n,r){return 0===n||"collapsed"!==t.type||"collapsed"!==r[n-1].type?e.concat(t):e},[])}function L(e){return F(D(e)).map(function(e){return("name"in e&&e.name)+","+e.type}).join()}function B(e){var t=e.find(function(e){return"collapsed"!==e.type&&"alert"in e&&e.closed});return t&&"alert"in t?t.alert:void 0}var z=Object(O.b)(Object(a.b)(A)),U=(n(1560),Object(i.a)("pedestrian-route-snippet-view")),W=Object(a.b)(function(e){var t=e.route,n=e.onFeedbackClick,r=e.config,i=_.H(t.constructions);return o.createElement("div",{className:U()},o.createElement("div",{className:U("route-title")},o.createElement("div",{className:U("route-title-primary")},_.q(t.duration,r)),o.createElement("div",{className:U("route-title-secondary")},t.distance.text),n?o.createElement("div",{className:U("feedback")},o.createElement(b.a,{route:t,onClick:n})):null),o.createElement(h,{stairsCount:i}))}),q=(n(1562),n(15)),V=n(22),H=Object(i.a)("taxi-route-snippet-view"),G=function(e){function t(t){var n;return(n=e.call(this,t)||this)._highPriceElement=null,n._toggleHighPricePopup=function(){n.setState({isHighPricePopupShown:!n.state.isHighPricePopupShown})},n._onHighPriceLeave=function(){n.setState({isHighPricePopupShown:!1})},n.state={isHighPricePopupShown:!1},n}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.route.taxiInfo,r=this.state.isHighPricePopupShown;return"time"in n?o.createElement("div",{className:H()},o.createElement("div",{className:H("title")},o.createElement("div",{className:H("price")},n.priceText),o.createElement("div",{className:H("duration")},_.q(n.time,t.config))),o.createElement("div",{className:H("waiting-time")},(function(params){return "Время ожидания "+params.waiting_time+" мин.";})({waiting_time:n.waitingTime})),n.isSurge?o.createElement("div",{onClick:function(e){return e.stopPropagation()}},o.createElement("div",{className:H("high-price"),ref:function(t){e._highPriceElement=t},onMouseLeave:this._onHighPriceLeave,onMouseEnter:this._toggleHighPricePopup,onClick:this._toggleHighPricePopup},"Высокий спрос"),o.createElement(V.a,{isShown:r,getTarget:function(){return e._highPriceElement},position:"bottom",onClose:function(){}},o.createElement("div",{className:H("popup")},o.createElement("div",{className:H("popup-title")},"Тариф временно увеличен"),o.createElement("div",{className:H("popup-text")},"Это вынужденная мера, так как спрос на такси чрезвычайно высок. Она позволит привлечь больше водителей. Вы сможете заказать такси по обычному тарифу, когда спрос уменьшится")))):null,o.createElement("div",{className:H("button"),onClick:function(e){return e.stopPropagation()}},o.createElement(C.a,{name:"get_taxi_button",logClick:!0},o.createElement(q.a,{view:"primary",size:"small",url:n.link,target:"_blank"},"Вызвать такси")))):null},t}(o.Component),K=Object(a.b)(G),J=(n(1564),n(2799)),X=n(59),Y=n(1566),Z=n.n(Y),$=n(1567),Q=n.n($),ee=n(1568),te=n.n(ee),ne=n(1569),re=n.n(ne),oe=n(1570),ie=n.n(oe),ae=n(1571),se=n.n(ae),ce=n(1572),ue=n.n(ce),le=n(1573),de=n.n(le),pe=n(1574),me=n.n(pe),fe=n(1575),ve=n.n(fe),ge=n(1576),he=n.n(ge),be=n(477),_e=n.n(be),ye=n(1577),Ee=n.n(ye),Se=n(1578),Re=n.n(Se),Ce=n(1579),Ie=n.n(Ce),ke=n(1580),Pe=n.n(ke),Oe=Object(i.a)("comparison-route-snippet-view"),Te={bus:Q.a,minibus:te.a,trolleybus:re.a,tramway:ie.a,suburban:se.a,aeroexpress:Pe.a,water:de.a,cable:me.a,funicular:ve.a,underground:he.a,train:se.a,aero:ue.a},xe=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onRouteShowDetailsClick=function(e){t.props.onRouteShowDetailsClick&&(e.stopPropagation(),t.props.onRouteShowDetailsClick())},t._renderCommonView=function(e){var t=e.iconUrl,n=e.titlePrimary,r=e.timeText,i=e.subtitle;return o.createElement("div",{className:Oe()},o.createElement(u.a,{url:t,className:Oe("icon")}),o.createElement("div",{className:Oe("route-title")},o.createElement("div",{className:Oe("route-title-primary")},n),o.createElement("div",{className:Oe("route-time-text")},r)),i?o.createElement("div",{className:Oe("route-subtitle")},i):null)},t._renderPedestrianSnippet=function(e){var n=t.props;return t._renderCommonView({iconUrl:Z.a,titlePrimary:"Пешком",timeText:_.q(e.duration,n.config,!0),subtitle:(function(params){return "Пройти "+params.distance;})({distance:e.distance.text})})},t._renderMasstrasnitSnippet=function(e){var n=t.props,r=e.transfersCount,i=e.totalWalkDistance,a=r>0?(function(params){return params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "пересадка" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "пересадки" : "пересадок"));})({count:r}):"Без пересадок",s=""+(i.value?(function(params){return "пешком "+params.distance;})({distance:i.text}):""),c=a+(s?", "+s:""),u=function(e){var t=_.t(e);if(t){if(e.paths.every(function(e){return e.segments.every(function(e){var n=e.transports&&_.y(e.transports);return"transport"!==e.type||Boolean(n&&n.type===t.type&&n.isMoscowCentralDiameter===t.isMoscowCentralDiameter)})}))return t}return}(e),l=u&&Te[u.type]||Q.a,d=u&&(function(params){return "На "+(function(params){switch (params.type) {case "trolleybus":return "троллейбусе";case "bus":return "автобусе";case "minibus":return "маршрутке";case "tramway":return "трамвае";case "underground":return "метро";case "water":return "пароме";case "funicular":return "фуникулёре";case "cable":return "фуникулёре";case "suburban":return "поезде";case "railway":return "поезде";default: return "транспорте";}}(params));})({type:String(u.type)})||"На транспорте";return o.createElement(o.Fragment,null,t._renderCommonView({titlePrimary:u&&u.isMoscowCentralDiameter?"На МЦД":d,iconUrl:l,timeText:_.q(e.duration,n.config,!0),subtitle:e.isIntercityRoute?void 0:Object(J.a)(c)}),n.active?o.createElement(C.a,{logClick:!0,name:"more",useParentState:!0,nodeState:{active:!0}},o.createElement("div",{onClick:t._onRouteShowDetailsClick,className:Oe("show-details",{comparison:!0})},"Посмотреть подробнее")):null)},t._renderTaxiSnippet=function(e){var n=t.props,r=e.taxiInfo;return"time"in r&&"price"in r&&r.price?o.createElement("div",{className:Oe()},t._renderCommonView({titlePrimary:o.createElement(o.Fragment,null,"На такси",o.createElement("div",{className:Oe("price",{surge:r.isSurge})},"~ "+Object(X.a)({value:r.price,currency:r.currencyCode},n.config.lang)),r.isSurge?o.createElement("div",{className:Oe("surge-icon")},o.createElement(u.a,{url:Re.a})):null),subtitle:(function(params){return "Время ожидания "+params.waiting_time+" мин";})({waiting_time:r.waitingTime}),timeText:_.q(r.time,n.config,!0),iconUrl:_e.a}),n.active?o.createElement(C.a,{name:"get_taxi_button",logClick:!0},o.createElement("a",{className:Oe("open-taxi-link"),href:r.link,target:"_blank"},"Вызвать такси")):null):null},t._renderAutoSnippet=function(e){var n=t.props;return o.createElement(o.Fragment,null,t._renderCommonView({titlePrimary:"На автомобиле",iconUrl:Ee.a,timeText:_.q(e.durationInTraffic,n.config,!0),subtitle:e.distance.text}),n.active?o.createElement(C.a,{logClick:!0,name:"more",useParentState:!0,nodeState:{active:!0}},o.createElement("div",{onClick:t._onRouteShowDetailsClick,className:Oe("show-details")},"Посмотреть подробнее")):null)},t._renderBicycleSnippet=function(e){var n=t.props,r=e.distance.text;return t._renderCommonView({titlePrimary:"На велосипеде",subtitle:(function(params){return "Проехать "+params.distance;})({distance:r}),timeText:_.q(e.duration,n.config,!0),iconUrl:Ie.a})},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props,t=null;switch(e.route.type){case"pedestrian":t=this._renderPedestrianSnippet(e.route);break;case"masstransit":t=this._renderMasstrasnitSnippet(e.route);break;case"taxi":t=this._renderTaxiSnippet(e.route);break;case"auto":t=this._renderAutoSnippet(e.route);break;case"bicycle":t=this._renderBicycleSnippet(e.route)}return o.createElement("div",{className:Oe()},t)},t}(o.Component);var we=Object(a.b)(xe),Ne=(n(1581),n(28)),Me=n(234),je=n(21),Ae=Object(i.a)("route-tip-view"),De=null,Fe={},Le=function(e){function t(t){var n;return(n=e.call(this,t)||this)._recalcPosition=function(){var e=n.props.getTarget();if(e){var t=e.getBoundingClientRect();n.setState({top:t.top})}},n._onClose=function(){n.props.tip&&(Fe[n.props.tip.id]=!0,n._recalcPosition())},n._onAnimationEnd=function(){De=n.props.route.type,n._recalcPosition()},n.state={top:0},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._recalcPosition(),this.props.tip||(De=null),this.props.resizeRef&&this.props.resizeRef(this._recalcPosition)},n.render=function(){var e=this.props;if(!e.tip||!e.tip.displayConditions||Fe[e.tip.id]||"taxi"===e.route.type)return null;var t="number"==typeof e.route.distance?e.route.distance:e.route.distance.value,n=e.route.duration,r=je.x(e.tip.url,{duration:n,distance:t/1e3});return o.createElement(o.Fragment,null,o.createElement(Ne.a,null,o.createElement("div",{className:Ae({"first-show":De!==e.route.type,hidden:e.collapsed}),style:{left:e.tip.displayConditions.display.visiblePxls,top:this.state.top},onAnimationEnd:this._onAnimationEnd},o.createElement("div",{className:Ae("image-click-blocker"),onClick:function(e){return e.stopPropagation()}}),o.createElement(C.a,{name:"routes_tip",logClick:!0,nodeState:e.analyticsState},o.createElement("a",{className:Ae("image"),target:e.tip.target||"_parent",href:r,onClick:this._onClose,style:{backgroundImage:'url("'+e.tip.image+'")'}})),o.createElement(C.a,{name:"routes_tip_close",logClick:!0,nodeState:e.analyticsState},o.createElement("div",{className:Ae("close-button"),onClick:this._onClose})),e.config.query["no-counters"]?null:o.createElement("img",{className:Ae("counter"),src:e.tip.showCounter}))),o.createElement(Me.a,{eventHandler:this._recalcPosition,throttleWait:64}))},t}(o.Component),Be=Object(a.b)(Le),ze=Object(i.a)("route-snippet-view"),Ue=0,We=9999,qe=0,Ve=9999,He=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._node=o.createRef(),t._getRouteTip=function(){var e=t.props,n=e.route;if(!e.detailed&&0===e.index&&n&&e.tip&&"displayConditions"in e.tip&&"duration"in n&&e.tip.displayConditions){var r=e.tip.displayConditions,o=r.distanceStart,i=void 0===o?Ue:o,a=r.distanceEnd,s=void 0===a?We:a,c=r.timeStart,u=void 0===c?qe:c,l=r.timeEnd,d=void 0===l?Ve:l,p="object"==typeof n.distance?n.distance.value:n.distance,m=n.duration;return p>=1e3*i&&p<=1e3*s&&m>=u&&m<=d?e.tip:void 0}},t._onClick=function(){var e=t.props;if(e.onClick&&e.onClick(),e.active&&!e.detailed){if(["pedestrian","bicycle","taxi"].includes(e.route.type))return;e.onRouteShowDetailsClick&&e.onRouteShowDetailsClick()}else e.onRouteClick&&e.onRouteClick()},t._getOnFeedbackClickCallback=function(){var e=t.props;if(e.active&&!e.collapsedCard)return e.onFeedbackClick},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=null;switch(t.route.type){case"auto":n=o.createElement(S.a,{ignoreTrafficJams:t.settings&&t.settings.auto.ignoreTrafficJams,active:Boolean(t.active),detailed:Boolean(t.detailed),route:t.route,onRouteShowDetailsClick:t.onRouteShowDetailsClick,timeDependent:t.settings&&t.settings.auto.timeDependent,onFeedbackClick:this._getOnFeedbackClickCallback()});break;case"metro":case"masstransit":n=o.createElement(z,{timeDependent:t.settings&&t.settings.masstransit.timeDependent,active:Boolean(t.active),detailed:Boolean(t.detailed),collapsedCard:t.collapsedCard,waypoints:t.waypoints,route:t.route,routes:t.routes,onRouteShowDetailsClick:t.onRouteShowDetailsClick,onFeedbackClick:this._getOnFeedbackClickCallback()});break;case"pedestrian":n=o.createElement(W,{route:t.route,onFeedbackClick:this._getOnFeedbackClickCallback()});break;case"taxi":n=o.createElement(o.Fragment,null,t.isTaxiMultiplePoints?o.createElement("div",{className:ze("warning-message",{collapsed:t.collapsedCard})},"Невозможно построить маршрут на такси более, чем через две точки"):null,o.createElement(K,{route:t.route,routeRegion:t.routeRegion}));break;case"bicycle":n=o.createElement(E,{route:t.route,onFeedbackClick:this._getOnFeedbackClickCallback()})}var r=this._getRouteTip();return t.isComparison&&!t.detailed&&"metro"!==t.route.type&&(n=o.createElement(we,{route:t.route,active:t.active,onRouteShowDetailsClick:t.onRouteShowDetailsClick})),o.createElement(o.Fragment,null,o.createElement("div",{className:ze({active:t.active,detailed:t.detailed,collapsed:t.collapsedCard,comparison:t.isComparison,type:t.route.type}),onClick:this._onClick,ref:this._node},n),r&&0===t.index&&"duration"in t.route&&"metro"!==t.route.type?o.createElement(Be,{tip:r,route:t.route,resizeRef:t.resizeRef,getTarget:function(){return e._node.current},collapsed:t.collapsedSidebar,analyticsState:{id:r?r.id:"",type:t.route.type}}):null)},t}(o.Component);t.a=Object(a.b)(He)},118:function(e,t,n){"use strict";var r=n(6),o=n(4),i=n(141),a=n(9),s=n(160),c=n(16),u=n(218),l=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){if(!t.isTimingLogged){var e=this.props,n=e.config.pageMode;"search-result"===e.config.pageMode&&(n="search"),"metro_page"===e.type&&(n="metro"),function(e){switch(e){case"routes_page":return"routes";case"org_page":return"orgpage";case"discovery_page":return"discovery";case"home_page":return"home";case"panorama_page":case"panorama_page_new":return"panoramas";case"photos_page":return"photos";case"search_card_page":case"search_list_page":return"search";case"traffic_page":return"traffic";case"masstransit_stop_page":case"masstransit_route_page":return"masstransit";case"catalog_page":return"catalog";case"metro_page":return"metro"}}(e.type)===n&&(t.isTimingLogged=!0,c.n(Object(u.a)(e.config))||this.setState({ready:i.a.getTimeToNow()}))}},n.render=function(){var e=this.props.type;return"undefined"==typeof window?null:o.createElement(s.a,{type:e,ready:this.state.ready,extraState:{show:window.timingsMarks&&e in window.timingsMarks?window.timingsMarks[e]:this.state.ready}})},t}(o.PureComponent);l.isTimingLogged=!1,t.a=Object(a.b)(l)},120:function(e,t,n){"use strict";var r=n(251),o=n(126),i=1,a=2;var s=function(e,t,n,s){var c=n.length,u=c,l=!s;if(null==e)return!u;for(e=Object(e);c--;){var d=n[c];if(l&&d[2]?d[1]!==e[d[0]]:!(d[0]in e))return!1}for(;++c<u;){var p=(d=n[c])[0],m=e[p],f=d[1];if(l&&d[2]){if(void 0===m&&!(p in e))return!1}else{var v=new r.a;if(s)var g=s(m,f,p,e,t,v);if(!(void 0===g?Object(o.a)(f,m,i|a,s,v):g))return!1}}return!0},c=n(100);var u=function(e){return e==e&&!Object(c.a)(e)},l=n(217);var d=function(e){for(var t=Object(l.a)(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,u(o)]}return t};var p=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}};var m=function(e){var t=d(e);return 1==t.length&&t[0][2]?p(t[0][0],t[0][1]):function(n){return n===e||s(n,e,t)}},f=n(89);var v=function(e,t,n){var r=null==e?void 0:Object(f.a)(e,t);return void 0===r?n:r},g=n(127),h=n(62),b=n(45),_=1,y=2;var E=function(e,t){return Object(h.a)(e)&&u(t)?p(Object(b.a)(e),t):function(n){var r=v(n,e);return void 0===r&&r===t?Object(g.a)(n,e):Object(o.a)(t,r,_|y)}},S=n(112),R=n(44),C=n(231);var I=function(e){return function(t){return Object(f.a)(t,e)}};var k=function(e){return Object(h.a)(e)?Object(C.a)(Object(b.a)(e)):I(e)};t.a=function(e){return"function"==typeof e?e:null==e?S.a:"object"==typeof e?Object(R.a)(e)?E(e[0],e[1]):m(e):k(e)}},124:function(e,t,n){"use strict";var r=n(13),o=n(41),i=n(6),a=n(4),s=n(54),c=n(55),u=n(22),l=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._ref=a.createRef(),t._onMapUpdate=function(){t.forceUpdate()},t}return Object(i.a)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.coordinates,i=Object(o.a)(t,["coordinates"]);return a.createElement(a.Fragment,null,a.createElement(s.a,{coordinates:n,nonInteractive:!0},a.createElement("div",{ref:this._ref}),a.createElement(u.a,Object(r.a)({type:"balloon"},i,{getTarget:function(){return e._ref.current}}),i.children)),a.createElement(c.b,{onUpdate:i.isShown?this._onMapUpdate:void 0}))},t}(a.PureComponent);t.a=l},127:function(e,t,n){"use strict";var r=function(e,t){return null!=e&&t in Object(e)},o=n(83),i=n(145),a=n(44),s=n(122),c=n(219),u=n(45);var l=function(e,t,n){for(var r=-1,l=(t=Object(o.a)(t,e)).length,d=!1;++r<l;){var p=Object(u.a)(t[r]);if(!(d=null!=e&&n(e,p)))break;e=e[p]}return d||++r!=l?d:!!(l=null==e?0:e.length)&&Object(c.a)(l)&&Object(s.a)(p,l)&&(Object(a.a)(e)||Object(i.a)(e))};t.a=function(e,t){return null!=e&&l(e,t,r)}},129:function(e,t,n){"use strict";var r=n(216),o="Expected a function";function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(o);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(i.Cache||r.a),n}i.Cache=r.a,t.a=i},130:function(e,t,n){e.exports=n.p+"_/c6253bebae4891e27181f3a4bb34a342.svg"},143:function(e,t,n){"use strict";var r=n(195),o=n(183),i=n(122),a=n(100);t.a=function(e,t,n){if(!Object(a.a)(n))return!1;var s=typeof t;return!!("number"==s?Object(o.a)(n)&&Object(i.a)(t,n.length):"string"==s&&t in n)&&Object(r.a)(n[t],e)}},1444:function(e,t,n){},1446:function(e,t,n){},1448:function(e,t,n){e.exports=n.p+"_/88dd6621d29f63b3bcd11823a075bab8.svg"},1449:function(e,t,n){e.exports=n.p+"_/982f21b161efbb26f879ac8dcf5bc613.svg"},1450:function(e,t,n){e.exports=n.p+"_/6dfdf3e1f699e358e2a45696b5910bfc.svg"},1451:function(e,t,n){e.exports=n.p+"_/d7eede432ce185c2bcdea2a81dd73d60.svg"},1452:function(e,t,n){},1454:function(e,t,n){e.exports=n.p+"_/af445ec16173f0fa9a696ec6b9f6c7e1.svg"},1455:function(e,t,n){},1457:function(e,t,n){e.exports=n.p+"_/e3fc7b2ee2e8adff5a3cf54a228b18be.svg"},1458:function(e,t,n){e.exports=n.p+"_/f869888cf7cada800b61fc42b9a84b32.svg"},1459:function(e,t,n){},1461:function(e,t,n){"use strict";var r=n(4),o=n(9),i=n(669),a=n(1462),s=n.n(a),c=n(1463),u=n.n(c),l=n(1464),d=n.n(l),p=n(1465),m=n.n(p),f=n(1466),v=n.n(f),g=n(1467),h=n.n(g),b=n(1468),_=n.n(b),y=n(1469),E=n.n(y),S=n(1470),R=n.n(S),C=n(1471),I=n.n(C),k=n(1472),P=n.n(k),O=n(1473),T=n.n(O),x=n(1474),w=n.n(x),N=n(1475),M=n.n(N),j=n(1476),A=n.n(j),D=n(1477),F=n.n(D),L=n(1478),B=n.n(L),z=n(1479),U=n.n(z),W=n(1480),q=n.n(W),V=n(1481),H=n.n(V),G=n(1482),K=n.n(G),J=n(1483),X=n.n(J),Y=n(1484),Z=n.n(Y),$=n(1485),Q=n.n($),ee=n(1486),te=n.n(ee),ne=n(1487),re=n.n(ne),oe=n(1488),ie=n.n(oe),ae=n(1489),se=n.n(ae),ce=n(1490),ue=n.n(ce),le=n(1491),de=n.n(le),pe=n(1492),me=n.n(pe),fe=n(1493),ve=n.n(fe),ge=n(1494),he=n.n(ge),be=n(1495),_e=n.n(be),ye=n(1496),Ee=n.n(ye),Se=n(1497),Re=n.n(Se),Ce=n(1498),Ie=n.n(Ce),ke=n(1499),Pe=n.n(ke),Oe=n(1500),Te=n.n(Oe),xe={start:[s.a],middle:["",u.a,d.a,m.a,v.a,h.a,_.a,E.a,R.a,I.a].concat(new Array(40).fill(H.a)),finish:["",P.a,T.a,w.a,M.a,A.a,F.a,B.a,U.a,q.a].concat(new Array(40).fill(q.a))},we={start:[K.a],middle:["",X.a,Z.a,Q.a,te.a,re.a,ie.a,se.a,ue.a,de.a],finish:["",me.a,ve.a,he.a,_e.a,Ee.a,Re.a,Ie.a,Pe.a,Te.a]};t.a=Object(o.b)(function(e){return e.cursor?r.createElement(i.a,{src:(t=e.cursor,n="MSIE"===e.config.uatraits.BrowserName,o=t.split("_"),a=o[0],s=o[1],c=n?we:xe,c[a][Number(s)]),basePoint:[32,44]}):null;var t,n,o,a,s,c})},1462:function(e,t,n){e.exports=n.p+"_/dff25d38edaaaed43455e2838501c7d2.png"},1463:function(e,t,n){e.exports=n.p+"_/7485047d3440076f2f17ebb52a011c9c.png"},1464:function(e,t,n){e.exports=n.p+"_/9dae14af44a24ba50a1bf841f2d22144.png"},1465:function(e,t,n){e.exports=n.p+"_/9c80a04cdee2564f1b348f2c942570e5.png"},1466:function(e,t,n){e.exports=n.p+"_/db96e0b37fb683edb082b6d22cd47375.png"},1467:function(e,t,n){e.exports=n.p+"_/9d7d9192162a766707427f0fdfad6e69.png"},1468:function(e,t,n){e.exports=n.p+"_/30566ea95b3b85e11fdf731ad19d0cb6.png"},1469:function(e,t,n){e.exports=n.p+"_/00dbdb577dd780ef99cebd89eabff5b0.png"},1470:function(e,t,n){e.exports=n.p+"_/6b36feaa685efb371af0a08ebce07269.png"},1471:function(e,t,n){e.exports=n.p+"_/74ca6ea4b76200fd171c44aa5a49f5a8.png"},1472:function(e,t,n){e.exports=n.p+"_/af158d44913f89ba43eabd0e26e9dda3.png"},1473:function(e,t,n){e.exports=n.p+"_/af158d44913f89ba43eabd0e26e9dda3.png"},1474:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1475:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1476:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1477:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1478:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1479:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1480:function(e,t,n){e.exports=n.p+"_/d3d3e5e71c45bd5a155c12a2f093120e.png"},1481:function(e,t,n){e.exports=n.p+"_/4107b60439ecfb91bb4f01454bb365e2.png"},1482:function(e,t,n){e.exports=n.p+"_/2895c340e20a14b930b3845b0512e44e.cur"},1483:function(e,t,n){e.exports=n.p+"_/a844062a0eaffe10a799d5be71fb1e96.cur"},1484:function(e,t,n){e.exports=n.p+"_/22bb451d564b9bc63fa35e077177f3c8.cur"},1485:function(e,t,n){e.exports=n.p+"_/97eede2c55efe4b62f625f8fe26f1e1b.cur"},1486:function(e,t,n){e.exports=n.p+"_/5580d76e6f3e57b8663342ff80ffdfb3.cur"},1487:function(e,t,n){e.exports=n.p+"_/c4310a3ff1a78554ae4dc8f7b524a6fd.cur"},1488:function(e,t,n){e.exports=n.p+"_/b4c8af6a4e960429e80d5440862372ab.cur"},1489:function(e,t,n){e.exports=n.p+"_/198ed6a9554076fc56a82c0985bb98fd.cur"},1490:function(e,t,n){e.exports=n.p+"_/77f712ffbfcba18db2c8850657e36998.cur"},1491:function(e,t,n){e.exports=n.p+"_/7a98e0d559879b9e47ba3ec591004685.cur"},1492:function(e,t,n){e.exports=n.p+"_/fc4c6835b9205f59246ba944e04a71cc.cur"},1493:function(e,t,n){e.exports=n.p+"_/e668414baaf69c8e7540674ca8275e5b.cur"},1494:function(e,t,n){e.exports=n.p+"_/ba58a27a815fd1343fe2c0d212fdc5d0.cur"},1495:function(e,t,n){e.exports=n.p+"_/2a00c11f7e4c162e1d6e5cedf789a572.cur"},1496:function(e,t,n){e.exports=n.p+"_/cb7500a925481ace5f9623bbc80341e2.cur"},1497:function(e,t,n){e.exports=n.p+"_/d2df2efa984582e486a631772c4b9619.cur"},1498:function(e,t,n){e.exports=n.p+"_/2d1572d9f3a463fbce3127d388c278fe.cur"},1499:function(e,t,n){e.exports=n.p+"_/f94856f86621e22403bd7615c836e5bb.cur"},150:function(e,t,n){},1500:function(e,t,n){e.exports=n.p+"_/aaf3b62ad23c9dd8af58eaa63304d163.cur"},1501:function(e,t,n){},1503:function(e,t,n){},1505:function(e,t,n){"use strict";var r=n(6),o=n(1506),i=n.n(o),a=n(1508),s=n.n(a),c=n(4),u=n.n(c),l=n(7),d=n(165),p=n(0),m=n(84),f=n.n(m),v=n(9),g=n(8),h=n(1510),b=n(1522),_=n(22),y=n(595),E=n(69),S=n(43),R=n(11),C=n(15),I=n(20),k=n(1525),P=n(1528),O=n.n(P),T=n(114),x=n(261),w=n(92),N=n(1529),M=n.n(N),j=Object(I.a)({resolved:{},chunkName:function(){return"dialog"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("dialog").then(n.bind(null,40))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 40}},{ssr:!1}),A=Object(l.a)("route-form-view"),D={main:-15,side:0},F=function(e){function t(t){var n;return(n=e.call(this,t)||this)._ref=c.createRef(),n._pointsElement=null,n._onHistoryPointClick=function(e){var t=n.props;t.setPoint(t.activeField,e),t.setActiveField(E.v(t.routePoints,t.activeField))},n._reversePoints=function(){n._movePoint(0,1)},n._onSubmit=function(e){e.preventDefault()},n._onReset=function(){n.props.resetPoints()},n._onNoLimitClick=function(){n.state.agreementSigned||(n._hideLimitPopup(),n.setState({showAgreementDialog:!0}))},n._onAgreementClick=function(){p.a.set("routes_b2b_agreement",!0),d.a.reachGoal("b2b_route_agreement"),n.state.showAgreementDialog&&n._addPoint(),n._hideAgreementDialog()},n._optimizeRoute=function(){n.props.optimizeRoute(),d.a.reachGoal("b2b_route_optimize")},n._addPoint=function(){n.props.addPoint(),n._isTryingAddB2bPoint()&&n.state.agreementSigned&&d.a.reachGoal("b2b_route_add_point"),n.setState({routePointFieldUuids:n.state.routePointFieldUuids.concat(f.a.v4())})},n._removePoint=function(e){n.setState({routePointFieldUuids:n.state.routePointFieldUuids.slice(0,e).concat(n.state.routePointFieldUuids.slice(e+1))}),n.props.removePoint(e)},n._movePoint=function(e,t){var r=n.state.routePointFieldUuids.slice(),o=r[e];r[e]=r[t],r[t]=o,n.setState({routePointFieldUuids:r}),n.props.movePoint(e,t)},n._isTryingAddB2bPoint=function(){return n._isB2BAvailable()&&n._getWaypoints().length>=n.props.config.routes.maxCount},n._onAddPointButtonClick=function(){n._isTryingAddB2bPoint()?n.props.checkAuthorization("routesB2b",function(){n.state.agreementSigned?n._addPoint():n._showLimitPopup()}):n._addPoint()},n._onPlacesClick=function(e,t){var r=n.props;if(r.places&&r.places.work&&r.places.home&&E.O(e)){var o=[r.places.home,r.places.work];"home"===e&&o.reverse();var i=Boolean(r.routePoints[0].value||r.routePoints[0].coords);o.forEach(function(e,t){var n=e.id,o=e.coords;0===t&&i||r.setPoint(t,{value:T.j(n,r.config),coords:o})})}else r.onActionItemClick(e,t)},n._hideAgreementDialog=function(){n.setState({showAgreementDialog:!1})},n._showLimitPopup=function(){n.setState({showLimitPopup:!0})},n._hideLimitPopup=function(){n.setState({showLimitPopup:!1})},n._isB2BAvailable=function(){var e=n.props;return E.L(e.config)&&"auto"===e.travelMode},n._isOptimizeAvailable=function(){var e=n.props;return["pedestrian","auto","masstransit"].includes(e.travelMode)},n._getWaypoints=function(){var e=n.props;return e.routePoints.filter(function(t,n){return!e.viaIndexes.includes(n)})},n._renderNoLimitButton=function(){return c.createElement(g.a,{name:"link_landing_routing",logClick:!0},c.createElement(C.a,{type:"submit",view:"secondary-blue",size:"small",onClick:n._onNoLimitClick},"Попробовать"))},n._renderAddPointButton=function(){var e=n.state,t=n._isTryingAddB2bPoint()&&n.state.agreementSigned;return c.createElement(c.Fragment,null,c.createElement(g.a,{name:"add_point",nodeState:{b2b:t,pointIndex:n._getWaypoints().length+1,authorized:Boolean(n.props.config.authorization)},logClick:!0},c.createElement("div",{ref:n._ref,className:A("add"),onClick:n._onAddPointButtonClick},"Добавить точку")),c.createElement(_.a,{isShown:e.showLimitPopup,getTarget:function(){return n._ref.current},type:"tooltip",zIndex:300,position:"right-bottom",onClose:n._hideLimitPopup,checkTargetVisibility:!0,offset:D},c.createElement(g.a,{name:"tooltip_by_click",logClick:!0,nodeState:{id:"maxWaypointsOnRoute"}},c.createElement(y.a,{title:"Нужно больше точек?",text:"Попробуйте бесплатную β-версию маршрутов для бизнеса",controls:n._renderNoLimitButton(),onClose:n._hideLimitPopup}))))},n._renderButtons=function(){var e=n.props,t=n.state,r=n._isB2BAvailable()?e.config.routes.maxB2BCount:e.config.routes.maxCount,o=n._getWaypoints();return c.createElement(c.Fragment,null,o.length<r?n._renderAddPointButton():c.createElement("div",{className:A("limit")},c.createElement(g.a,{name:"max_points",nodeState:{travelMode:e.travelMode}},(function(params){return params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "точка" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "точки" : "точек"))+" максимум";})({count:r}))),n._isOptimizeAvailable()&&e.hasRouterResponse&&o.length>=e.config.routes.minOptimizeCount&&o.length<=r?c.createElement(S.a,{text:"Перестроить маршрут оптимальным способом",position:"bottom"},c.createElement(g.a,{name:"optimize",nodeState:{travelMode:e.travelMode,agreementSigned:t.agreementSigned,authorized:Boolean(e.config.authorization)},logClick:!0},c.createElement("div",{className:A("optimize"),onClick:n._optimizeRoute},"Оптимизировать"))):null,c.createElement(j,{isOpen:t.showAgreementDialog,onClose:n._hideAgreementDialog,showCloseButton:!0},c.createElement("div",{className:A("beta")},c.createElement("div",{className:A("beta-icon")},c.createElement(R.a,{url:M.a})),c.createElement("div",{className:A("beta-title")},"Маршруты для бизнеса β"),c.createElement("div",{className:A("beta-description-wrapper")},"Добавьте все точки, которые нужно посетить курьеру, а  мы построим оптимальный маршрут.\n\nβ-версия абсолютно бесплатна, но мы можем связаться с вами для сбора обратной связи по email из профиля."),c.createElement("div",{className:A("beta-button")},c.createElement(g.a,{name:"agree",logClick:!0},c.createElement(C.a,{type:"submit",view:"primary",size:"small",onClick:n._onAgreementClick},"Принять условия и попробовать"))))))},n.state={agreementSigned:!1,showLimitPopup:!1,showAgreementDialog:!1,routePointFieldUuids:n._getWaypoints().map(function(){return f.a.v4()})},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=p.a.get("routes_b2b_agreement")||!1;this.setState({agreementSigned:e,showLimitPopup:this._isB2BAvailable()&&!e&&this._getWaypoints().length>this.props.config.routes.maxCount})},n.componentDidUpdate=function(){var e=p.a.get("routes_b2b_agreement")||!1;e!==this.state.agreementSigned&&this.setState({agreementSigned:e})},n.render=function(){var e=this,t=this.props,n=t.travelMode,r=t.config,o=t.routePoints,i=t.viaIndexes,a=t.activeField,s=t.isFocused,u=t.setPoint,l=t.setActiveField,d=t.setFocused,p=t.setScrollDisabled,m=t.places,f=t.isError,v=t.isLoading,_=t.changeTravelMode,y=t.hasRouterResponse,E=o.filter(function(e,t){return!i.includes(t)}),S=0===E.filter(function(e){return Boolean(e.coords)&&Boolean(e.value)}).length,R=!y&&!v&&!f,C=o.slice(1).every(function(e){return!e.coords});return c.createElement(g.a,{name:"form"},c.createElement("form",{className:A({"optimizing-loading":"loading"===this.props.optimizingStatus}),action:"/",onSubmit:this._onSubmit,onReset:this._onReset},c.createElement(b.a,{travelMode:n,changeTravelMode:_}),c.createElement("div",{className:A("points"),ref:function(t){return e._pointsElement=t}},c.createElement(h.a,{routePoints:o,viaIndexes:i,travelMode:n,activeField:a,isFocused:s,mapLocation:this.props.mapLocation,places:m,optimizingStatus:this.props.optimizingStatus,routePointFieldUuids:this.state.routePointFieldUuids,setGeolocationPoint:this.props.setGeolocationPoint,setPoint:u,removePoint:this._removePoint,setActiveField:l,movePoint:this._movePoint,setFocused:d,getTarget:function(){return e._pointsElement},setScrollDisabled:p,onActionItemClick:this.props.onActionItemClick}),E.length===r.routes.minCount?c.createElement("div",{className:A("reverse",{disabled:S}),onClick:S?void 0:this._reversePoints},c.createElement("div",{className:A("reverse-icon")})):null),c.createElement("div",{className:A("buttons")},this._renderButtons(),c.createElement(g.a,{name:"reset_route",logClick:!0},c.createElement("input",{className:A("reset"),type:"reset",value:"Сбросить"})),c.createElement("input",{className:A("submit"),type:"submit"})),C&&R?c.createElement(k.a,{travelMode:n,firstPoint:o[0],places:m,onClick:function(t){return e._onPlacesClick(t,o.length-1)}}):null,R&&r.bunker.routesNaviPromo?c.createElement(x.a,{id:"navi-promo",view:"blue",size:"s",text:"В дороге важна точность<br/>Возьмите Яндекс.Карты с собой",href:"https://yandex.ru/promo/maps/navi/index?utm_source=web-maps",buttonContent:c.createElement(w.a,{inline:!0,className:A("promo-button-icon"),name:"share",size:24}),icon:c.createElement(w.a,{inline:!0,className:A("promo-icon"),name:"car",size:16})}):null,null))},t}(c.Component);t.a=Object(v.b)(F)},1506:function(e,t,n){},1508:function(e,t,n){},1510:function(e,t,n){"use strict";var r=n(13),o=n(6),i=n(4),a=n(7),s=n(9),c=n(1511),u=n(69),l=Object(a.a)("route-point-fields-view"),d=function(e){function t(t){var n;return(n=e.call(this,t)||this)._fields=[],n._dragged=null,n._draggedFrom=null,n._draggedIndex=-1,n._fakeDraggedShiftX=0,n._fakeDraggedShiftY=0,n._fakeDragged=null,n._refreshMaxCount=function(){var e=n.props,t=u.A(e.travelMode,e.config);t!==n.state.maxCount&&n.setState({maxCount:t})},n._removePoint=function(e,t){var r=n.props.removePoint;n._fields.splice(e,1),r(t)},n._onDragStart=function(e,t,r){var o=window.getSelection&&window.getSelection();if(o&&o.rangeCount>0&&(o.empty?o.empty():o.removeAllRanges&&o.removeAllRanges()),n._dragged=n._fields[r],n._draggedIndex=r,n._dragged){var i=n._dragged.getBoundingClientRect();n._fakeDraggedShiftX=e-i.left,n._fakeDraggedShiftY=t-i.top,n._fakeDragged=n._dragged.cloneNode(!0),n._fakeDragged.classList.add("_draggable"),n._fakeDragged.style.left=e-n._fakeDraggedShiftX+"px",n._fakeDragged.style.top=t-n._fakeDraggedShiftY+"px",n._fakeDragged.style.width=n._dragged.offsetWidth+"px",document.body.appendChild(n._fakeDragged),n._dragged.style.visibility="hidden",n._draggedFrom=n._dragged.nextElementSibling}},n._onDragMove=function(e,t){if(n._dragged&&n._fakeDragged){n._fakeDragged.style.left=e-n._fakeDraggedShiftX+"px",n._fakeDragged.style.top=t-n._fakeDraggedShiftY+"px",n._fakeDragged.style.visibility="hidden";var r=document.elementFromPoint(e,t);n._fakeDragged.style.visibility="visible";var o=n._fields.find(function(e){return Boolean(e&&e.contains(r))});if(o&&o!==n._dragged){var i=o.getBoundingClientRect(),a=i.top,s=i.height,c=t-a;if(!(c<0||c>s)){var u=n._dragged.parentNode;n._draggedIndex=Array.prototype.indexOf.call(u.children,o),c<(0===n._draggedIndex?0:n._draggedIndex===n._fields.length-1?s:s/2)?u.insertBefore(n._dragged,o.nextElementSibling):u.insertBefore(n._dragged,o)}}}},n._onDragEnd=function(){if(n._dragged){n._dragged.style.visibility="visible",n._dragged.parentNode.insertBefore(n._dragged,n._draggedFrom),n._fakeDragged&&(document.body.removeChild(n._fakeDragged),n._fakeDragged=null);var e=n._fields.findIndex(function(e){return e===n._dragged});n._dragged=null,-1!==n._draggedIndex&&e!==n._draggedIndex&&n.props.movePoint(e,n._draggedIndex)}},n._renderFields=function(){var e=n.props,t=e.config,o=e.routePoints,a=e.viaIndexes,s=e.travelMode,l=e.activeField,d=e.isFocused,m=e.setPoint,f=e.setActiveField,v=e.getTarget,g=e.setFocused,h=e.setScrollDisabled,b=e.places,_=e.optimizingStatus;if(!o)return null;var y=o.map(function(e,t){return{point:e,index:t}}).filter(function(e){return!a.includes(e.index)}),E="taxi"===s;return y.map(function(e,a){var s=E&&0!==a&&a!==y.length-1||a>=n.state.maxCount-1&&a!==y.length-1||"loading"===_;return i.createElement(c.a,Object(r.a)({},e.point,{ignoreGeolocationActionItem:y[a-1]&&"geolocation"===y[a-1].point.serviceType,setGeolocationPoint:n.props.setGeolocationPoint,isLast:a===y.length-1,key:a,uuid:n.props.routePointFieldUuids[a],innerRef:function(e){return n._fields[a]=e},position:e.index,index:a,clearRemove:y.length>t.routes.minCount,isFocused:e.index===l&&d,setPoint:m,removePoint:n._removePoint,onDragStart:"loading"!==_?function(e,t){return n._onDragStart(e,t,a)}:p,onDragMove:"loading"!==_?n._onDragMove:p,onDragEnd:"loading"!==_?n._onDragEnd:p,setActiveField:f,setFocused:g,getTarget:v,disabled:s,mapLocation:n.props.mapLocation,nextEmptyFieldIndex:u.v(o,a),setScrollDisabled:h,places:b,onActionItemClick:n.props.onActionItemClick}))})},n.state={maxCount:t.config.routes.maxCount},n}Object(o.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._refreshMaxCount()},n.componentDidUpdate=function(){this._refreshMaxCount()},n.render=function(){return i.createElement("div",{className:l()},i.createElement("div",{className:l("fields")},this._renderFields()))},t}(i.Component);function p(){}t.a=Object(s.b)(d)},1511:function(e,t,n){"use strict";var r=n(13),o=n(10),i=n(6),a=n(1512),s=n.n(a),c=n(4),u=n.n(c),l=n(2796),d=n(2792),p=n(2801),m=n(7),f=n(8),v=n(18),g=n(20),h=n(319),b=n(117),_=n(414),y=n(9),E=n(48),S=n(598),R=n(99),C=n(411),I=n.n(C),k=n(17),P=n(412),O=n(11),T=n(49),x=n(182),w=n(738),N=n(1019),M=n(22),j=n(1518),A=n(739),D=n(1521),F=n.n(D),L=n(69),B=n(32),z=Object(g.a)({resolved:{},chunkName:function(){return"draggable"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("draggable").then(n.bind(null,641))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 641}},{fallback:c.createElement(j.a,{withIcon:!0})}),U=Object(m.a)("route-field-view"),W=200,q=7,V=Object(k.a)(y.b,E.b,P.b,h.b),H=function(e){function t(t){var n;return(n=e.call(this,t)||this)._input=null,n._wrapper=c.createRef(),n._isSuggestMouseDown=!1,n._analyticsRef=c.createRef(),n._suggestAnalyticsRef=c.createRef(),n._clearAnalyticsRef=c.createRef(),n._setFullScreen=function(e){0},n._setGeolocationPoint=function(){var e=n.props;"geolocation"!==e.serviceType||e.coords||n.state.isFullScreen||e.setGeolocationPoint(e.position)},n._onLayoutChange=function(){n.state.isFullScreen&&n._input&&n._input.click()},n._isFinished=function(e){var t=void 0===e?n.props:e,r=t.value,o=t.input;return""!==r&&r===o},n._getValue=function(e){return(void 0===e?n.props:e).input||""},n._isNotSubmitted=function(){var e=n.props,t=e.value,r=e.isFocused,o=""===n._getValue()&&!t;return!n._isFinished()&&!(r||o)},n._loader=function(e,t){return n._isFinished({value:n.props.value,input:e})&&!n.state.isFullScreen?Promise.resolve({items:[]}):n._suggestLoader(e,t)},n._emitLoader=function(){I()(function(){return n._input&&n._input.click()})},n._suggestLoader=function(e,t){var r=n.props,o=""===e,i=r.config.experiments.ui.routeSuggestHistory,a=r.config.experiments.ui.routeSuggestGeosearchAndHistory,s=!i||!o,c=B.g(n.props.timeContext).getTime()+"_"+Math.floor(1e6*Math.random()),u={search_type:"all",part:e,pos:t,ll:Object(l.a)(r.mapLocation.center),zero_suggest_personal:"house_work",origin:"maps-route",client_reqid:c};s&&n._analyticsRef.current&&n._analyticsRef.current.logEvent("request",{part:e,client_reqid:c});var m=[s?_.a.fetch(u,n.props.config):Promise.resolve(void 0),(a||i)&&o?L.W.getRecords(n.props.config):Promise.resolve(void 0)];return Promise.all(m).then(function(t){var s=t[0],u=t[1],l=[].concat((null==s?void 0:s.results)||[]);if(o){var m,f=n._getActionItems();if(u&&u.length>0){var v=0===r.index?"from":"to",g=Object(p.a)(u.map(function(e){return e[v]}),function(e,t){return e.title===t.title&&e.description===t.description}).map(function(e){return{type:"history",text:e.title,title:{text:e.title},subtitle:{text:e.description},coordinates:e.coordinates}}).filter(function(e){return!f.find(function(t){return t.coordinates&&e.coordinates&&Object(d.a)(t.coordinates,e.coordinates)})});if(i)l=g;else if(a){var h;(h=l).push.apply(h,g)}l=l.slice(0,q)}if(l)(m=l).unshift.apply(m,f)}return{items:l,rawResponse:{part:(null==s?void 0:s.part)||e,results:(null==s?void 0:s.results)||[],suggest_reqid:(null==s?void 0:s.suggest_reqid)||"",client_reqid:c,isZeroSuggest:o}}})},n._fetchSearch=function(e,t){var r={center:n.props.mapLocation.center,span:n.props.mapLocation.span,count:20,clientUsecase:"router",origin:"router",snippets:["route_point/1.x","experimental/1.x"],type:["biz","geo"]},i=t&&T.k(t)&&T.e(t),a=i?{text:Object(l.a)(i,{reverse:!0}),type:["geo"]}:t?{uri:t}:{text:e};return R.a.fetch(Object(o.a)(Object(o.a)({},r),a),n.props.config)},n._searchLoader=function(){var e=n.state.searchResponse;if(!e)return Promise.resolve({items:[]});var t=e.items.filter(function(t,n){return"single"!==e.displayType||0===n}).map(function(e){return{type:"business",text:e.title||"",title:{text:"shortTitle"in e&&e.shortTitle||e.title||""},subtitle:{text:e.description||""},uri:e.uri,tags:"business"===e.type&&e.categories?e.categories.reduce(function(e,t){return t.class?e.concat(t.class):e},[]):void 0,result:e}});return Promise.resolve({items:t})},n._submitSuggest=function(e,t,r){n._getValue()!==e&&n.props.setPoint(n.props.position,{input:e,value:n.props.value,coords:n.props.coords});var o=e.trim();o&&(n.state.searchResponse?n._emitLoader():(n._logEvent(o,r),n._searchAction=v.a.create(n._fetchSearch(o,t),{success:function(e){if(1===e.items.length||"single"===e.displayType)return n._updatePoint(e.items[0]),void n._blurInput();n.setState({searchResponse:e},n._emitLoader)}})))},n._resetSearch=function(){v.a.cancel(n._searchAction),n.state.searchResponse&&n.setState({searchResponse:void 0})},n._updatePoint=function(e){n._resetSearch();var t=e.title,r=e.displayCoordinates;n.props.setPoint(n.props.position,{input:t,value:t,coords:r,searchResult:e})},n._onWindowMouseUp=function(){n._isSuggestMouseDown=!1},n._onWindowBlur=function(){window.document.activeElement===n._input&&n._blurInput()},n._blurInput=function(){n._input&&n._input.blur(),n.props.setActiveField(n.props.nextEmptyFieldIndex),n._setFullScreen(!1)},n._onResponseSuccess=function(e){0!==e.groups.reduce(function(e,t){return e+t.items.length},0)&&n.props.setScrollDisabled(!0)},n._onSelect=function(e,t){var r=t.value,o=r&&"tags"in r&&r.tags&&r.tags.find(function(e){return K(e)}),i=r&&K(r.type)?r.type:o;if(i)return n._setFullScreen(!1),void n.props.onActionItemClick(i,n.props.index);var a=t.data&&t.data.rawResponse&&"suggest_reqid"in t.data.rawResponse&&t.data.rawResponse.suggest_reqid||void 0,s=a||"history"===(null==r?void 0:r.type);return r&&n._suggestAnalyticsRef.current&&s?n._suggestAnalyticsRef.current.logEvent("click",{suggest_log_id:"log_id"in r?"string"==typeof r.log_id?r.log_id:JSON.stringify(r.log_id):void 0,suggest_reqid:a,index:n.props.index,suggestItemIndex:t.itemIndex}):"enter"===t.type&&n._logEvent(e,t.type),r&&"history"===r.type&&r.coordinates?(n.props.setPoint(n.props.position,{input:r.text,value:r.text,coords:r.coordinates}),void n._blurInput()):r&&"result"in r&&r.result?(n._updatePoint(r.result),void n._blurInput()):void n._submitSuggest(e,r&&"uri"in r&&r.uri||null,t.type)},n._logEvent=function(e,t){n._analyticsRef.current&&n._analyticsRef.current.logEvent(t,{initial_query:e})},n._getActionItems=function(){var e=n.props,t=[];return e.ignoreGeolocationActionItem||t.push(w.a.GEOLOCATION),e.places?t.push(e.places[x.a.HOME_ID]?w.a.HOME:w.a.ADD_HOME,e.places[x.a.WORK_ID]?w.a.WORK:w.a.ADD_WORK):e.config.authorization||t.push(w.a.UNAUTH_HOME,w.a.UNAUTH_WORK),t.map(function(t){return{type:t,text:e.places&&Object(w.c)(t,e.places)||"",coordinates:e.places&&Object(w.d)(t,e.places)||void 0}})},n._onChange=function(e,t){var r=(t||{}).reason;"arrow"!==r&&n._resetSearch();var o="clear"===r;o?(n._clearAnalyticsRef.current.logEvent("click"),n.props.setScrollDisabled(!1),n.props.clearRemove?(n.props.removePoint(n.props.index,n.props.position),n.props.setActiveField(n.props.isLast?n.props.index-1:n.props.index)):(n.props.setPoint(n.props.position),n.props.setActiveField(n.props.index))):n.props.setPoint(n.props.position,{input:e,value:n.props.value,coords:n.props.coords}),"arrow"===r||o||n.state.isFullScreen||n._setFullScreen(!0)},n._onClick=function(e){var t=n._input&&e.target&&n._input.contains(e.target);!n.state.isFullScreen&&t&&n._setFullScreen(!0)},n._onSearchClick=function(){n._submitSuggest(n._getValue(),null,"enter")},n._onTab=function(){""===n.props.input&&n.props.value&&n.props.setPoint(n.props.position)},n._fieldRef=function(e){n._input=e},n._onFocus=function(){n.props.setActiveField(n.props.position),n.props.setFocused(!0)},n._onBlur=function(){n._isSuggestMouseDown||n.props.setFocused(!1),n.props.setScrollDisabled(!1)},n._getClientXY=function(e){return{clientX:"clientX"in e?e.clientX:e.touches[0].clientX,clientY:"clientY"in e?e.clientY:e.touches[0].clientY}},n._onDragStart=function(e){e.stopPropagation();var t=n._getClientXY(e);n.props.setFocused(!1),n.props.onDragStart(t.clientX,t.clientY)},n._onDragMove=function(e){e.stopPropagation();var t=n._getClientXY(e);n.props.onDragMove(t.clientX,t.clientY)},n._onFullScreenCancelClick=function(){n._setFullScreen(!1)},n._mapItemToString=function(e){return"toponym"===e.type&&e.title?e.title.text.trim():e.text&&e.text.trim()||""},n._renderDropItem=function(e){var t=e.content;return G(t)?c.createElement(w.b,Object(r.a)({},e,{key:t.type,type:t.type,places:n.props.places,hovered:e.selected})):c.createElement(S.a,Object(r.a)({},e,{type:t.type,tags:"tags"in t&&t.tags?t.tags:[],title:t.title,subtitle:t.subtitle}))},n._renderSearchIcon=function(){return""!==n._getValue()&&n.props.isFocused?c.createElement(f.a,{key:"search",name:"search",logClick:!0},c.createElement(O.a,{className:U("search"),url:F.a,onClick:n._onSearchClick})):null},n._renderFullScreenCancel=function(){return c.createElement("div",{className:U("full-screen-cancel"),onClick:n._onFullScreenCancelClick},"Отмена")},n._renderDragHandler=function(){return n.props.clearRemove?c.createElement(z,{onStart:n._onDragStart,onDrag:n._onDragMove,onStop:n.props.onDragEnd},c.createElement("div",null,c.createElement(j.a,{withIcon:!0}))):c.createElement(j.a,null)},n._renderDropWrapper=function(e,t){var r,o=t.groups.reduce(function(e,t){return e.concat(t.items)},[]),i=o.filter(function(e){return G(e)}),a=o.filter(function(e){return"history"===e.type}),s=o.filter(function(e){return"history"!==e.type&&!G(e)}),u=t.rawResponse&&"suggest_reqid"in t.rawResponse&&t.rawResponse.suggest_reqid||void 0,l=!u;return c.createElement(f.a,{key:l?"client":u,name:l?"client_suggest":"suggest",nodeState:{suggestMode:(null===(r=t.rawResponse)||void 0===r?void 0:r.isZeroSuggest)?"zero":"geosearch",suggestItemsCount:{action:(i||[]).length,geosearch:(s||[]).length,historical:(a||[]).length},query:n._getValue(),suggest_reqid:u,client_reqid:t.rawResponse&&"client_reqid"in t.rawResponse&&t.rawResponse.client_reqid||void 0,length:o.length,index:n.props.index},nodeRef:n._suggestAnalyticsRef},e)},n._renderWaypointIcon=function(){var e=n.props,t=""===n._getValue(),r=!e.isFocused&&!t&&e.value===n._getValue();return c.createElement("div",{className:U("icon")},c.createElement(N.a,{isGeolocation:"geolocation"===e.serviceType,index:e.index,isLast:e.isLast,activated:r,focused:e.isFocused,disabled:e.disabled||n._isNotSubmitted()}))},n._renderWrapper=function(){var e=n.props,t=n.state,r=n._getValue(),o=""===r,i=e.isFocused||e.config.uatraits.isMobile?"always":"hover";return c.createElement("div",{className:U("wrapper"),ref:n._wrapper},c.createElement(f.a,{name:"input_clear",nodeState:{mode:e.clearRemove?"remove":"clear",indexField:e.index},nodeRef:n._clearAnalyticsRef}),c.createElement(A.a,{isFullScreen:t.isFullScreen||!1,renderLeftIcon:n._renderWaypointIcon,renderRightIcon:t.isFullScreen?n._renderFullScreenCancel:n._renderDragHandler,tabIndex:e.config.uatraits.isMobile?-1:void 0,isPhone:!1,value:"geolocation"===e.serviceType&&t.isFullScreen?"":r,view:"filled",renderDropWrapper:n._renderDropWrapper,placeholder:0===e.index?"Откуда":e.isLast?"Куда":"Промежуточная точка",showClear:e.clearRemove?i:!o&&i,rightIcons:[n._renderSearchIcon()],selectOnFocus:!1,onMouseDown:function(){return n._isSuggestMouseDown=!0},renderDropItem:n._renderDropItem,mapItemToString:n._mapItemToString,loader:n.state.searchResponse?n._searchLoader:n._loader,onSelect:n._onSelect,onChange:n._onChange,onClick:n._onClick,onTab:n._onTab,renderDropInPopup:!0,requestOnEmpty:!0,fieldRef:n._fieldRef,onFocus:n._onFocus,onBlur:n._onBlur,getTarget:function(){return n._wrapper.current},contentMargin:"4px 0 0",showOnEmpty:!0,showSuggestOnClear:t.isFullScreen,disabled:e.disabled,initialFocus:e.isFocused&&!e.config.uatraits.isMobile,onResponseSuccess:n._onResponseSuccess}),e.isFocused?null:c.createElement(M.a,{isShown:n._isNotSubmitted(),position:"right",getTarget:function(){return n._input},onClose:function(){},arrowOffset:0,type:"error",zIndex:W,checkTargetVisibility:!0},c.createElement("div",{className:U("route-input-error")},"Вы не задали точку маршрута")))},n.state={searchResponse:void 0,isFullScreen:!1},n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){0},n.componentDidUpdate=function(e){var t=this.props;e.isFocused||!t.isFocused||t.config.uatraits.isMobile||this._input.focus();var n=this._getValue(t),r=this._getValue(e);!n&&r&&this._resetSearch()},n.componentWillUnmount=function(){v.a.cancel(this._searchAction)},n.render=function(){var e=this.props,t=this._isNotSubmitted();return c.createElement("div",{className:U({disabled:e.disabled,"not-submitted":t,index:String(e.index)}),ref:e.innerRef},c.createElement(f.a,{name:"waypoint",nodeRef:this._analyticsRef,nodeState:{position:e.position,coords:e.coords||void 0,value:e.value||void 0,incomplete:t,uuid:e.uuid}},this._renderWrapper()),c.createElement(b.a,{type:"layout-change",listener:this._onLayoutChange}),c.createElement(b.a,{type:"blur",listener:this._onWindowBlur}),c.createElement(b.a,{type:"mouseup",listener:this._onWindowMouseUp}))},t}(c.Component);function G(e){return K(e.type)}function K(e){return Object.keys(w.a).map(function(e){return w.a[e]}).some(function(t){return e===t})}t.a=V(H)},1512:function(e,t,n){},1514:function(e,t,n){},1516:function(e,t,n){},1518:function(e,t,n){"use strict";n(1519);var r=n(4),o=n(7),i=Object(o.a)("drag-handler-view");t.a=function(e){var t=e.withIcon?r.createElement("div",{className:i("icon")}):null;return r.createElement("div",{className:i()},t)}},1519:function(e,t,n){},152:function(e,t,n){e.exports=n.p+"_/ab65d8cbf4996eb9048efd9031d9f38b.svg"},1521:function(e,t,n){e.exports=n.p+"_/937fb5789e219e8a91c184bf7442ff6a.svg"},1522:function(e,t,n){"use strict";var r=n(6),o=(n(1523),n(4)),i=n(7),a=n(9),s=n(8),c=n(92),u={comparison:"comparison",auto:"car",masstransit:"bus",pedestrian:"pedestrian",taxi:"taxi",bicycle:"bikes"},l=Object(i.a)("route-travel-modes-view"),d=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._changeTravelMode=function(e){e!==t.props.travelMode&&t.props.changeTravelMode(e)},t._renderButton=function(e){var t=o.createElement(c.a,{name:u[e],size:24,inline:!0,className:l("icon")});return"comparison"===e?o.createElement("div",{className:l("comparison-button")},t,o.createElement("span",{className:l("comparison-button-text")},"Все")):t},t._renderTravelModeButton=function(e){var n=t.props;return o.createElement("div",{className:l("mode",{mode:e,checked:n.travelMode===e}),onClick:function(){return t._changeTravelMode(e)}},t._renderButton(e))},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.config,r=t.travelMode,i=["comparison","auto","masstransit","pedestrian","bicycle"];return n.enableTaxi&&i.push("taxi"),o.createElement(s.a,{name:"travel_modes",nodeState:{type:r}},o.createElement("div",{className:l()},i.map(function(t){return o.createElement(s.a,{key:t,name:t,nodeState:{checked:r===t},logClick:r!==t},e._renderTravelModeButton(t))})))},t}(o.Component);t.a=Object(a.b)(d)},1523:function(e,t,n){},1525:function(e,t,n){"use strict";var r=n(6),o=(n(1526),n(4)),i=n(2798),a=n(8),s=n(7),c=n(18),u=n(11),l=n(9),d=n(738),p=n(36),m=n(182),f=n(458),v=n(69),g=Object(s.a)("route-home-work-view"),h=function(e){function t(t){var n;return(n=e.call(this,t)||this)._getSummaryParams=function(e){if(!e.firstPoint||!e.firstPoint.coords||!e.places)return{};var t=n._getItems(),r=e.places[m.a.HOME_ID],o=r&&t.includes(d.a.HOME)?[e.firstPoint,{coords:r.coords,value:r.addressLine}]:void 0,i=e.places[m.a.WORK_ID],a=i&&t.includes(d.a.WORK)?[e.firstPoint,{coords:i.coords,value:i.addressLine}]:void 0,s="comparison"===e.travelMode?"auto":e.travelMode;return{homeSummaryParams:o&&{rll:o.map(function(e){var t=e.coords;return null==t?void 0:t.join(",")}).join("~"),pctx:v.w(o),type:s},workSummaryParams:a&&{rll:a.map(function(e){var t=e.coords;return null==t?void 0:t.join(",")}).join("~"),pctx:v.w(a),type:s}}},n._loadSummaryInfo=function(e){var t=e.homeSummaryParams,r=e.workSummaryParams;c.a.cancel(n._loadSummaryAction);var o=n.props,i=[t?f.a.getSummary(t,o.config).catch(function(){return null}):Promise.resolve(null),r?f.a.getSummary(r,o.config).catch(function(){return null}):Promise.resolve(null)];n._loadSummaryAction=c.a.create(Promise.all(i),{success:function(e){var t=e[0],r=e[1];n.setState({homeSummaryResponse:t,workSummaryResponse:r})}})},n._getItems=function(){var e=n.props,t=[];if(e.places){var r,o,i=e.places[m.a.HOME_ID],a=e.places[m.a.WORK_ID],s=(null===(r=e.firstPoint)||void 0===r?void 0:r.coords)&&i&&v.S(e.firstPoint.coords,i.coords),c=(null===(o=e.firstPoint)||void 0===o?void 0:o.coords)&&a&&v.S(e.firstPoint.coords,a.coords);s||t.push(i?d.a.HOME:d.a.ADD_HOME),c||t.push(a?d.a.WORK:d.a.ADD_WORK)}else e.config.authorization||(t=[d.a.UNAUTH_HOME,d.a.UNAUTH_WORK]);return t},n._renderItem=function(e,t){var r,i,s=n.props,c=n.state,l=Object(d.e)(e),m=l&&p.d({type:"service",name:l,size:"small"},s.config),f=function(e,t){switch(e){case d.a.HOME:return "Домой";case d.a.ADD_HOME:case d.a.UNAUTH_HOME:return "Дом";case d.a.WORK:return "На работу";case d.a.ADD_WORK:case d.a.UNAUTH_WORK:return "Работа";default:return""}}(e,s.config),v=s.places&&Object(d.c)(e,s.places),h=Object(d.f)(e)&&"Добавить адрес"||e===d.a.HOME&&(null===(r=c.homeSummaryResponse)||void 0===r?void 0:r.time.text)||e===d.a.WORK&&(null===(i=c.workSummaryResponse)||void 0===i?void 0:i.time.text);return o.createElement(a.a,{name:"home_work",nodeState:{type:e},logClick:!0,key:t},o.createElement("div",{className:g("item"),onClick:function(){return s.onClick(e)}},o.createElement("div",{className:g("icon-wrapper")},m?o.createElement(u.a,{url:m}):null),o.createElement("div",{className:g("title-container")},o.createElement("div",{className:g("title")},f),v?o.createElement("div",{className:g("subtitle")},v):null),h?o.createElement("div",{className:g("extra-text")},h):null))},n.state={homeSummaryResponse:null,workSummaryResponse:null},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._loadSummaryInfo(this._getSummaryParams(this.props))},n.componentDidUpdate=function(e){var t=this.props,n=this._getSummaryParams(e),r=this._getSummaryParams(t);Object(i.a)(n,r)||this._loadSummaryInfo(r)},n.componentWillUnmount=function(){c.a.cancel(this._loadSummaryAction)},n.render=function(){var e=this._getItems();return 0===e.length?null:o.createElement("div",{className:g()},e.map(this._renderItem))},t}(o.Component);t.a=Object(l.b)(h)},1526:function(e,t,n){},1528:function(e,t){},1529:function(e,t,n){e.exports=n.p+"_/4db6e4bed395f2a810009a33f45ca5b9.svg"},1530:function(e,t,n){"use strict";var r=n(10),o=n(6),i=n(1531),a=n.n(i),s=n(1533),c=n.n(s),u=n(4),l=n.n(u),d=n(2800),p=n(257),m=n(0),f=n(20),v=n(7),g=n(9),h=n(48),b=n(8),_=n(1141),y=n(417),E=n(1583),S=n(1587),R=n(263),C=n(11),I=n(222),k=n(85),P=n(32),O=n(47),T=n(39),x=n(15),w=n(69),N=n(88),M=n(324),j=n(1590),A=n.n(j),D=Object(f.a)({resolved:{},chunkName:function(){return"tooltip"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("tooltip").then(n.bind(null,271))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 271}}),F=Object(f.a)({resolved:{},chunkName:function(){return"emergency"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("emergency").then(n.bind(null,166))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 166}},{ssr:!1}),L=64,B=1,z=6,U=3,W=Object(v.a)("route-list-view"),q=function(e){function t(t){var n;return(n=e.call(this,t)||this)._resizeRef=null,n._showCargoPopup=function(){var e=n.props;if("auto"===e.travelMode){var t=m.a.get("routes_cargo_timestamp")||void 0,r=Object(M.c)(e.travelMode,e.settings)>0&&(!t||!Object(p.a)(Number(t),n.props.getToday()));n.setState({showCargoPopup:r}),r&&m.a.set("routes_cargo_timestamp",String(n.props.getToday().getTime()))}},n._hasIntercityRoute=function(){return Boolean(n.props.routerResponse&&n.props.routerResponse.routes.find(function(e){return"masstransit"===e.type&&e.isIntercityRoute}))},n._switchSettingsOpenState=function(){var e;n.setState({settingsOpenByTravelMode:Object(r.a)(Object(r.a)({},n.state.settingsOpenByTravelMode),{},(e={},e[n.props.travelMode]=!n.state.settingsOpenByTravelMode[n.props.travelMode],e))})},n._closeWarning=function(){n.setState({isWarningClose:!0})},n._getChangedSettings=function(){var e=n.props;switch(e.travelMode){case"auto":var t=[].concat(e.settings[e.travelMode].avoid);return e.settings[e.travelMode].ignoreTrafficJams&&t.push("ignoreTrafficJams"),t;case"masstransit":var r=e.settings[e.travelMode].avoidTypes;return r.length===w.b.length?[]:r;default:return[]}},n._onRouteClick=function(e){var t=n.props,r=t.activeRouteIndex,o=t.setActiveRouteIndex,i=t.setActiveComparisonMode;if(n.props.routerResponse){var a=n.props.routerResponse.routes[e].type;e!==r&&(o(e),"comparison"===n.props.travelMode&&i(a))}},n._onRouteShowDetailsClick=function(e){var t=n.props,r=t.detailedIndex,o=t.setDetailedIndex;r!==e&&o(e)},n._onMoreRouteClick=function(){n.props.showMoreSnipets()},n._onResize=function(){n._resizeRef&&n._resizeRef()},n._renderTravelRouteView=function(e,t){var r,o,i,a=n.props,s=a.activeRouteIndex,c=a.onEditClick,l=a.travelMode,d=a.tip,p=a.collapsedSidebar,m=a.settings,f=a.routeRegion,v=a.optimizingStatus,g=a.routePoints,h=s===t&&"taxi"!==l&&("comparison"!==l||!0),y=!["bicycle","pedestrian"].includes(l);if("taxi"===e.type&&"time"in e.taxiInfo)i={type:"taxi",time:60*e.taxiInfo.time,distance:e.taxiInfo.distance};else if("taxi"!==e.type){var E="comparison"===l,S=Object(M.c)(l,m);i={isComparison:Boolean(E),position:t,isOptimized:v?"success"===v:void 0,type:"comparison"===l?e.type:l,active:h,time:"durationInTraffic"in e&&e.durationInTraffic||e.duration,distance:e.distance.value,isCargo:S>0,cargoSettings:S>0?m.auto.cargo:void 0,isIntercityRoute:Boolean("isIntercityRoute"in e&&e.isIntercityRoute)}}var R="taxi"===l&&g.length>2;return u.createElement(b.a,{name:"route",logClick:y||!h,nodeState:i,key:e.uuid||t},u.createElement(_.a,{active:h,route:e,routes:null===(r=n.props.routerResponse)||void 0===r?void 0:r.routes,waypoints:null===(o=n.props.routerResponse)||void 0===o?void 0:o.waypoints,routeRegion:f,index:t,tip:d,resizeRef:function(e){return n._resizeRef=e},collapsedSidebar:p,isComparison:"comparison"===l,isTaxiMultiplePoints:R,settings:m,onFeedbackClick:c,onRouteClick:function(){return n._onRouteClick(t)},onRouteShowDetailsClick:function(){return n._onRouteShowDetailsClick(t)}}))},n._renderWarning=function(){return n.state.isWarningClose?null:u.createElement("div",{className:W("warning")},u.createElement(I.a,{view:"info",analyticsType:"matched_routes",rightSlot:u.createElement(b.a,{name:"close",logClick:!0},u.createElement("span",{onClick:function(){return n._closeWarning()}},"Ок"))},"Полностью подходящих маршрутов не нашлось. Есть варианты проезда, соответствующие не всем параметрам."))},n._renderNotMatchFilterTitle=function(){return u.createElement("div",{key:"title",className:W("without-parameters")},"Без учета параметров")},n._renderFilteredRoutes=function(e){var t=n.props,r=e.filter(function(e){return e.matchFilter}),o=e.filter(function(e){return!e.matchFilter}),i=[].concat(r,o),a=i.map(n._renderTravelRouteView),s=r.length>0&&r.length<=U?r.length:U,c=a.slice(0,s),l=a.slice(s);1===l.length&&(c.push(l[0]),l=[]);var d=l.length>0&&r.length>0&&r.length!==i.length?r.length-s:void 0;return u.createElement(u.Fragment,null,0===r.length?u.createElement(u.Fragment,null,n._renderWarning(),n._renderNotMatchFilterTitle()):null,c,l.length>0?u.createElement(u.Fragment,null,t.moreSnippetsShown?u.createElement(u.Fragment,null,d?u.createElement(u.Fragment,null,l.slice(0,d),n._renderNotMatchFilterTitle(),l.slice(d)):l,n._renderShare()):u.createElement("div",{className:W("more-routes-button")},u.createElement(b.a,{name:"more_routes",nodeState:{counts:l.length,type:t.travelMode},logClick:!0},u.createElement(x.a,{view:"primary",size:"small",onClick:n._onMoreRouteClick},(function(params){return "Ещё "+params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "вариант" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "варианта" : "вариантов"));})({count:l.length}))))):n._renderShare())},n._renderB2BInfo=function(){var e=n.props;return e.optimizingStatus&&"loading"!==e.optimizingStatus?u.createElement("div",{className:W("b2b-info")},u.createElement("div",{className:W("b2b-info-text")},"success"===e.optimizingStatus?"Планируйте оптимальные маршруты для курьеров и контролируйте их выполнение в платной версии":"Маршрут оптимизировать не удалось"),"success"===e.optimizingStatus?u.createElement("div",{className:W("b2b-info-link-wrapper")},u.createElement("a",{target:"_blank",href:e.config.routesB2BUrl,className:W("b2b-info-link")},"Подробнее")):null,u.createElement(C.a,{url:A.a,className:W("b2b-info-close"),onClick:function(){return e.setOptimizingStatus(void 0)}})):null},n._renderRoutesComparisonView=function(){var e=n.props,t=e.routerResponse&&e.routerResponse.routes;return t?t.map(n._renderTravelRouteView):null},n._renderRouteView=function(){var e=n.props;switch(e.travelMode){case"comparison":return n._renderRoutesComparisonView();case"auto":case"masstransit":return!e.routerResponse||"auto"!==e.routerResponse.type&&"masstransit"!==e.routerResponse.type?null:n._renderFilteredRoutes(e.routerResponse.routes);default:return(e.routerResponse&&e.routerResponse.routes||[]).map(n._renderTravelRouteView)}},n._renderSettingsButton=function(){var e=n.props,t=n.state,r=Object(M.c)(e.travelMode,e.settings),o="auto"===e.travelMode?e.settings.auto.avoid.length+Number(e.settings.auto.ignoreTrafficJams)+r:w.b.length-e.settings.masstransit.avoidTypes.length,i=Boolean(n.state.settingsOpenByTravelMode[e.travelMode]),a=u.createElement(b.a,{name:"filter_settings",logClick:!0,nodeState:{active:i}},u.createElement("div",{className:W("settings"),onClick:n._switchSettingsOpenState},"Параметры",0!==o?u.createElement("div",{className:W("settings-count",{disabled:n._hasIntercityRoute()})},o):null,u.createElement(N.a,{isFlipped:i})));return t.showCargoPopup&&"masstransit"!==e.travelMode?u.createElement(D,{id:"cargo_set",position:"right-bottom",title:"Заданы параметры грузовика",showOnMobile:!0,checkTargetVisibility:!0,hideForeverOnTargetClick:!1},a):a},n._renderShare=function(){var e,t=n.props,r="taxi"===t.travelMode,o=t.routerResponse&&t.routerResponse.waypoints.map(function(e){return e.coordinates}),i=!r&&!t.isLoading&&o&&o.length>=t.config.routes.minCount&&o.length<=t.config.routes.maxCount,a=null===(e=t.routerResponse)||void 0===e?void 0:e.routes[t.activeRouteIndex],s=a&&"masstransit"===a.type&&a.isIntercityRoute;return i&&o&&!s?u.createElement("div",{className:W("mobile-share")},u.createElement(y.a,{buttonText:"Отправить",openOptions:{type:"route",pushMessage:"Ваш маршрут в Яндекс.Картах",sendParams:{fromCoords:o[0],toCoords:o[o.length-1]}}},"Отправьте этот маршрут на телефон")):null},n._renderSettingsView=function(){var e=n.props,t=null;switch(e.travelMode){case"auto":t=u.createElement(S.a,{settings:e.settings.auto,updateSettings:e.updateSettings});break;case"masstransit":t=u.createElement(E.a,{settings:e.settings.masstransit,updateSettings:e.updateSettings,isIntercityRoute:n._hasIntercityRoute()})}return u.createElement(R.a,{isExpanded:Boolean(n.state.settingsOpenByTravelMode[e.travelMode])},t)},n._renderTimeDependentIncut=function(){var e=n.props;if("auto"!==e.travelMode&&"masstransit"!==e.travelMode)return null;var t=e.settings[e.travelMode].timeDependent,r=t.time&&new Date(t.time),o=t.type,i=u.createElement(b.a,{logClick:!0,name:"time_dependent_incut",nodeState:{type:o}},u.createElement("div",{className:W("time-dependent-incut"),onClick:n._switchSettingsOpenState},(function(params){return (function(params){switch (params.type) {case "arrival":return "Прибытие";case "departure":return "Отправление";}}(params))+(params.date?" "+params.date+",":"")+(params.time?" в "+params.time:" сейчас");})({type:o,date:r&&Object(p.a)(r,n.props.getToday())?void 0:r&&Object(O.a)(r,e.config,{isShortDate:!0,isShortMonth:!0}),time:r?P.h(r.getHours()+":"+r.getMinutes()):void 0}))),a=n.props.getToday().getHours(),s=a>=B&&a<=z,c=e.routerResponse&&"masstransit"===e.routerResponse.type&&(e.routerResponse.routes||[]).some(function(e){return Boolean(e.waitClosedUntil)});return!Boolean(e.settings[e.travelMode].timeDependent.time)&&(s||c)?u.createElement(D,{key:"tooltip",id:"timeDependentNight",position:"right-bottom",title:"Поедете позже?",text:"Можете настроить время отправления и узнать, сколько займёт маршрут в другое время",closeOnOutsideClick:!0,closeOnContentClick:!0},i):i},n.state={settingsOpenByTravelMode:{},isWarningClose:!1,showCargoPopup:!1},n._onResizeThrottled=Object(d.a)(n._onResize,L),n}Object(o.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props;!isNaN(e.activeRouteIndex)&&e.activeRouteIndex>=U&&e.showMoreSnipets(),this._showCargoPopup()},n.componentDidUpdate=function(e){var t=this.props;if(t.routerResponse!==e.routerResponse&&this.setState({isWarningClose:!1}),!isNaN(t.activeRouteIndex)&&t.activeRouteIndex>=U&&t.activeRouteIndex!==e.activeRouteIndex&&t.showMoreSnipets(),"comparison"===t.travelMode&&t.activeRouteIndex!==e.activeRouteIndex&&!t.isLoading){var n=t.routerResponse&&t.routerResponse.routes[t.activeRouteIndex]&&t.routerResponse.routes[t.activeRouteIndex].type;n&&t.updateRoutesComparisonRoute&&t.updateRoutesComparisonRoute(n)}},n.render=function(){var e,t=this.props,n=t.detailedIndex<0&&t.routerResponse&&t.routerResponse.routes.length>0&&["auto","masstransit"].includes(t.travelMode),r=t.routePoints.map(function(e){return e.coords});return u.createElement(b.a,{name:"results",actionSubtreeState:{type:t.travelMode},nodeState:{type:t.travelMode,waypoints:r,changedSettings:this._getChangedSettings().join()||void 0,time:t.settings.masstransit.timeDependent.time,isArrival:"arrival"===t.settings.masstransit.timeDependent.type},key:t.travelMode},u.createElement("div",{className:W({"travel-mode":t.travelMode})},"loading"!==t.optimizingStatus?u.createElement(u.Fragment,null,n?u.createElement("div",{className:W("incut")},this._renderSettingsButton(),this._renderTimeDependentIncut()):null,this._renderSettingsView()):null,u.createElement("div",{className:W("emergency")},u.createElement(F,{notifications:null===(e=t.routerResponse)||void 0===e?void 0:e.notifications})),u.createElement("div",{className:W("list")},t.isLoading?u.createElement("div",{className:W("spinner")},u.createElement(T.a,{view:"large",withoutMargin:!0})):u.createElement(u.Fragment,null,this._renderB2BInfo(),this._renderRouteView())),["auto","masstransit"].includes(t.travelMode)?null:this._renderShare()),u.createElement(k.a,{onResize:this._onResizeThrottled}))},t}(u.Component);t.a=Object(h.b)(Object(g.b)(q))},1531:function(e,t,n){},1533:function(e,t,n){},1535:function(e,t,n){},1537:function(e,t,n){},1539:function(e,t,n){},1541:function(e,t,n){},1543:function(e,t,n){},1545:function(e,t,n){e.exports=n.p+"_/328e1277f536b4bb20314d2eabca1705.svg"},1546:function(e,t,n){e.exports=n.p+"_/73e517049750fe35ffbf65f4f47dac19.svg"},1547:function(e,t,n){e.exports=n.p+"_/5ad67203a366b96d73fc7c9606137d47.svg"},1548:function(e,t,n){},1550:function(e,t,n){e.exports=n.p+"_/26f84abd2ebd7efd1947a1c7334547f1.svg"},1551:function(e,t,n){"use strict";var r=n(6),o=n(1552),i=n.n(o),a=n(1554),s=n.n(a),c=n(4),u=n.n(c),l=n(7),d=n(20),p=n(9),m=n(48),f=n(43),v=n(1020),g=n(8),h=n(47),b=n(32),_=n(257),y=n(69),E=n(605),S=Object(d.a)({resolved:{},chunkName:function(){return"cargo"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("cargo").then(n.bind(null,1113))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 1113}}),R=Object(l.a)("auto-route-snippet-view"),C=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onRouteShowDetailsClick=function(e){t.props.onRouteShowDetailsClick&&(e.stopPropagation(),t.props.onRouteShowDetailsClick())},t._renderArrival=function(){var e=t.props,n=e.timeDependent&&e.timeDependent.time?new Date(e.timeDependent.time):e.getToday(),r=e.route.paths[e.route.paths.length-1].endTime;if(!r)return null;var o=b.a(new Date(1e3*Number(r.value)),r.tzOffset),i=(function(params){return "в "+params.time;})({time:r.text}),a=y.h({text:i,tzOffset:r.tzOffset},e.config,e.route),s=Object(_.a)(n,o)?a:Object(h.a)(o,e.config,{isShortMonth:!0})+", "+a;return c.createElement("div",{className:R("arrival")},"Прибытие"+" "+s)},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.config.tld,n="tolls";e.route.flags.hasTolls&&["tr","com","eu","ua","kz"].includes(t)&&("tr"===t?n="tolls-tr":"com"===t||"eu"===t?n="tolls-com":"ua"===t?n="tolls-ua":"kz"===t&&(n="tolls-kz"));var r=!e.ignoreTrafficJams||e.route.flags.blocked?(function(params){return "Без пробок: "+params.duration;})({duration:y.q(e.route.duration,e.config)}):"Без учета пробок",o=e.ignoreTrafficJams?y.q(e.route.duration,e.config):y.q(e.route.durationInTraffic,e.config);return c.createElement("div",{className:R()},c.createElement("div",{className:R("route-title")},c.createElement("div",{className:R("route-title-primary")},e.route.flags.blocked?"Частично заблокирован":o),c.createElement("div",{className:R("hints")},this._renderArrival(),e.route.flags.blocked?c.createElement(v.a,{type:"blocked"}):null,e.route.flags.requiresAccessPass?c.createElement(f.a,{position:["bottom","right"],text:"Ведёт на закрытую территорию"},c.createElement(v.a,{type:"barrier"})):null,e.route.flags.hasTolls?c.createElement(f.a,{position:["bottom","right"],text:"На маршруте есть платная дорога"},c.createElement(v.a,{type:n})):null,e.route.flags.hasFerries?c.createElement(f.a,{position:["bottom","right"],text:"На маршруте есть паромная переправа"},c.createElement(v.a,{type:"ferries"})):null,e.route.flags.hasFordCrossing?c.createElement(f.a,{position:["bottom","right"],text:" На маршруте есть брод"},c.createElement(v.a,{type:"ford"})):null,e.route.flags.hasRuggedRoads?c.createElement(f.a,{position:["bottom","right"],text:"На маршруте есть неровная дорога"},c.createElement(v.a,{type:"rugged-road"})):null)),c.createElement("div",{className:R("route-subtitle")},e.route.distance.text+", ",c.createElement("span",{className:R("excluding-traffic")},r)),c.createElement(S,{route:e.route,detailed:e.detailed}),c.createElement("div",{className:R("links")},e.active&&!e.detailed?c.createElement(g.a,{logClick:!0,name:"more",useParentState:!0,nodeState:{active:!0}},c.createElement("div",{onClick:this._onRouteShowDetailsClick,className:R("show-details")},"Посмотреть подробнее")):null,e.onFeedbackClick?c.createElement(E.a,{route:e.route,onClick:e.onFeedbackClick}):null))},t}(c.Component);t.a=Object(m.b)(Object(p.b)(C))},1552:function(e,t,n){},1554:function(e,t,n){},1556:function(e,t,n){},1558:function(e,t,n){},1560:function(e,t,n){},1562:function(e,t,n){},1564:function(e,t,n){},1566:function(e,t,n){e.exports=n.p+"_/c96b52518f395e1cba53e98f103ef9a7.svg"},1567:function(e,t,n){e.exports=n.p+"_/0697754e78c31f74a0175a4976680abf.svg"},1568:function(e,t,n){e.exports=n.p+"_/6179ad251dee11f2e08f52ffbcb5018f.svg"},1569:function(e,t,n){e.exports=n.p+"_/3ffdd4ccfb2357ca8ef52c0af561a149.svg"},1570:function(e,t,n){e.exports=n.p+"_/941c002d322a99aa7f8ec2636b5aa740.svg"},1571:function(e,t,n){e.exports=n.p+"_/eb61e4850866b8628b4f62bd87e6b090.svg"},1572:function(e,t,n){e.exports=n.p+"_/cc9f752fd908081b3e020ab355b52e64.svg"},1573:function(e,t,n){e.exports=n.p+"_/1986d767b4c0f9bac31ed39c3b018408.svg"},1574:function(e,t,n){e.exports=n.p+"_/24e00928620530fea4de82e28d1eeef5.svg"},1575:function(e,t,n){e.exports=n.p+"_/ecbf691e3d9800d024f77c98b1d2efa5.svg"},1576:function(e,t,n){e.exports=n.p+"_/5c96df7c388d62255fded5c72dc332c6.svg"},1577:function(e,t,n){e.exports=n.p+"_/05283e98a36aadd17ab9d73755f33060.svg"},1578:function(e,t,n){e.exports=n.p+"_/df140ca32678915eb18ef760f94c6577.svg"},1579:function(e,t,n){e.exports=n.p+"_/cb0bab2bc4ed1ae789d4a7067fd09f1c.svg"},1580:function(e,t,n){e.exports=n.p+"_/d79a68caecd1135428c71918b192fcab.svg"},1581:function(e,t,n){},1583:function(e,t,n){"use strict";var r=n(6),o=n(1584),i=n.n(o),a=n(4),s=n.n(a),c=n(8),u=n(7),l=n(197),d=n(20),p=n(11),m=n(43),f=n(9),v=n(1586),g=n.n(v),h=Object(d.a)({resolved:{},chunkName:function(){return"time-dependent"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("time-dependent").then(n.bind(null,642))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 642}}),b=Object(u.a)("masstransit-route-settings-view"),_=2,y=[{type:"underground",text:"Метро"},{type:"tramway",text:(function(params){return (params.count % 10 === 1 && params.count % 100 !== 11 ? "Трамвай" :"Трамваи");})({})},{type:"bus",text:(function(params){return (params.count % 10 === 1 && params.count % 100 !== 11 ? "Автобус" :"Автобусы");})({})},{type:"minibus",text:(function(params){return (params.count % 10 === 1 && params.count % 100 !== 11 ? "Маршрутка" :"Маршрутки");})({})},{type:"trolleybus",text:(function(params){return (params.count % 10 === 1 && params.count % 100 !== 11 ? "Троллейбус" :"Троллейбусы");})({})},{type:"railway",text:(function(params){return (params.count % 10 === 1 && params.count % 100 !== 11 ? "Электричка" :"Электрички");})({count:_})}],E=function(e){function t(t){var n;return(n=e.call(this,t)||this)._getNewValue=function(e){var t=n.props;return t.settings.avoidTypes.includes(e)?t.settings.avoidTypes.filter(function(t){return t!==e}):t.settings.avoidTypes.concat(e)},n._updateTimeDependent=function(e){n.props.updateSettings("masstransit","timeDependent",e)},n._onInfoClick=function(){n.setState({hintKey:Math.random()})},n._renderItem=function(e){var t=!n.props.settings.avoidTypes.includes(e.type);return a.createElement("div",{className:b("item"),key:e.type},a.createElement(c.a,{name:"filter_item",logClick:!0,nodeState:{type:e.type,selected:t}},a.createElement(l.a,{checked:t,onChange:function(){return n.props.updateSettings("masstransit","avoidTypes",n._getNewValue(e.type))},label:a.createElement("div",{className:b("label")},e.text)})))},n._renderPreferences=function(){return a.createElement("div",{className:b("preferences",{disabled:n.props.isIntercityRoute})},a.createElement("div",{className:b("preferences-title")},"Предпочтения по транспорту",a.createElement(m.a,{key:n.state.hintKey,isInitialShown:Boolean(n.state.hintKey),isNeededOnMobile:!0,text:a.createElement("div",{className:b("preferences-info-text")},"Карты постараются найти оптимальный\nмаршрут по вашим предпочтениям"),position:"bottom",hideOnClick:!0},a.createElement("div",{className:b("preferences-info-icon"),onClick:n.props.config.uatraits.isMobile?n._onInfoClick:void 0},a.createElement(p.a,{url:g.a})))),a.createElement("div",{className:b("transport-types")},y.map(n._renderItem)))},n._renderTimeDependent=function(){return a.createElement("div",{className:b("time-dependent")},a.createElement(h,{timeDependent:n.props.settings.timeDependent,updateTimeDependent:n._updateTimeDependent,staticType:n.props.isIntercityRoute}))},n.state={hintKey:void 0},n}return Object(r.a)(t,e),t.prototype.render=function(){return a.createElement("div",{className:b()},this._renderPreferences(),this._renderTimeDependent())},t}(a.Component);t.a=Object(f.b)(E)},1584:function(e,t,n){},1586:function(e,t,n){e.exports=n.p+"_/c7f03dce466c9a656d8227ab64f94d06.svg"},1587:function(e,t,n){"use strict";var r=n(6),o=n(1588),i=n.n(o),a=n(4),s=n.n(a),c=n(8),u=n(7),l=n(197),d=n(20),p=Object(d.a)({resolved:{},chunkName:function(){return"time-dependent"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("time-dependent").then(n.bind(null,642))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 642}}),m=Object(d.a)({resolved:{},chunkName:function(){return"cargo"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("cargo").then(n.bind(null,1114))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 1114}}),f=Object(u.a)("auto-route-settings-view"),v=[{type:"tolls",text:"Избегать платных дорог"}],g=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._getNewValue=function(e){return t.props.settings.avoid.includes(e)?[]:[e]},t._updateTimeDependent=function(e){t.props.updateSettings("auto","timeDependent",e)},t._renderItem=function(e){var n=t.props.settings.avoid.includes(e.type);return a.createElement("div",{className:f("item"),key:e.type},a.createElement(c.a,{name:"filter_item",logClick:!0,nodeState:{type:e.type,selected:n}},a.createElement(l.a,{checked:n,onChange:function(){return t.props.updateSettings("auto","avoid",t._getNewValue(e.type))},label:a.createElement("div",{className:f("label")},e.text)})))},t._renderIgnoreTrafficJams=function(){return a.createElement("div",{className:f("item")},a.createElement(c.a,{name:"avoid_traffic",logClick:!0,nodeState:{checked:t.props.settings.ignoreTrafficJams}},a.createElement(l.a,{disabled:Boolean(t.props.settings.timeDependent.time),checked:t.props.settings.ignoreTrafficJams,onChange:function(e){return t.props.updateSettings("auto","ignoreTrafficJams",e)},label:a.createElement("div",{className:f("label")},"Показывать варианты без учета пробок")})))},t}return Object(r.a)(t,e),t.prototype.render=function(){return a.createElement("div",{className:f()},a.createElement("div",{className:f("checks")},this._renderIgnoreTrafficJams(),v.map(this._renderItem)),a.createElement(m,{cargo:this.props.settings.cargo,updateSettings:this.props.updateSettings}),a.createElement(p,{staticType:!0,timeDependent:this.props.settings.timeDependent,updateTimeDependent:this._updateTimeDependent}))},t}(a.Component);t.a=g},1588:function(e,t,n){},1590:function(e,t,n){e.exports=n.p+"_/d381b7f525c33d5f672e2de9acbfd9d7.svg"},1591:function(e,t,n){},1593:function(e,t,n){},1595:function(e,t,n){},1597:function(e,t,n){},1599:function(e,t,n){},1601:function(e,t,n){},1603:function(e,t,n){},1605:function(e,t,n){"use strict";var r=n(10),o=n(6),i=n(1606),a=n.n(i),s=n(4),c=n.n(s),u=n(7),l=n(8),d=n(15),p=n(257),m=n(47),f=n(69),v=n(11),g=n(1021),h=n(9),b=n(20),_=n(43),y=n(36),E=n(32),S=n(58),R=n(1608),C=Object(b.a)({resolved:{},chunkName:function(){return"metro-jams"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("metro-jams").then(n.bind(null,270))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 270}}),I=Object(b.a)({resolved:{},chunkName:function(){return"metro-details"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("metro-details").then(n.bind(null,1116))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 1116}}),k=Object(u.a)("route-masstransit-step-view"),P=3600,O=function(e){function t(t){var n;return(n=e.call(this,t)||this)._stops=null,n._getWalkParams=function(){var e=n.props.segment;return{details:{left:0!==e.duration.value?f.q(e.duration.value,n.props.config):void 0,right:e.distance&&0!==e.distance.value?e.distance.text:"",withWalkIcon:!0},type:"walk"}},n._getTransitStops=function(e,t){var n=e.stops;if(!(n.length<3))return{type:t.type,count:n.length-1,items:n.slice(1,n.length-1).map(function(e){return{title:e.name,color:t.color,icon:"transit"}})}},n._getUndergroundTransportParams=function(e){var t=n.props,r=t.segment,o=t.transferFrom,i=r.transports,a=f.I(i),s=f.y(i),c=a.underground[0],u=c.color,l=c.name;return e.color=u||S.j("underground"),e.firstStop.transportDescriptions={priority:{type:s.type,id:s.id,threadId:s.threadId,name:s.undergroundLineNumber||"",title:l,essentialStops:s.essentialStops,isMoscowCentralDiameter:s.isMoscowCentralDiameter||!1}},o&&(e.lastStop.undergroundTransfer=!0),e.details.stops=n._getTransitStops(r,{type:"underground",color:u}),e},n._getAbovegroundTransportParams=function(e){var t=n.props,o=t.segment,i=t.transferFrom,a=n._getAbovegroundTransportDescriptions(),s=a.find(function(e){return Boolean(e.items.find(function(e){return Boolean(e.isRecommended)}))})||a[0];return e.firstStop.transportDescriptions={priority:{id:s.id,threadId:s.threadId,name:s.name,title:S.p(s.type),type:s.type,items:s.items,essentialStops:s.essentialStops},other:a.map(function(e){return Object(r.a)(Object(r.a)({},e),{},{items:e.items.filter(function(e){return e.name!==s.name})})}).filter(function(e){return e.items.length>0})},i&&(e.lastStop.abovegroundTransfer=!0),e.details.stops=n._getTransitStops(o,{type:"aboveground"}),e.color=s.color,e},n._getTransportParams=function(){var e=n.props.segment,t=e.stops,r=e.transports,o=f.I(r),i=f.y(r),a=o.underground||[],s={type:i.type,city:i.city,alert:i.alert,isMoscowCentralDiameter:i.isMoscowCentralDiameter,firstStop:{stopId:t[0].id,title:t[0].name,metroJamsInfo:t[0].metroJamsInfo,icon:"stop",coordinates:t[0].coordinates},lastStop:{stopId:t[t.length-1].id,title:t[t.length-1].name,icon:"underground"===i.type?"stop":"empty",coordinates:t[t.length-1].coordinates,metroExit:e.metroExit},details:{left:f.q(e.duration.value,n.props.config),transportWaitingDuration:e.waiting&&0!==e.waiting.value?f.q(e.waiting.value,n.props.config):void 0},state:{transport:!0}};return"underground"===i.type&&a.length>0?n._getUndergroundTransportParams(s):n._getAbovegroundTransportParams(s)},n._getAbovegroundTransportDescriptions=function(){var e=f.I(n.props.segment.transports);return f.a.reduce(function(t,n){var r=e[n]||[];if(r.length>0){var o=f.y(r);t.push({id:o.id,threadId:o.threadId,title:S.p(n,{isPlural:r.length>1}),items:r,type:n,name:o&&o.name||"",color:o&&o.color,essentialStops:o.essentialStops})}return t},[])},n._onItemClick=function(e){var t=n.props;t.segment.edgePoints&&t.onClick(e>0?t.segment.edgePoints[1]:t.segment.edgePoints[0])},n._onStopsSwitchClick=function(){var e=n.state.stopsIsActive,t=Array.prototype.slice.call(n._stops.children).reduce(function(e,t){return e+t.offsetHeight},0);n.setState({stopsIsActive:!e,stopsMaxHeight:e?void 0:t})},n._getEssentialStopText=function(e,t){var r=n.props.segment.stops;return[R.a,R.b].includes(e)&&r&&r[1]?(function(params){return "В направлении: «"+params.direction+"»";})({direction:r[1].name}):t[0].name===t[1].name?t[0].name+" - "+t[1].name:(function(params){return "В направлении: «"+params.direction+"»";})({direction:t[1].name})},n._renderStops=function(e){if(!e)return s.createElement("div",{className:k("details-info-no-stops")},"Проехать одну станцию");var t=n.state,r=t.stopsIsActive,o=t.stopsMaxHeight,i=e.type,a=e.items,c="underground"===i?(function(params){return "Ещё "+params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "станция" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "станции" : "станций"));})({count:a.length}):(function(params){return "Ещё "+params.count+" "+(params.count % 10 === 1 && params.count % 100 !== 11 ? "остановка" :(params.count % 10 > 1 && params.count % 10 < 5 && (params.count % 100 < 10 || params.count % 100 > 20) ? "остановки" : "остановок"));})({count:a.length}),u=s.createElement("div",{className:k("stops-switch")},s.createElement(l.a,{name:"switch",nodeState:{expanded:r},logClick:!0},s.createElement(d.a,{tick:"triangle",view:"secondary-gray",size:"small",onClick:n._onStopsSwitchClick,flippedTick:r},c)));return s.createElement(s.Fragment,null,n._renderItem({node:u,title:"",icon:r?"none":"transits",color:e.items[0].color},-1),s.createElement("div",{className:k("stops",{visible:r}),ref:function(e){return n._stops=e},style:{maxHeight:o}},s.createElement("div",{className:k("stops-content")},a.map(n._renderItem))))},n._renderDetails=function(e,t,r){var o=e.left,i=e.right,a=e.stops,c=e.withWalkIcon;return s.createElement("div",{className:k("details")},s.createElement("div",{className:k("details-info")},o?s.createElement("div",{className:k("details-info-left-content",{type:t})},o):null,c?s.createElement("div",{className:k("details-info-icon",{walk:!0})}):null,i?s.createElement("div",{className:k("details-info-right-content")},"string"==typeof i?(function(params){return "пройти "+params.distance;})({distance:i}):s.createElement("a",{className:k("link"),href:i.href,target:i.target},i.content)):null),"walk"===t||r?null:n._renderStops(a))},n._renderItem=function(e,t){var r,o=e.clickableIndex,i=e.icon,a=e.color,c=e.title,u=e.type,d=e.abovegroundTransfer,p=e.node,m=e.undergroundTransfer,f=e.details,g=void 0===f?{}:f,h=e.city,b=e.metroExit,_=e.stopId,E=e.metroJamsInfo,S=u?y.d({type:"masstransit",name:u+"-"+h,size:"normal"},n.props.config)||y.d({type:"masstransit",name:u,size:"normal"},n.props.config):void 0;return s.createElement("div",{className:k("item"),key:t},d?s.createElement("div",{className:k("no-walk")}):null,s.createElement("div",{className:k("icon",i?(r={},r[i]=Boolean(i),r):void 0),style:{backgroundColor:a,borderColor:a}},S?s.createElement(v.a,{className:k("icon-svg"),url:S}):null),s.createElement(l.a,{key:t,name:"step_item",nodeState:{type:"masstransit",description:u},logClick:"number"==typeof o},s.createElement("div",{className:k("title",{clickable:"number"==typeof o}),onClick:"number"==typeof o?function(){return n._onItemClick(o)}:void 0},p||c)),m?s.createElement("div",{className:k("transfer-text")},"Пересадка на другую линию"):null,d?s.createElement("div",{className:k("transfer-text",{aboveground:!0})},"Пересадка"):null,g.transportWaitingDuration?s.createElement("div",{className:k("waiting-duration")},(function(params){return "подождать "+params.duration;})({duration:""}),s.createElement("span",{className:k("waiting-duration-unit")},g.transportWaitingDuration)):null,n._renderDescriptions(e),b?s.createElement("div",{className:k("metro-exit")},s.createElement("span",{className:k("metro-exit-number")},b.name),s.createElement("span",{className:k("metro-exit-text")},"Выход")):null,n.props.isTimeDependent||!_||n.props.hasAlerts||"metro"===n.props.routeType||void 0===E||"underground"!==u?null:s.createElement(C,{view:"details",stopId:_,metroJamsInfo:E}))},n._renderDescriptions=function(e){var t=e.color,r=e.transportDescriptions,o=e.alert,i=e.coordinates,a=e.stopId,c=r&&r.priority;return r&&c?s.createElement("div",{className:k("transports")},n._renderPriorityDescription(c,t,o,i,a),r.other&&r.other.length>0?s.createElement(s.Fragment,null,s.createElement("div",{className:k("transports-head")},"Ещё варианты"),r.other.map(function(e,t){return n._renderDescription(e,t,a)})):null):null},n._renderDepartureAndArrival=function(e,t){var r,o=n.props.segment.beginTime&&E.a(new Date(1e3*Number(n.props.segment.beginTime.value)),n.props.segment.beginTime.tzOffset),i=n.props.segment.endTime&&E.a(new Date(1e3*Number(n.props.segment.endTime.value)),n.props.segment.endTime.tzOffset),a=o&&((null==t?void 0:t.closed)||["suburban","aeroexpress","train","aero"].includes(e.type)||f.P(n.props.segment)||"bus"===e.type&&((null===(r=n.props.segment.distance)||void 0===r?void 0:r.value)?n.props.segment.distance.value>f.c:n.props.segment.duration.value>P)),c=i&&a&&(f.P(n.props.segment)||["suburban","aeroexpress","train","aero"].includes(e.type)),u=o&&(i&&!Object(p.a)(o,i)||n.props.isInterDateRoute),l=c&&i&&u;return a?s.createElement("div",{className:k("departure-arrival-time")},a?s.createElement("div",{className:k("timetable-departure")},s.createElement("span",{className:k("nowrap-row")},(function(params){return (function(params){switch (params.type) {case "plane":return "Вылет в ";case "ground":return "Отправление в ";}}(params));})({type:"aero"===e.type?"plane":"ground"}),s.createElement("span",{className:k("timetable-departure-time")},f.i(n.props.segment.beginTime,n.props.config,n.props.segment))),u&&o?s.createElement("span",{className:k("timetable-departure-date")}," "+Object(m.a)(o,n.props.config,{isShortDate:!0,isShortMonth:!0})):null):null,c?s.createElement("div",{className:k("timetable-arrival")},s.createElement("span",{className:k("nowrap-row")},(function(params){return (function(params){switch (params.type) {case "plane":return "Прилёт в ";case "ground":return "Прибытие в ";}}(params));})({type:"aero"===e.type?"plane":"ground"}),s.createElement("span",{className:k("timetable-arrival-time")},f.i(n.props.segment.endTime,n.props.config,n.props.segment))),l&&i?s.createElement("span",{className:k("timetable-arrival-date")}," "+Object(m.a)(i,n.props.config,{isShortDate:!0,isShortMonth:!0})):null):null):null},n._renderPriorityDescription=function(e,t,r,o,i){var a="underground"===e.type&&e.isMoscowCentralDiameter,c=!["suburban","aeroexpress"].includes(e.type)&&!a&&!n.props.isIntercityRoute&&"metro"!==n.props.routeType,u=n.props.onStopClick;return s.createElement(l.a,{name:"step_item"},s.createElement(l.a,{name:"line_item",nodeState:{lineId:e.id,type:e.type},logClick:!0},s.createElement("div",{className:k("transport-priority",{type:e.type})},s.createElement("div",{className:k("transport-name",{clickable:c}),onClick:c?function(){return n.props.onMasstransitLineClick({lineId:e.id,threadId:e.threadId,skipApplyBounds:!0,openedBy:{stopId:i}})}:void 0},s.createElement("div",{className:k("transport-number",{clickable:c}),style:t?{backgroundColor:t}:void 0},e.name),s.createElement("div",{className:k("transport-title")},e.title)),n._renderDepartureAndArrival(e,r),e.essentialStops?s.createElement("div",{className:k("transport-essential-stops")},a?e.essentialStops[1].name:n._getEssentialStopText(e.id,e.essentialStops)):null,r?s.createElement("div",{className:k("transport-alert")},s.createElement(g.a,{alert:r})):null,"underground"!==e.type&&o&&i&&u&&!n.props.isIntercityRoute?s.createElement("div",{className:k("link"),onClick:function(){return u({id:i,coordinates:o},e.id)}},"Показать расписание"):null)))},n._renderDescription=function(e,t,r){return s.createElement("div",{key:t,className:k("transports-other",{type:e.type})},s.createElement("div",{className:k("transport-title")},e.title),e.items.map(function(e,t){return s.createElement(l.a,{name:"step_item",key:t},s.createElement(l.a,{name:"line_item",nodeState:{lineId:e.id,type:e.type},logClick:!0},s.createElement("span",null,s.createElement(_.a,{isAir:!0,text:e.essentialStops?n._getEssentialStopText(e.id,e.essentialStops):"",position:"bottom",isDisabled:!e.essentialStops},!n.props.isIntercityRoute&&"suburban"!==e.type&&"underground"!==e.type&&f.a.includes(e.type)?s.createElement("div",{className:k("transport-number",{clickable:!0}),onClick:function(){return n.props.onMasstransitLineClick({lineId:e.id,threadId:e.threadId,skipApplyBounds:!0,openedBy:{stopId:r}})}},e.name):s.createElement("div",{className:k("transport-number")},e.name)))))}))},n.state={stopsIsActive:!1},n}return Object(o.a)(t,e),t.prototype.render=function(){var e,t=this.props.segment;if("walk"===t.type||"transfer"===t.type)e=this._getWalkParams();else{if("transport"!==t.type||!t.transports||0===t.transports.length)return null;e=this._getTransportParams()}var n=e,o=n.state,i=n.type,a=n.color,c=n.details,u=n.firstStop,l=n.lastStop,d=n.alert,p=n.city,m=n.isMoscowCentralDiameter,f=t.stops&&1===t.stops.length;return s.createElement("div",{className:k(Object(r.a)(Object(r.a)({},o),{},{type:i}))},s.createElement("div",{className:k("details-axis-layout")},s.createElement("div",{className:k("details-axis"),style:{borderColor:a}}),u&&!f?this._renderItem(Object(r.a)(Object(r.a)({},u),{},{clickableIndex:t.firstStopMetroDetails?void 0:0,color:a,type:i,details:c,alert:d,city:p})):null,u&&t.firstStopMetroDetails&&!f?s.createElement(I,{metroDetails:t.firstStopMetroDetails,stopId:u.stopId,metroJamsInfo:"metro"===this.props.routeType?u.metroJamsInfo:void 0}):null,f&&"transport"===t.type?null:this._renderDetails(c,i,Boolean(m||t.transports&&t.transports.find(function(e){var t=e.type;return["train","aero"].includes(t)})))),l?this._renderItem(Object(r.a)(Object(r.a)({},l),{},{clickableIndex:t.firstStopMetroDetails?void 0:1,color:a,type:i,alert:d,city:p})):null,t.lastStopMetroDetails?s.createElement(I,{metroDetails:t.lastStopMetroDetails,isSingleStop:!0}):null)},t}(s.Component);t.a=Object(h.b)(O)},1606:function(e,t,n){},1608:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i});n(10);var r,o="100000088",i="1727497101";r={100000099:"1",100000069:"2",100000122:"3",100000127:"4"},r[o]="5",r[100000083]="6",r[100000114]="7",r[100000107]="8",r[100000078]="9",r[100000064]="10",r[2224008691]="11",r[100000073]="11A",r[100000059]="12",r[100000006]="13",r[i]="14",r[3526118655]="15"},1609:function(e,t,n){},1611:function(e,t,n){},1613:function(e,t,n){e.exports=n.p+"_/4cf255641a4b490c90610e80c6fc0f94.svg"},1614:function(e,t,n){"use strict";var r=n(6),o=(n(1615),n(4)),i=n(7),a=n(54),s=Object(i.a)("active-point-view"),c=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){return o.createElement(a.a,{coordinates:this.props.coordinates,nonInteractive:!0},o.createElement("div",{className:s()}))},t}(o.Component);t.a=c},1615:function(e,t,n){},1617:function(e,t){},1618:function(e,t){},1619:function(e,t,n){"use strict";var r=n(13),o=n(442),i=n(6),a=n(4),s=n.n(a),c=n(9),u=n(18),l=n(198),d=n(69),p=n(58),m=n(32),f=n(20),v=Object(f.a)({resolved:{},chunkName:function(){return"masstransit-vehicle-placemarks"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("masstransit-vehicle-placemarks").then(n.bind(null,643))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 643}},{ssr:!1}),g=3,h=5e3,b=function(e){function t(t){var n;return(n=e.call(this,t)||this)._updateStopInfoTimeout=0,n._getTransportAndStopId=function(){var e,t,r=null===(e=n.props.masstransitRoute.paths[0])||void 0===e?void 0:e.segments.find(function(e){return Boolean(e.transports)}),o=(null==r?void 0:r.transports)&&d.y(r.transports),i=(null==r?void 0:r.stops)&&(null==r?void 0:null===(t=r.stops[0])||void 0===t?void 0:t.id);if(i&&o&&["bus","minibus","trolleybus","tramway"].includes(o.type))return{transport:o,stopId:i}},n._loadStopInfo=function(){u.a.cancel(n._loadStopInfoAction),window.clearTimeout(n._updateStopInfoTimeout);var e=n.props,t=n._getTransportAndStopId();if(t){var r=t.transport,i=t.stopId;n._loadStopInfoAction=u.a.create(l.a.getStopInfo({id:i},e.config),{success:function(e){for(var t,i,a,s,c=Object(o.a)(e.transports);!(s=c()).done;){var u=s.value,l=u.lineId,d=u.threads;if(l===r.id){a=d.find(function(e){return e.threadId===r.threadId});break}}if(!(null===(t=a)||void 0===t?void 0:null===(i=t.BriefSchedule)||void 0===i?void 0:i.Events))return n.setState({vehicleIds:[]});var f=m.a(new Date(e.currentTime),e.tzOffset),v=p.n(a.BriefSchedule.Events,f,e.tzOffset).filter(function(e){var t=e.isLive,n=e.vehicleId;return t&&n}).slice(0,g),b=0!==v.length?v[0].date.getTime()-f.getTime():void 0;b&&(n._updateStopInfoTimeout=window.setTimeout(function(){return n._loadStopInfo()},b>h?b:h)),n.setState({vehicleIds:v.map(function(e){return e.vehicleId})})}})}else n.setState({vehicleIds:[]})},n._loadRouteVehicles=function(e){var t=e.ll,r=e.spn,o=n.props,i=n._getTransportAndStopId();i&&o.loadVehicles({ll:t,spn:r,lineId:i.transport.id})},n.state={vehicleIds:[]},n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._loadStopInfo()},n.componentDidUpdate=function(e){e.masstransitRoute.uuid!==this.props.masstransitRoute.uuid&&this._loadStopInfo()},n.componentWillUnmount=function(){window.clearTimeout(this._updateStopInfoTimeout),u.a.cancel(this._loadStopInfoAction)},n.render=function(){var e=this,t=this.props;if(0===this.state.vehicleIds.length)return null;var n=t.vehicles.filter(function(t){return e.state.vehicleIds.includes(t.properties.VehicleMetaData.id)});return a.createElement(v,Object(r.a)({key:t.masstransitRoute.uuid},t,{vehicles:n,loadVehicles:this._loadRouteVehicles,mode:"route"}))},t}(a.Component);t.a=Object(c.b)(b)},171:function(e,t,n){},178:function(e,t,n){"use strict";var r=Math.floor,o=Math.random;var i=function(e,t){return e+r(o()*(t-e+1))},a=n(143),s=n(343),c=parseFloat,u=Math.min,l=Math.random;var d=function(e,t,n){if(n&&"boolean"!=typeof n&&Object(a.a)(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=Object(s.a)(e),void 0===t?(t=e,e=0):t=Object(s.a)(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var o=l();return u(e+o*(t-e+c("1e-"+((o+"").length-1))),t)}return i(e,t)},p=n(84),m=n.n(p);n.d(t,"b",function(){return h}),n.d(t,"c",function(){return b}),n.d(t,"g",function(){return _}),n.d(t,"f",function(){return y}),n.d(t,"e",function(){return E}),n.d(t,"d",function(){return S}),n.d(t,"a",function(){return R});var f=[],v=97,g=122;function h(){for(var e="",t=0;t<10*Math.random();t++)e+=" ";return e}function b(e){return e.filter(function(e){return!f.includes(e.abuseInfo)})}function _(e){f.push(e)}function y(){var e=new Array(d(1,5)).fill(0);return(e=e.map(function(){return String.fromCharCode(d(v,g))})).join("")+"__"+m.a.v4().replace(/-|\d/g,"")}function E(e){return Object.entries(e).map(function(e){return S(e[1])}).join("")}function S(e){return"."+e.selector+"{"+e.style+"}"}function R(e){return void 0===t&&(t="webmaps"),"utm_source="+t+"&utm_medium="+"gp_label"+"&utm_campaign="+(e?"orgpage_label":"previewcard_label");var t}},180:function(e,t,n){"use strict";var r=n(321),o=n(229),i=n(145),a=n(44),s=o.a?o.a.isConcatSpreadable:void 0;var c=function(e){return Object(a.a)(e)||Object(i.a)(e)||!!(s&&e&&e[s])};t.a=function e(t,n,o,i,a){var s=-1,u=t.length;for(o||(o=c),a||(a=[]);++s<u;){var l=t[s];n>0&&o(l)?n>1?e(l,n-1,o,i,a):Object(r.a)(a,l):i||(a[a.length]=l)}return a}},188:function(e,t,n){"use strict";var r=n(26);t.a=Object(r.a)(function(){return n.e("promo").then(n.bind(null,409))},{open:!0,close:!0})},198:function(e,t,n){"use strict";var r,o=n(10),i=n(323),a=n(25),s=6e4,c={loadLayerRegions:function(e){return r||(r=Object(a.a)("masstransit/getLayerRegions",{},e).catch(function(){return[]}))},getStopInfo:function(e,t){return Object(a.a)("masstransit/getStopInfo",{query:{id:e.id,uri:e.uri,locale:t.locale,lang:t.lang,mode:"prognosis"}},t).then(function(e){if(!e)throw new Error("Stop no data");return e})},getPreviewStopInfo:function(e,t){return Object(a.a)("masstransit/getPreviewStopInfo",{query:{uri:e.uri,locale:t.locale,lang:t.lang,mode:"prognosis"}},t)},getStopTimetable:function(e,t){return Object(a.a)("masstransit/getStopTimetable",{query:{id:e.id,timestamp:e.timestamp,locale:t.locale,lang:t.lang}},t).then(function(e){if(!e)return null;var t=function(e){return{id:e.id,name:e.name,type:e.type,currentTime:e.currentTime,region:e.region,tzOffset:e.tzOffset,transports:Object(i.a)(e.transports.map(function(e){return Object(i.a)(e.threads.map(function(t){var n=[];return t.BriefSchedule&&t.BriefSchedule.Frequencies.length>0&&n.push.apply(n,t.BriefSchedule.Frequencies.map(function(n){var r;return Object(o.a)(Object(o.a)({},e),{},{threads:[Object(o.a)(Object(o.a)({},t),{},{BriefSchedule:{Frequencies:[n],Events:[],departureTime:null===(r=t.BriefSchedule)||void 0===r?void 0:r.departureTime}})]})})),t.BriefSchedule&&t.BriefSchedule.Events.length>0&&n.push.apply(n,t.BriefSchedule.Events.map(function(n){var r;return Object(o.a)(Object(o.a)({},e),{},{threads:[Object(o.a)(Object(o.a)({},t),{},{BriefSchedule:{Frequencies:[],Events:[n],departureTime:null===(r=t.BriefSchedule)||void 0===r?void 0:r.departureTime}})]})})),0===n.length&&n.push(Object(o.a)(Object(o.a)({},e),{},{threads:[Object(o.a)({},t)]})),n}))}))}}(e);return t.transports=t.transports.filter(function(e){return u(e,t.currentTime)>0}).sort(function(e,n){return u(e,t.currentTime)-u(n,t.currentTime)}),t})},getVehiclesInfo:function(e,t){return Object(a.a)("masstransit/getVehiclesInfoWithRegion",{query:Object(o.a)({locale:t.locale,lang:t.lang},e)},t)},getVehiclePredictionInfo:function(e,t){return Object(a.a)("masstransit/getVehiclePredictionInfo",{query:Object(o.a)({},e)},t)},getLine:function(e,t){return Object(a.a)("masstransit/getLine",{query:Object(o.a)({locale:t.locale,lang:t.lang},e)},t)},getDistance:function(e,t){return Object(a.a)("masstransit/distance",{query:{startPoint:e.coordinates.join(","),destinationPoints:e.stops.map(function(e){return e.coordinates.join(",")}),locale:t.locale}},t)}};function u(e,t){var n,r,o,i,a=e.threads[0];if((null==a?void 0:null===(n=a.BriefSchedule)||void 0===n?void 0:n.Events)&&(null===(r=a.BriefSchedule)||void 0===r?void 0:r.Events.length)>0){var c,u,l=(null===(c=a.BriefSchedule.Events[0].Estimated)||void 0===c?void 0:c.value)||(null===(u=a.BriefSchedule.Events[0].Scheduled)||void 0===u?void 0:u.value);if(l){var d=1e3*Number(l);return d-t<s?d-t:d}}if((null==a?void 0:null===(o=a.BriefSchedule)||void 0===o?void 0:o.Frequencies)&&(null==a?void 0:null===(i=a.BriefSchedule)||void 0===i?void 0:i.Frequencies.length)>0){var p=1e3*a.BriefSchedule.Frequencies[0].value,m=a.BriefSchedule.Frequencies[0].begin?1e3*Number(a.BriefSchedule.Frequencies[0].begin.value):void 0,f=a.BriefSchedule.Frequencies[0].end?1e3*Number(a.BriefSchedule.Frequencies[0].end.value):void 0;return f&&f<t?-1/0:!m||m<t?p:m}return-1/0}t.a=c},222:function(e,t,n){"use strict";n(280);var r=n(4),o=n(7),i=n(8),a=Object(o.a)("notification-banner");t.a=function(e){var t=e.rightSlot?"center":"top";return r.createElement(i.a,{name:"notification_banner",subtreeState:{type:e.analyticsType}},r.createElement("div",{className:a({shadow:e.shadow,view:e.view})},r.createElement("div",{className:a("left",{position:t})},e.leftSlot),r.createElement("div",{className:a("content")},e.children),r.createElement("div",{className:a("right")},e.rightSlot)))}},223:function(e,t,n){"use strict";var r=n(4),o=n(28);t.a=function(e){return r.createElement(o.a,{selector:"head"},r.createElement("style",{type:"text/css"},e.stylesString))}},235:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(24);function o(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var o=t||{},i=Object(r.a)(e,n).getTime(),a=Object(r.a)(o.start,n).getTime(),s=Object(r.a)(o.end,n).getTime();if(!(a<=s))throw new RangeError("Invalid interval");return i>=a&&i<=s}},250:function(e,t,n){"use strict";var r=n(406);var o=function(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1};var i=function(e){return e!=e};var a=function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1};var s=function(e,t,n){return t==t?a(e,t,n):o(e,i,n)};var c=function(e,t){return!!(null==e?0:e.length)&&s(e,t,0)>-1};var u=function(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1},l=n(349),d=n(348);var p=function(){},m=n(196),f=d.a&&1/Object(m.a)(new d.a([,-0]))[1]==1/0?function(e){return new d.a(e)}:p,v=200;t.a=function(e,t,n){var o=-1,i=c,a=e.length,s=!0,d=[],p=d;if(n)s=!1,i=u;else if(a>=v){var g=t?null:f(e);if(g)return Object(m.a)(g);s=!1,i=l.a,p=new r.a}else p=t?[]:d;e:for(;++o<a;){var h=e[o],b=t?t(h):h;if(h=n||0!==h?h:0,s&&b==b){for(var _=p.length;_--;)if(p[_]===b)continue e;t&&p.push(b),d.push(h)}else i(p,b,n)||(p!==d&&p.push(b),d.push(h))}return d}},257:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(98);function o(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var o=Object(r.a)(e,n),i=Object(r.a)(t,n);return o.getTime()===i.getTime()}},258:function(e,t,n){"use strict";var r={setLayer:function(e){return function(t,n){t({type:"DEEP_EXTEND",payload:e?{parking:{isLayerShown:n().parking.isLayerEnabled},traffic:{isLayerEnabled:!1},panoramas:{isLayerEnabled:!1},photos:{isLayerEnabled:!1},mrc:{isLayerEnabled:!1}}:{parking:{isLayerShown:!1}}})}},toggleLayer:function(){return function(e,t){if(t().parking.isLayerShown)return e(r.setLayer(!1));e(r.setLayer(!0))}},updateLayerAvailability:function(e){return{type:"DEEP_EXTEND",payload:{parking:e}}}};t.a=r},260:function(e,t,n){"use strict";var r=n(94);t.a=function(e,t,n){for(var o=-1,i=e.length;++o<i;){var a=e[o],s=t(a);if(null!=s&&(void 0===c?s==s&&!Object(r.a)(s):n(s,c)))var c=s,u=a}return u}},261:function(e,t,n){"use strict";n(276);var r=n(4),o=n(7),i=n(8),a=n(11),s=n(38),c=Object(o.a)("card-banner-view");t.a=function(e){if(!e.href&&!e.onClick)return null;var t=r.createElement(r.Fragment,null,e.iconUrl?r.createElement(a.a,{className:c("icon"),url:e.iconUrl}):e.icon||null,r.createElement("div",{className:c("text"),dangerouslySetInnerHTML:{__html:e.text}}),r.createElement("div",{className:c("button")},e.buttonContent));return r.createElement(i.a,{name:"card_promo",subtreeState:{id:e.id},logClick:!0},r.createElement("div",{className:c({view:e.view,size:e.size})},e.onClick?r.createElement(s.a,{className:c("banner"),onLeftClick:e.onClick,href:e.href},t):r.createElement("a",{className:c("banner"),href:e.href,target:"_blank"},t)))}},262:function(e,t,n){"use strict";var r=n(6),o=n(4),i=n(12),a={openMobileAppShare:n(188).a.open},s=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onClick=function(){var e=t.props;e.openMobileAppShare(e.openOptions)},t}return Object(r.a)(t,e),t.prototype.render=function(){return this.props.children({onClick:this._onClick})},t}(o.PureComponent);t.a=i.b(null,a)(s)},263:function(e,t,n){"use strict";var r=n(6),o=(n(278),n(4)),i=n(7),a=n(52),s=n(8),c=n(111),u=Object(i.a)("dropdown-view"),l=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._content=null,t._show=function(){t._animateContent("EXPAND")},t._hide=function(){t._animateContent("COLLAPSE")},t._animateContent=function(e){if(t._content){var n=t._content,r="EXPAND"===e?0:n.offsetHeight,o="EXPAND"===e?n.offsetHeight:0;n.style[Object(c.b)().styles.transition]="max-height 0.15s ease-in-out",n.style.maxHeight=r+"px",n.getBoundingClientRect(),n.style.maxHeight=o+"px"}},t._onTransitionEnd=function(e){e.target===t._content&&t._content&&(t._content.style[Object(c.b)().styles.transition]="",t._content.style.maxHeight="",t.props.onTransitionEnd&&t.props.onTransitionEnd())},t._renderContent=function(){var e=t.props;return e.isExpanded?o.createElement(s.a,{name:"content"},o.createElement("div",{className:u("content"),ref:function(e){return t._content=e},onTransitionEnd:t._onTransitionEnd},e.children)):null},t}return Object(r.a)(t,e),t.prototype.render=function(){return o.createElement("div",{className:u()},o.createElement(a.a,{onShow:this._show,onHideStart:this._hide},this._renderContent()))},t}(o.Component);t.a=l},27:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(119),o=Object(r.a)("wideCard",!1,function(e){return{isWideCard:e}}),i=o.connect,a=o.Provider;t.b=i},2747:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n(2796),i=n(18),a=n(350),s=n(69),c=n(99),u={};function l(e,t,n){return m(e.join(","),function(){return c.a.fetch({mode:"reverse",type:["geo"],center:e,count:1,origin:n},t)})}function d(e,t,n){return m(e,function(){return c.a.fetch({uri:e,count:1,origin:n},t)})}function p(e,t,n,r){return d(e,n,r).then(function(e){return!e&&t?l(t,n,r):e})}function m(e,t){return u[e]?Promise.resolve(u[e]):t().then(function(e){return e.items.length>0?e.items[0]:void 0}).then(function(t){var n;t&&(u[e]=t,Object.keys(u).length>100&&((n={})[e]=u[e],u=n));return t})}var f=n(2792),v=n(84),g=n.n(v),h=n(120),b=n(588);var _=function(e,t,n,r){for(var o=e.length,i=r?o:-1;(r?i--:++i<o)&&t(e[i],i,e););return n?Object(b.a)(e,r?0:i,r?i+1:o):Object(b.a)(e,r?i+1:0,r?o:i)};var y,E=function(e,t){return e&&e.length?_(e,Object(h.a)(t,3),!0,!0):[]},S=n(458),R=n(37),C=n(16),I=n(600),k=n(696),P=n(324),O="routes",T=1e5,x=500,w={buildRoute:function(e){var t=e.points,n=e.travelMode,o=void 0===n?"auto":n,i=e.departureTime;return function(e,n){var a=n(),c=C.h(a,"routes"),u=c||s.p(a),l=s.o(),d=t&&t.length>=l.length?t:l,p=-1!==u.activeField?u.activeField:s.g(d,[]);i&&"auto"===o&&(u.settings.auto.timeDependent.time=i);var m={travelMode:o,activeField:p,isFocused:-1!==p,index:0,detailedIndex:-1,moreSnippetsShown:!1,activePoint:null,routePoints:M(d),viaIndexes:[],mobileViewState:"mini"};e(c?R.a.update(c,m):R.a.push(Object(r.a)(Object(r.a)({mode:O},u),m))),e(w.updateRoute())}},buildRouteTo:function(e,t){void 0===t&&(t={});return N(function(n,o,i){i.config;var a=o(),c=C.h(a,"routes"),u=c||s.p(a),l=[].concat(u.routePoints),d=s.o();if(l)for(;l.length<d.length;)l.push(s.r());else l=d;l[l.length-1]=e;o().geolocation;var p=-1!==u.activeField?u.activeField:s.g(l,u.viaIndexes),m=M(l),f=m.every(function(e){return e.coords}),v={activeField:p,isFocused:-1!==p,skipApplyBounds:t.skipApplyBounds||u.skipApplyBounds,travelMode:t.travelMode||u.travelMode,routePoints:m,viaIndexes:u.viaIndexes,mobileViewState:f?"mini":"expanded"},g=t.departureTime;g&&"auto"===v.travelMode&&(u.settings.auto.timeDependent.time=g),n(c?R.a.update(c,v):R.a.push(Object(r.a)(Object(r.a)({mode:O},u),v))),n(w.updateRoute())},{requestOnlyPhone:!0,timeout:k.a,checkPermission:!0,checkAccuracy:!0})},buildRouteFrom:function(e,t){void 0===t&&(t={});return N(function(n,o,i){i.config;var a=o(),c=C.h(a,"routes"),u=c||s.p(a),l=[].concat(u.routePoints),d=s.o();(!l||l.length<d.length)&&(l=d),l[0]=e;var p=!l[1].coords;o().geolocation;var m=M(l),f={activeField:p?1:-1,isFocused:p,skipApplyBounds:t.skipApplyBounds||u.skipApplyBounds,routePoints:m,viaIndexes:u.viaIndexes,mobileViewState:"expanded"};n(c?R.a.update(c,f):R.a.push(Object(r.a)(Object(r.a)({mode:O},u),f))),n(w.updateRoute())},{requestOnlyPhone:!0,timeout:k.a,checkPermission:!0,checkAccuracy:!0})},updateRoute:function(e){var t=(void 0===e?{}:e).isRough;return function(e,n,o){var a,c,u=o.config;i.a.cancel(y),e(function(e,t,n){var o=n.config,i=t();(s.F(i)||s.p(i)).routePoints.forEach(function(n){!n||!n.coords||n.value&&(n.searchResult||n.isEditing)||(n.uri?p(n.uri,n.coords,o,"router"):l(n.coords,o,"router")).then(function(o){var a=s.F(t());if(a){var c=a||s.p(i),u=!1,l=c.routePoints.map(function(e){return e.coords===n.coords?(u=!0,Object(r.a)(Object(r.a)({},e),{},{value:e.value||(o?o.title:""),input:e.input||(o?o.title:""),ignorePctx:!n.uri,searchResult:o})):e});u&&e(R.a.update(c,{routePoints:l,routerResponse:c.routerResponse&&Object(r.a)({},s.e(c.routerResponse,l))}))}})})});var d=n(),m=s.F(d),v=m||s.p(d);if(F(v.routePoints,v.viaIndexes))e(j({error:"invalid_points"}));else{var h=v.routePoints.filter(function(e){return Boolean(e.coords)}).map(function(e){return e.coords});if(h.length<2)e(j({error:void 0,routerResponse:null,moreSnippetsShown:!1,sessionId:void 0}));else{var b=v.travelMode;"arrival"===(null===(a=v.settings)||void 0===a?void 0:a.masstransit.timeDependent.type)&&["comparison","masstransit"].includes(v.travelMode)&&s.Q(v.routePoints.map(function(e){return e.coords}).filter(function(e){return Boolean(e)}))&&e(j({settings:Object(r.a)(Object(r.a)({},v.settings),{},{masstransit:Object(r.a)(Object(r.a)({},v.settings.masstransit),{},{timeDependent:{type:"departure",time:void 0}})})}));var _=s.F(n()),E={isLoading:!0,mrcFeatures:null,activeMrcIndex:null,error:void 0};(!(null==_?void 0:null===(c=_.mrcThumbnail)||void 0===c?void 0:c.point)||!Object(f.a)(h[0],null==_?void 0:_.mrcThumbnail.point))&&(E.mrcThumbnail=null),e(j(E));var C,I,k=function(e,t,n){var o=n.regionId,i=n.isRough,a=t.travelMode,c=t.routerResponse,u=t.routePoints,l=t.activeRouteIndex,d=t.viaIndexes,p=u.filter(function(e){return Boolean(e.coords)}),m=p.map(function(e){return e.coords}),f=c?c.routes[l]:null,v=t.activeComparisonMode?t.activeComparisonMode:f&&"taxi"!==f.type&&f.type||void 0,g=s.G(a,t.settings),h=[];s.N(m,a)||h.push("bicycle");return Object(r.a)(Object(r.a)({rll:m.map(function(e){return e.join(",")}).join("~"),type:a,activeComparisonMode:v,via:d.length>0?d.join("~"):void 0,mode:A({ignoreTrafficJams:t.settings.auto.ignoreTrafficJams||Boolean(g&&g.timeDependent&&g.timeDependent.time&&"comparison"!==a),travelMode:a,isRough:i}),pctx:s.w(p),ignoreTravelModes:h.length>0?h.join(","):void 0,regionId:o,enableRoutesB2B:s.M(a,e)||void 0},g),{},{isIntercityRoute:s.Q(m),"no-taxi-route-hidden":e.query["no-taxi-route-hidden"]})}(d.config,v,{regionId:d.mapRegion&&d.mapRegion.id,isRough:t}),P=v.routePoints[v.routePoints.length-1],O=P.input||P.value;if(P.coords&&O)s.V.addRecord({title:O,description:(null===(C=P.searchResult)||void 0===C?void 0:C.description)||O,coordinates:P.coords,uri:(null===(I=P.searchResult)||void 0===I?void 0:I.uri)||P.uri},u);y=i.a.create(S.a.buildRoute(k,u),{success:function(t){var r=t&&t.routes[0],o=r&&"taxiInfo"in r&&"error"in r.taxiInfo&&r.taxiInfo.error;if(t&&0!==t.routes.length&&!o){var i=n().routes.isRoutePointDragging?v.activeRouteIndex:0;if("comparison"===t.type){i=t.routes.findIndex(function(e){return!(e.type!==k.activeComparisonMode||"taxiInfo"in e&&"error"in e.taxiInfo)});var a=t.routes.find(function(e){return"taxi"===e.type}),s=t.routes.find(function(e){return"auto"===e.type});!a||!s||"error"in a.taxiInfo||(a.encodedCoordinates=s.encodedCoordinates,a.colorizeInfo=s.colorizeInfo,a.constructions=s.constructions)}e(j({error:void 0,routerResponse:t,sessionId:(null==m?void 0:m.sessionId)||"r:"+g.a.v4(),ignoreTravelModes:k.ignoreTravelModes,activeComparisonMode:"comparison"===b?k.activeComparisonMode:void 0,activeRouteIndex:-1===i?0:i})),e(D())}else e(j({routerResponse:t,error:o||"unable_to_plot_the_route"}))},fail:function(){"taxi"!==b&&e(j({error:"unknown_error"}))},always:function(){e(j({isLoading:!1}))}})}}}},checkPoints:function(){return function(e,t){var n=t(),r=C.h(n,"routes")||s.p(n);F(r.routePoints,r.viaIndexes)&&e(j({error:"invalid_points"}))}},makeRouteInitialActions:function(){return function(e,t,n){var o=n.config,i=t(),a=C.h(i,"routes");a&&(o.query.rtt||e(R.a.update(a,{travelMode:i.routes.temporaryStackData.travelMode||"auto"})),i.routes.temporaryStackData.cargo&&e(R.a.update(a,{settings:Object(r.a)(Object(r.a)({},a.settings),{},{auto:Object(r.a)(Object(r.a)({},a.settings.auto),{},{cargo:Object(r.a)(Object(r.a)({},i.routes.temporaryStackData.cargo),Object(P.d)(o.query))})})})),e(D()),(Object(P.c)(a.travelMode,a.settings)>0||s.M(a.travelMode,o)&&a.routePoints.length>o.routes.maxCount)&&e(w.updateRoute()))}},updateRoutesComparisonRoute:function(e){void 0===e&&(e="auto");return function(t,n,r){var o=r.config;i.a.cancel(y);var a=n(),c=C.h(a,"routes")||s.p(a);if(F(c.routePoints,c.viaIndexes))t(j({error:"invalid_points"}));else{var u=c.routePoints.filter(function(e){return Boolean(e.coords)}),l=u.map(function(e){return e.coords});if(u.length<2)t(j({error:void 0,routerResponse:null}));else{var d=c.routerResponse;if(d){var p=d.routes.find(function(t){return t.type===e});if(p&&p.coordinates&&!(p.coordinates.length>0)){var m={rll:l.map(function(e){return e.join(",")}).join("~"),results:1,type:e,mode:"approx",pctx:s.w(u),regionId:a.mapRegion&&a.mapRegion.id};y=i.a.create(S.a.buildRoute(m,o),{success:function(e){var n=e&&e.routes[0];n&&(p.encodedCoordinates=n.encodedCoordinates,"constructions"in p&&"constructions"in n&&(p.constructions=n.constructions),"colorizeInfo"in p&&"colorizeInfo"in n&&(p.colorizeInfo=n.colorizeInfo),"flags"in p&&"flags"in n&&(p.flags=n.flags),t(j({error:void 0,routerResponse:d})))}})}}}}}},changeMrcFeatures:D},N=Object(k.b)();function M(e){return e.map(function(e){return Object(r.a)(Object(r.a)({},e),{},{input:void 0!==e.input?e.input:e.value})})}function j(e){return function(t,n,o){var i=o.config,a=s.F(n());if(a){var c;if(e.error&&!i.query["no-taxi-route-hidden"])e.routerResponse=null;else if(e.routerResponse){s.f(e.routerResponse),s.e(e.routerResponse,a.routePoints);var u=e.activeRouteIndex&&e.routerResponse.routes[e.activeRouteIndex]||e.routerResponse.routes[0];u&&u.bounds&&(c={bounds:u.bounds,skipFirstApply:a.skipApplyBounds},a.skipApplyBounds&&(e.skipApplyBounds=!1))}t(R.a.update(a,c?Object(r.a)(Object(r.a)({},e),{},{mapLocationRequest:c}):e))}}}function A(e){var t=e.ignoreTrafficJams,n=e.travelMode,r=e.isRough;if(["auto","taxi","comparison"].includes(n))return r?"approx":t?"nojams":"best"}function D(){return function(e,t,n){var r,o=n.config;var i=t(),a=C.h(i,"routes");if(a&&a.routerResponse){var s=a.routerResponse;if("auto"===s.type||"taxi"===s.type){e(j({mrcFeatures:null,mrcThumbnail:null,activeMrcIndex:null}));var c=s.routes[a.activeRouteIndex];if(!(!c||i.routes.isRoutePointDragging||c.distance.value>T)){var u=a.routePoints[0].coords,l=!(null===(r=a.mrcThumbnail)||void 0===r?void 0:r.point)||!u||!Object(f.a)(u,a.mrcThumbnail.point);c.distance.value>x&&l&&I.e({encodedCoordinates:c.encodedCoordinates,graphType:"road"},o).then(function(n){n&&L(t())===a.activeRouteIndex&&e(j({mrcThumbnail:{feature:n,point:u}}))}),I.c({encodedCoordinates:c.encodedCoordinates,graphType:"road"},o).then(function(n){n&&L(t())===a.activeRouteIndex&&e(j({mrcFeatures:n,activeMrcIndex:0}))})}}}}}function F(e,t){var n=E(e.filter(function(e,n){return!t.includes(n)}),function(e,t){return t>=2&&!e.input&&!e.value&&!e.coords}),r=n.filter(function(e){return!e.input&&!e.value&&!e.coords}),o=n.filter(function(e){return Boolean(e.input)&&!e.coords});return 2===n.length?0===r.length&&o.length>0:r.length>0||o.length>0}function L(e){var t;return null===(t=C.h(e,"routes"))||void 0===t?void 0:t.activeRouteIndex}var B=w,z=0,U=Object(k.b)(),W={setRoutePoints:function(e,t,n){return void 0===t&&(t=[]),function(r,o){var i=C.h(o(),"routes");if(i){var a=s.o(),c=e&&e.length>=a.length?[].concat(e):a;r(R.a.update(i,{skipApplyBounds:!0,activePoint:null,routePoints:c,viaIndexes:t})),r(B.updateRoute({isRough:n}))}}},addPoint:function(){return function(e,t){var n=C.h(t(),"routes");if(n){var r=[].concat(n.routePoints,[s.r()]),o=r.length-1;e(R.a.update(n,{skipApplyBounds:!1,activeField:o,isFocused:-1!==o,routePoints:r,viaIndexes:n.viaIndexes||[]}))}}},setPoint:function(e,t){return void 0===t&&(t=s.r()),function(n,o){var i=C.h(o(),"routes");if(i){var a=[].concat(i.routePoints),s=[].concat(i.viaIndexes),c=e,u=a[e].coords!==t.coords;a[e]=Object(r.a)(Object(r.a)({},t),{},{input:void 0===t.input?t.value:t.input});var l=!a[e].input&&!a[e].coords;if(l){var d=q(e,a,s);a=d.points,s=d.viaIndexes,c=d.index}var p=i.activeField;!l||-1!==p&&p!==e||(p=c);var m=i.routePoints.every(function(e){var t=e.coords;return Boolean(t)}),f=a.every(function(e){var t=e.coords;return Boolean(t)});n(R.a.update(i,{activeField:p,routePoints:a,viaIndexes:s,mobileViewState:f&&!m&&"comparison"!==i.travelMode?"mini":i.mobileViewState})),u&&n(B.updateRoute())}}},removePoint:function(e){return function(t,n){var r=C.h(n(),"routes");if(r){var o=q(e,r.routePoints,r.viaIndexes),i=o.points,a=o.viaIndexes,c=o.index,u=s.r();i.length-a.length>2?(u=i.splice(c,1)[0],a=a.map(function(e){return e>c?e-1:e})):i[c]=s.r();var l=s.o();i=i.length>=l.length?i:l;var d=r.activeField||0;-1!==d&&d!==e||(d=s.g(i,a)),t(R.a.update(r,{skipApplyBounds:!u.value,activeField:d,isFocused:-1!==d,routePoints:i,viaIndexes:a})),t(B.updateRoute())}}},resetPoints:function(){return function(e,t){var n=C.h(t(),"routes");n&&(e(R.a.update(n,{activeField:0,isFocused:!0,error:void 0,routePoints:s.o(),viaIndexes:[],isLoading:!1})),e(B.updateRoute()))}},movePoint:function(e,t){return function(n,r){var o=C.h(r(),"routes");if(o){var i=o.viaIndexes,a=o.routePoints.filter(function(e,t){return!i.includes(t)}),s=a[e];e<t?(a.splice(t+1,0,s),a.splice(e,1)):(a.splice(e,1),a.splice(t,0,s));var c=o.activeField,u=Math.min(e,t),l=Math.max(e,t);c===u?c=l-u:c===l-u?c=u:-1===c&&(c=a.findIndex(function(e){return!e.input})),n(R.a.update(o,{skipApplyBounds:!1,activeField:c,routePoints:a,viaIndexes:[]})),n(B.updateRoute())}}},setActiveField:function(e){return function(t,n){var r=-1!==e;r||t(B.checkPoints());var o=C.h(n(),"routes");o&&t(R.a.update(o,{activeField:e,isFocused:r}))}},setFocused:function(e){return function(t,n){var r=C.h(n(),"routes");r&&(e?z&&window.clearTimeout(z):z=window.setTimeout(function(){return t(B.checkPoints())},20),t(R.a.update(r,{isFocused:e})))}},setActiveRouteIndex:function(e){return function(t,n){var r=C.h(n(),"routes");if(r){var o=e===r.activeRouteIndex;e=e>0?e:0,t(R.a.update(r,{activeRouteIndex:e,detailedIndex:-1!==r.detailedIndex?e:r.detailedIndex,activePoint:null})),o||t(B.changeMrcFeatures())}}},setActiveComparisonMode:function(e){return function(t,n){var r=C.h(n(),"routes");r&&t(R.a.update(r,{activeComparisonMode:e}))}},setDetailedIndex:function(e){return function(t,n){var o=C.h(n(),"routes");o&&(o.detailedIndex>-1?t(R.a.update(o,{detailedIndex:e,activePoint:null})):t(R.a.push(Object(r.a)(Object(r.a)({},o),{},{detailedIndex:e,activePoint:null}))))}},setActivePoint:function(e){return function(t,n){var r=C.h(n(),"routes");r&&t(R.a.update(r,{activePoint:e||null,mobileViewState:"mini"}))}},setRoutePointIsDragging:function(e){return{type:"DEEP_EXTEND",payload:{routes:{isRoutePointDragging:e}}}},setGeolocationPoint:function(e,t){return U(function(t,n,r){var o=r.config,i=C.h(n(),"routes");if(i&&i.routePoints[e]&&!i.routePoints[e].input){var a=n().geolocation;if(Object(k.d)(a,n().timeContext)){var c;t(W.setPoint(e,Object(k.c)(a.currentPosition,o)));var u=null===(c=C.h(n(),"routes"))||void 0===c?void 0:c.routePoints;u&&t(W.setActiveField(s.v(u,e)))}else"geolocation"===i.routePoints[e].serviceType&&t(W.setPoint(e))}},t)},updateGeolocationPoints:function(){return function(e,t){var n=C.h(t(),"routes"),o=t().geolocation.currentPosition;if(n&&o){var i=!1,a=n.routePoints.map(function(e){return"geolocation"===e.serviceType&&e.coords&&!Object(f.a)(e.coords,o)?(i=!0,Object(r.a)(Object(r.a)({},e),{},{searchResult:void 0,coords:o})):e});i&&e(W.setRoutePoints(a,n.viaIndexes))}}}};function q(e,t,n){for(var r=e+1,o=[];t[r]&&n.includes(r);)o.push(r),r++;for(var i=e-1;t[i]&&n.includes(i);)o.push(i),i--;var a=!1,s=n.slice().sort(function(e,t){return e-t}).reduce(function(e,t){return o.includes(t)?(a=!0,e):e.concat(a?t-o.length:t)},[]);return{index:i+1,points:t.filter(function(e,t){return!o.includes(t)}),viaIndexes:s}}var V,H=W,G=n(109),K=n(23),J=n(49),X=n(32),Y=s.o().length,Z=Object(r.a)(Object(r.a)(Object(r.a)({},H),B),{},{setGeolocationError:function(e){return function(t,n){var r=C.h(n(),"routes");r&&t(R.a.update(r,{geolocationError:e}))}},open:function(e,t){return void 0===t&&(t=[]),function(n,o){var i=o(),c=C.h(o(),"routes"),u=e&&e.length>=Y?[].concat(e):s.o();u[1].value||t.includes(1)||(u[1]=a.a(i));var l=c&&-1!==c.activeField?c.activeField:s.g(u,t);n(R.a.push(Object(r.a)(Object(r.a)({mode:"routes"},s.p(i)),{},{activeField:l,isFocused:-1!==l,routePoints:u,viaIndexes:t}),{ruler:Object(r.a)(Object(r.a)({},i.ruler),{},{isEnabled:!1})})),n(B.updateRoute())}},changeTravelMode:function(e,t){return void 0===t&&(t={}),function(n,o){var i=C.h(o(),"routes");if(i){var a=i.routePoints.filter(function(e,t){return!i.viaIndexes.includes(t)});n(K.a.changeTravelMode(e));var c=a[i.activeField]&&!a[i.activeField].value?i.activeField:s.g(a,[]),u=null;!i.routerResponse||"comparison"!==e&&"comparison"!==i.travelMode||((u=Object(r.a)({},i.routerResponse)).routes=u.routes.filter(function(e,t){return t===i.activeRouteIndex})),n(R.a.update(i,{routerResponse:u,travelMode:e,activeRouteIndex:0,detailedIndex:-1,moreSnippetsShown:!1,activePoint:null,skipApplyBounds:!1,activeField:c,isFocused:-1!==c,error:void 0,optimizingStatus:void 0,routePoints:a.length>=Y?a:s.o(),viaIndexes:[],mobileViewState:"comparison"===e?"expanded":t.mobileViewState||i.mobileViewState})),n(B.updateRoute())}}},setSkipApplyBounds:function(e){return function(t,n){var r=C.h(n(),"routes");r&&t(R.a.update(r,{skipApplyBounds:e}))}},processMapObjectClick:function(e){return function(t,n,o){var i=o.config,a=n(),c=C.h(n(),"routes"),u=s.u(a);if(-1!==u){if(!c)return;var l=e.skipApplyBounds,d=void 0===l||l,m=e.point;t(Z.setSkipApplyBounds(d));var f=J.m(m.uri),v=m.uri&&J.j(m.uri);(f||v?p(m.uri,m.coords,i,"router").then(function(e){return function(e,t){return e.uri&&t?Object(r.a)(Object(r.a)({},e),{},{value:t.title,input:t.title,searchResult:t}):e.value&&!e.coords&&t?Object(r.a)(Object(r.a)({},e),{},{coords:t.displayCoordinates}):e.coords?Object(r.a)(Object(r.a)({},e),{},{value:e.value||t&&t.title||"",input:e.input||t&&t.title||"",searchResult:t}):e}(m,e)}):Promise.resolve(m)).then(function(e){t(H.setPoint(u,Object(r.a)(Object(r.a)({},e),{},{ignorePctx:e.searchResult&&"toponym"===e.searchResult.type})))});var g=u+1,h=c.routePoints[g],b=!h||h.coords?c.routePoints.findIndex(function(e){return!e.input}):g;u!==b&&t(H.setActiveField(b));var _=C.h(n(),"routes");_&&_.routePoints.every(function(e){var t=e.value;return Boolean(t)})&&t(Z.hideMapForm())}else e.action&&e.action()}},activateMasstransitLinePanel:function(e){return function(t){t(G.a.fetchLineInfo(e))}},openMapForm:function(){return function(e,t){var n=C.h(t(),"routes");n&&e(R.a.update(n,{showMapForm:!0}))}},hideMapForm:function(){return function(e,t){var n=C.h(t(),"routes");n&&e(R.a.update(n,{showMapForm:!1}))}},updateSettings:function(e,t,n){return function(o,i){var a,s,c=C.h(i(),"routes");if(c){var u=Object(r.a)(Object(r.a)({},c.settings),{},((s={})[e]=Object(r.a)(Object(r.a)({},c.settings[e]),{},((a={})[t]=n,a)),s));o(R.a.update(c,{settings:u})),o(B.updateRoute())}}},setActiveMrcIndex:function(e){return function(t,n){var r=C.h(n(),"routes");r&&(t(R.a.update(r,{activeMrcIndex:e||0})),t({type:"DEEP_EXTEND",payload:{routes:{isMrcPlayerHidden:!1}}}))}},hideMrcMiniPlayer:function(){return function(e,t){var n=C.h(t(),"routes");n&&(e(R.a.update(n,{activeMrcIndex:null})),e({type:"DEEP_EXTEND",payload:{routes:{isMrcPlayerHidden:!0}}}))}},optimizeRoute:function(){return function(e,t,n){var a=n.config;i.a.cancel(V);var c=C.h(t(),"routes");if(c&&c.routerResponse&&["pedestrian","auto","masstransit"].includes(c.travelMode)){var u=s.G(c.travelMode,c.settings),l=c.routePoints.filter(function(e,t){return Boolean(e.coords)&&!c.viaIndexes.includes(t)});if(0!==l.length){var d="auto"===c.travelMode&&0!==Object.keys((null==u?void 0:u.cargo)||{}).length,p={rll:l.map(function(e){return e.coords.join(",")}).join("~"),routeType:c.travelMode,isTruck:d,dateString:u&&u.timeDependent&&u.timeDependent.time||s.n(X.g({hydrationPhaseTime:null,mocks:a.query}))};e(Z.setOptimizingStatus("loading")),V=i.a.create(S.a.optimizeRoutePoints(p,a),{success:function(n){if(n){var i=C.h(t(),"routes");if(i&&i.travelMode===c.travelMode&&i.routePoints===c.routePoints){var a=l.reduce(function(e,t){var n;return Object(r.a)(Object(r.a)({},e),{},((n={})[Object(o.a)(t.coords)]=t,n))},{}),s=n.points.map(function(e){return a[Object(o.a)(e)]});e(Z.setOptimizingStatus("success")),e(B.buildRoute({points:s,travelMode:c.travelMode}))}else e(Z.setOptimizingStatus(void 0))}else e(Z.setOptimizingStatus("error"))},fail:function(){e(Z.setOptimizingStatus("error"))}})}}}},setOptimizingStatus:function(e){return function(t,n){var r=C.h(n(),"routes");r&&t(R.a.update(r,{optimizingStatus:e,isLoading:"loading"===e}))}},showMoreSnippets:function(){return function(e,t){var n=C.h(t(),"routes");n&&e(R.a.update(n,{moreSnippetsShown:!0}))}}});t.default=Z},2753:function(e,t,n){"use strict";var r=n(6),o=(n(1593),n(1595),n(4)),i=n(7),a=n(9),s=n(1022),c=n(13),u=n(10),l=(n(1597),n(1599),n(257)),d=n(69),p=n(8),m=(n(1601),n(1603),Object(i.a)("route-auto-step-view")),f=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onClick=function(){var e=t.props,n=e.segment,r=e.onClick;n.edgePoints&&r(n.edgePoints[0])},t}return Object(r.a)(t,e),t.prototype.render=function(){var e,t=this.props.segment,n=t.distance,r=t.street,i=t.action,a=n&&n.text||"";r&&(a+=", "+r);var s=i&&i.value.toLowerCase().replace(/_/g,"-")||"";return o.createElement(p.a,{name:"step_item",logClick:!0,nodeState:{description:i&&i.text||""},useParentState:!0},o.createElement("div",{className:m(),onClick:this._onClick},o.createElement("div",{className:m("item")},o.createElement("div",{className:m("icon",(e={},e[s]=Boolean(s),e))}),o.createElement("div",{className:m("title")},i&&i.text||""),o.createElement("div",{className:m("description")},o.createElement("div",{className:m("description-content")},a)))))},t}(o.Component),v=n(1605),g=(n(1609),n(1611),n(2796)),h=n(1019),b=Object(i.a)("route-waypoint-step-view"),_=function(e){var t=e.waypoint,n=e.type,r=e.onClick,i=e.timeText,a=e.waitClosedUntilText,s=e.isLast,c=e.dateText;return o.createElement(p.a,{name:"waypoint",nodeState:{index:String(t.index)},logClick:!0},o.createElement("div",{className:b({index:String(t.index),type:n,last:s}),onClick:function(){return r(t.coordinates)}},o.createElement("div",{className:b("item",{"with-date":Boolean(c)})},o.createElement("div",{className:b("row")},o.createElement("div",{className:b("icon")},o.createElement(h.a,{index:t.index,isLast:s,activated:!0})),o.createElement("div",{className:b("title")},t.name||Object(g.a)(t.coordinates,{reverse:!0})),i||c?o.createElement("div",{className:b("time-date-text")},i?o.createElement("div",{className:b("time-text")},i):null,c?o.createElement("div",{className:b("date-text")},c):null):null),a&&0===t.index?o.createElement("div",{className:b("waiting-duration")},(function(params){return "подождать "+params.duration;})({duration:""}),o.createElement("span",{className:b("waiting-duration-unit")},a)):null)))},y=n(47),E=n(324),S=n(48),R=n(29),C=n(1613),I=n.n(C),k=Object(i.a)("route-detailed-view"),P=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._getSteps=function(e){var n=t.props,r=n.waypoints,o=[];"auto"===n.route.type?n.route.paths.forEach(function(t,i){o.push({model:r[i],options:{dateText:t.beginTime&&e?Object(y.a)(new Date(1e3*Number(t.beginTime.value)),n.config,{isShortDate:!0}):void 0,timeText:t.beginTime?d.h(t.beginTime,n.config,n.route):void 0}}),t.segments.forEach(function(e){o.push({model:e,options:{}})})}):"masstransit"!==n.route.type&&"metro"!==n.route.type||n.route.paths.forEach(function(t,i){"metro"!==n.route.type&&o.push({model:r[i],options:{dateText:t.beginTime&&e?Object(y.a)(new Date(1e3*Number(t.beginTime.value)),n.config,{isShortDate:!0}):void 0,timeText:t.beginTime?d.h(t.beginTime,n.config,n.route):void 0}}),t.segments.forEach(function(e,t,n){var r={};"transport"===e.type&&(n[t+1]&&"walk"!==n[t+1].type&&(r.transferFrom=!0),n[t-1]&&"walk"!==n[t-1].type&&(r.transferTo=!0)),o.push({model:Object(u.a)({},e),options:r})})});var i=n.route.paths[n.route.paths.length-1];return"metro"!==n.route.type&&o.push({model:r[n.route.paths.length],options:{dateText:i.endTime&&e?Object(y.a)(new Date(1e3*Number(i.endTime.value)),n.config,{isShortDate:!0}):void 0,timeText:i.endTime?d.h(i.endTime,n.config,n.route):void 0}}),o},t}return Object(r.a)(t,e),t.prototype.render=function(){var e,t,n=this.props,r=("auto"===n.route.type||"masstransit"===n.route.type)&&(e=n.route,t=e.paths[0].beginTime&&new Date(1e3*Number(e.paths[0].beginTime.value)),e.paths.some(function(e){if(!t||!e.beginTime||!e.endTime)return!1;var n=new Date(1e3*Number(e.beginTime.value)),r=new Date(1e3*Number(e.endTime.value));return!Object(l.a)(n,t)||!Object(l.a)(r,t)})),i=("auto"===n.route.type||"masstransit"===n.route.type)&&function(e,t){var n=e.paths[0].beginTime&&new Date(1e3*Number(e.paths[0].beginTime.value));return!!n&&!Object(l.a)(n,t)}(n.route,this.props.getToday()),a=this._getSteps(r||i),s=Object(E.c)(n.travelMode,n.settings),m=a.some(function(e){var t;return"transports"in e.model&&e.model.transports&&(null===(t=d.y(e.model.transports))||void 0===t?void 0:t.alert)});return o.createElement(p.a,{name:"route_details",actionSubtreeState:{type:n.travelMode,isIntercityRoute:Boolean("isIntercityRoute"in n.route&&n.route.isIntercityRoute),isCargo:s>0}},o.createElement("div",{className:k({type:n.route.type})},o.createElement("div",{className:k("steps-layout")},a.map(function(e,t){var i,a=Object(u.a)({type:n.route.type,onClick:n.onPointClick,key:t,waitClosedUntilText:n.route.waitClosedUntil&&d.q(n.route.waitClosedUntil.value,n.config)||void 0,onMasstransitLineClick:n.onMasstransitLineClick},e.options);return d.K(e.model)?o.createElement(f,Object(c.a)({segment:e.model},a)):d.R(e.model)?o.createElement(v.a,Object(c.a)({onStopClick:n.onStopClick,routeType:n.route.type,isInterDateRoute:r,segment:e.model},a,{isIntercityRoute:"isIntercityRoute"in n.route&&n.route.isIntercityRoute,isTimeDependent:Boolean(null===(i=n.settings)||void 0===i?void 0:i.masstransit.timeDependent.time),hasAlerts:m||Boolean(a.waitClosedUntilText)})):d.U(e.model)?o.createElement(_,Object(c.a)({isLast:e.model.index===n.waypoints.length-1,waypoint:e.model},a)):null})),n.onEditClick?o.createElement(p.a,{name:"feedback",nodeState:{type:n.route.type,uri:n.route.uri},logClick:!0},o.createElement(R.a,{className:k("edit",{noprint:!0}),view:"link",iconUrl:I.a,onClick:n.onEditClick},"Исправить неточность")):null))},t}(o.Component);var O=Object(S.b)(Object(a.b)(P)),T=n(42),x=n(72),w=n(1141),N=Object(i.a)("route-panel-detailed-view"),M=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._renderContent=function(){var e=t.props;return o.createElement(o.Fragment,null,o.createElement("div",{className:N("header")},o.createElement(w.a,{route:e.route,waypoints:e.waypoints,settings:e.settings,isComparison:"comparison"===e.travelMode,detailed:!0})),o.createElement("div",{className:N("body")},o.createElement(O,{travelMode:e.travelMode,route:e.route,settings:e.settings,waypoints:e.waypoints,onPointClick:e.onDetailedPointClick,onEditClick:e.onEditClick,onStopClick:e.onStopClick,onMasstransitLineClick:e.onMasstransitLineClick})))},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props;return o.createElement("div",{className:N()},o.createElement(T.a,{position:"top",disabled:!0},o.createElement(x.a,{showBorder:!0,title:"Подробный маршрут",onClose:void 0})),o.createElement("div",{className:N("content")},o.createElement(s.a,{travelMode:e.travelMode,detailed:!0},this._renderContent())))},t}(o.Component);t.a=Object(a.b)(M)},276:function(e,t,n){},278:function(e,t,n){},2784:function(e,t,n){"use strict";var r=n(6),o=(n(1501),n(1503),n(4)),i=n(7),a=n(9),s=n(1505),c=n(1530),u=(n(1591),n(8)),l=Object(i.a)("route-error-view"),d={auto:{title:"Не удалось проложить\nавтомобильный маршрут",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},bicycle:{title:"Не удалось проложить\nвеломаршрут",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},masstransit:{title:"Не удалось проложить маршрут\nна общественном транспорте",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},pedestrian:{title:"Не удалось\nпроложить пеший маршрут",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},taxi:{title:"Не удалось проложить\nмаршрут на такси",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},comparison:{title:"Не удалось\nпостроить маршрут",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"}},p={taxi_unavailable:{title:"К сожалению, заказ такси через Яндекс Go\nещё не работает в этом регионе"},taxi_no_cars:{title:"В данный момент нет доступных\nмашин для выбранного маршрута"},taxi_not_found:{title:"Не удалось проложить\nмаршрут на такси",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},metro_route_invalid:{advice:"Не удалось построить маршрут. Попробуйте выбрать другие станции"}},m={title:"Невозможно проложить маршрут между точками",advice:"Попробуйте выбрать другой транспорт\nили поменять точки маршрута"},f=function(e){var t=e.error,n=e.travelMode,r=e.showLink;if("invalid_points"===t)return null;var i="unknown_error"===t||"unable_to_plot_the_route"===t?d[n]:p[t],a={type:(null==i?void 0:i.title)||m.title||(null==i?void 0:i.advice)||m.advice};i||(a.error=String(t),a.travelMode=String(n));var s=i||m;return o.createElement(u.a,{name:"error",nodeState:a,key:t},o.createElement("div",{className:l()},s.title?o.createElement("div",{className:l("text")},s.title):null,s.advice?o.createElement("div",{className:l("advice",{"with-margin":Boolean(s.title)})},s.advice):null,r?o.createElement("span",{className:l("link")},"Изменить маршрут"):null))},v=(n(42),n(72),n(1022)),g=n(69),h=n(599),b=n.n(h),_=n(30),y=(n(16),Object(i.a)("route-panel-form-view")),E=-1,S=function(e){function t(t){var n;return(n=e.call(this,t)||this)._renderForm=function(){var e=n.props,t=e.routePoints,r=e.travelMode,i=e.viaIndexes,a=e.activeField,c=e.isFocused,u=e.optimizeRoute,l=e.addPoint,d=e.setPoint,p=e.removePoint,m=e.changeTravelMode,f=e.resetPoints,v=e.movePoint,g=e.setActiveField,h=e.setFocused,b=e.places,_=e.routerResponse;return o.createElement("div",{className:y("top-pane")},o.createElement(s.a,{travelMode:r,routePoints:t,viaIndexes:i,activeField:a,isFocused:c,mapLocation:n.props.mapLocation,places:b,hasRouterResponse:Boolean(_),optimizingStatus:n.props.optimizingStatus,isLoading:n.props.isLoading,isError:Boolean(n.props.error&&"invalid_points"!==n.props.error),setGeolocationPoint:n.props.setGeolocationPoint,addPoint:l,setPoint:d,removePoint:p,changeTravelMode:m,resetPoints:f,movePoint:v,setActiveField:g,setFocused:h,setScrollDisabled:n.props.setScrollDisabled,optimizeRoute:u,checkAuthorization:n.props.checkAuthorization,onActionItemClick:n.props.onActionItemClick}))},n._renderPanelCategoriesView=function(){var e=n.props.routePoints.filter(function(e){return e.coords}),t=e[e.length-1];return t&&t.coords?o.createElement("div",{className:y("categories")},o.createElement("div",{className:y("categories-title")},(function(params){return "Искать рядом с «"+params.place+"»";})({place:t.value})),o.createElement(b.a,{theme:"gray",mode:"routes",nearbyPlace:t.searchResult?_.l(t.searchResult):{coordinates:t.coords,title:t.value}})):null},n._renderData=function(){var e=n.props,t=n.state,r=e.travelMode;return e.error?o.createElement("div",{className:y("error")},o.createElement(f,{error:e.error,travelMode:r})):t.formRouterResponse&&t.formRouterResponse.routes&&t.formRouterResponse.routes.length>0||e.isLoading?o.createElement(o.Fragment,null,o.createElement("div",{className:y("route-list")},o.createElement(c.a,{routePoints:e.routePoints,routerResponse:t.formRouterResponse,routeRegion:g.D(e.routePoints),tip:e.tip,travelMode:e.travelMode,activeRouteIndex:e.activeRouteIndex,detailedIndex:E,collapsedSidebar:e.collapsedSidebar,settings:e.settings,isLoading:!e.isRoutePointDragging&&e.isLoading,moreSnippetsShown:e.moreSnippetsShown,optimizingStatus:e.optimizingStatus,onEditClick:e.onEditClick,setActiveComparisonMode:e.setActiveComparisonMode,setActiveRouteIndex:e.setActiveRouteIndex,setDetailedIndex:e.setDetailedIndex,updateSettings:e.updateSettings,changeTravelMode:e.changeTravelMode,setOptimizingStatus:e.setOptimizingStatus,showMoreSnipets:e.showMoreSnippets,updateRoutesComparisonRoute:e.updateRoutesComparisonRoute})),null):null},n._renderContent=function(){return o.createElement(o.Fragment,null,n._renderForm(),n._renderData())},n.state={formRouterResponse:t.routerResponse},n}return Object(r.a)(t,e),t.getDerivedStateFromProps=function(e){return e.isRoutePointDragging?null:{formRouterResponse:e.routerResponse}},t.prototype.render=function(){var e=this.props;return o.createElement("div",{className:y()},null,o.createElement("div",{className:y("content")},o.createElement(v.a,{travelMode:e.travelMode},this._renderContent())),"loading"===e.optimizingStatus?o.createElement("div",{className:y("map-paranja"),style:{width:e.mapSize.width,height:e.mapSize.height,left:e.mapOffset.left,top:e.mapOffset.top}}):null)},t}(o.Component);t.a=Object(a.b)(S)},280:function(e,t,n){},2801:function(e,t,n){"use strict";var r=n(250);t.a=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Object(r.a)(e,void 0,t):[]}},282:function(e,t,n){"use strict";var r=n(6),o=n(283),i=n.n(o),a=n(4),s=n.n(a),c=n(178),u=n(9),l=n(223),d=n(8),p=n(7),m=n(20),f=Object(m.a)({resolved:{},chunkName:function(){return"promo"},isReady:function(e){var t=this.resolve(e);return!1!==this.resolved[t]&&!!n.m[t]},importAsync:function(){return n.e("promo").then(n.bind(null,144))},requireAsync:function(e){var t=this,n=this.resolve(e);return this.resolved[n]=!1,Promise.resolve(this.importAsync(e)).then(function(e){return t.resolved[n]=!0,e})},requireSync:function e(t){var r=this.resolve(t);return n(r)},resolve:function e(){return 144}},{ssr:!1}),v=Object(p.a)("banner-wrapper-view"),g=function(e){function t(t){var n;return(n=e.call(this,t)||this)._bannerContainerRef=a.createRef(),n._timerId=-1,n._collectStyles=function(e){var t=Object(c.d)(e.emptyBannerStyle)+Object(c.d)(e.containersStyle);return e.slots.forEach(function(e){t+=Object(c.d)(n._getSlotStyleSet(e))}),t},n._getSlotStyleSet=function(e){var t=n.props.bannerFirst;return"banner"===e.type?t?e.beforeChildrenStyle:e.afterChildrenStyle:"children"===e.type?t?e.afterBannerStyle:e.beforeBannerStyle:e.style},n._renderBanner=function(){var e=n.props;return a.createElement(d.a,{name:"banner",nodeState:{isBlocked:n.state.isBlocked}},a.createElement(f,{id:e.bannerId,fallback:e.fallback,fallbackDirect:e.fallbackDirect,fallbackView:e.fallbackView}))},n._renderSlot=function(e){var t=n.props,r=n._getSlotStyleSet(e);return"banner"===e.type?a.createElement("div",{key:r.selector,className:r.selector,style:t.bannerStyle,ref:n._bannerContainerRef},n._renderBanner()):"children"===e.type?a.createElement("div",{key:r.selector,className:r.selector},t.children):a.createElement("div",{key:r.selector,className:r.selector},a.createElement("div",{className:e.childrenClassNames[0]},a.createElement("div",{className:e.childrenClassNames[1]}),a.createElement("div",{className:e.childrenClassNames[2]})))},n.state={},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this._timerId=window.setTimeout(function(){var t,n;(null===(t=e._bannerContainerRef.current)||void 0===t?void 0:null===(n=t.style)||void 0===n?void 0:n.cssText)&&e.setState({isBlocked:!0})},5e3)},n.componentWillUnmount=function(){clearTimeout(this._timerId)},n.render=function(){var e=this.props,t=e.config.bannerLayout;if(h()){var n={order:e.bannerFirst?2:0};return a.createElement("div",{className:v("")},a.createElement("div",{className:v("content"),style:n},e.children),a.createElement("div",{className:v("banner")},this._renderBanner()),a.createElement(l.a,{stylesString:Object(c.d)({selector:"banner-wrapper-view__banner",style:""})}))}return a.createElement("div",{className:t.containersStyle.selector},a.createElement(l.a,{stylesString:this._collectStyles(t)}),t.slots.map(this._renderSlot))},t}(a.Component);function h(){return Math.random()==Math.random()}t.a=Object(u.b)(g)},283:function(e,t,n){},29:function(e,t,n){"use strict";var r=n(6),o=(n(171),n(4)),i=n(7),a=n(27),s=n(11),c=n(130),u=n.n(c),l=Object(i.a)("card-feature-view"),d=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._renderIcon=function(){var e=t.props,n=e.iconUrl;if(null===n)return null;var r=e.iconClassName;return o.createElement("div",{className:l("icon-wrapper",{"no-color":e.keepIconColor})+(r?" "+r:"")},n?o.createElement(s.a,{url:n}):e.icon)},t._renderMain=function(){var e=t.props;return o.createElement("div",{className:l("main")},t._renderIcon(),o.createElement("div",{className:l("content")},e.title?o.createElement("div",{className:l("title")},e.title):null,o.createElement("div",{className:l("main-content")},e.children),e.subcontent?o.createElement("div",{className:l("subcontent")},e.subcontent):null))},t._renderAdditional=function(){var e=t.props;return e.value||e.arrowView?o.createElement("div",{className:l("additional"),onClick:e.onAdditionalClick},e.value?o.createElement("div",{className:l("value")},e.value):null,e.arrowView?o.createElement("div",{className:l("arrow",{view:e.arrowView})},o.createElement(s.a,{url:u.a})):null):null},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.subcontent,n=e.onClick,r=e.title?"medium":e.size||"large",i=null===e.icon||null===e.iconUrl;return o.createElement("div",{className:l({view:e.view||"normal",size:r,subcontent:Boolean(t),interactive:Boolean(n),"has-title":Boolean(e.title),disabled:e.disabled,"no-icon":i,"no-side-padding":e.noSidePadding||e.isWideCard})+(e.className?" "+e.className:""),onClick:n},o.createElement("div",{className:l("wrapper")},this._renderMain(),this._renderAdditional()),o.createElement("div",{className:l("border",{border:e.border,stretch:e.stretchBorder||i})}))},t}(o.Component);t.a=Object(a.b)(d)},322:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(194),o=n(232);function i(e){var t=e[0][1],n=[e[1][0]-e[0][0],e[1][1]-t],i=Math.tan(Object(r.a)(t+90)/2),a=Math.tan(Object(r.a)(n[1])/2),s=Math.max((-i*i-i*a)/(i*a-1),0),c=.5*Math.log(s),u=2*(Math.atan(Math.exp(c))-.25*Math.PI);return{center:[(e[0][0]+e[1][0])/2,Object(o.a)(u)],span:n}}},323:function(e,t,n){"use strict";var r=n(180);t.a=function(e){return(null==e?0:e.length)?Object(r.a)(e,1):[]}},324:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return a});var r=["vehicle_eco_class","vehicle_has_trailer","vehicle_width","vehicle_height","vehicle_length","vehicle_weight","vehicle_axle_weight","vehicle_max_weight","vehicle_pass_ids","vehicle_payload"],o=[{type:"vehicle_weight",restrictionType:"weightLimit",text:"Фактическая масса (с грузом)",unit:"т",controlType:"number"},{type:"vehicle_max_weight",restrictionType:"maxWeightLimit",text:"Разрешённая максимальная масса",unit:"т",controlType:"number"},{type:"vehicle_axle_weight",restrictionType:"axleWeightLimit",text:"Нагрузка на ось",unit:"т",controlType:"number"},{type:"vehicle_payload",restrictionType:"payloadLimit",text:"Ограничение грузоподъёмности",unit:"т",controlType:"number"},{type:"vehicle_height",restrictionType:"heightLimit",text:"Высота",unit:"м",controlType:"number"},{type:"vehicle_width",restrictionType:"widthLimit",text:"Ширина",unit:"м",controlType:"number"},{type:"vehicle_length",restrictionType:"lengthLimit",text:"Длина",unit:"м",controlType:"number"},{type:"vehicle_eco_class",restrictionType:"minEcoClass",text:"Экологический класс",controlType:"select",selectItems:[{text:"——",id:"0"},{text:"Евро-1",id:"1"},{text:"Евро-2",id:"2"},{text:"Евро-3",id:"3"},{text:"Евро-4",id:"4"},{text:"Евро-5",id:"5"},{text:"Евро-6",id:"6"}]},{type:"vehicle_has_trailer",restrictionType:"trailerNotAllowed",text:"Движение с прицепом",controlType:"checkbox"}];function i(e){return function(e){if(!e||0===e.length)return[];var t=[];return e.forEach(function(e){t=t.concat(Object.keys(e))}),Array.from(new Set(t))}(e).map(function(e){var t=o.find(function(t){return t.restrictionType===e});return null==t?void 0:t.text}).filter(Boolean)}function a(e,t){return"auto"===e&&t&&t.auto.cargo?Object.values(t.auto.cargo).filter(Boolean).length:0}function s(e){return r.filter(function(t){return void 0!==e[t]}).reduce(function(t,n){return t[n]=e[n],t},{})}},326:function(e,t,n){e.exports=n.p+"_/113d4bdd030901e316d83e1a389ed2ad.svg"},327:function(e,t,n){"use strict";var r=n(6),o=(n(371),n(4)),i=n(232),a=n(2796),s=n(7),c=n(60),u=n(55),l=n(54),d=n(8),p=n(87),m=Object(s.a)("map-entrances-view"),f=function(e){function t(t){var n;return(n=e.call(this,t)||this)._onMapUpdate=function(){var e=n.props,t=n.state,r=e.map.zoom,o=e.map.azimuth;r===t.mapZoom&&o===t.mapAzimuth||n.setState({mapZoom:r,mapAzimuth:o})},n._renderEntrance=function(e,t){var r=n.props,s=n.state,c=v(s.mapZoom),u=(e.azimuth||0)+Object(i.a)(s.mapAzimuth);return o.createElement(d.a,{key:t,name:"entrance",nodeState:{name:e.name,coords:Object(a.a)(e.coordinates)}},o.createElement(l.a,{coordinates:e.coordinates,nonInteractive:!r.onEntranceClick,onClick:function(){var t;return null===(t=r.onEntranceClick)||void 0===t?void 0:t.call(r,e)},zIndex:p.a.search.base},o.createElement("div",{className:m({size:c,animated:r.animated}),style:{transform:"rotate("+u+"deg) translate(-50%, -50%)"}},void 0!==e.azimuth?o.createElement("div",{className:m("arrow")}):void 0,o.createElement("div",{className:m("dot")}))))},n._renderEntrances=function(){var e=n.props,t=v(n.state.mapZoom);return e.result.entrances&&t?e.result.entrances.map(n._renderEntrance):null},n.state={mapZoom:t.map.zoom,mapAzimuth:t.map.azimuth},n}return Object(r.a)(t,e),t.prototype.render=function(){return o.createElement(o.Fragment,null,this._renderEntrances(),o.createElement(u.b,{onUpdate:this._onMapUpdate}))},t}(o.PureComponent);function v(e){return e>=18?"large":e>=17?"normal":e>=16?"small":void 0}t.a=Object(c.b)({shouldWait:!0})(f)},369:function(e,t,n){"use strict";var r,o,i=n(6),a=n(4),s=n(5),c=n(582),u=n(9),l=function(e){function t(t){var n;return(n=e.call(this,t)||this)._ref=a.createRef(),n._calcSizes=function(e){return new Promise(function(t){n.setState({render:e},function(){var e=n._ref.current.children[0],r=e.offsetWidth,o=e.offsetHeight;t({width:r,height:o})})})},n.state={render:function(){return null}},n}Object(i.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.setCalcSizes(this._calcSizes)},n.render=function(){return a.createElement("div",{ref:this._ref},this.state.render())},t}(a.PureComponent);t.a=function(e){var t=function(){var t,n;return o||(t=window.document.createElement("div"),n=Object(c.a)(),t.setAttribute("style","position: absolute; top: -1000px; left: -1000px"),window.document.body.appendChild(t),o=new Promise(function(e){s.render(a.createElement(u.a,{value:n},a.createElement(l,{setCalcSizes:e})),t)})),o.then(function(t){return t(e)})};return r=r?r.then(t):t()}},370:function(e,t,n){"use strict";var r,o=n(6),i=n(4),a=n(60),s=function(e){function t(){return e.apply(this,arguments)||this}Object(o.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props;if(!r){var t=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._uris=[],t}Object(o.a)(t,e);var n=t.prototype;return n.test=function(e){var t=e.metadata,n=t&&t.get("uri");return!n||!this._uris.includes(n)},n.add=function(e){this._uris.push(e),this._emit("update")},n.remove=function(e){this._uris=this._uris.filter(function(t){return t!==e}),this._emit("update")},t}(e.ymaps3.eventify().with());r=new t,e.map.addObjectFilter(r)}r.add(this.props.uri)},n.componentDidUpdate=function(e){this.props.uri!==e.uri&&(r.remove(e.uri),r.add(this.props.uri))},n.componentWillUnmount=function(){r.remove(this.props.uri)},n.render=function(){return null},t}(i.Component);t.a=Object(a.b)({shouldWait:!0})(s)},371:function(e,t,n){},373:function(e,t,n){"use strict";var r=n(6),o=(n(374),n(4)),i=n(12),a=n(7),s=n(28),c=n(8),u=n(9),l=n(17),d=n(16),p=Object(l.a)(i.b(function(e){return{isCollapsed:d.n(e)}}),u.b),m=Object(a.a)("sidebar-dropdown"),f=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props;return e.isCollapsed?null:o.createElement(s.a,{selector:".sidebar-dropdown-container"},o.createElement(c.a,{name:"dropdown"},o.createElement("div",{className:m({shown:!0})},o.createElement("div",{className:m("mask"),onClick:e.onClose}),o.createElement("div",{className:m("content")},e.children))))},t}(o.PureComponent);t.a=p(f)},374:function(e,t,n){},416:function(e,t,n){"use strict";n(734);var r=n(4),o=n(7),i=n(110),a=n(54),s=Object(o.a)("mrc-map-icon-view");t.a=Object(i.a)(function(e){return r.createElement(a.a,{disableRoundCoordinates:!0,coordinates:e.coordinates,nonInteractive:!e.onClick,zIndex:e.zIndex,onClick:e.onClick},r.createElement("div",{className:s({type:e.type||"main"}),style:{transform:"rotate("+(e.direction?e.direction:0)+"deg)"},ref:e.forwardedRef?e.forwardedRef:null}))})},417:function(e,t,n){"use strict";var r=n(4),o=n(8),i=n(262),a=n(478),s=n(11),c=n(326),u=n.n(c);t.a=function(e){return r.createElement(o.a,{name:"send_to_phone"},r.createElement(i.a,{openOptions:e.openOptions},function(t){var n=t.onClick;return r.createElement(a.a,{icon:r.createElement(s.a,{url:u.a}),text:e.children,buttonText:e.buttonText,onClick:n})}))}},42:function(e,t,n){"use strict";var r=n(6),o=(n(81),n(4)),i=n(7),a=n(116),s=n(97),c=n(46),u=1,l=Object(i.a)("sticky-wrapper"),d=function(e){function t(t){var n;return(n=e.call(this,t)||this)._containerRef=o.createRef(),n._isDisabled=function(e){return void 0===e&&(e=n.props),e.disabled||!e.scrollId},n._registerContainer=function(){var e,t=n.props,r=null!==(e=t.order)&&void 0!==e?e:u;if(n._containerRef.current){var o=t.scrollId;if(!o)return;t.registerStickyElement(o,r,n._containerRef,n._onPositionUpdate),t.updateStickyElement(o,r,n._containerRef.current.offsetHeight),n._unregisterContainer=function(){t.unregisterStickyElement(o,r)}}},n._onIntersectionChange=function(e){n.setState({fixed:!e})},n._onPositionUpdate=function(e){var t,r;n.setState({position:e}),null===(t=(r=n.props).onOffsetChange)||void 0===t||t.call(r,e)},n._onIntersectionParentBoundaries=function(e){n.setState({reachedParentBoundaries:!e})},n.state={fixed:!1,reachedParentBoundaries:!1,position:0},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._isDisabled()||this._registerContainer()},n.componentDidUpdate=function(e,t){var n=this.props,r=this.state,o=n.children!==e.children;(n.children&&o||this._isDisabled(e)&&!this._isDisabled())&&this._registerContainer(),n.onFixedChange&&t.fixed!==r.fixed&&n.onFixedChange(r.fixed)},n.componentWillUnmount=function(){var e;null===(e=this._unregisterContainer)||void 0===e||e.call(this)},n.render=function(){var e,t=this.props,n=this.state;return t.children?this._isDisabled()?t.children:o.createElement(o.Fragment,null,"top"===t.position?o.createElement(c.a,{threshold:0,style:n.position?{transform:"translateY(-"+n.position+"px)"}:void 0,className:l("observer-target"),onChange:this._onIntersectionChange},null):null,o.createElement("div",{className:l({position:t.position,fixed:n.fixed,header:t.header,border:null!==(e=t.border)&&void 0!==e?e:"auto",wide:t.wide,"reached-boundaries":n.reachedParentBoundaries}),style:{top:this.state.position,zIndex:t.zIndex},ref:this._containerRef},o.createElement(c.a,{threshold:0,style:n.position?{transform:"translateY(-"+n.position+"px)"}:void 0,className:l("observer-target",{absolute:!0}),onChange:this._onIntersectionParentBoundaries},null),t.children)):null},t}(o.Component);t.a=Object(s.b)(Object(a.b)(d))},45:function(e,t,n){"use strict";var r=n(94),o=1/0;t.a=function(e){if("string"==typeof e||Object(r.a)(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}},458:function(e,t,n){"use strict";var r=n(10),o=n(25),i={getSummary:function(e,t){return Object(o.a)("router/getSummary",{query:Object(r.a)(Object(r.a)({},e),{},{lang:t.lang,locale:t.locale})},t)},optimizeRoutePoints:function(e,t){return Object(o.a)("router/optimizeRoutePoints",{query:Object(r.a)(Object(r.a)({},e),{},{lang:t.locale})},t)},buildRoute:function(e,t){return Object(o.a)("router/buildRoute",{query:Object(r.a)(Object(r.a)({},e),{},{locale:t.locale,lang:t.lang})},t)}};t.a=i},474:function(e,t,n){"use strict";var r,o=n(6),i=(n(475),n(4)),a=n(60),s=n(9),c=n(142),u=n(54),l=n(957),d=n(2792),p=n(7),m=n(87),f=n(184),v=Object(p.a)("map-line-editor"),g=m.a.editing-3,h=m.a.editing-1,b=m.a.editing-2,_=function(e){function t(t){var n;return(n=e.call(this,t)||this)._setLayers=function(e){var t=n.props.map,o=t.getLayers(),i=o.topRasterLayers,a=o.mainLayers,s=[].concat(i,a),c=n.props.config.uatraits.isMobile?"click":"fastclick";n.props.editorLayerOwner?(s.push(f.b),r=n.props.editorLayerOwner,t.events.on(c,f.b,n._onEditorLayerClick)):e&&(e.editorLayerOwner===r&&(s=s.filter(function(e){return e!==f.b}),r=void 0),t.events.off(c,f.b,n._onEditorLayerClick)),t.setLayers(Object(f.l)(s,n.props.ymaps3.EventBlockerLayer))},n._onEditorLayerClick=function(e,t){n.props.onPointAdd(t.coordinates,n.props.points.length)},n._updatePoint=function(e,t,r){n.props.onPointUpdate&&void 0!==t&&n.props.onPointUpdate(e,t,Boolean(r))},n._onMouseMove=function(e){var t=n.props.map.convertScreenToWorldCoordinates(e).coordinates;if(n.props.onLineMouseMove&&n.props.onLineMouseMove(e,{coordinates:t}),n.props.polyLineCoordinates&&n.props.isActive&&void 0===n.state.draggingPoint){var r=Math.max.apply(Math,n.props.lineStyle.stroke.map(function(e){return e.width||0})),o=Object(l.a)(n.props.polyLineCoordinates,t,r,n.props.map.zoom,!0);o&&"point"in o&&n.setState({previewPoint:o})}},n._onNewPointDragStart=function(){var e=n.state,t=n.props;if(e.previewPoint){var r=function(e,t,n){for(var r=0,o=0;o<e.length-1;o++){var i=t[r];if(i&&Object(d.a)(i,e[o],15e-7)&&(r+=1),o===n)return r}return r}(t.polyLineCoordinates,t.points,e.previewPoint.segmentIndex)||void 0;void 0!==r&&e.previewPoint.point&&(n.setState({draggingPoint:{index:r,point:e.previewPoint.point}}),t.onPointAdd(e.previewPoint.point,r))}},n._onExistingPointDragStart=function(e){n.props.points[e]&&n.setState({draggingPoint:{index:e,point:n.props.points[e]}})},n._onDragMove=function(e){var t=e.coordinates,r=n.state;r.draggingPoint&&(n.setState({draggingPoint:{index:r.draggingPoint.index,point:t}}),n._updatePoint(t,r.draggingPoint.index))},n._onDragEnd=function(){var e=n.state;e.draggingPoint&&(n.setState({draggingPoint:void 0,previewPoint:void 0}),n._updatePoint(e.draggingPoint.point,e.draggingPoint.index,!0))},n._onPointDoubleClick=function(e){n.props.isActive&&n.props.onPointRemove&&n.props.onPointRemove(e)},n._onPointClick=function(e){n.props.onPointClick&&n.props.onPointClick(e)},n._renderDraggingOrPreviewPoint=function(){var e=n.state,t=n.props,r=e.draggingPoint||(t.disableAddingPoints?void 0:e.previewPoint);if(!r||!t.isActive||t.config.uatraits.isMobile)return null;var o="segmentIndex"in r;return i.createElement(u.a,{coordinates:r.point,onDragStart:n._onNewPointDragStart,onDragMove:n._onDragMove,onDragEnd:n._onDragEnd,onMouseMove:n._onMouseMove,onMouseLeave:t.onPreviewPointMouseLeave,onClick:t.onPreviewPointClick,zIndex:o?g:h,draggable:t.isActive,dataSourceId:f.d[t.editorLayerOwner?"EDITOR_MARKERS":"DEFAULT_MARKERS"],blockEvents:!0},o?i.createElement("div",{className:v("preview-point")},t.previewPointElement):n.props.renderPointElement("index"in r&&r.index||0))},n._renderPoints=function(){return n.props.points.map(function(e,t){return i.createElement(u.a,{key:t,onDragStart:function(){return n._onExistingPointDragStart(t)},onDragMove:n._onDragMove,onDragEnd:n._onDragEnd,onDoubleClick:function(){return n._onPointDoubleClick(t)},onClick:function(){return n._onPointClick(t)},coordinates:e,draggable:n.props.isActive,zIndex:b,dataSourceId:f.d[n.props.editorLayerOwner?"EDITOR_MARKERS":"DEFAULT_MARKERS"],blockEvents:!0,nonInteractive:!n.props.isActive},n.state.draggingPoint&&n.state.draggingPoint.index===t?null:n.props.renderPointElement(t))})},n.state={},n}Object(o.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._setLayers()},n.componentDidUpdate=function(e){e.editorLayerOwner!==this.props.editorLayerOwner&&this._setLayers(e)},n.render=function(){var e=this.props.editorLayerOwner?"EDITOR_GRAPHICS":"DEFAULT_GRAPHICS";return i.createElement(i.Fragment,null,this._renderDraggingOrPreviewPoint(),this._renderPoints(),i.createElement(c.a,{drawingStyle:this.props.lineStyle,geometry:{type:"LineString",coordinates:this.props.polyLineCoordinates},onMouseMove:this._onMouseMove,onMouseEnter:this.props.onLineMouseEnter,onMouseLeave:this.props.onLineMouseLeave,dataSourceId:f.d[e],onClick:this.props.onPreviewPointClick}))},t}(i.Component);t.a=Object(a.b)({shouldWait:!0})(Object(s.b)(_))},475:function(e,t,n){},477:function(e,t,n){e.exports=n.p+"_/5bcb85f0acb9638dd984a9f953f3de6a.svg"},478:function(e,t,n){"use strict";n(479);var r=n(4),o=n(7),i=n(8),a=n(15),s=Object(o.a)("card-tip-view");t.a=function(e){return r.createElement("div",{className:s()},r.createElement("div",{className:s("icon")},e.icon),r.createElement("div",{className:s("text")},e.text),r.createElement("div",{className:s("button")},r.createElement(i.a,{name:"button",logClick:!0},r.createElement(a.a,{view:"secondary-blue",size:"small",onClick:e.onClick,url:e.href,target:"_blank"},r.createElement("span",{className:s("send-text")},e.buttonText)))))}},479:function(e,t,n){},600:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"d",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"b",function(){return l});var r=n(10),o=n(25),i={cameraDirection:"front"};function a(e,t){var n=e.type,a=e.featureId,s=e.graphType,c=Object(r.a)({featureId:a,types:"data"===n?["path","similar"]:[n],graphType:s},i);return Object(o.a)("mrc",{query:c},t)}function s(e,t){return Object(o.a)("mrc/near",{query:{ll:e.ll.join(","),z:e.z,graphType:e.graphType}},t)}function c(e,t){var n=e.encodedCoordinates,a=e.graphType;return Object(o.a)("mrc/along-route",{body:Object(r.a)(Object(r.a)({},i),{},{encodedCoordinates:n,graphType:a})},t).catch(function(){return null})}function u(e,t){var n=e.encodedCoordinates,a=e.graphType;return Object(o.a)("mrc/route-thumbnail",{body:Object(r.a)(Object(r.a)({},i),{},{encodedCoordinates:n,graphType:a})},t).catch(function(){return null})}function l(e,t){var n=e.ll,a=e.dir,s=e.graphType;return Object(o.a)("/mrc/directions",{query:Object(r.a)(Object(r.a)({},i),{},{ll:n.join(","),dir:a,graphType:s})},t).catch(function(){return null})}},602:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="hidden"},603:function(e,t,n){"use strict";var r=n(6),o=n(4),i=n(654),a=n(2800),s=n(2797),c=n(957),u=n(416),l=n(604),d=200,p=16,m=function(e){function t(t){var n;return(n=e.call(this,t)||this)._leaveTimer=0,n._getNearestFeature=function(e){var t=n.props,r=Object(i.a)(t.features,function(t){return Object(s.a)(t.geometry.coordinates,e)});if(!r||r.properties.id!==t.selectedFeatureId)return r},n._onClick=function(){var e=n.state.currentFeature;e&&n.props.onClick&&n.props.onClick(e.properties.id),n.setState({currentFeature:null})},n._onMouseMove=function(e,t){var r=t.coordinates,o=Object(c.a)(n.props.features.map(function(e){return e.geometry.coordinates}),r,n.props.lineWidth,n.props.zoom);if(o&&!("point"in o)){var i=n._getNearestFeature(o);n.setState({currentFeature:i||null})}},n._onMouseEnter=function(){window.clearTimeout(n._leaveTimer)},n._onMouseLeave=function(){n._leaveTimer=window.setTimeout(function(){n.setState({currentFeature:null})},d)},n._renderPreview=function(){var e=n.state;return e.currentFeature?"placemark"===n.props.preview?o.createElement(u.a,{coordinates:e.currentFeature.geometry.coordinates,direction:e.currentFeature.properties.heading,type:"additional"}):o.createElement(l.a,{coordinates:e.currentFeature.geometry.coordinates,image:e.currentFeature.properties.imagePreview}):null},n.state={currentFeature:null},n._onMouseMove=Object(a.a)(n._onMouseMove,p),n}Object(r.a)(t,e);var n=t.prototype;return n.componentWillUnmount=function(){window.clearTimeout(this._leaveTimer)},n.render=function(){var e=this.props;return o.createElement(o.Fragment,null,e.children({onMouseMove:this._onMouseMove,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onClick:this._onClick}),this._renderPreview())},t}(o.Component);t.a=m},604:function(e,t,n){"use strict";var r=n(6),o=(n(736),n(4)),i=n(7),a=n(8),s=n(39),c=n(124),u=Object(i.a)("mrc-preview-balloon"),l={main:20,side:20},d=function(e){function t(t){var n;return(n=e.call(this,t)||this)._image=o.createRef(),n._onLoad=function(){n.setState({isPreviewLoaded:!0})},n._renderSpinner=function(){var e;return n.state.isPreviewLoaded||(null===(e=n._image.current)||void 0===e?void 0:e.complete)?null:o.createElement("div",{className:u("placeholder")},o.createElement("div",{className:u("spinner")},o.createElement(s.a,{view:"large"})))},n.state={isPreviewLoaded:!1},n}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props;return o.createElement(a.a,{name:"preview_balloon"},o.createElement("div",{className:u()},o.createElement(c.a,{type:"transparent",coordinates:e.coordinates,position:"bottom-right",offset:l,onClose:function(){},showArrow:!1,isShown:!0},o.createElement("div",{className:u("balloon")},this._renderSpinner(),o.createElement("img",{ref:this._image,className:u("image",{loaded:this.state.isPreviewLoaded}),src:e.image.url,onLoad:this._onLoad})))))},t}(o.Component);t.a=d},605:function(e,t,n){"use strict";n(1548);var r=n(4),o=n(7),i=n(8),a=n(11),s=n(1550),c=n.n(s),u=Object(o.a)("route-snippet-feedback-button-view");t.a=function(e){return r.createElement(i.a,{name:"feedback",useParentState:!0,nodeState:{type:e.route.type,uri:e.route.uri},logClick:!0},r.createElement("div",{className:u(),onClick:function(t){t.stopPropagation(),e.onClick()}},"Исправить",r.createElement(a.a,{className:u("icon"),url:c.a})))}},61:function(e,t,n){"use strict";var r=n(26);t.a=Object(r.a)(function(){return n.e("feedback").then(n.bind(null,249))},{openCommonFeedback:!0,closeCommonFeedback:!0,openFeedback:!0,closeFeedback:!0,openSelectObjectFeedback:!0,openBusinessFeedback:!0,openRouteFeedback:!0,openAddObjectFeedback:!0,openEditObjectFeedback:!0,openMapEditFeedback:!0,completeFeedback:!0,submitFeedback:!0})},62:function(e,t,n){"use strict";var r=n(44),o=n(94),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.a=function(e,t){if(Object(r.a)(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Object(o.a)(e))||(a.test(e)||!i.test(e)||null!=t&&e in Object(t))}},654:function(e,t,n){"use strict";var r=n(260),o=n(120);var i=function(e,t){return e<t};t.a=function(e,t){return e&&e.length?Object(r.a)(e,Object(o.a)(t,2),i):void 0}},676:function(e,t,n){"use strict";var r=n(10),o=n(2796),i=n(114),a=n(49),s=n(99),c={},u={},l={loadSearchResults:function(e,t){for(var n={},r=e.slice(),o=function e(){if(0===r.length)return Promise.resolve();var o=r.shift();if(n[o.uri])return e();var i=p(o,t);return i.then(function(e){return n[o.uri]=e}),i.then(e)},i=[],a=0;a<5;a++)i.push(o());return Promise.all(i).then(function(){return n})},loadPlacesSearchResults:function(e,t){var n=e.filter(function(e){return["home","work"].includes(e.id)}),r=n.map(function(e){return d(e,t)});return Promise.all(r).then(function(e){return e.reduce(function(e,t,r){return e[n[r].coords.join(",")]=t,e},{})})},searchByBookmarkUri:function(e,t){var n=a.k(e);return(n?m(a.e(e),t):function(e,t){return s.a.fetch({mode:"uri",uri:e,origin:"bookmark"},t)}(e,t)).then(function(t){var r=t.items[0];if(!r)throw new Error("Empty search result. Bookmark uri: "+e);return n||(r.uri=e),r})},loadSearchResult:p,loadPlaceSearchResult:d};function d(e,t){var n=e.coords.join(",");return c[n]?c[n]:(c[n]=m(e.coords,t).then(function(o){var a=o.items[0];if(!a)throw new Error("Empty search result. Place coords: "+n);return delete c[n],Object(r.a)(Object(r.a)({},a),{},{placeId:e.id,title:i.j(e.id,t),description:a.address})}).catch(function(){return delete c[n],{placeId:e.id,id:"-1",seoname:"",requestId:"",type:"toponym",coordinates:e.coords,displayCoordinates:e.coords,encodedCoordinates:Object(o.a)(e.coords),title:i.j(e.id,t),description:e.addressLine,address:e.addressLine,kind:"other",analyticsId:"",geoId:-1}}),c[n])}function p(e,t){return u[e.uri]?u[e.uri]:(u[e.uri]=l.searchByBookmarkUri(e.uri,t).then(function(t){return delete u[e.uri],t}).catch(function(){return delete u[e.uri],null}),u[e.uri])}function m(e,t){return e?s.a.fetch({mode:"reverse",type:["geo"],center:e,count:1,origin:"bookmark"},t):Promise.reject(new Error("Invalid pin-uri"))}t.a=l},696:function(e,t,n){"use strict";n.d(t,"b",function(){return m}),n.d(t,"c",function(){return p}),n.d(t,"d",function(){return f}),n.d(t,"a",function(){return l});var r=n(18),o=n(1003),i=n(23),a=n(1155),s=n(115),c=n(32),u=3e3,l=1e3,d=500;function p(e,t){return{coords:e,input:"Моё местоположение",value:"Моё местоположение",serviceType:"geolocation"}}function m(){var e;return function(t,n){return function(c,u,l){if(n&&n.requestOnlyPhone)t(c,u,l);else{r.a.cancel(e);var p=n&&n.checkPermission,m=n&&n.timeout,f=n&&n.checkPermission;e=r.a.create(o.a.checkPermission().then(function(e){return!p||(!e||"granted"===e)?o.a.getCurrentPosition(Object(a.b)(l.config),l.config,m).then(function(e){return f?function(e){return 0,e.accuracy<d?Promise.resolve(e):Promise.reject()}(e):e}):Promise.reject(void 0)}),{success:function(e){c(i.a.setCurrentPosition([e.longitude,e.latitude],e.accuracy))},fail:function(e){e&&n&&n.useError&&c(s.a.setGeolocationError(o.a.ERROR_TYPES[e.code]))},always:function(){t(c,u,l)}})}}}}function f(e,t){return Boolean(e.currentPosition&&c.g(t).getTime()-e.lastTimeUpdate<u)}},72:function(e,t,n){"use strict";n(103),n(105);var r=n(4),o=n(7),i=n(31),a=n(46),s=Object(o.a)("sidebar-panel-header-view"),c=r.memo(function(e){return r.createElement("div",{className:[s({bordered:e.showBorder,view:e.view}),e.className].filter(Boolean).join(" ")},r.createElement("div",{className:s("title",{big:e.big})},e.title||e.children),r.createElement(a.a,{onChange:e.onChangeVisibiltyTitle},null),r.createElement("div",{className:s("controls")},e.onClose?r.createElement(i.a,{onClick:function(t){t.stopPropagation(),e.onClose()},relative:!0,circle:!0}):null))});c.displayName="SidebarPanelHeaderView",t.a=c},734:function(e,t,n){},736:function(e,t,n){},738:function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"c",function(){return f}),n.d(t,"d",function(){return v}),n.d(t,"e",function(){return g}),n.d(t,"f",function(){return h});var r=n(6),o=(n(1514),n(4)),i=n(7),a=n(9),s=n(8),c=n(11),u=n(182),l=n(36),d={HOME:"home",WORK:"work",ADD_HOME:"add-home",ADD_WORK:"add-work",UNAUTH_HOME:"unauth-home",UNAUTH_WORK:"unauth-work",GEOLOCATION:"geolocation",SHOW_MAP:"show-map"},p=Object(i.a)("route-quick-access-item"),m=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._renderTitle=function(){var e;switch(t.props.type){case d.HOME:case d.ADD_HOME:case d.UNAUTH_HOME:e="Дом";break;case d.WORK:case d.ADD_WORK:case d.UNAUTH_WORK:e="Работа";break;case d.SHOW_MAP:e="Указать на карте";break;default:e="Моё местоположение"}return o.createElement("div",{className:p("title")},e,t._renderSubtitle())},t._renderSubtitle=function(){var e=f(t.props.type,t.props.places);return e?o.createElement("div",{className:p("subtitle")},e):null},t._renderAddLink=function(){return h(t.props.type)?o.createElement("div",{className:p("add-link")},"Добавить адрес"):null},t._renderIcon=function(){var e=g(t.props.type);return e?o.createElement("div",{className:p("icon",{type:e})},o.createElement(c.a,{url:l.d({type:"service",name:e,size:"small"},t.props.config)})):null},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.type;return o.createElement(s.a,{name:"action",nodeState:{type:t},logClick:!0},o.createElement("div",{className:p({hovered:e.hovered}),onClick:e.onClick},this._renderIcon(),this._renderTitle(),this._renderAddLink()))},t}(o.PureComponent);function f(e,t){var n,r;if(t)switch(e){case d.HOME:return null===(n=t[u.a.HOME_ID])||void 0===n?void 0:n.addressLineShort;case d.WORK:return null===(r=t[u.a.WORK_ID])||void 0===r?void 0:r.addressLineShort}}function v(e,t){var n,r;switch(e){case d.HOME:return null===(n=t[u.a.HOME_ID])||void 0===n?void 0:n.coords;case d.WORK:return null===(r=t[u.a.WORK_ID])||void 0===r?void 0:r.coords}}function g(e){return e===d.GEOLOCATION?"geolocation":e===d.SHOW_MAP?"show-map":e.includes(d.HOME)?"home":e.includes(d.WORK)?"work":void 0}function h(e){return[d.UNAUTH_HOME,d.UNAUTH_WORK,d.ADD_HOME,d.ADD_WORK].includes(e)}t.b=Object(a.b)(m)},739:function(e,t,n){"use strict";var r=n(13),o=n(41),i=n(6),a=(n(740),n(4)),s=n(7),c=n(256),u=n(28),l=n(52),d=Object(s.a)("full-screen-suggest"),p=d("drop"),m=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onContentTouchStart=function(e){e.stopPropagation()},t._renderDropWrapper=function(e,n){var r=t.props;return r.renderDropWrapper&&(e=r.renderDropWrapper(e,n)),a.createElement(u.a,{selector:"."+p},e)},t._renderFullScreenMode=function(){var e={renderDropInPopup:!1,renderDropWrapper:t._renderDropWrapper,fullHeight:!0,contentMargin:"0",initialFocus:!0,initialSuggest:!0};return a.createElement(u.a,null,a.createElement(l.a,null,a.createElement("div",{className:d(),onTouchStart:function(e){return e.stopPropagation()}},a.createElement("div",{className:p}),t._renderContent(e))))},t._renderContent=function(e){void 0===e&&(e={});var n=t.props,i=n.renderLeftIcon,s=n.renderRightIcon,u=Object(o.a)(n,["renderLeftIcon","renderRightIcon"]);return a.createElement("div",{className:d("content"),onTouchStart:t._onContentTouchStart},i?i():null,a.createElement("div",{className:d("input")},a.createElement(c.a,Object(r.a)({},u,e))),s?s():null)},t}return Object(i.a)(t,e),t.prototype.render=function(){var e=this.props;return e.isFullScreen&&e.isPhone?this._renderFullScreenMode():this._renderContent()},t}(a.Component);t.a=m},740:function(e,t,n){},81:function(e,t,n){},83:function(e,t,n){"use strict";var r=n(44),o=n(62),i=n(129),a=500;var s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,c=/\\(\\)?/g,u=function(e){var t=Object(i.a)(e,function(e){return n.size===a&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(s,function(e,n,r,o){t.push(r?o.replace(c,"$1"):n||e)}),t}),l=n(181);t.a=function(e,t){return Object(r.a)(e)?e:Object(o.a)(e,t)?[e]:u(Object(l.a)(e))}},88:function(e,t,n){"use strict";n(150);var r=n(4),o=n(7),i=n(11),a=n(152),s=n.n(a),c=Object(o.a)("flip-icon");t.a=function(e){var t=e.isFlipped;return r.createElement(i.a,{className:c({flipped:t}),url:s.a})}},89:function(e,t,n){"use strict";var r=n(83),o=n(45);t.a=function(e,t){for(var n=0,i=(t=Object(r.a)(t,e)).length;null!=e&&n<i;)e=e[Object(o.a)(t[n++])];return n&&n==i?e:void 0}},948:function(e,t,n){"use strict";n.r(t);var r=n(6),o=n(4),i=n(9),a=n(142),s=n(602),c=n(69),u=n(454),l=n(84),d=n.n(l),p=n(60),m=n(17),f=n(184),v=n(1018),g=Object(m.a)(v.b,Object(p.b)({shouldWait:!0}))(function(e){function t(t){var n;return(n=e.call(this,t)||this)._id=d.a.v4(),t.map.addGroup(n._dataSourceId,n._id,t.style,t.parentGroupId),n}Object(r.a)(t,e);var n=t.prototype;return n.componentWillUnmount=function(){this.props.map.removeGroupAndChildren(this._dataSourceId,this._id)},n.render=function(){return o.createElement(v.a,{value:{parentGroupId:this._id}},this.props.children)},Object(u.a)(t,[{key:"_dataSourceId",get:function(){return this.props.dataSourceId||f.d.DEFAULT_GRAPHICS}}]),t}(o.PureComponent)),h={main:4,underlay:8,dash:[5,10]},b="#6000ff",_="#b3b3b3",y=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._getStrokeStyleByType=function(e){return{simplifyPalette:!1,width:h.main,dash:h.dash,opacity:"undergroundWalk"===e?.5:1,palette:t.props.activeRoute.colorizeInfo.map(function(t){var n=t.type,r=t.count;return{color:n===e?"binding"===n?_:b:s.a,count:r}})}},t._getActiveStyle=function(){return[t._getStrokeStyleByType("undergroundWalk"),t._getStrokeStyleByType("walk"),t._getStrokeStyleByType("binding"),{width:h.underlay,color:"#fff"}]},t._getInactiveStyle=function(){return[{width:h.main,color:"#6d6d6d"},{width:h.underlay,color:"#fff"}]},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props;return o.createElement(g,{style:{opacity:.6}},o.createElement(a.a,{key:t.activeRoute.uuid,drawingStyle:{stroke:this._getActiveStyle(),cursor:"default",zIndex:10},geometry:c.z(t.activeRoute)}),t.inactiveRoutes?t.inactiveRoutes.map(function(n){return o.createElement(a.a,{key:n.uuid,drawingStyle:{stroke:e._getInactiveStyle(),cursor:"pointer"},geometry:c.z(n),onFastClick:function(){return t.onRouteClick(n)}})}):null)},t}(o.Component),E="#737ce6",S="#54b235",R={stroke:[{width:4,color:"#6d6d6d"},{width:8,color:"#fff"}],cursor:"pointer"},C=17,I=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._getBicycleActiveDrawingStyle=function(){var e=t.props.mapLocation.zoom>=C,n={width:c.E(t.props.mapLocation.zoom).main,opacity:1,palette:(t.props.activeRoute.colorizeInfo||[]).map(function(t){return{count:t.count,color:["PEDESTRIAN","PEDESTRIAN_UNDERGROUND"].includes(t.type)&&e?s.a:"AUTO"===t.type?E:S}})},r={width:e?4:0,opacity:1,palette:(t.props.activeRoute.colorizeInfo||[]).map(function(e){return{count:e.count,color:"PEDESTRIAN"===e.type?E:s.a}}),dash:[5,10]},o={width:e?4:0,opacity:.5,palette:(t.props.activeRoute.colorizeInfo||[]).map(function(e){return{count:e.count,color:"PEDESTRIAN_UNDERGROUND"===e.type?E:s.a}}),dash:[5,10]};return{stroke:[{width:1.5,opacity:1,palette:(t.props.activeRoute.colorizeInfo||[]).map(function(e){return{count:e.count,color:"BICYCLE"===e.type?"#fff":s.a}}),dash:[2,4]},n,r,o,{width:c.E(t.props.mapLocation.zoom).underlay,color:"#fff"}],cursor:"default",zIndex:10}},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props;return o.createElement(g,{style:{opacity:1}},o.createElement(a.a,{drawingStyle:this._getBicycleActiveDrawingStyle(),geometry:c.z(t.activeRoute)}),t.inactiveRoutes?o.createElement(g,{style:{opacity:.6}},t.inactiveRoutes.map(function(t){return o.createElement(a.a,{key:t.uuid,drawingStyle:R,geometry:c.z(t),onFastClick:function(){return e.props.onRouteClick(t)}})})):null)},t}(o.Component),k=n(13),P=(n(1444),n(8)),O=n(474),T=n(603),x=n(416),w=n(55),N=n(232),M=n(7),j=Object(M.a)("map-routes-auto-view"),A=12,D=function(e){function t(t){var n;return(n=e.call(this,t)||this)._getPoints=function(){var e=n.props;return e.activeRoute.refPointsLineCoordinates.map(function(t,r){return n.state.editingIndex===r?e.routePoints[r].coords:t})},n._getPointsWithVia=function(){return{points:n.props.routePoints.map(function(e){return e.coords}),isViaPoints:n.props.routePoints.map(function(e,t){return n.props.viaIndexes.includes(t)})}},n._getViaIndexesFromRefsWithVia=function(e){return e.map(function(e,t){return e?t:0}).filter(Boolean)},n._removeViaPoint=function(e){if(n.props.onRoutePointsChange){var t=n._getPointsWithVia(),r=t.points,o=t.isViaPoints;r.splice(e,1),o.splice(e,1),n.props.onRoutePointsChange(r,{viaIndexes:n._getViaIndexesFromRefsWithVia(o),isRough:!1})}},n._addViaPoint=function(e,t){if(n.props.onRoutePointsChange){var r=n._getPointsWithVia(),o=r.points,i=r.isViaPoints;o.splice(t,0,e),i.splice(t,0,!n.props.config.experiments.ui.wayInsteadOfVia),n.props.setDragging(!0),n.props.onRoutePointsChange(o,{viaIndexes:n._getViaIndexesFromRefsWithVia(i),isRough:!1})}},n._updateViaPoint=function(e,t,r){if(n.props.onRoutePointsChange){var o=n.props.routePoints.slice().map(function(e){return e.coords});o.splice(t,1,e),n.setState({editingIndex:r?t:void 0}),n.props.onRoutePointsChange(o,{viaIndexes:n.props.viaIndexes,isRough:r})}},n._getActiveRouteStrokeStyles=function(){var e=n.props;return c.j({route:e.activeRoute,isDefaultColor:e.isDefaultColor},e.config)},n._onPointUpdate=function(e,t,r){n._updateViaPoint(e,t,!r),n.props.setDragging(!r)},n._onMapUpdate=function(){n.setState({mapAzimuth:n.props.map.azimuth})},n._renderPointElement=function(e){return n.props.activeRoute.refPointsLineCoordinates.reduce(function(e,t,r){return n.props.viaIndexes.includes(r)?e:e.concat(r)},[]).includes(e)?null:o.createElement("div",{className:j("via-point")})},n._renderActiveRoute=function(e){var t=n.props,r=n._getActiveRouteStrokeStyles().underlayStyle.width,i=e?{onLineMouseEnter:e.onMouseEnter,onLineMouseMove:e.onMouseMove,onLineMouseLeave:e.onMouseLeave,onPreviewPointClick:e.onClick,onPreviewPointMouseLeave:e.onMouseLeave}:{},a=n._getPointsWithVia().isViaPoints.filter(function(e){return!e}).length;return o.createElement(O.a,Object(k.a)({lineStyle:{stroke:[{width:r,opacity:0}],zIndex:A},polyLineCoordinates:t.activeRoute.coordinates||[],points:n._getPoints(),renderPointElement:n._renderPointElement,previewPointElement:o.createElement("div",{className:j("via-point",{preview:!0})}),isActive:t.isEditorActive,disableAddingPoints:t.config.experiments.ui.wayInsteadOfVia&&a>=t.config.routes.maxCount,onPointAdd:n._addViaPoint,onPointUpdate:n._onPointUpdate,onPointRemove:n._removeViaPoint},i))},n._renderActiveMrcFeature=function(){var e=n.props;if(e.isMrcPlayerHidden||e.isLoading||"comparison"===e.travelMode||e.feedback&&"route/edit/better"===e.feedback.type||!e.mrcFeatures||!e.activeMrcIndex&&0!==e.activeMrcIndex||e.isRoutePointDragging||!e.isMrcPlaying&&0===e.activeMrcIndex)return null;var t=e.mrcFeatures[e.activeMrcIndex];return t?o.createElement(o.Fragment,null,o.createElement(x.a,{coordinates:t.geometry.coordinates,direction:t.properties.heading+Object(N.a)(n.state.mapAzimuth)}),o.createElement(w.b,{onUpdate:n._onMapUpdate})):null},n.state={mapAzimuth:t.map.azimuth},n}return Object(r.a)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,r=this._getActiveRouteStrokeStyles().underlayStyle.width,i=!("route/edit/better"===(null===(e=n.feedback)||void 0===e?void 0:e.type))&&!n.config.uatraits.isMobile&&"comparison"!==n.travelMode;return o.createElement(o.Fragment,null,i?o.createElement(P.a,{name:"mrc_route_thread",logClick:!0},o.createElement(T.a,{features:n.mrcFeatures||[],lineWidth:r,zoom:n.zoom,onClick:n.onMrcClick,preview:"balloon"},this._renderActiveRoute)):this._renderActiveRoute(),o.createElement(g,{style:{opacity:.7}},o.createElement(a.a,{drawingStyle:c.k({route:n.activeRoute,isActive:!0,isDefaultColor:n.isDefaultColor},n.config),geometry:c.z(n.activeRoute)}),n.inactiveRoutes?o.createElement(g,{style:{opacity:.86}},n.inactiveRoutes.map(function(e){return o.createElement(a.a,{key:e.uuid,drawingStyle:c.k({route:e,isActive:!1,isDefaultColor:n.isDefaultColor},n.config),geometry:c.z(e),onFastClick:function(){return t.props.onRouteClick(e)}})})):null),n.config.uatraits.isMobile?null:this._renderActiveMrcFeature())},t}(o.Component),F=Object(p.b)({shouldWait:!0})(Object(i.b)(D)),L=n(165),B=n(10),z=(n(1446),n(11)),U=n(967),W=n(252),q=n(369),V=7,H=-10,G=-30,K=8,J=10,X={};function Y(e,t){if(!t.offset||!t.size)return{left:0,right:0,bottom:0,top:0};var n=t.offset[0],r=t.offset[0],o=t.offset[1],i=t.offset[1]+t.size.height;return"MASSTRANSIT"===e.pinType&&(n+=e.rotated?-t.size.width:-V,r+=e.rotated?V:t.size.width),"CONSTRUCTION"===e.pinType&&(n+=H,r=r+t.size.width+H,o+=G,i+=G),"ROUTEPOINT"===e.pinType&&(n-=t.size.width/2,r+=t.size.width/2,o=o+K-10,i+=K),{left:n,right:r,top:o,bottom:i}}function Z(e,t,n){return Promise.all(e.map(function(e){return function(e,t,n){var r=Q(e);return X[r]=X[r]||Object(q.a)(function(){return t(e)}),X[r].then(function(t){var r=Object(W.a)(n.bounds[0],n.zoom),o=Object(W.a)(e.coordinates,n.zoom);return{size:t,offset:[o[0]-r[0],o[1]-r[1]]}})}(e,t,n)})).then(function(t){return e.map(function(n,r){return function(e,t,n){var r=e[n],o=t[n];if(!o.offset||!o.size)return[];var i=Y(r,o);return i.left===i.right||i.top===i.bottom?[]:e.reduce(function(e,n,o){if(r===n)return e;var a=t[o];if(!a.offset||!a.size)return e;var s=Y(n,a);return s.left===s.right||s.top===s.bottom?e:Object(U.a)([[i.left,i.top],[i.right,i.bottom]],[[s.left,s.top],[s.right,s.bottom]])?e.concat(o):e},[])}(e,t,r)})})}function $(e,t,n){return Z(e,t,n).then(function(e){return e.every(function(e){return 0===e.length})})}function Q(e){switch(e.pinType){case"CONSTRUCTION":return e.coordinates.join(",")+e.pinType;case"MASSTRANSIT":return(e.balloonItems&&String(e.balloonItems.length)||"0")+(e.text||"")+(e.dotSize||"")+(e.rotated||"")+e.pinType+e.coordinates.join(",")+e.pinIndex;case"ROUTEPOINT":return(String(e.index)||0)+(e.value||"")+e.pinType+(e.isLast&&"last")}}function ee(e){switch(e.pinType){case"CONSTRUCTION":case"MASSTRANSIT":return Q(e);case"ROUTEPOINT":return(String(e.index)||0)+e.pinType+(e.isLast&&"last")}}var te=n(54),ne=n(253),re=n(2800),oe={ROUTEPOINT:"ROUTEPOINT",MASSTRANSIT:"MASSTRANSIT",CONSTRUCTION:"CONSTRUCTION"},ie=2,ae=50,se=300,ce=.25,ue=function(e){function t(t){var n;return(n=e.call(this,t)||this)._validityChecksCounter=0,n._processingTimeout=0,n._routeComponentProcessingFunction=function(e,t){return 1===e.length?Promise.resolve(e):function(e,t,n){return t.reduce(function(e,t){return e.then(function(e){return e.optimized?e:n(e.pins,t)})},Promise.resolve({pins:e,optimized:!1}))}(e.sort(function(e,t){return e.pinIndex>t.pinIndex?1:-1}),n.props.algoSteps,t).then(function(e){return e.pins})},n._updatePins=function(){n._validityChecksCounter=0,window.clearTimeout(n._processingTimeout),n._validateDrawing(n.props.unprocessedPins.map(function(e,t){return Object(B.a)({pinIndex:t},e)}))},n._collectAndProcessGroups=function(e){var t=n.state.mapLocation;Z(e,n.props.getNodeByPin,t).then(function(r){var o=function(e){for(var t=new Array(e.length).map(function(){return!1}),n=[],r=0;r<e.length;r++)if(!t[r]){var o=[r],i=[r];for(t[r]=!0;o.length>0;)for(var a=e[o.pop()],s=0;s<a.length;++s){var c=a[s];t[c]||(t[c]=!0,o.push(c),i.push(c))}n.push(i)}return n}(r).map(function(r){var o=r.map(function(t){return e[t]});return n._routeComponentProcessingFunction(o,function(e,r){return function e(t,n,r,o,i){return new Promise(function(a){if(1===t.length)a({pins:t,optimized:!0});else if(i>J)a({pins:t,optimized:!1});else{var s=n(t);$(s.pins,r,o).then(function(t){t?a({pins:s.pins,optimized:!0}):s.isFinished?s.isFinished&&a({pins:s.pins,optimized:!1}):a(e(s.pins,n,r,o,i++))})}})}(e,r,n.props.getNodeByPin,t,0)})});Promise.all(o).then(function(e){var t=e.reduce(function(e,t){return e.concat(t)});n._validateDrawing(t)})})},n._updateMapLocation=function(){var e=n.props.map.zoom;Math.abs(n.state.mapLocation.zoom-e)<ce||n.setState({mapLocation:Object(ne.d)(n.props.map)})},n._onMapUpdate=function(){n._updateMapLocationThrottled()},n._validateDrawing=function(e){n._validityChecksCounter+=1,n._validityChecksCounter>=ie?n.setState({pinsToDraw:e}):$(e,n.props.getNodeByPin,n.state.mapLocation).then(function(t){t?n.setState({pinsToDraw:e}):n._processingTimeout=window.setTimeout(function(){return n._collectAndProcessGroups(e)},ae)})},n.state={pinsToDraw:[],mapLocation:Object(ne.d)(n.props.map)},n._updateMapLocationThrottled=Object(re.a)(n._updateMapLocation,se),n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._validityChecksCounter=0,this._validateDrawing(this.props.unprocessedPins.map(function(e,t){return Object(B.a)({pinIndex:t},e)}))},n.componentDidUpdate=function(e,t){this.state.mapLocation.zoom===t.mapLocation.zoom&&this.props.unprocessedPins===e.unprocessedPins||this._updatePins()},n.componentWillUnmount=function(){window.clearTimeout(this._processingTimeout)},n.render=function(){var e=this;return o.createElement(o.Fragment,null,this.state.pinsToDraw.map(function(t){var n=e.props.getMapPlacemarkProps(t);return n?o.createElement(te.a,Object(k.a)({key:ee(t)},n),e.props.getNodeByPin(t)):null}),o.createElement(w.b,{onUpdate:this._onMapUpdate}))},t}(o.Component),le=Object(p.b)({shouldWait:!0})(ue),de=n(1448),pe=n.n(de),me=n(1449),fe=n.n(me),ve=n(1450),ge=n.n(ve),he=n(1451),be=n.n(he),_e=n(87),ye=n(370),Ee=(n(1452),n(36)),Se=n(1454),Re=n.n(Se),Ce=Object(M.a)("masstransit-route-pin-view"),Ie=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._onClick=function(e){var n=t.props,r=e||n.balloonItems&&n.balloonItems[0].stopId;r&&n.onClick&&n.onClick({coordinates:n.coordinates,id:r})},t._renderBalloonItem=function(e){var n="underground"===e.iconType&&e.city?e.iconType+"-"+e.city:e.iconType,r=Ee.d({type:"masstransit",name:n,size:"normal"},t.props.config);return o.createElement("div",{className:Ce("balloon-item",{type:e.iconType}),style:{backgroundColor:"underground"!==e.iconType?e.color:void 0},onClick:function(){return t._onClick(e.stopId)}},r?o.createElement(z.a,{className:Ce("balloon-icon"),url:r}):null,["suburban","aeroexpress"].includes(e.iconType)?null:o.createElement("div",{className:Ce("balloon-text"),style:{backgroundColor:e.color}},e.text))},t._renderBalloon=function(){var e=t.props.balloonItems;return e?o.createElement("div",{className:Ce("balloon")},t._renderBalloonItem(e[0]),e[1]?o.createElement(o.Fragment,null,o.createElement(z.a,{url:Re.a,className:Ce("arrow")}),t._renderBalloonItem(e[1])):null):null},t._renderText=function(){return t.props.text?o.createElement("span",{className:Ce("text"),onClick:function(){return t._onClick()}},t.props.text):null},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.balloonItems&&t.balloonItems[t.balloonItems.length-1].color||t.dotColor,r=t.dotSize||"normal";return o.createElement("div",{className:Ce({rotated:t.rotated,double:t.balloonItems&&2===t.balloonItems.length,clickable:Boolean(t.onClick)})},o.createElement("div",{className:Ce("container")},o.createElement("div",{className:Ce("dot",{size:r}),style:{background:n},onClick:function(){return e._onClick()}}),this._renderBalloon()),this._renderText())},t}(o.PureComponent),ke=Object(i.b)(Ie),Pe=(n(1455),n(2807)),Oe=n(1457),Te=n.n(Oe),xe=n(1458),we=n.n(xe),Ne=Object(M.a)("waypoint-pin-view"),Me=function(e){function t(t){var n;(n=e.call(this,t)||this)._getServiceIconUrl=function(){var e=n.props;return e.serviceType&&"geolocation"!==e.serviceType?Ee.d({type:"service",name:e.serviceType,size:e.mobileChooseMode?"normal":"small"},e.config):null},n._getRubricIconUrl=function(){var e=n.props;if(e.searchResult){var t,r;if("categories"in e.searchResult&&e.searchResult.categories)t=null===(r=e.searchResult.categories[0])||void 0===r?void 0:r.class;else"kind"in e.searchResult&&(t=e.searchResult.kind);if(t)return Ee.d({type:"rubrics",name:t,size:e.mobileChooseMode?"normal":"small"},e.config)||void 0}},n._renderText=function(){if(!n.props.text)return null;var e=Object(Pe.a)(n.props.text,{length:40});return o.createElement("div",{className:Ne("text")},e.split(" ").map(function(e,t){return o.createElement("span",{key:t,className:Ne("word")},e)}))},n._renderWaypoint=function(){var e=n.props,t=n.state;return o.createElement(o.Fragment,null,o.createElement(z.a,{url:e.mobileChooseMode?we.a:Te.a,className:Ne("pin-icon")}),o.createElement(z.a,{url:t.currentIconUrl,key:t.currentIconUrl,className:Ne("rubric-icon",{"mobile-choose":e.mobileChooseMode,current:!0,type:e.serviceType})}),t.temporaryIconUrl?o.createElement(z.a,{url:t.temporaryIconUrl,key:t.temporaryIconUrl,className:Ne("rubric-icon",{"mobile-choose":e.mobileChooseMode,temporary:!0})}):null,n._renderText())},n._renderIntermediatePoint=function(){var e=n.props;return o.createElement(o.Fragment,null,o.createElement("div",{className:Ne("content")},o.createElement("span",{className:Ne("index")},e.index)),n._renderText())};var r=Ee.d({type:"rubrics",name:"fallback",size:t.mobileChooseMode?"normal":"small"},t.config),i=n._getServiceIconUrl()||n._getRubricIconUrl()||r;return n.state={temporaryIconUrl:null,currentIconUrl:i},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this.props,n=this._getServiceIconUrl()||this._getRubricIconUrl();(t.serviceType||t.searchResult!==e.searchResult)&&n&&n!==this.state.currentIconUrl&&this.setState({temporaryIconUrl:this.state.currentIconUrl,currentIconUrl:n})},n.render=function(){var e=this.props,t=0===e.index,n=!t&&!e.isLast&&!e.mobileChooseMode;return e.serviceType,o.createElement("div",{className:Ne({disabled:e.disabled,first:t,last:e.isLast,intermediate:n,"mobile-choose":e.mobileChooseMode})},n?this._renderIntermediatePoint():this._renderWaypoint())},t}(o.Component),je=Object(i.b)(Me),Ae=n(58),De=n(451);function Fe(e){return"CONSTRUCTION"===e.pinType&&["STAIRS_UP","STAIRS_DOWN","STAIRS_UNKNOWN"].includes(e.type)}function Le(e){if(e.filter(function(e){return"CONSTRUCTION"===e.pinType&&["STAIRS_UP","STAIRS_DOWN","STAIRS_UNKNOWN"].includes(e.type)}).length<2)return{pins:e,isFinished:!0};var t=e.findIndex(function(e){return Fe(e)}),n=Object(De.a)(e[t],{type:"STAIRS_UNKNOWN"});return{pins:e.filter(function(e){return!Fe(e)}).concat(n),isFinished:!0}}function Be(e){if(e.filter(function(e){return"CONSTRUCTION"===e.pinType}).length<2)return{pins:e,isFinished:!0};var t=e.findIndex(function(e){return"CONSTRUCTION"===e.pinType});return{pins:e.filter(function(e){return"CONSTRUCTION"!==e.pinType}).concat(e[t]),isFinished:!0}}function ze(e){return{pins:e.filter(function(e){return"CONSTRUCTION"!==e.pinType}),isFinished:!0}}function Ue(e){return{pins:e.filter(function(e){return"MASSTRANSIT"!==e.pinType||"balloonItems"in e&&e.balloonItems||"dotSize"in e}),isFinished:!0}}function We(e){var t=e.findIndex(function(e){return"MASSTRANSIT"===e.pinType&&e.balloonItems});if(-1!==t){var n=[].concat(e),r=n[t];return n[t]=Object(De.a)(n[t],{balloonItems:void 0,dotColor:r.balloonItems&&r.balloonItems[r.balloonItems.length-1].color,dotSize:"none",rotated:!1,text:void 0}),{pins:n,isFinished:!1}}return{pins:e,isFinished:!0}}function qe(e){return{pins:e.filter(function(e){var t;return"MASSTRANSIT"!==e.pinType||!e.balloonItems||"metro-exit"!==(null===(t=e.balloonItems[0])||void 0===t?void 0:t.iconType)}),isFinished:!0}}function Ve(e){var t=Ye(e);return t?Xe(t,e):{pins:e,isFinished:!0}}function He(e){var t=e.reduce(function(e,t,n){return"MASSTRANSIT"===t.pinType?e.concat(n):e},[]);return Xe(t.length>2?t.slice(0,3):t.slice(0,2),e)}function Ge(e){var t=Ye(e);return t?function(e,t){var n=e[0],r=e[1],o=t[n],i=t[r];if("MASSTRANSIT"!==o.pinType||"MASSTRANSIT"!==i.pinType)return{pins:t,isFinished:!0};if(!o.balloonItems||!i.balloonItems)return{pins:t,isFinished:!0};var a=o.balloonItems[0].initialText===i.balloonItems[0].initialText&&o.balloonItems[0].color===i.balloonItems[0].color;return t[r]=a?Object(De.a)(i,Object(B.a)(Object(B.a)({},o),{},{pinIndex:i.pinIndex,rotated:!1})):Object(De.a)(i,{rotated:!1,text:"",balloonItems:[o.balloonItems[0],i.balloonItems[0]]}),{pins:t.filter(function(e){return e.pinIndex!==o.pinIndex}),isFinished:!1}}(t,e):{pins:e,isFinished:!0}}function Ke(e){var t=e.findIndex(function(e,t,n){var r=n[t+1];return r&&"MASSTRANSIT"===e.pinType&&"MASSTRANSIT"===r.pinType&&e.text===r.text}),n=-1!==t?[e[t],e[t+1]]:[];return 2===n.length&&"MASSTRANSIT"===n[0].pinType&&"MASSTRANSIT"===n[1].pinType?n[0].balloonItems&&1===n[0].balloonItems.length&&n[1].balloonItems&&1===n[1].balloonItems.length&&n[0].balloonItems[0].color!==n[1].balloonItems[0].color?{pins:e,isFinished:!0}:{pins:[].concat(e.filter(function(e){return!n.includes(e)}),[n[1]]),isFinished:!0}:{pins:e,isFinished:!0}}function Je(e){return{pins:e.map(function(e){return"MASSTRANSIT"!==e.pinType||!e.balloonItems||2===e.balloonItems.length||e.first?e:"MASSTRANSIT"!==e.pinType||1!==e.balloonItems.length||e.first?e:Object(De.a)(e,{balloonItems:void 0,dotColor:e.balloonItems&&e.balloonItems[e.balloonItems.length-1].color,dotSize:"none",rotated:!1,text:void 0})}),isFinished:!0}}function Xe(e,t){var n=e.map(function(e){return t[e].rotated?1:0}),r=Math.pow(2,n.length)-1,o=parseInt(n.join(""),2);return o<r?((o+1).toString(2).padStart(n.length,"0").split("").map(Number).map(Boolean).forEach(function(n,r){t[e[r]]=Object(De.a)(t[e[r]],{rotated:n})}),{pins:t,isFinished:!1}):{pins:t,isFinished:!0}}function Ye(e){for(var t=e.map(function(e,t){return{pin:e,index:t}}).filter(function(e){var t=e.pin;return"MASSTRANSIT"===t.pinType&&t.balloonItems&&1===t.balloonItems.length}),n=[],r=1;r<t.length;r++)if(t[r-1].pin.pinIndex===t[r].pin.pinIndex-1){n.push(t[r-1],t[r]);break}return n.length>0?[n[0].index,n[1].index]:null}function Ze(e){var t=e.findIndex(function(e){return"MASSTRANSIT"===e.pinType&&e.balloonItems&&2===e.balloonItems.length});if(-1===t)return{pins:e,isFinished:!0};var n=e[t];if("MASSTRANSIT"!==n.pinType||!n.balloonItems||2!==n.balloonItems.length)return{pins:e,isFinished:!0};var r={pinIndex:n.pinIndex-1,balloonItems:[n.balloonItems[0]],coordinates:n.balloonItems[0].initialCoordinates,last:!0,pinType:oe.MASSTRANSIT,rotated:!1,text:n.balloonItems[0].initialText},o={pinIndex:n.pinIndex,balloonItems:[n.balloonItems[1]],coordinates:n.balloonItems[1].initialCoordinates,first:!0,pinType:oe.MASSTRANSIT,rotated:!1,text:n.balloonItems[1].initialText},i=[].concat(e);return i.splice(t,1,r,o),{pins:i,isFinished:!1}}function $e(e){return{pins:[].concat(e).map(function(e){return Object(De.a)(e,{rotated:!1})}),isFinished:!0}}function Qe(e){if(e.filter(function(e){return"ROUTEPOINT"===e.pinType&&e.value}).length>1){var t=e.findIndex(function(e){return"ROUTEPOINT"===e.pinType&&e.value&&0!==e.index&&!e.isLast}),n=[].concat(e);if(-1!==t)return n[t]=Object(De.a)(n[t],{value:""}),{pins:n,isFinished:!1};var r=e.findIndex(function(e){return"ROUTEPOINT"===e.pinType&&e.value&&0===e.index});if(-1!==r)return n[r]=Object(De.a)(e[r],{value:""}),{pins:n,isFinished:!0}}return{pins:e,isFinished:!0}}var et={STAIRS_UP:pe.a,STAIRS_DOWN:fe.a,STAIRS_UNKNOWN:ge.a,GATES:be.a},tt=Object(M.a)("route-pins-view"),nt=function(e){function t(t){var n;return(n=e.call(this,t)||this)._updatePins=function(){n.setState({pins:[].concat(n._getRoutePointPins(),n._getMasstransitPins(),n._getConstructionPins())})},n._getUpdatedWaypointCoordinates=function(e,t){var r=n.props,o=r.routePoints.filter(function(e,t){return!r.viaIndexes.includes(t)})[t];return r.routePoints.map(function(t){return o===t?e:t.coords})},n._onDragStart=function(){n.props.setDragging(!0)},n._onDragMove=function(e,t){var r=n.props,o=n._getUpdatedWaypointCoordinates(e,t);r.onRoutePointsChange&&r.onRoutePointsChange(o,{viaIndexes:r.viaIndexes,isRough:!0})},n._onDragEnd=function(e,t){var r=n.props;r.setDragging(!1);var o=n._getUpdatedWaypointCoordinates(e,t);r.onRoutePointsChange&&r.onRoutePointsChange(o,{viaIndexes:r.viaIndexes,isRough:!1})},n._getMasstransitPins=function(){var e=n.props;return e.activeRoute&&"paths"in e.activeRoute?e.activeRoute.paths.reduce(function(t,n){return t.concat((r=n.segments,e.config,r.reduce(function(e,t){if(!t.edgePoints||!t.transports)return e;var n,r,o=t.stops&&t.stops[0],i=t.stops&&t.stops[t.stops.length-1];return e.push({balloonItems:[ot(t.transports,t.edgePoints[0],o)],pinType:oe.MASSTRANSIT,coordinates:t.edgePoints[0],rotated:!1,first:!0,text:null==o?void 0:o.name},{pinType:oe.MASSTRANSIT,dotColor:rt(t.transports),coordinates:t.edgePoints[1]}),t.metroExit&&e.push({pinType:oe.MASSTRANSIT,balloonItems:[(n=t.metroExit,r=i,{iconType:"metro-exit",color:"#666",text:n.name,initialCoordinates:[Number(n.lon),Number(n.lat)],initialText:n.name,stopId:null==r?void 0:r.id})],coordinates:[Number(t.metroExit.lon),Number(t.metroExit.lat)],rotated:!1,dotSize:"small",text:"Выход"}),e.push({pinType:oe.MASSTRANSIT,balloonItems:[ot(t.transports,t.edgePoints[1],i)],coordinates:t.edgePoints[1],rotated:!1,last:!0,text:null==i?void 0:i.name}),e},[])));var r},[]):[]},n._getMapPlacemarkProps=function(e){switch(e.pinType){case"CONSTRUCTION":return{coordinates:e.coordinates,zIndex:_e.a.routes};case"MASSTRANSIT":return{coordinates:e.coordinates,zIndex:_e.a.routePins.masstransit,blockEvents:!0};case"ROUTEPOINT":var t=n.props,r=e;return r.coords?{zIndex:0===r.index?_e.a.routePins.waypoint+1:r.isLast?_e.a.routePins.waypoint+2:_e.a.routePins.waypoint,coordinates:r.coords,draggable:t.draggable&&!r.disabled,onDragStart:n._onDragStart,onDragEnd:function(e){var t=e.coordinates;return n._onDragEnd(t,r.index)},onDragMove:function(e){var t=e.coordinates;return n._onDragMove(t,r.index)}}:null}return null},n._getConstructionPins=function(){var e=n.props;return e.activeRoute&&"constructions"in e.activeRoute?e.activeRoute.constructions.map(function(e){return Object(B.a)(Object(B.a)({},e),{},{pinType:oe.CONSTRUCTION})}):[]},n._getRoutePointPins=function(){var e=n.props,t="taxi"===e.travelMode,r=c.A(e.travelMode,e.config),o=e.routePoints.every(function(e){return!e.coords||Boolean(e.input)})&&!e.isRoutePointDragging;return e.routePoints.filter(function(t,n){return!e.viaIndexes.includes(n)}).map(function(e,n,i){var a=t&&0!==n&&n!==i.length-1||n>=r-1&&n!==i.length-1;return Object(B.a)(Object(B.a)({},e),{},{pinType:oe.ROUTEPOINT,coordinates:e.coords||[0,0],disabled:a,showText:o,index:n,isLast:n===i.length-1})})},n._getConstructionNode=function(e){return o.createElement("div",{className:tt("construction",{type:e.type})},o.createElement(z.a,{url:et[e.type]}))},n._getMasstransitPinNode=function(e){var t=n.props,r=!t.activeRoute||"isIntercityRoute"in t.activeRoute&&t.activeRoute.isIntercityRoute?void 0:t.onStopClick;return o.createElement(ke,Object(k.a)({},e,{onClick:r}))},n._getWaypointPinNode=function(e){return o.createElement(je,{text:e.showText?e.value:void 0,index:e.index,isLast:e.isLast,disabled:e.disabled,searchResult:e.searchResult,serviceType:e.serviceType})},n._getRouteItemPinNode=function(e){switch(e.pinType){case"CONSTRUCTION":return n._getConstructionNode(e);case"MASSTRANSIT":return n._getMasstransitPinNode(e);case"ROUTEPOINT":return n._getWaypointPinNode(e)}return null},n._getAlgoSteps=function(){var e=[Le,Be,ze],t=n.props.activeRoute&&"masstransit"===n.props.activeRoute.type?[Ue,Ke,Ve,qe,$e,Ve,Ge,Je,Ze,Je,$e,He,$e,We]:[];return[].concat(e,t,[Qe])},n.state={pins:[]},n}Object(r.a)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){this.props.activeRoute===e.activeRoute&&this.props.routePoints===e.routePoints||this._updatePins()},n.componentDidMount=function(){this._updatePins()},n.render=function(){return o.createElement(o.Fragment,null,o.createElement(le,{unprocessedPins:this.state.pins,getNodeByPin:this._getRouteItemPinNode,getMapPlacemarkProps:this._getMapPlacemarkProps,algoSteps:this._getAlgoSteps()}),this.state.pins.filter(function(e){return e.pinType===oe.ROUTEPOINT}).map(function(e){var t,n=e.uri||(null===(t=e.searchResult)||void 0===t?void 0:t.uri);return n?o.createElement(ye.a,{key:n,uri:n}):null}))},t}(o.Component);function rt(e){var t=c.y(e);return Ae.u(t)}function ot(e,t,n){var r=c.y(e);return{iconType:r.type,color:rt(e),city:r.city,text:"underground"===r.type&&r.undergroundLineNumber?r.undergroundLineNumber:r.name,initialCoordinates:t,initialText:null==n?void 0:n.name,stopId:null==n?void 0:n.id}}var it=Object(i.b)(nt),at=n(324),st=(n(1459),[{width:4,color:"#6d6d6d"},{width:8,color:"#fff"}]),ct={main:4,dash:[5,10]},ut="#9d64fb",lt="#b3b3b3",dt=14,pt=Object(M.a)("map-routes-masstransit-view"),mt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._getStopPlacemarksData=function(){return t.props.activeRoute.paths.reduce(function(e,t){return e.concat(t.segments.reduce(function(e,t){if(!t.stops)return e;var n=t.stops.reduce(function(e,t){return t.coordinateOnRoute?e.concat([t.coordinateOnRoute]):e},[]);return n.shift(),e.concat({color:t.transports?ft(t.transports):void 0,coordinates:n})},[]))},[])},t._getColorForTransport=function(e){var n=t.props,r=e.type,o=e.segmentIndex;if(["walk","transfer","undergroundWalk","binding"].includes(r))return s.a;var i=n.activeRoute.paths.reduce(function(e,t){return e.concat(t.segments)},[]);return o&&i[o]&&i[o].transports?ft(i[o].transports):Ae.j(r)},t._getActiveDrawingStyle=function(){var e=t.props;return{cursor:"default",zIndex:10,stroke:[{simplifyPalette:!1,width:c.E(e.mapLocation.zoom).main,palette:e.activeRoute.colorizeInfo.map(function(e){return{color:t._getColorForTransport(e),count:e.count}})},{simplifyPalette:!1,width:ct.main,dash:ct.dash,opacity:.5,palette:e.activeRoute.colorizeInfo.map(function(e){var t=e.type,n=e.count;return{color:["undergroundWalk","transfer"].includes(t)?ut:s.a,count:n}})},{simplifyPalette:!1,width:ct.main,dash:ct.dash,palette:e.activeRoute.colorizeInfo.map(function(e){var t=e.type,n=e.count;return{color:"walk"===t?ut:s.a,count:n}})},{simplifyPalette:!1,width:ct.main,dash:ct.dash,palette:e.activeRoute.colorizeInfo.map(function(e){var t=e.type,n=e.count;return{color:"binding"===t?lt:s.a,count:n}})},{width:c.E(e.mapLocation.zoom).underlay,opacity:.9,color:"#fff"}]}},t._renderStopDots=function(){return t.props.mapLocation.zoom<dt?null:t._getStopPlacemarksData().map(function(e,t){return e.coordinates.map(function(n,r){return o.createElement(te.a,{key:t+"_"+r,coordinates:n,zIndex:_e.a.default},o.createElement("div",{className:pt("stop-dot"),style:{borderColor:e.color}}))})})},t}return Object(r.a)(t,e),t.prototype.render=function(){var e=this,t=this.props;return o.createElement(o.Fragment,null,o.createElement(g,{style:{opacity:1}},o.createElement(a.a,{drawingStyle:this._getActiveDrawingStyle(),geometry:c.z(t.activeRoute)}),t.inactiveRoutes?o.createElement(g,{style:{opacity:.6}},t.inactiveRoutes.map(function(t){return o.createElement(a.a,{key:t.uuid,drawingStyle:{cursor:"pointer",stroke:st},geometry:c.z(t),onFastClick:function(){return e.props.onRouteClick(t)}})})):null),this._renderStopDots())},t}(o.Component);function ft(e){var t=c.y(e);return Ae.u(t)}var vt=Object(i.b)(mt),gt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._logRouterResponse=function(){var e=t.props;if(e.analyticsRef&&e.analyticsRef.current&&e.routerResponse&&(![e.routerResponse.type,e.travelMode].includes("comparison")||e.routerResponse.type===e.travelMode)){var n=Object(at.c)(e.routerResponse.type,e.settings);e.analyticsRef.current.logEvent("routerResponse",{type:e.routerResponse.type,routePoints:e.routePoints.filter(function(e){return Boolean(e.coords)}).map(function(e){return{uri:e.uri||e.searchResult&&e.searchResult.uri||null,coords:e.coords}}),routes:e.routerResponse.routes.map(function(e){return{id:e.uuid,type:e.type,isIntercityRoute:Boolean("isIntercityRoute"in e&&e.isIntercityRoute),isCargo:Boolean(n&&n>0),distance:"distance"in e?e.distance.value.toFixed(1):null,time:"duration"in e?e.duration.toFixed(1):null}})})}},t._setDragging=function(e){t.props.setDragging&&t.props.setDragging(e)},t._onRouteClick=function(e){var n=t.props;!n.isMapEditing&&n.routerResponse&&(n.analyticsRef&&n.analyticsRef.current&&n.analyticsRef.current.logEvent("click"),n.isRouteModeActive&&n.onActiveRouteChange&&n.onActiveRouteChange(n.routerResponse.routes.findIndex(function(t){return t.uuid===e.uuid})))},t._renderRouteView=function(){var e=t.props;if(!e.routerResponse||0===e.routerResponse.routes.length)return null;var n=e.routerResponse.routes[e.activeRouteIndex]||e.routerResponse.routes[0],r="comparison"===e.routerResponse.type,i=Boolean(e.isMapEditing||!e.isRouteModeActive||e.isRoutePointDragging||r)?void 0:e.routerResponse.routes.filter(function(e){return e.uuid!==n.uuid});switch(n.type){case"pedestrian":return o.createElement(y,{activeRoute:n,inactiveRoutes:i,onRouteClick:t._onRouteClick});case"bicycle":return o.createElement(I,{activeRoute:n,inactiveRoutes:i,mapLocation:e.mapLocation,onRouteClick:t._onRouteClick});case"taxi":case"auto":return o.createElement(F,{activeRoute:n,inactiveRoutes:i,routePoints:e.routePoints,viaIndexes:e.viaIndexes,travelMode:e.travelMode,feedback:e.feedback,mrcFeatures:e.isRouteModeActive?e.mrcFeatures:null,activeMrcIndex:e.activeMrcIndex,zoom:e.mapLocation.zoom,isEditorActive:e.isRouteModeActive&&!e.isMapEditing&&!e.isDetailed&&"auto"===e.travelMode,isDefaultColor:Boolean(e.isTrafficLayerEnabled)||Boolean(e.isPrint)||(n.colorizeInfo||[]).every(function(e){return"UNKNOWN"===e.type}),isLoading:e.isLoading,isMrcPlayerHidden:e.isMrcPlayerHidden,isMrcPlaying:e.isMrcPlaying,isRoutePointDragging:e.isRoutePointDragging,onRouteClick:t._onRouteClick,onRoutePointsChange:e.onRoutePointsChange,setDragging:t._setDragging,onMrcClick:e.onMrcClick});case"masstransit":return o.createElement(vt,{activeRoute:n,inactiveRoutes:i,mapLocation:e.mapLocation,onRouteClick:t._onRouteClick});default:return null}},t._renderRoutePinsView=function(){var e=t.props,n=e.routerResponse?e.routerResponse.routes[e.activeRouteIndex]||e.routerResponse.routes[0]:null;return o.createElement(it,{activeRoute:n,travelMode:e.travelMode,routePoints:e.routePoints,viaIndexes:e.viaIndexes,isRoutePointDragging:e.isRoutePointDragging,draggable:e.isRouteModeActive&&!e.isMapEditing&&!e.isDetailed,onStopClick:e.onStopClick,setDragging:t._setDragging,onRoutePointsChange:e.onRoutePointsChange})},t}Object(r.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props,t=e.routerResponse;t&&t.routes.length>0&&!e.isRoutePointDragging&&(L.a.reachGoal("route_"+e.travelMode),this._logRouterResponse())},n.componentDidUpdate=function(e){var t=this.props,n=t.routerResponse;n&&(!e.routerResponse||function(e,t){if(e.routes.length!==t.routes.length)return!0;return e.routes.some(function(e,n){var r=t.routes[n];return e.uuid!==(r&&r.uuid)})}(n,e.routerResponse))&&n.routes.length>0&&!t.isRoutePointDragging&&(this._logRouterResponse(),L.a.reachGoal("route_"+t.travelMode))},n.render=function(){return o.createElement(o.Fragment,null,this._renderRouteView(),this._renderRoutePinsView())},t}(o.Component);t.default=Object(i.b)(gt)},95:function(e,t,n){"use strict";n.d(t,"f",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"a",function(){return d}),n.d(t,"d",function(){return p}),n.d(t,"b",function(){return m}),n.d(t,"e",function(){return g});var r=n(235),o=n(0),i=n(32),a=["mastercardStandart","goldMastercard","worldMastercard","platinumMastercard","worldMastercardBlackEdition","worldEliteMastercard"],s=["mastercardBusinessCard","mastercardWorldBusinessCard","mastercardPreferredBusinessCard","mastercardCorporateCard"],c=[].concat(a,s);function u(e){o.a.set("promo_mastercard_type",e)}function l(){var e=o.a.get("promo_mastercard_type");return Array.isArray(e)?e.filter(function(e){return c.includes(e)}):[]}function d(e){var t=e.bunker.mastercard;return t&&Array.isArray(t.types)?t.types.filter(function(e){var t=e.id;return void 0===t||c.includes(t)}):[]}function p(e,t,n){return function(e){return Boolean(e.bunker.mastercard&&e.bunker.mastercard.serp.isActive)}(n)?f(e,t,n):null}function m(e,t,n){return f(e,t,n)}function f(e,t,n){var o=i.f(n);return e&&Object(r.a)(i.g(o),{start:e.startDate,end:e.endDate})?function(e,t){return function(e){var t=e.some(function(e){return a.includes(e)}),n=e.some(function(e){return s.includes(e)}),r=t&&n?[]:function(e,t){var n=t?a:s;return[].concat(e).sort(function(e,t){return n.indexOf(t)-n.indexOf(e)})}(e,a.includes(e[0]));return[].concat(r,["anyCard"])}(t).map(function(t){return e.find(function(e){return e.id===t})}).filter(function(e){return Boolean(e)})[0]}(e.offers,t):null}var v={anyCard:"",mastercardStandart:"mastercard_standard",goldMastercard:"gold_mastercard",worldMastercard:"world_mastercard",platinumMastercard:"platinum_mastercard",worldMastercardBlackEdition:"worldblack_mastercard",worldEliteMastercard:"worldelite_mastercard",mastercardBusinessCard:"business_mastercard",mastercardWorldBusinessCard:"worldbusiness_mastercard",mastercardPreferredBusinessCard:"preferredbusiness_mastercard",mastercardCorporateCard:"corporate_mastercard"};function g(e,t){if(void 0===t&&(t=l()),!e.includes("provider:mastercardoffers"))return e;var n=e.replace(/\(? ?feature:\(mastercards_types.*?\)( \|)?\)?/,"");return 0===t.length?n:n+"("+t.map(function(e){return"feature:(mastercards_types:"+v[e]+")"}).join(" | ")+")"}},956:function(e,t,n){"use strict";var r=n(342);var o=n(252),i=n(341),a=n(450),s=n(193);function c(e){var t=[[0,0],[0,0]];e.length&&(t=function(e,t,n){var o=[[1/0,1/0],[-1/0,-1/0]],i=e.length;return[0,1].forEach(function(a){if(n[a]){e.sort(function(e,t){return e[a]-t[a]});var s=0;e.forEach(function(n,c){var u=c+1,l=u===i?e[0]:e[u],d=Object(r.a)(l[a]-n[a],0,t);d>=s&&(s=d,o[0][a]=l[a],o[1][a]=n[a])}),o[0][a]>o[1][a]&&(o[1][a]+=t)}else e.forEach(function(e){o[0][a]=Math.min(o[0][a],e[a]),o[1][a]=Math.max(o[1][a],e[a])})}),o}(e.map(function(e){return Object(o.a)(e,s.g)}),Object(i.a)(s.g),s.k).map(function(e){return Object(a.a)(e,s.g)}));return t}n.d(t,"a",function(){return c})},957:function(e,t,n){"use strict";var r=n(252);function o(e,t){var n=t[0],r=t[1],o=[n[1]-r[1],r[0]-n[0],n[0]*r[1]-r[0]*n[1]],i=[o[1],-o[0],e[1]*o[0]-e[0]*o[1]],a=o[0]*i[1]-i[0]*o[1];return[(i[2]*o[1]-o[2]*i[1])/a,(i[0]*o[2]-o[0]*i[2])/a]}var i=n(449);function a(e,t,n,a,s){for(var c=0;c<e.length-1;c++){var u=[e[c],e[c+1]];if(Object(i.a)(Object(r.a)(t,a),Object(r.a)(u[0],a),Object(r.a)(u[1],a))<n/2){var l=o(t,[u[0],u[1]]);return s?{point:l,segmentIndex:c}:l}}}n.d(t,"a",function(){return a})},98:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(24);function o(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=Object(r.a)(e,t);return n.setHours(0,0,0,0),n}},99:function(e,t,n){"use strict";var r=n(41),o=n(10),i=n(159),a=n(2796),s=n(322),c=n(2809),u=n(25),l=n(95),d="search_",p="",m={fetch:function(e,t){return Object(u.a)("search",{query:v(e,t)},t).then(function(e){return p=e.requestId,e})},fetchSearchResult:function(e,t){if("poi"===e.from)return e.uri?m.loadPoiByUri(e.uri,t).then(function(t){return Object(o.a)(Object(o.a)({},t),{},{items:t.items.map(function(t,n){return Object(o.a)(Object(o.a)({},t),{},{hotspotProperties:e.hotspotProperties,displayCoordinates:e.coordinates&&0===n?e.coordinates:t.displayCoordinates})})})}):m.loadPoiByCoordinates(e.coordinates,t);if("whatshere"===e.from)return m.loadWhatshere(e,t);var n=Object(o.a)(Object(o.a)({},e),{},{count:1,searchType:"TEXT"});return n.uri&&(n.mode="uri"),m.fetch(n,t)},prepareChainSearchRequest:function(e,t){return m.fetch({count:1,kind:"locality",text:Object(a.a)(e.center,{reverse:!0}),origin:"chain-city"},t).then(function(t){var n={searchType:"TEXT",displayText:e.chain.name,text:"chain_id:("+e.chain.id+")",origin:e.origin||"chain"},r=t.bounds;if(r){var o=Object(s.a)(r);n.center=o.center,n.span=o.span}return n})},loadPoiByCoordinates:function(e,t){return m.fetch({text:Object(a.a)(e,{reverse:!0}),count:1,origin:"poi",snippets:f(t)},t)},loadPoiByUri:function(e,t){return m.fetch({mode:"uri",uri:e,count:1,origin:"poi",snippets:f(t)},t)},loadWhatshere:function(e,t){var n=e.origin,o=Object(r.a)(e,["origin"]);return m.fetch({pin:!0,text:Object(a.a)(o.coordinates,{reverse:!0}),zoom:o.zoom,span:[.001,.001],count:1,origin:n||"poi",addBuildingGeometry:e.addGeometry},t).then(function(e){var t=e.items[0];return t?("poi"===n&&(t.displayCoordinates=t.coordinates),e):null}).catch(function(){return null})}};function f(e){return e.search.snippets.filter(function(e){return"related_adverts/1.x"!==e&&"related_adverts_1org/1.x"!==e})}function v(e,t){var n,r=e.clientId||"maps",s=e.origin?r+"-"+e.origin:r,u=((n={text:e.text,lang:t.locale,yandex_gid:t.userRegion.id,client_id:e.clientId,origin:s,results:e.count,ctx:e.context,mode:e.mode,lr:e.lr,uri:e.uri,business_oid:e.id,z:e.zoom,sort:e.sort,business_filter:e.filters,autoscale:e.autoscale,distinguish_layers:e.distinguishLayers,correct_misspell:e.correctMisspell,geocoder_kind:e.kind,skip:e.skip,rspn:e.restrictSpan,rearr:e.rearr,groupchains_advert:e.groupchains_advert,relev_ranking_formula:e.relev_ranking_formula,relev_allow_combined_drugs:e.relev_allow_combined_drugs,maxadv:e.maxadv})[i.e]=e[i.e],n.eventsBranch=t.query.eventsBranch,n);return e.addBuildingGeometry&&(u.search_geometry="2"),e.sortOrigin&&(u.sort_origin=e.sortOrigin.join()),e.center&&(u.ll=e.center.join()),e.span&&(u.spn=e.span.join()),e.bbox&&(u.bbox=e.bbox.join("~")),e.snippets?u.snippets=e.snippets.join():u.snippets=t.search.snippets.join(),e.direct&&(u=Object(o.a)(Object(o.a)({},u),t.advert.direct.params)),e.pin&&(u.geocoder_pin=1),e.type&&(u.type=e.type.join()),e.routeCoordinates&&e.bounds&&e.routeCoordinates.some(function(t){return Object(c.a)(e.bounds,t)})&&(u.business_rll=e.routeCoordinates.map(function(e){return Object(a.a)(e,{fractionDigits:5})}).join("~")),e.clientUsecase&&(u.client_usecase=e.clientUsecase),e.suggestReqid&&"form"===e.origin&&(u.suggest_reqid=e.suggestReqid),e.serpId&&(u.serpid=e.serpId),(e.parentReqId||p||t.searchPreloadedResults)&&(u.parent_reqid=e.parentReqId||p||t.searchPreloadedResults.requestId),(t.experiments.ui.whatshereInDistrictTop||t.experiments.ui.whatshereInDistrictBottom)&&(u.includeWhatshereInDistrict=1),e.geoWhere&&(u.geowhere=[].concat(e.geoWhere).reverse().join()),e.businessMode&&(u.business_mode=e.businessMode),"boolean"==typeof e.businessShowClosed&&(u.business_show_closed=e.businessShowClosed?1:0),u.text=u.text&&l.e(u.text),Object(o.a)(Object(o.a)(Object(o.a)({},u),e.rawParams),function(e){var t=Object(o.a)({},e.experiments.geoSearchParams||{}),n=e.experiments.boxes;n&&(t["test-buckets"]=n);return Object.keys(e.query).forEach(function(n){n.startsWith(d)&&(t[n]=e.query[n])}),t}(t))}t.a=m}}]);