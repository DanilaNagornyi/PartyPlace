(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["ymaps"],{125:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var o=n(34),i=n(75),r=n(155),a=n(76),s={getScale:function(t,e){return Math.pow(2,e-t)},getWorldPixelSize:function(t){return 256*Math.pow(2,t)},worldToPixels:function(t,e){var n=Math.pow(2,e)/2*256;return a.muln({x:t.x+1,y:1-t.y},n)},worldToRelativePixels:function(t,e){var n=Math.pow(2,e)/2*256;return a.mulv(t,{x:n,y:-n})},worldToTile:function(t,e,n){var o=s.worldToPixels(t,e);return a.divn(o,n)},moveCloseToCenter:function(t,e,n){n=n||t;var o=a.sub(t,e).x;return Math.abs(o)>1?a.add(n,{x:-2*Object(i.mathSign)(o),y:0}):n},convertPixelSizeToWorldSize:function(t,e,n){var o=Math.pow(2,e)/2*256;return a.divv(t,{x:o,y:-o},n)},pixelsToWorld:function(t,e){var n=Math.pow(2,e)/2*256;return{x:t.x/n-1,y:1-t.y/n}},fitViewportToWorld:function(t,e){var n=e.zoom,o=e.worldOptions,i=e.size,r=void 0===i?a.ORIGIN:i;if(o.cycledX&&o.cycledY)return t;var c=s.convertPixelSizeToWorldSize(r,n);return{x:u(t.x,c.x,o.cycledX),y:u(t.y,-c.y,o.cycledY)}},restrictToZeroWorld:function(t,e){var n=Object(o.a)({},t);return e.cycledX&&(n.x=Object(r.a)(n.x,-1,1)),e.cycledY&&(n.y=Object(r.a)(n.y,-1,1)),n},computePixelPerfectWorldCoordinates:function(t,e,n,o,i){void 0===o&&(o=1),void 0===i&&(i={x:0,y:0});var r=s.getWorldPixelSize(e)/2*o*n;return a.applyFunction(t,function(t){return Math.round(t*r)/r},i)}};function u(t,e,n){var o=e/2;return n?Object(r.a)(t,-1,1):Object(r.b)(t,Math.min(0,o-1),Math.max(0,1-o))}},155:function(t,e,n){"use strict";function o(t,e,n){return t-Math.floor((t-e)/(n-e))*(n-e)}function i(t,e,n){return Math.max(Math.min(t,n),e)}n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i})},167:function(t,e,n){"use strict";var o=n(34),i=n(76),r=n(402),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=16;function u(){return new Array(s)}function c(t,e){void 0===e&&(e=u());for(var n=0;n<s;++n)e[n]=t[n];return e}function l(t,e,n){void 0===n&&(n=u());for(var o=0;o<s;o+=4)for(var i=t[o],r=t[o+1],a=t[o+2],c=t[o+3],l=0;l<4;++l)n[o+l]=i*e[l]+r*e[4+l]+a*e[8+l]+c*e[12+l];return n}var d=c(a);function h(t,e,n){void 0===n&&(n=r.e(0,0,0));var o=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],i=(t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12])/o,a=(t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13])/o,s=(t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14])/o;return n.x=i,n.y=a,n.z=s,n}var p=n(125);function _(t,e){var n=e.container.getBoundingClientRect();return f({x:t.x-n.left,y:t.y-n.top},e)}function m(t,e){var n=y(t,e),o=e.container.getBoundingClientRect();return i.add(n,{x:o.left,y:o.top},n),n}function f(t,e){var n=e.size,i=e.zoom,a=e.worldCenter,s=e.azimuth,u=e.tilt,c=e.fov,l=Math.tan(.5*c),d={x:0,y:0,z:g(-p.a.convertPixelSizeToWorldSize(n,i).y,c)};r.k(d,u,d),r.l(d,s,d),r.c(d,Object(o.a)(Object(o.a)({},a),{z:0}),d);var h=n.x/n.y,_=r.e(l*h,l,1),m={x:2*(t.x-n.x/2)/n.x,y:2*(n.y/2-t.y)/n.y,z:-1};r.i(m,_,m),r.k(m,u,m),r.l(m,s,m);var f=r.h(r.b,{origin:d,direction:m});if(!f)throw new Error("Pointer above the horizon.");return f}function y(t,e){var n=e.size,_=e.zoom,m=e.worldCenter,f=e.azimuth,y=e.tilt,v=e.fov,b=p.a.convertPixelSizeToWorldSize(n,_),S=i.divn(b,2),x=g(-b.y,v),O={x:0,y:0,z:x};r.k(O,y,O),r.l(O,f,O),r.c(O,Object(o.a)(Object(o.a)({},m),{z:0}),O);var z=function(t,e,n,o,i){void 0===i&&(i=u());var a=r.m(e,n);r.j(a,a);var s=r.f(o,a);r.j(s,s);var c=r.f(a,s);return d[0]=s.x,d[1]=c.x,d[2]=a.x,d[4]=s.y,d[5]=c.y,d[6]=a.y,d[8]=s.z,d[9]=c.z,d[10]=a.z,d[12]=-r.g(s,e),d[13]=-r.g(c,e),d[14]=-r.g(a,e),l(t,d,i)}(a,O,Object(o.a)(Object(o.a)({},m),{z:0}),r.l({x:0,y:1,z:0},f));if(y>0){var E=-S.y*Math.sin(y),w=-E-x,T=E-x,R=S.x/-S.y,C=function(t,e,n,o,i,r){void 0===r&&(r=u());for(var a=1/Math.tan(.5*e),c=a/n,l=(o+i)/(o-i),d=2*o*i/(o-i),h=0;h<s;h+=4){r[h]=t[h]*c,r[h+1]=t[h+1]*a;var p=t[h+2],_=t[h+3];r[h+2]=p*l+_*d,r[h+3]=-p}return r}(c(a),v,R,w,T);return C[0]=C[0]*n.x/2,C[5]=C[5]*(-n.y/2),C[8]=-n.x/2,C[9]=-n.y/2,h(l(z,C),Object(o.a)(Object(o.a)({},t),{z:0}))}var j=h(z,Object(o.a)(Object(o.a)({},t),{z:0})),A=i.add(j,S);return p.a.worldToRelativePixels(A,_)}function g(t,e){return.5*t/Math.tan(.5*e)}n.d(e,"c",function(){return _}),n.d(e,"e",function(){return m}),n.d(e,"b",function(){return f}),n.d(e,"d",function(){return y}),n.d(e,"a",function(){return g})},192:function(t,e,n){"use strict";n.r(e),n.d(e,"queueMicrotask",function(){return r}),n.d(e,"Promise",function(){return o}),n.d(e,"promiseFinally",function(){return a});var o=Promise,i=o.resolve(),r=function(t){return i.then(t)},a=function(t,e){var n=Promise.resolve(t);return"finally"in n?n.finally(e):n.then(function(t){return Promise.resolve(e()).then(function(){return Promise.resolve(t)})},function(t){return Promise.resolve(e()).then(function(){return Promise.reject(t)})})}},248:function(t,e,n){"use strict";var o=n(34);!function(t){function e(e){var n=t.call(this,e)||this;return n.name="AssertionError",n}Object(o.b)(e,t)}(Error)},2495:function(t,e,n){},268:function(t,e,n){"use strict";n.d(e,"b",function(){return s}),n.d(e,"a",function(){return o});var o,i=n(34),r=n(74),a=n(435);!function(t){t[t.QUICK=1]="QUICK",t[t.INTERMEDIATE=2]="INTERMEDIATE",t[t.FULL=3]="FULL"}(o||(o={}));var s=function(t){function e(){var e=t.call(this)||this;return e._rafId=0,e._animationsCounter=0,e._framesSinceIntermediateRendering=0,e._renderFrame=function(){e._rafId=0,e._updateIsRequested=!1;var t=Date.now();try{e._emit("beforeRender",t);var n=e._getQualityForCurrentFrame();e._emit("render",{time:t,qualityHint:n})}catch(o){throw o&&"object"==typeof o&&e._lastTriggerStack&&(o.additionalInfo=e._lastTriggerStack),o}e._isRunning&&e._requestFrame()},e._updateIsRequested=!1,e._isRunning=!1,e}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._isRunning=!0,this._requestFrame(),this._lastTriggerStack=(new Error).stack},e.prototype.stop=function(){this._isRunning&&(this._isRunning=!1,this._updateIsRequested||this._cancelFrame(),this._lastTriggerStack=void 0)},e.prototype.renderImmediately=function(t){var e=Date.now();this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._updateIsRequested=!1,this._emit("beforeRender",e),this._emit("render",{time:e,qualityHint:t})},e.prototype.update=function(){this._isRunning||(this._lastTriggerStack=(new Error).stack),this._updateIsRequested=!0,this._requestFrame()},e.prototype.destroy=function(){this._cancelFrame()},e.prototype.animate=function(t){var e=this;0===this._animationsCounter&&this.start(),this._animationsCounter++;var n=!0,o=this.on("beforeRender",function(i){n?t(i):(o.offAll(),e._animationsCounter--,0===e._animationsCounter&&e.stop())}),i=new a.b;return{complete:i.promise,get isRunning(){return n},stop:function(){n?(n=!1,i.resolve()):console.warn("Trying to stop animation twice")}}},e.prototype.animateForDuration=function(t,e){var n=-1,o=this.animate(function(i){if(n<0)n=i;else{var r=(i-n)/e;r<1?t(r):(t(1),o.stop())}});return o},e.prototype._requestFrame=function(){this._rafId||(this._rafId=requestAnimationFrame(this._renderFrame))},e.prototype._cancelFrame=function(){cancelAnimationFrame(this._rafId),this._rafId=0},e.prototype._getQualityForCurrentFrame=function(){return this._isRunning?this._framesSinceIntermediateRendering<12?(this._framesSinceIntermediateRendering++,o.QUICK):(this._framesSinceIntermediateRendering=1,o.INTERMEDIATE):(this._framesSinceIntermediateRendering=0,o.FULL)},e}(Object(r.a)().with())},2803:function(t,e,n){"use strict";n.r(e),n.d(e,"EventBlockerLayer",function(){return i});var o=n(6),i=function(t){function e(e){var n;return(n=t.call(this,e)||this).element=document.createElement("div"),n.element.style.width="100%",n.element.style.height="100%",n.element.style.position="absolute",n.element.style.top="0",n.element.style.left="0",n}Object(o.a)(e,t);var n=e.prototype;return n.findObjectInPosition=function(){return{type:"empty-object"}},n.destroy=function(){},e}(n(636).a)},2805:function(t,e,n){"use strict";n.r(e);var o,i=n(34),r=(n(2495),n(75)),a=n(434),s=n(192),u=n(76),c=n(312),l=n(268),d=n(436),h=n(455),p=Math.PI/180,_=180/Math.PI,m=30*p,f=n(74);!function(t){t[t.INACTIVE=-1]="INACTIVE",t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=2]="SECONDARY",t[t.CTRL_PRIMARY=8]="CTRL_PRIMARY"}(o||(o={}));var y=500,g=function(t){function e(n,i){var r=t.call(this)||this;return r._suppressNextClickStartTs=0,r.destroyed=!1,r.state=o.INACTIVE,r._spots=[],r._onElementPointerDown=function(){if(void 0===e._owner)e._owner=r;else if(e._owner!==r)return;r.element.removeEventListener(r._eventMap.start,r._onElementPointerDown),document.addEventListener(r._eventMap.start,r._onDocumentPointerDown),document.addEventListener(r._eventMap.end,r._onPointerUp)},r._onDocumentPointerDown=function(t){if(e._owner===r){var n=0===r._spots.length;r.state=n?r._getEventState(t):r.state,r._handleAdd(t),r._emit("spotsAdded"),n&&r._emit("stateChanged")}},r._onPointerMove=function(t){e._owner===r&&(r._handleChange(t),r._spots.length>0&&r._emit("spotsChanged"))},r._onPointerUp=function(t){e._owner===r&&(r._handleRemove(t),0===r._spots.length?(document.removeEventListener(r._eventMap.start,r._onDocumentPointerDown),document.removeEventListener(r._eventMap.end,r._onPointerUp),r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),e._owner=void 0,r._emit("spotsRemoved"),r.state=o.INACTIVE,r._emit("stateChanged")):r._emit("spotsRemoved"))},r._onClick=function(t){var e=Date.now();r._suppressNextClickStartTs+y>e&&(r._suppressNextClickStartTs=0,t.stopPropagation(),t.preventDefault())},r._onDragStart=function(t){t.stopPropagation(),t.preventDefault()},r.element=n,r._eventMap=i,r.element.style.touchAction="none",r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),r.element.addEventListener("click",r._onClick,!0),r.element.addEventListener("dragstart",r._onDragStart),document.addEventListener(r._eventMap.move,r._onPointerMove),r}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return this._spots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._spots.length>0?u.avg(this._spots):this._getPointerPositionWithoutSpots()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener(this._eventMap.start,this._onElementPointerDown),document.removeEventListener(this._eventMap.start,this._onDocumentPointerDown),document.removeEventListener(this._eventMap.move,this._onPointerMove),document.removeEventListener(this._eventMap.end,this._onPointerUp),this.element.removeEventListener("dragstart",this._onDragStart),this.element.removeEventListener("click",this._onClick,!0),this.element.style.touchAction="auto",this.destroyed=!0,e._owner===this&&(e._owner=void 0))},e.prototype.suppressNextClick=function(){this._suppressNextClickStartTs=Date.now()},e.prototype.suppressSelection=function(){},e.prototype._getEventState=function(t){return t instanceof MouseEvent?t.ctrlKey&&0===t.button?o.CTRL_PRIMARY:t.button:o.PRIMARY},e}(Object(f.a)().with()),v={start:"pointerdown",move:"pointermove",end:"pointerup"};function b(t){var e=[];return t.forEach(function(t){e.push(t)}),e}var S=function(t){function e(e){var n=t.call(this,e,v)||this;return n._spotMap=new r.Map,n._pointerPosition={x:0,y:0},n._suppressSelection=!1,n._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(n._pointerPosition={x:t.clientX,y:t.clientY})},document.addEventListener("wheel",n._onWheel,!0),document.addEventListener("pointercancel",function(){n._spotMap.clear(),n.state=o.INACTIVE,n._emit("stateChanged")}),n}return Object(i.b)(e,t),e.prototype.suppressSelection=function(){this._suppressSelection=!0},e.prototype.destroy=function(){document.removeEventListener("wheel",this._onWheel,!0),t.prototype.destroy.call(this)},e.prototype._handleAdd=function(t){var e=this;this._spotMap.set(t.pointerId,{x:t.clientX,y:t.clientY}),this._spots=b(this._spotMap),this._pointerPosition={x:t.clientX,y:t.clientY};var n=t.target;if(n){var o=function(t){n.removeEventListener("pointerup",o),e._handleRemove(t)};n.addEventListener("pointerup",o)}},e.prototype._handleChange=function(t){this._suppressSelection&&1===this._spots.length&&t.preventDefault(),this._pointerPosition={x:t.clientX,y:t.clientY},this._spots.length>0&&this._spotMap.has(t.pointerId)&&(this._spotMap.set(t.pointerId,this._pointerPosition),this._spots=b(this._spotMap))},e.prototype._handleRemove=function(t){this._spotMap.delete(t.pointerId),this._spots=b(this._spotMap),this._suppressSelection=!1},e.prototype._getPointerPositionWithoutSpots=function(){return this._pointerPosition},e}(g),x={start:"touchstart",move:"touchmove",end:"touchend"},O=function(t){function e(n){var i=t.call(this,n,x)||this;return i._mouseCoords={x:0,y:0},i._holdingMouseButton=!1,i._onMouseDown=function(t){if(void 0===e._mouseOwner)e._mouseOwner=i;else if(e._mouseOwner!==i)return;i._mouseCoords={x:t.clientX,y:t.clientY};var n=i.state===o.INACTIVE;i.state=n?i._getEventState(t):i.state,i._holdingMouseButton=!0,document.addEventListener("mouseup",i._onMouseUp),i._emit("spotsAdded"),n&&i._emit("stateChanged")},i._onMouseMove=function(t){i._mouseCoords={x:t.clientX,y:t.clientY},e._mouseOwner===i&&i._holdingMouseButton&&i._emit("spotsChanged")},i._onMouseUp=function(){e._mouseOwner===i&&(e._mouseOwner=void 0,i._holdingMouseButton=!1,document.removeEventListener("mouseup",i._onMouseUp),i._emit("spotsRemoved"),i.state=o.INACTIVE,i._emit("stateChanged"))},i._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(i._mouseCoords={x:t.clientX,y:t.clientY})},i.element.addEventListener("mousedown",i._onMouseDown),document.addEventListener("mousemove",i._onMouseMove),i.element.addEventListener("wheel",i._onWheel),/ipad|iphone/i.test(navigator.userAgent)&&i.element.addEventListener("touchmove",function(t){return t.preventDefault()}),i}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return 0!==this._spots.length?this._spots:this._holdingMouseButton?[this._mouseCoords]:[]},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this.element.removeEventListener("wheel",this._onWheel),t.prototype.destroy.call(this))},e.prototype._handleAdd=function(t){this._spots=z(t.touches)},e.prototype._handleChange=function(t){var e=this._spots.length;this._spots=z(t.touches),this._spots.length<e?this._emit("spotsRemoved"):this._spots.length>e&&this._emit("spotsAdded")},e.prototype._handleRemove=function(t){this._spots=z(t.touches)},e.prototype._getPointerPositionWithoutSpots=function(){return this._mouseCoords},e}(g);function z(t){for(var e=new Array,n=0;n<t.length;n++)e[n]={x:t[n].clientX,y:t[n].clientY};return e}var E,w=new r.WeakMap;function T(t){var e=w.get(t);e&&!e.destroyed||(e=!/ipad|iphone/i.test(navigator.userAgent)&&"PointerEvent"in window?new S(t):new O(t),w.set(t,e));return e}!function(t){t[t.IDLE=0]="IDLE",t[t.DRAGGING_BEYOND_THRESHOLD=1]="DRAGGING_BEYOND_THRESHOLD",t[t.DRAGGING=2]="DRAGGING"}(E||(E={}));var R,C={tremorPixels:3,listenToButtons:new r.Set([o.PRIMARY]),minSpotsCount:1},j=function(t){function e(e,n){void 0===n&&(n={});var o=t.call(this)||this;return o._state=E.IDLE,o._startingPoint={x:0,y:0},o._dragOffset={x:0,y:0},o._pointerPosition={x:0,y:0},o._onSpotAdded=function(){if(!(o._device.spots.length<o._options.minSpotsCount)){var t=o._device.state;if(o._state<E.DRAGGING_BEYOND_THRESHOLD&&o._options.listenToButtons.has(t)){var e=o._device.pointerPosition;o._state=E.DRAGGING_BEYOND_THRESHOLD,o._startingPoint.x=e.x,o._startingPoint.y=e.y,o._dragOffset={x:0,y:0},o._pointerPosition=o._device.pointerPosition}else o._skip(o._device.pointerPosition)}},o._onSpotsChanged=function(){if(!(o._state<E.DRAGGING_BEYOND_THRESHOLD)){var t=o._device.pointerPosition,e=o._dragOffset;o._dragOffset=u.sub(t,o._startingPoint),o._pointerPosition=o._device.pointerPosition,o._state<=E.DRAGGING_BEYOND_THRESHOLD&&Math.max(Math.abs(o._dragOffset.x),Math.abs(o._dragOffset.y))>o._options.tremorPixels?(o._emit("dragStart"),o._state=E.DRAGGING,o._device.suppressSelection()):o._state!==E.DRAGGING||u.areEqual(e,o._dragOffset)||o._emit("dragMove")}},o._onSpotsRemoved=function(){o._device.spots.length<o._options.minSpotsCount?(o._emit("dragEnd"),o._state===E.DRAGGING&&o._device.suppressNextClick(),o._state=E.IDLE,o._dragOffset={x:0,y:0},o._pointerPosition={x:0,y:0}):o._skip(o._device.pointerPosition)},o._device=e,o._options=Object(i.a)(Object(i.a)({},C),n),o._deviceSubscription=o._device.on("spotsAdded",o._onSpotAdded).on("spotsChanged",o._onSpotsChanged).on("spotsRemoved",o._onSpotsRemoved),o}return Object(i.b)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"dragStartingPoint",{get:function(){return this._startingPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._pointerPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragOffset",{get:function(){return this._state===E.DRAGGING?this._dragOffset:{x:0,y:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._state!==E.IDLE},enumerable:!1,configurable:!0}),e.prototype._skip=function(t){if(this._state<E.DRAGGING)return this._startingPoint=t,void(this._pointerPosition=t);this._emit("dragEnd"),this._startingPoint=t,this._pointerPosition=t,this._emit("dragStart")},e}(Object(f.a)().with()),A=40;!function(t){t[t.SCROLL_DOWN=-1]="SCROLL_DOWN",t[t.SCROLL_UP=1]="SCROLL_UP"}(R||(R={}));var M=function(t){function e(e){var n=t.call(this)||this;return n._onWheel=function(t){if("boolean"!=typeof t.isTrusted||t.isTrusted){t.preventDefault(),t.stopPropagation();var e=t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?1:A,o=(void 0!==t.wheelDeltaY?t.wheelDeltaY:-t.deltaY)*e*(t.shiftKey?.25:1);n._emit("wheel",o)}},n._element=e,n._element.addEventListener("wheel",n._onWheel,{passive:!1}),n}return Object(i.b)(e,t),e.prototype.destroy=function(){this._element.removeEventListener("wheel",this._onWheel)},e}(Object(f.a)().with()),P=15,L=5,D=10,I=12*p,k=function(t){function e(e){var n=t.call(this)||this;return n._scale=1,n._state=0,n._angle=0,n._angleDelta=0,n._panTiltDelta=0,n._initialTouchDistance=1,n._initialTouchesY=[0,0],n._initialDirection={x:0,y:0},n._device=e,n._deviceSubscription=n._device.on("spotsAdded",function(){2===n._device.spots.length&&(n._state=1,n._initialTouchDistance=F(n._device.spots),n._initialTouchesY=[n._device.spots[0].y,n._device.spots[1].y],n._initialDirection=G(n._device.spots),n._updateState())}).on("spotsChanged",function(){if(!(n._device.spots.length<=1)&&(n._updateState(),1===n._state)){var t=Math.abs(F(n._device.spots)-n._initialTouchDistance),e=Math.abs(n._angle)>I,o=t>=P,i=n._device.spots[0].y-n._initialTouchesY[0],a=n._device.spots[1].y-n._initialTouchesY[1],s=!e&&Object(r.mathSign)(i)===Object(r.mathSign)(a)&&Math.abs(i)>=L&&Math.abs(a)>=L&&t<D;(e||o||s)&&(n._state=2,n._initialTouchDistance=F(n._device.spots),n._initialDirection=G(n._device.spots),n._updateState(),n._emit(o||e?"pinchRotateStart":"panTiltStart"))}}).on("spotsRemoved",function(){n._device.spots.length<=1?(2===n._state&&n._emit("gestureEnd"),n._scale=1,n._angle=0,n._angleDelta=0,n._panTiltDelta=0,n._initialDirection={x:0,y:0},n._initialTouchDistance=0,n._initialTouchesY=[0,0]):n._updateState()}),n}return Object(i.b)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"scale",{get:function(){return 2===this._state?this._scale:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return 2===this._state?this._getCorrectedAngle():0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panTiltDelta",{get:function(){return 2===this._state?this._panTiltDelta:0},enumerable:!1,configurable:!0}),e.prototype._updateState=function(){var t,e,n=this._device.spots,o=F(n);this._scale=o?o/this._initialTouchDistance:1,this._angle=(t=G(n),e=this._initialDirection,Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)),this._panTiltDelta=this._initialTouchesY[0]-n[0].y},e.prototype._getCorrectedAngle=function(){var t=Math.abs(this._angle)>I;return!this._angleDelta&&t&&(this._angleDelta=-Object(r.mathSign)(this._angle)*I),this._angleDelta?this._angle+this._angleDelta:0},e}(Object(f.a)().with());function F(t){if(t.length<2)return 0;var e=u.sub(t[0],t[1]);return u.length(e)}function G(t){return u.sub(t[0],t[1])}var W=n(125);n(248);function Z(t){var e=document.createElement("ymaps");return t&&(e.className=t),e}var N=n(633),B=n(167),Y=n(155),H=function(t){function e(e){var n=t.call(this)||this;return n._device=null,n._dragger=null,n._dragStartSubscription=null,n.options=Object(i.a)({},e.options),n.options.draggable=Boolean(n.options.draggable),n.options.zIndex=n.options.zIndex||0,n.options.disableRoundCoordinates=Boolean(n.options.disableRoundCoordinates),n.container=n._makeWrapper(e.element),n.element=e.element,n._state={type:"idle",coordinates:e.coordinates},n._toggleDrag(n.options.draggable||!1),n}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"coordinates",{get:function(){if("idle"===this._state.type)return this._state.coordinates;if(this._layer){var t=X(this._state);return V(this._layer,t)}return this._state.initialCoordinates},enumerable:!1,configurable:!0}),e.prototype.toggleDrag=function(t){t!==this.options.draggable&&this._toggleDrag(t)},e.prototype.toggleRoundCoordinates=function(t){t!==this.options.disableRoundCoordinates&&(this.options.disableRoundCoordinates=t,this.reposition(!0))},e.prototype.setCoordinates=function(t){"idle"===this._state.type?this._state.coordinates=t:this._state.initialCoordinates=t,this.reposition(!0)},e.prototype.setZIndex=function(t){this.options.zIndex=t,this.reposition(!0)},e.prototype.destroy=function(){this._destroyDrag(),this._layer=void 0},e.prototype.reposition=function(t){if(void 0===t&&(t=!1),this._layer){var e=void 0,n=(e="dragging"===this._state.type?X(this._state):function(t,e,n){var o=t.zoom,i=t.size,r=t.tilt,a=t.azimuth,s=t.fov,u=n&&0===r?W.a.computePixelPerfectWorldCoordinates(t.center,o,Object(N.a)(),1):t.center,c=t.projection.toGlobalCoordinates(e),l=n?W.a.computePixelPerfectWorldCoordinates(c,o,Object(N.a)(),1):c,d=t.worldOptions.cycledX?W.a.moveCloseToCenter(l,u):l;return d.y=Object(Y.b)(d.y,-1,1),Object(B.d)(d,{azimuth:a,tilt:r,worldCenter:u,zoom:o,size:i,fov:s})}(this._layer,this.coordinates,!this.options.disableRoundCoordinates&&t)).x,o=e.y;this.container.style.transform="translate("+n+"px, "+o+"px)",this.container.style.zIndex=String(this.options.zIndex)}},e.prototype.attachToLayer=function(t){if(this._layer)throw new Error("Marker is already attached to layer");this._layer=t,this.options.draggable&&this._initDrag(this._layer),this.reposition()},e.prototype.detachFromLayer=function(){if(!this._layer)throw new Error("Marker is not attached to layer");this._destroyDrag(),this._layer=void 0},e.prototype._makeWrapper=function(t){var e=Z("ymaps3x0--marker");return e.appendChild(t),e},e.prototype._toggleDrag=function(t){this.options.draggable=t,t?this._layer&&this._initDrag(this._layer):this._destroyDrag()},e.prototype._initDrag=function(t){var e=this;this._device=T(this.container);var n=new j(this._device);this._dragger=n,this._dragStartSubscription=n.on("dragStart",function(){if(e._emit("dragStart"),"dragging"===e._state.type)throw new Error("Dragging can't be started more than once");var o=e.container.getBoundingClientRect(),i=u.sub(n.dragStartingPoint,{x:o.left,y:o.top}),r={type:"dragging",pointerPosition:n.pointerPosition,layer:t,markerOffset:i,initialCoordinates:e._state.coordinates,subscription:n.group().on("dragMove",function(){r.pointerPosition=n.pointerPosition,e.reposition(),e._emit("dragMove")}).on("dragEnd",function(){var n=X(r);r.subscription.offAll(),e._state={type:"idle",coordinates:V(t,n)},e.reposition(!0),e._emit("dragEnd")})};e._state=r})},e.prototype._destroyDrag=function(){"dragging"===this._state.type&&(this._state.subscription.offAll(),this._state={coordinates:this._state.initialCoordinates,type:"idle"}),this._dragStartSubscription&&(this._dragStartSubscription.offAll(),this._dragStartSubscription=null),this._dragger&&(this._dragger.destroy(),this._dragger=null),this._device&&(this._device.destroy(),this._device=null)},e}(Object(f.a)().with());function V(t,e){var n=t.center,o=t.zoom,i=t.azimuth,r=t.tilt,a=t.size,s=t.projection,u=t.fov,c=Object(B.b)(e,{worldCenter:n,zoom:o,tilt:r,azimuth:i,size:a,fov:u});return s.fromGlobalCoordinates(c)}function X(t){var e=t.layer,n=t.markerOffset,o=t.pointerPosition,i=e.element.getBoundingClientRect();return{x:o.x-i.left-n.x,y:o.y-i.top-n.y}}function q(t,e,n,o){var i=t.toGlobalCoordinates(e);if(!o)return i;var r=W.a.worldToPixels(i,n),a=u.sub(r,U(o));return W.a.pixelsToWorld(a,n)}function U(t){return{x:(t[3]-t[1])/2,y:(t[0]-t[2])/2}}var Q,K=n(988);function J(t){Q||(Q=t)}var $,tt=n(656),et=n(435),nt=n(634),ot=n(565),it=n(437),rt=function(t){return Math.abs(t)>=1e21?t.toPrecision(100):t.toFixed(5)};function at(t,e){return t.state=e,t}!function(t){t[t.QUEUED=0]="QUEUED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ANIMATING=3]="ANIMATING",t[t.READY=4]="READY",t[t.EMPTY=5]="EMPTY",t[t.REMOVED=6]="REMOVED"}($||($={}));var st=function(t){function e(e,n,o,a,s,c,l,d,h,p,_,m,f){var y=t.call(this)||this;return y._currentTiles=new r.Map,y._renderedOffset={x:0,y:0},y._renderedScale=0,y._renderedAzimuth=0,y._renderedTilt=0,y._loadedTiles=new r.Set,y._haveTilesToAnimate=!1,y._tileBounds=[u.ORIGIN,u.ORIGIN,u.ORIGIN,u.ORIGIN],y.element=Z("ymaps3x0--tile-layer__container"),y.state={tilesLoaded:0,tilesTotal:0,tilesReady:0,borderLoaded:0,borderReady:0,borderTotal:0},y._createTile=function(t){var e=y._computeScreenCordinatesForTile(t),n=y._computeTilePriority(t),o=Object(i.a)({state:$.QUEUED,info:t,screenX:Math.round(e.x),screenY:Math.round(e.y),animate:!y._firstScreen||y._animateFirstScreen,animationStartTs:0,image:null},y._tileLoadingQueue.enqueue(function(t){var e,n=null===(e=y._tileSource.rasterSourceDescription)||void 0===e?void 0:e.tileUrl;return"function"==typeof n?y._generateTile(n,o,t):y._loadTile(o,t)},n));return o.promise.then(function(t){o.abortController.signal.aborted||y._onTileLoad(t)}).catch(function(t){if(!(t instanceof ot.a))throw t}),o},y._updateTile=function(t,e){t.info=e;var n=y._computeScreenCordinatesForTile(t.info);t.state===$.QUEUED&&t.updatePriority(y._computeTilePriority(t.info)),t.screenX===n.x&&t.screenY===n.y||(t.screenX=n.x,t.screenY=n.y,t.state!==$.ANIMATING&&t.state!==$.READY||(t.element.style.left=n.x+"px",t.element.style.top=n.y+"px"))},y._removeTile=function(t){t.state!==$.QUEUED&&t.state!==$.LOADING||t.abortController.abort(),t.state===$.LOADED&&y._loadedTiles.delete(t),t.state!==$.ANIMATING&&t.state!==$.READY||y.element.removeChild(t.element),t.state!==$.READY&&t.state!==$.ANIMATING&&t.state!==$.LOADED||!t.ctx||(t.ctx=void 0),at(t,$.REMOVED)},y._generateTile=function(t,e,n){var o=at(e,$.LOADING);return t(e.info.x,e.info.y,y.zoom).then(function(t){if(n.aborted)throw new ot.a;var e=at(o,$.LOADED),i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.style.width=y._tileSource.tileSize+"px",i.style.height=y._tileSource.tileSize+"px",i.style.position="absolute";var r=i.getContext("2d");if(null===r)throw new Error("Can't obtain canvas context");return r.drawImage(t,0,0),e.ctx=r,e.element=i,y._countLoadedTile(e),e}).catch(function(){if(n.aborted)throw new ot.a;var t=at(o,$.EMPTY);return y._countReadyTile(t),t})},y._loadTile=function(t,e){var n=at(t,$.LOADING),o=y._tileSource.generateTileUrl(n.info.x,n.info.y,y.zoom,Object(N.a)());if(!o){var i=at(n,$.EMPTY);return y._countReadyTile(i),Promise.resolve(i)}var r=new et.b,a=new Image,s=function(t){if(a.onerror=null,a.onload=null,e.removeEventListener("abort",u),0===t){var o=at(n,$.LOADED);o.element=a,r.resolve(o),y._countLoadedTile(o)}else if(1===t){var i=at(n,$.EMPTY);r.resolve(i),y._countReadyTile(i)}else 2===t&&(a.src="",r.reject(new ot.a))},u=s.bind(null,2);e.addEventListener("abort",u);var c=s.bind(null,0),l=s.bind(null,1);return a.decode?(a.src=o,a.decode().then(c,l)):(a.onload=c,a.onerror=l,a.src=o),r.promise},y._onTileLoad=function(t){t.state===$.LOADED?(y._loadedTiles.add(t),y._emit("requestRender")):t.state===$.EMPTY&&y._countReadyTile(t)},y._shouldAwaitAllTiles=m,y._releaseAwaitAllTilesTrigger=f,y._visibleCenter=n,y._scale=o,y._azimuth=a,y._tilt=s,y._fov=c,y._size=d,y._tileSource=h,y._parent=e,y.zoom=l,y._animateFirstScreen=p,y._tileLoadingQueue=_,y.element.dataset.z=String(l),e.appendChild(y.element),y.element.addEventListener("dragstart",function(t){t.stopPropagation(),t.preventDefault()}),y._fetchedCenter=y._visibleCenter,y._fetched=!1,y._firstScreen=!0,y}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"needsRender",{get:function(){return 0!==this._loadedTiles.size||this._haveTilesToAnimate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.element.parentElement.removeChild(this.element),this._currentTiles.forEach(function(t){t.state!==$.QUEUED&&t.state!==$.LOADING||t.abortController.abort()})},e.prototype.resize=function(t){this._fetched=!1,this._size=t,this.reposition(l.a.FULL)},e.prototype.update=function(t,e,n,o,i){this._visibleCenter=W.a.computePixelPerfectWorldCoordinates(t,this.zoom,Object(N.a)(),o),this._azimuth=e,this._tilt=n,this._scale=o,this._fov=i},e.prototype.setVisibile=function(t){this.element.style.display=t?"":"none"},e.prototype.freeze=function(){var t=this;this._loadedTiles.clear(),this._currentTiles.forEach(function(e,n){e.state<=$.LOADED&&(t._currentTiles.delete(n),e.state!==$.QUEUED&&e.state!==$.LOADING||e.abortController.abort())})},e.prototype.unfreeze=function(){this._fetched=!1},e.prototype.reposition=function(t){var e=u.sub(this._fetchedCenter,this._visibleCenter),n=this._tileSource.worldOptions.cycledX?W.a.moveCloseToCenter(this._fetchedCenter,this._visibleCenter,e):e,o=W.a.worldToRelativePixels(n,this.zoom),i=t>=l.a.FULL;if(i&&u.applyFunction(o,Math.round,o),!u.areEqual(o,this._renderedOffset)||this._renderedScale!==this._scale||this._renderedAzimuth!==this._azimuth||this._renderedTilt!==this._tilt){var r=t===l.a.QUICK?u.ORIGIN:this._computeContainerSubpixelOffset(Object(N.a)());this._renderedOffset=u.sub(o,r,o);var a=Object(B.a)(this._size.y,this._fov),s=a-a/this._scale,c=s*Math.sin(this._tilt),d=s*Math.cos(this._tilt),h=[(i?this._renderedOffset.x.toString():rt(this._renderedOffset.x))+"px",(i?this._renderedOffset.y.toString():rt(this._renderedOffset.y))+"px","0px"].join(", ");this.element.style.transform="\n            rotateX("+rt(this._tilt)+"rad)\n            translate3d(0px, "+c+"px, "+d+"px)\n            rotateZ("+rt(this._azimuth)+"rad) translate3d("+h+")\n        ",this._renderedScale=this._scale,this._renderedAzimuth=this._azimuth,this._renderedTilt=this._tilt}},e.prototype.render=function(t){var e=Object(it.c)(W.a.worldToPixels(this._visibleCenter,this.zoom),this._azimuth,this._size,this._scale,this._tileSource.tileSize);this._fetched&&!Object(it.g)(e,this._tileBounds)||this._fetch(),this._fetch(),this._tileSource.isTileAnimationStarted&&this._animateTilesContent(t.time),this.reposition(t.qualityHint),this._shouldAwaitAllTiles()&&this.state.tilesLoaded!==this.state.tilesTotal||(this._attachLoadedTiles(t.time),this._revealNewTiles(t.time))},e.prototype.finishTileAnimations=function(){var t=this;this._haveTilesToAnimate&&(this._currentTiles.forEach(function(e){e.state===$.ANIMATING&&(e.element.style.opacity="1",t._countReadyTile(at(e,$.READY)))}),this._haveTilesToAnimate=!1)},e.prototype._computeContainerSubpixelOffset=function(t){var e=this._parent.getBoundingClientRect(),n={x:e.left,y:e.top};return u.applyFunction(n,function(e){var n=e*t;return(n-Math.round(n))/t})},e.prototype._fetch=function(){var t=this,e=u.sub(this._fetchedCenter,this._visibleCenter).x;this._fetchedCenter=this._visibleCenter;var n=W.a.worldToPixels(this._fetchedCenter,this.zoom);this._centralTilePoint=u.add(u.divn(n,this._tileSource.tileSize),{x:-.5,y:-.5});var o=Object(it.b)(this._visibleCenter,this._azimuth,this._tilt,this.zoom,this._scale,this._size,this._tileSource.tileSize),i=o.tiles,a=o.tileBounds;this._tileBounds=a;var s=Object(it.d)(this.zoom,this._tileSource.tileSize),c=this._currentTiles,l=e>1;(l||e<-1)&&(c=new r.Map,this._currentTiles.forEach(function(e){var n=e.info,o=n.x,i=n.y,r=l?-s:s;c.set(Object(it.e)({x:o+r,y:i},t.zoom),e)}));var d=Object(nt.a)(c,i,this._createTile,this._removeTile,this._updateTile);this._currentTiles=d.result,this._updateState()&&this._emitStateChanged(),this._fetched=!0,this._firstScreen=!1},e.prototype._animateTilesContent=function(t){var e=this;this._currentTiles.forEach(function(n){var o;if((null===(o=e._tileSource.rasterSourceDescription)||void 0===o?void 0:o.animateTile)&&n.state===$.READY&&n.ctx){var i=e._tileSource.rasterSourceDescription.animateTile(n.info.x,n.info.y,e.zoom,t);n.element&&!1!==i&&(n.ctx.clearRect(0,0,n.element.width,n.element.height),n.ctx.drawImage(i,0,0))}})},e.prototype._attachLoadedTiles=function(t){var e=this;if(0!==this._loadedTiles.size){var n=document.createDocumentFragment();this._loadedTiles.forEach(function(o){if(o.element.style.left=o.screenX+"px",o.element.style.top=o.screenY+"px",o.element.style.width=e._tileSource.tileSize+"px",o.element.style.height=e._tileSource.tileSize+"px",o.animate){var i=at(o,$.ANIMATING);i.element.style.opacity="0",i.animationStartTs=t}else o.element.style.opacity="1",e._countReadyTile(at(o,$.READY));n.appendChild(o.element)}),this.element.appendChild(n),this._loadedTiles.clear()}},e.prototype._revealNewTiles=function(t){var e=this;this._haveTilesToAnimate=!1,this._currentTiles.forEach(function(n){if(n.state===$.ANIMATING){var o=Math.min(1,(t-n.animationStartTs)/200);n.element.style.opacity=String(o),o<1?e._haveTilesToAnimate=!0:e._countReadyTile(at(n,$.READY))}}),this._haveTilesToAnimate?this._emit("requestRender"):this._releaseAwaitAllTilesTrigger()},e.prototype._countLoadedTile=function(t){t.info.border?this.state.borderLoaded++:this.state.tilesLoaded++,this._emitStateChanged()},e.prototype._countReadyTile=function(t){t.info.border?this.state.borderReady++:this.state.tilesReady++,this._emitStateChanged()},e.prototype._emitStateChanged=function(){this.state=Object(i.a)({},this.state),this._emit("stateChanged")},e.prototype._updateState=function(){var t={borderTotal:0,borderLoaded:0,borderReady:0,tilesTotal:0,tilesReady:0,tilesLoaded:0};this._currentTiles.forEach(function(e){e.info.border?t.borderTotal++:t.tilesTotal++,e.state!==$.LOADED&&e.state!==$.ANIMATING&&e.state!==$.READY||(e.info.border?t.borderLoaded++:t.tilesLoaded++),e.state===$.READY&&(e.info.border?t.borderReady++:t.tilesReady++)});var e=t.borderTotal!==this.state.borderTotal||t.borderLoaded!==this.state.borderLoaded||t.borderReady!==this.state.borderReady||t.tilesTotal!==this.state.tilesTotal||t.tilesReady!==this.state.tilesReady||t.tilesLoaded!==this.state.tilesLoaded;return e&&(this.state=t),e},e.prototype._computeTilePriority=function(t){return(t.border?Number.MAX_SAFE_INTEGER/2:0)+(e=t,n=this._centralTilePoint,Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));var e,n},e.prototype._computeScreenCordinatesForTile=function(t){var e=this._tileSource.tileSize,n=W.a.worldToPixels(this._visibleCenter,this.zoom),o=u.muln(t,e),i=u.add(u.sub(o,n),u.divn(this._size,2));return u.applyFunction(i,Math.round)},e}(Object(f.a)().with()),ut=n(635),ct=function(t){function e(e,n,o,i,r,a){var s=t.call(this)||this;return s._needsRender=!0,s._awaitAllTilesTrigger=!1,s._fov=m,s._deprecatedLayers=[],s.element=Z("ymaps3x0--layer ymaps3x0--tile-layer"),s._onForegroundTileReady=function(){(s._layer.state.tilesReady===s._layer.state.tilesTotal||s._tileSource.transparent&&s._layer.state.tilesLoaded>0)&&s._cleanUpDeprecatedLayers(),s._emit("stateChanged")},s._shouldAwaitAllTiles=function(){return s._awaitAllTilesTrigger},s._releaseAwaitAllTilesTrigger=function(){s._awaitAllTilesTrigger=!1,s._oldDataSourceLayer&&(s._oldDataSourceLayer.destroy(),s._oldDataSourceLayer=void 0)},s._awaitAllTilesTrigger=o.awaitAllTilesOnFirstDisplay,s._size=e,s._camera=n,s._tileSource=o,s._zoomRoundingRule=i,s._processingQueue=a,s._updatePerspective(),s._roundZoom=s._zoomRoundingRule(s._camera.zoom),s._createLayerForCurrentZoom(r),s._inZoomRange=!0,s._tileSourceSubscription=s._tileSource.group().on("sourceChanged",function(t){return s.handleDataSourceUpdate(t)}).on("tileAnimationStarted",function(){return s._emit("requestRender")}),s}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._layer.state},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._tileSourceSubscription.offAll(),this._layer.destroy(),this._cleanUpDeprecatedLayers()},e.prototype.update=function(t,e){this._needsRender=!0,Object(ut.b)(this._camera,t)||this._releaseAwaitAllTilesTrigger(),this._camera=t,this._fov=e,this._roundZoom=this._zoomRoundingRule(this._camera.zoom),this._roundZoom!==this._layer.zoom&&this._layer.freeze()},e.prototype.handleDataSourceUpdate=function(t){this._awaitAllTilesTrigger=this._tileSource.awaitAllTilesOnFirstDisplay,(t.fetchTile||t.tileSize)&&(t.fetchTile&&this._awaitAllTilesTrigger?this._oldDataSourceLayer||(this._oldDataSourceLayer=this._layer,this._oldDataSourceLayer.freeze()):this._layer.destroy(),this._cleanUpDeprecatedLayers(),this._createLayerForCurrentZoom(!0),this._emit("requestRender"))},e.prototype.render=function(t){if(this._tileSource.isTileAnimationStarted&&this._emit("requestRender"),this._needsRender||this._layer.needsRender||t.qualityHint===l.a.FULL){if(this._checkZoomInZoomRange())this._inZoomRange||(this._layer.unfreeze(),this._layer.setVisibile(!0),this._inZoomRange=!0);else{if(!this._inZoomRange)return;this._layer.freeze(),this._layer.setVisibile(!1),this._cleanUpDeprecatedLayers(),this._inZoomRange=!1}this._updatePerspective(),this._needsRender=!1,t.qualityHint===l.a.FULL&&this._roundZoom!==this._layer.zoom&&(this._layerEventGroup.offAll(),Math.abs(this._layer.zoom-this._roundZoom)>3?this._layer.destroy():this._deprecatedLayers.push(this._layer),this._createLayerForCurrentZoom(!0));for(var e=0,n=this._deprecatedLayers;e<n.length;e++){var o=n[e];this._updateLayer(o),o.reposition(t.qualityHint),o.finishTileAnimations()}this._updateLayer(this._layer),this._roundZoom===this._layer.zoom?this._layer.render(t):this._layer.reposition(t.qualityHint),this._sortLayers()}},e.prototype._updateLayer=function(t){var e=W.a.getScale(t.zoom,this._camera.zoom);t.update(this._camera.worldCenter,this._camera.azimuth,this._camera.tilt,e,this._fov)},e.prototype.resize=function(t){this._needsRender=!0,this._size=t,this._layer.resize(t);for(var e=0,n=this._deprecatedLayers;e<n.length;e++){n[e].resize(t)}this._updatePerspective()},e.prototype.findObjectInPosition=function(){return null},e.prototype._updatePerspective=function(){this.element.style.perspective=Object(B.a)(this._size.y,this._fov)+"px"},e.prototype._checkZoomInZoomRange=function(){return this._roundZoom>=this._tileSource.zoomRange.min&&this._roundZoom<=this._tileSource.zoomRange.max},e.prototype._cleanUpDeprecatedLayers=function(){for(var t=0,e=this._deprecatedLayers;t<e.length;t++){e[t].destroy()}this._deprecatedLayers=[]},e.prototype._createLayerForCurrentZoom=function(t){var e=this,n=Object(r.arrayFind)(this._deprecatedLayers,function(t){return t.zoom===e._roundZoom});if(n)this._deprecatedLayers.splice(this._deprecatedLayers.indexOf(n),1),n.unfreeze();else{var o=Object(Y.b)(this._zoomRoundingRule(this._camera.zoom),this._tileSource.zoomRange.min,this._tileSource.zoomRange.max),i=W.a.getScale(o,this._camera.zoom);n=new st(this.element,this._camera.worldCenter,i,this._camera.azimuth,this._camera.tilt,this._fov,o,this._size,this._tileSource,t,this._processingQueue,this._shouldAwaitAllTiles,this._releaseAwaitAllTilesTrigger)}this._layer=n,this._layerEventGroup=this._layer.on("stateChanged",this._onForegroundTileReady).on("requestRender",function(){return e._emit("requestRender")})},e.prototype._sortLayers=function(){for(var t=Math.round(this._camera.zoom),e=Object(i.c)([this._layer],this._deprecatedLayers),n=e.reduce(function(t,e){var n=e.zoom;return Math.max(n,t)},-1/0),o=0,r=e;o<r.length;o++){var a=r[o];t===a.zoom?a.element.style.zIndex=String(n):t>a.zoom?a.element.style.zIndex=String(a.zoom-t):a.element.style.zIndex=String(n-a.zoom)}},e}(Object(f.a)().with()),lt=n(901),dt=n(902),ht=function(t){function e(e){var n=e.size,o=e.camera,i=e.worldOptions,r=e.projection,a=e.dataSource,s=t.call(this)||this;return s._fov=m,s._fullRenderedZoom=-1/0,s.element=Z("ymaps3x0--layer ymaps3x0--marker-layer"),s._size=n,s._camera=o,s._needsRender=!0,s._dataSource=a,s.projection=r,s.worldOptions=i,s._dataSourceEventGroup=s._dataSource.group().on("markerAdded",function(t){return s._addMarker(t)}).on("markerRemoved",function(t){return s._removeMarker(t)}),s._dataSource.markers.forEach(function(t){return s._addMarker(t)}),s}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return dt.a},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t=this;this._dataSource.markers.forEach(function(e){return t._removeMarker(e)}),this._dataSourceEventGroup.offAll()},Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.update=function(t,e){this._needsRender=!0,this._camera=t,this._fov=e},e.prototype.resize=function(t){this._needsRender=!0,this._size=t},e.prototype.render=function(t){var e=t.qualityHint;this._needsRender&&(e>=l.a.FULL&&(this._fullRenderedZoom=this._camera.zoom),this._needsRender=e<l.a.FULL,this._reposition(e>=l.a.FULL||this._fullRenderedZoom===this._camera.zoom))},e.prototype.findObjectByElement=function(t){var e=Object(r.arrayFind)(this._dataSource.markers,function(e){return e.container.contains(t)});return e?{type:"marker",marker:e}:null},e.prototype.findObjectInPosition=function(t){var e=Object(B.e)(t,Object(i.a)(Object(i.a)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var n=document.elementFromPoint(e.x,e.y);if(!this.element.contains(n))return null;for(var o=0,r=this._dataSource.markers;o<r.length;o++){var a=r[o];if(a.container.contains(n))return{type:"marker",marker:a}}return null},e.prototype._addMarker=function(t){var e=t;e.attachToLayer(this),this.element.appendChild(e.container),this._needsRender=!0},e.prototype._removeMarker=function(t){var e=t;e.detachFromLayer(),this.element.removeChild(e.container),this._needsRender=!0},e.prototype._reposition=function(t){void 0===t&&(t=!1),this.element.style.transformOrigin=this._size.x/2+"px "+this._size.y/2+"px",this._dataSource.markers.forEach(function(e){return e.reposition(t)})},e}(Object(f.a)().with());function pt(t,e,n){void 0===n&&(n={minX:0,maxX:0,minY:0,maxY:0});var o=t.minX>e.minX?t.minX:e.minX,i=t.maxX>e.maxX?e.maxX:t.maxX;if(o>i)return null;var r=t.minY>e.minY?t.minY:e.minY,a=t.maxY>e.maxY?e.maxY:t.maxY;return r>a?null:(n.minX=o,n.maxX=i,n.minY=r,n.maxY=a,n)}function _t(t,e){return e.minX>=t.minX&&e.minY>=t.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}var mt="http://www.w3.org/2000/svg";function ft(t,e){for(var n=Math.floor((t+1)/2),o=Math.floor((e+1)/2),i=[],r=n;r<=o;r++)i.push(r);return i}function yt(t,e){if(t.length<3||e<=0)return Object(i.c)(t);var n=new Uint8Array(t.length);n[0]=1,n[t.length-1]=1,function t(e,n,o,i,r){var a=e[o];var s=e[i];var u=s.x-a.x;var c=s.y-a.y;if(0!==u||0!==c){var l=Math.sqrt(Math.pow(u,2)+Math.pow(c,2));u/=l,c/=l}var d=0;var h=0;var p=-1/0;var _=-1;for(var m=o+1;m<i;m++){d=e[m].x-a.x,h=e[m].y-a.y;var f=0;if(0===u&&0===c)f=Math.pow(d,2)+Math.pow(h,2);else{var y=u*d+c*h;f=Math.pow(u*y-d,2)+Math.pow(c*y-h,2)}f>p&&(p=f,_=m)}p>r&&(n[_]=1,t(e,n,o,_,r),t(e,n,_,i,r))}(t,n,0,t.length-1,Math.pow(e,2));for(var o=[],r=0;r<t.length;r++)n[r]&&o.push(t[r]);return o}function gt(t,e,n){for(var o=[],i={x:0,y:0},r={x:1/0,y:1/0},a={x:e,y:-e},s=0,c=0,l=0,d=t;l<d.length;l++){var h=d[l];s=h.x-r.x,c=h.y-r.y,(o.length<2||s>=n||s<=-n||c>=n||c<=-n)&&(u.mulv(h,a,i),o.push({x:i.x,y:i.y}),r.x=h.x,r.y=h.y)}return o}var vt=function(){function t(t,e,n){var o=this;this._strokeStamp="",this._lineSegments=[],this._simplifiedLineSegments=new r.Map,this._colorLines=new r.Map,this.worldsTranslations=[],this.geometry=Object(i.a)({},t.geometry),this.bbox=n,ft(n.minX,n.maxX).reduce(function(t,e){return t.add(e).add(-e)},new r.Set).forEach(function(t){return o.worldsTranslations.push({x:2*t,y:0})}),this.worldsTranslations.sort(function(t,e){return t.x-e.x}),this.updateStyle(e)}return Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeSize",{get:function(){return this._strokeSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStrokeWidth",{get:function(){return this._maxStrokeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStamp",{get:function(){return this._strokeStamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPalette",{get:function(){return this.style.paletteColorStops.length>0},enumerable:!1,configurable:!0}),t.prototype.updateStyle=function(t){this._style=t,this._strokeSize="LineString"===this.geometry.type||"MultiLineString"===this.geometry.type?this._style.stroke.length:1,this._maxStrokeWidth=-1/0,this._strokeStamp="";for(var e=0;e<this._strokeSize;e++){var n=this.style.stroke[e];n.width>this._maxStrokeWidth&&(this._maxStrokeWidth=n.width),this._strokeStamp+=n.paletteColors.length>0?"c":"p"}"LineString"===this.geometry.type&&t.paletteColorStops.length>0&&(this._lineSegments=function(t,e){for(var n=[],o=0,i=0,r=e;i<r.length;i++){var a=r[i],s=t.slice(o,a+1);n.push({coordinates:s,length:St(s)}),o=a}return n}(this.geometry.coordinates,t.paletteColorStops))},t.prototype.getStrokeStyleForStrokeIndex=function(t){if(this.style.stroke.length-1<t)throw new Error("Can't find stroke style for stroke with index "+t);return this.style.stroke[this.style.stroke.length-1-t]},t.prototype.getSimplifiedLineSegments=function(t,e){var n=this;if(t=Math.round(t),!this._simplifiedLineSegments.has(t)){var o=W.a.getWorldPixelSize(t)/2,r=this._lineSegments.map(function(t){var r=gt(t.coordinates,o,e);return Object(i.a)(Object(i.a)({},t),{coordinates:yt(r,n.style.simplificationRate)})});this._simplifiedLineSegments.set(t,r)}return this._simplifiedLineSegments.get(t)},t.prototype.getColorLine=function(t,e,n){var o=t+"_"+(e=Math.round(e));if(!this._colorLines.has(o)){var i=this.getStrokeStyleForStrokeIndex(t),r=i.paletteColors,a=i.simplifyPalette;this._colorLines.set(o,function(t,e,n,o){for(var i=[],r=t.length-1,a=bt/W.a.getWorldPixelSize(n),s=[],u=0,c="",l=0,d={},h=0;h<t.length;h++){var p=t[h],_=p.coordinates,m=p.length;o?s.push.apply(s,_):s=_,u+=m;var f=e[h];d[f]=void 0===d[f]?m:d[f]+m,d[f]>l&&(l=d[f],c=f);var y=i[i.length-1];o&&h!==r&&(!y||c!==y.color)&&u<a||(y&&c===y.color?y.coordinates=y.coordinates.concat(s):i.push({coordinates:s,color:c}),s=[],u=0,c="",l=0,d={})}return i}(this.getSimplifiedLineSegments(e,n),r,e,a))}return this._colorLines.get(o)},t.prototype.hasStructuralDifferenceWithOtherModel=function(t){return this.geometry.type!==t.geometry.type||this._strokeStamp!==t.strokeStamp||"MultiPolygon"===this.geometry.type&&"MultiPolygon"===t.geometry.type&&this.geometry.coordinates.length!==t.geometry.coordinates.length},t}(),bt=1.5;function St(t){for(var e={x:0,y:0},n=0,o=1;o<t.length;o++)u.sub(t[o-1],t[o],e),n+=u.length(e);return n}var xt=1e-12;function Ot(t,e,n,o){var i=e.y-t.y,r=t.x-e.x,a=i*t.x+r*t.y,s=o.y-n.y,c=n.x-o.x,l=s*n.x+c*n.y,d=i*c-s*r;if(Math.abs(d)<xt)return null;var h=(c*a-r*l)/d,p=(l*i-a*s)/d;return u.create(h,p)}function zt(t,e,n){return void 0===n&&(n=!1),function(t,e,n){for(var o=t,i=[],r=e[e.length-1],a=0,s=e;a<s.length;a++){for(var u=s[a],c=o[n?o.length-1:0],l=0,d=o;l<d.length;l++){var h=d[l],p=Et(r,u,c);if(Et(r,u,h)){if(!p){if(null===(_=Ot(r,u,c,h)))throw new Error("Lines are collinear or parallel");i.push(_)}i.push(h)}else if(p){var _;if(null===(_=Ot(r,u,c,h)))throw new Error("Lines are collinear or parallel");i.push(_)}c=h}o=i,i=[],r=u}return o}(t,e,n)}function Et(t,e,n){return(e.x-t.x)*(n.y-t.y)>(e.y-t.y)*(n.x-t.x)}var wt=n(602);function Tt(t){for(;t.firstChild;)t.removeChild(t.firstChild)}var Rt=[Object(i.a)({},u.ORIGIN)],Ct=function(){function t(t,e,n){this._recreateDomStructureOnNextRender=!1,this._renderedCenter=u.ORIGIN,this._renderedZoom=-1/0,this._renderedBBoxes=[],this._isVisible=!1,this._translation={x:0,y:0};var o="ymaps3x0--feature-"+t+"-"+e;this._model=n,this.element=document.createElementNS(mt,"g"),this.element.setAttribute("stroke-linejoin","round"),this.element.setAttribute("stroke-linecap","round"),this.element.setAttribute("id",o),this.elementCopy=document.createElementNS(mt,"use"),this.elementCopy.setAttribute("href","#"+o),this.elementCopy.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+o),this.elementCopy.setAttribute("data-feature-id",e),this._featureId=e,this._fullWorldVisibleData={worldsTranslations:Rt,bboxes:[n.bbox]},this._createDomStructure()}return Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!1,configurable:!0}),t.prototype.setModel=function(t){this._recreateDomStructureOnNextRender=this._recreateDomStructureOnNextRender||this._model.hasStructuralDifferenceWithOtherModel(t),this._model=t,this._teardownRenderedState(),this._fullWorldVisibleData={worldsTranslations:Rt,bboxes:[t.bbox]}},t.prototype.render=function(t){var e=t.fullWorldVisible?this._fullWorldVisibleData:this._computeWorldsTranslationsAndBBoxes(t.svgBBox,t.viewportWorldsTranslations),n=e.worldsTranslations,o=e.bboxes;0!==n.length?(this._setVisibility(!0),this._needsFullRender(o,t.zoom)?(this._fullRender(t,n,o),this.adjustStrokeWidthAndDash(t.clippingPadding)):this._reposition(t.pixelCenter)):this._setVisibility(!1)},t.prototype.adjustStrokeWidthAndDash=function(t,e){void 0===e&&(e=1),Math.min(this.model.maxStrokeWidth/e,t)===t&&(e=this.model.maxStrokeWidth/t);for(var n=0;n<this.model.strokeSize;n++){var o=this.model.getStrokeStyleForStrokeIndex(n),i=o.dash,r=(o.width/e).toFixed(3),a=(1===e?i:i.map(function(t){return t/e})).join(" ");if("MultiPolygon"===this.model.geometry.type||"Polygon"===this.model.geometry.type)return this.element.setAttribute("stroke-width",r),void this.element.setAttribute("stroke-dasharray",a);var s=this.element.childNodes[n];s&&(s.setAttribute("stroke-width",r),s.setAttribute("stroke-dasharray",a))}},t.prototype._computeWorldsTranslationsAndBBoxes=function(t,e){for(var n=this.model,o=n.bbox,i=n.worldsTranslations,r={},a={worldsTranslations:[],bboxes:[]},s=0,u=e.concat(i);s<u.length;s++){var c=u[s];if(r[c.x]=r[c.x]||{},!r[c.x][c.y]){r[c.x][c.y]=!0;var l=pt(t,{minX:o.minX+c.x,maxX:o.maxX+c.x,minY:o.minY+c.y,maxY:o.maxY+c.y});l&&(a.worldsTranslations.push(c),a.bboxes.push(l))}}return a},t.prototype._needsFullRender=function(t,e){if(this._recreateDomStructureOnNextRender||0===this._renderedBBoxes.length||this._renderedBBoxes.length!==t.length||this._renderedZoom!==e)return!0;for(var n=0;n<this._renderedBBoxes.length;n++)if(!_t(this._renderedBBoxes[n],t[n]))return!0;return!1},t.prototype._reposition=function(t){var e=u.sub(this._renderedCenter,t);this._setTranslation(e.x,e.y)},t.prototype._fullRender=function(t,e,n){var o,i,r=t.fullWorldVisible||1===n.length&&(o=this._model.bbox,i=n[0],o.minX===i.minX&&o.maxX===i.maxX&&o.minY===i.minY&&o.maxY===i.maxY);switch(this._renderedCenter=t.pixelCenter,this._renderedZoom=t.zoom,this._renderedBBoxes=n,this.element.style.cursor=this.model.style.cursor,this.model.style.interactive?this.element.style.pointerEvents="":this.element.style.pointerEvents="none",this._setTranslation(0,0),this._recreateDomStructureOnNextRender&&(this._recreateDomStructureOnNextRender=!1,this._createDomStructure()),this.model.geometry.type){case"LineString":case"MultiLineString":if(this.element.setAttribute("fill","none"),this.model.hasPalette)this._renderLineWithPalette(e,t,r);else{var a="LineString"===this.model.geometry.type?[this.model.geometry.coordinates]:this.model.geometry.coordinates;this._renderLinesWithoutPalette(a,e,t,r)}break;case"Polygon":case"MultiPolygon":this.element.setAttribute("fill",this.model.style.fill),this.element.setAttribute("fill-opacity",String(this.model.style.fillOpacity)),this.element.setAttribute("fill-rule",this.model.style.fillRule);var s=this.model.geometry,u="Polygon"===s.type?[s.coordinates]:s.coordinates;this._renderPolygons(u,e,t,r);break;default:throw new Error("Unexpected geometry type: "+this.model.geometry.type)}},t.prototype._renderLineWithPalette=function(t,e,n){for(var o=null,i=0;i<this.model.strokeSize;i++){var r=this.element.childNodes[i],a=this.model.getStrokeStyleForStrokeIndex(i);a.paletteColors.length>0?this._renderColorLineStroke(r,i,e,n,t):(null===o&&(o=this._computeSplittedLinePath(e,n,t)),Mt(r,o,a))}},t.prototype._renderLinesWithoutPalette=function(t,e,n,o){for(var i=[],r=0,a=t;r<a.length;r++){var s=gt(a[r],n.halfWorldSize,n.pointFilterBox);i.push(jt(s,n,o,e,this.model.style.simplificationRate))}for(var u=i.join(" "),c=0;c<this.model.strokeSize;c++)Mt(this.element.childNodes[c],u,this.model.getStrokeStyleForStrokeIndex(c))},t.prototype._renderPolygons=function(t,e,n,o){for(var i=0;i<t.length;i++){for(var r=[],a=0,s=t[i];a<s.length;a++){var u=gt(s[a],n.halfWorldSize,n.pointFilterBox);r.push(jt(u,n,o,e,this.model.style.simplificationRate,!0))}Mt(this.element.childNodes[i],r.join(" "),this.model.style.stroke[0])}},t.prototype._renderColorLineStroke=function(t,e,n,o,i){var r=this,a=this.model.getColorLine(e,n.zoom,n.pointFilterBox),s=this.model.getStrokeStyleForStrokeIndex(e);Tt(t);var u=document.createDocumentFragment(),c=W.a.getScale(Math.round(n.zoom),n.zoom),l=null;a.forEach(function(t){var e=t.coordinates,a=t.color;if(a!==wt.a){var d=jt(e,n,o,i,0,!1,c),h=At(r._featureId);Mt(h,d,s),h.setAttribute("stroke",a),u.insertBefore(h,l),l=h}}),t.appendChild(u)},t.prototype._computeSplittedLinePath=function(t,e,n){for(var o=[],i=0,r=this.model.getSimplifiedLineSegments(t.zoom,t.pointFilterBox);i<r.length;i++){var a=r[i].coordinates;o.push.apply(o,a)}return jt(o,t,e,n,0,!1,W.a.getScale(Math.round(t.zoom),t.zoom))},t.prototype._createDomStructure=function(){if(Tt(this.element),"MultiPolygon"!==this.model.geometry.type)for(e=0;e<this.model.strokeSize;e++){var t=this.model.getStrokeStyleForStrokeIndex(e).paletteColors.length>0&&"LineString"===this.model.geometry.type?document.createElementNS(mt,"g"):At(this._featureId);this.element.appendChild(t)}else for(var e=0;e<this.model.geometry.coordinates.length;e++){var n=At(this._featureId);this.element.appendChild(n)}},t.prototype._setVisibility=function(t){this._isVisible!==t&&(this.element.style.display=t?"":"none",this._isVisible=t)},t.prototype._setTranslation=function(t,e){this._translation.x===t&&this._translation.y===e||(this.element.setAttribute("transform","translate("+t+" "+e+")"),this._translation={x:t,y:e})},t.prototype._teardownRenderedState=function(){this._renderedZoom=-1/0,this._renderedBBoxes=[],this._renderedCenter=u.ORIGIN},t}();function jt(t,e,n,o,i,r,a){void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=1);for(var s=[],c={x:0,y:0},l=function(o){var l=W.a.worldToRelativePixels(o,e.zoom),d=t;if(!n){var h=u.sub(e.pixelCenter,l),p=e.clippingWindow.map(function(t){var e=u.add(t,h);return 1===a?e:u.divn(e,a,e)});d=zt(t,p,r)}if(d.length>0){var _=0===i?d:yt(d,i),m=u.sub(l,e.pixelCenter),f="M"+_.map(function(t){return 1!==a&&(t=u.muln(t,a,c)),u.add(t,m,c),c.x+","+c.y}).join(" L");r&&(f+=" Z"),s.push(f)}},d=0,h=o;d<h.length;d++){l(h[d])}return s.join(" ")}function At(t){var e=document.createElementNS(mt,"path");return e.setAttribute("data-feature-id",t),e}function Mt(t,e,n){t.setAttribute("d",e);var o=n.opacity,i=n.color;t.setAttribute("stroke-opacity",String(o)),t.setAttribute("stroke",i)}var Pt={width:1,opacity:1,color:"rgb(0,102,255)",palette:[],simplifyPalette:!0,dash:[]},Lt={zIndex:0,opacity:1};function Dt(t){var e=Object(i.a)(Object(i.a)({},Pt),t);return Object(i.a)(Object(i.a)({},e),{dash:Object(i.c)(e.dash),paletteColors:[]})}function It(t,e){var n=e.stroke||[Pt],o="LineString"===t.type?function(t,e){for(var n=t.coordinates.length-1,o=[],i=[],a=new r.Set,s=[],u=0,c=e;u<c.length;u++){var l=c[u],d=l.palette,h=Dt(l);if(i.push(h),d&&0!==d.length){for(var p=new r.Map,_=0,m=0;m<d.length;m++){var f=d[m],y=f.count,g=f.color;p.set(_,g),_+=y;var v=m===d.length-1||_>n;if(v||g!==d[m+1].color){var b=v?n:_;if(a.has(b)||(a.add(b),s.push(b)),v)break}}o.push({stopsColors:p,paletteColors:h.paletteColors})}}s.sort(function(t,e){return t-e});for(var S=0,x=o;S<x.length;S++){var O=x[S],z=(p=O.stopsColors,O.paletteColors);z.push(p.get(0));for(m=0;m<s.length-1;m++){g=p.get(s[m]);z.push("string"==typeof g?g:z[z.length-1])}}return{paletteColorStops:s,stroke:i}}(t,n):{paletteColorStops:[],stroke:n.map(Dt)},i=o.stroke,a=o.paletteColorStops;return{zIndex:kt(e.zIndex,0),fill:e.fill||"rgb(0,102,255)",fillOpacity:kt(e.fillOpacity,.6),fillRule:e.fillRule||"evenodd",stroke:i,paletteColorStops:a,cursor:e.cursor||"inherit",interactive:kt(e.interactive,!0),simplificationRate:kt(e.simplificationRate,2)}}function kt(t,e){return void 0!==t?t:e}function Ft(t){return Object(i.a)(Object(i.a)({},Lt),t)}var Gt="__root__",Wt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._features=new r.Map,e._groups=new r.Map([[Gt,{type:"group",id:Gt,style:Ft({}),children:[],parentGroupId:null}]]),e}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},enumerable:!1,configurable:!0}),e.prototype.addGroup=function(t,e,n){var o={type:"group",id:t,style:Ft(e),children:[],parentGroupId:n};this._addChild(n,o),this._groups.set(t,o),this._emit("groupAdded",t),this._emit("changed")},e.prototype.removeGroupAndChildren=function(t){if(this._groups.has(t)){for(var e=this._groups.get(t),n=[e],o=[];n.length>0;){var i=n.pop();o.push(i);for(var r=0,a=i.children;r<a.length;r++){var s=a[r];"feature"===s.type?(this._features.delete(s.id),o.push(s)):n.push(s)}this._groups.delete(i.id)}e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._emit("groupRemoved",{id:t,removed:o}),this._emit("changed")}},e.prototype.addFeature=function(t,e,n,o){Object(c.a)(t);var i={type:"feature",id:t.id,feature:t,style:It(t.geometry,e),bbox:n,parentGroupId:o};this._addChild(o,i),this._features.set(i.id,i),this._emit("featureAdded",i.id),this._emit("changed")},e.prototype.removeFeatureById=function(t){if(this._features.has(t)){var e=this._features.get(t);e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._features.delete(t),this._emit("featureRemoved",t),this._emit("changed")}},e.prototype.updateFeature=function(t,e,n){var o=this._features.get(t.id).parentGroupId,i={type:"feature",id:t.id,feature:t,style:It(t.geometry,e),bbox:n,parentGroupId:o},r=this._groups.get(o),a=this._features.get(i.id),s=r.children.indexOf(a);r.children[s]=i,this._features.set(i.id,i),this._emit("featureUpdated",i.id),this._emit("changed")},e.prototype.hasFeatureWithId=function(t){return this._features.has(t)},e.prototype.moveFeatureToGroup=function(t,e){var n=this._features.get(t);n.parentGroupId!==e&&(this._removeChild(n.parentGroupId,n),this._addChild(e,n),n.parentGroupId=e,this._emit("featureMovedToGroup"),this._emit("changed"))},e.prototype._addChild=function(t,e){this._groups.get(t).children.push(e)},e.prototype._removeChild=function(t,e){var n=this._groups.get(t),o=n.children.indexOf(e);n.children.splice(o,1)},e}(Object(f.a)().with()),Zt={x:50,y:50},Nt=0,Bt=function(t){function e(e,n,o,i){var a=t.call(this)||this;a._svg=document.createElementNS(mt,"svg"),a._zeroWorld=document.createElementNS(mt,"g"),a._groups=new r.Map,a._features=new r.Map,a._nodesToRemove=new r.Set,a._renderedWorldCopies=new r.Set,a._multiWorldsSource=document.createDocumentFragment(),a._layerId=String(Nt++),a._shouldRender=!0,a._fullWorldRendered=!1,a._lastTimeStrokeAdjusted=0,a._willChangeFlag=!1,a._fov=m,a.element=Z("ymaps3x0--layer ymaps3x0--graphics-layer"),a._setSizeValues(e),a._camera=n,a._worldOptions=o,a._dataSource=i,a._renderedZoom=n.zoom,a._zoomOfAdjustedStoke=n.zoom,a._renderedCenter=n.worldCenter;var s=document.createElementNS(mt,"g");return a._multiWorldsSource.appendChild(s),a._groups.set(Gt,{id:Gt,element:a._zeroWorld,elementCopy:s}),a._svg.appendChild(a._zeroWorld),a._svg.setAttributeNS("xmlns","xlink","http://www.w3.org/1999/xlink"),a._svg.ondragstart=function(){return!1},a.element.appendChild(a._svg),a._dataSourcesSubscriptions=i.group().on("groupAdded",function(t){return a._addGroup(t)}).on("groupRemoved",function(t){return a._removeGroup(t)}).on("featureAdded",function(t){return a._addFeatureById(t)}).on("featureRemoved",function(t){return a._removeFeatureById(t)}).on("featureUpdated",function(t){return a._updateFeatureById(t)}).on("featureMovedToGroup",function(){return a._shouldRender=!0}),a._dataSource.groups.forEach(function(t){var e=t.id;e!==Gt&&a._addGroup(e)}),a._dataSource.features.forEach(function(t){var e=t.id;return a._addFeatureById(e)}),a._updatePerspective(),a}return Object(i.b)(e,t),e.prototype.destroy=function(){this._features.clear(),this._dataSourcesSubscriptions.offAll(),this._shouldRender=!0},Object.defineProperty(e.prototype,"state",{get:function(){return dt.a},enumerable:!1,configurable:!0}),e.prototype.resize=function(t){this._setSizeValues(t),this._shouldRender=!0,this._updatePerspective()},e.prototype.update=function(t,e){this._camera=t,this._fov=e},e.prototype.render=function(t){var e=t.qualityHint;if(this._cleanupNodesToRemove(),this._updatePerspective(),0!==this._features.size){this.element.style.setProperty("display",null);var n=this._getVisibleWorlds(),o=W.a.getScale(this._renderedZoom,this._camera.zoom);e===l.a.QUICK?(this._setWillChange(!0),this._positionZeroWorld(o)):this._needsFullRender(e)?(this._fullRender(n),this._renderWorldCopies(this._camera.zoom,!0)):(this._adjustStrokeWidthAndDash(o),this._positionZeroWorld(o),this._renderWorldCopies(this._renderedZoom))}else this.element.style.display="none"},e.prototype.findObjectInPosition=function(t){var e=Object(B.e)(t,Object(i.a)(Object(i.a)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var n=document.elementFromPoint(e.x,e.y);if(!n)return null;var o=n.getAttribute("data-feature-id");return null!==o&&this._dataSource.hasFeatureWithId(o)&&this.element.contains(n)?{type:"feature",featureId:o}:null},e.prototype._addGroup=function(t){var e=document.createElementNS(mt,"g");this._groups.set(t,{id:t,element:e,elementCopy:e.cloneNode()}),this._shouldRender=!0},e.prototype._removeGroup=function(t){var e=t.id,n=t.removed;this._nodesToRemove.add(this._groups.get(e));for(var o=0,i=n;o<i.length;o++){var r=i[o];"feature"===r.type?this._removeFeatureById(r.id):this._groups.delete(r.id)}this._shouldRender=!0},e.prototype._addFeatureById=function(t){var e=this._dataSource.features.get(t),n=e.feature,o=e.style,i=e.bbox,r=new vt(n,o,i),a=new Ct(this._layerId,n.id,r),s={id:n.id,element:a.element,elementCopy:a.elementCopy,renderer:a};this._features.set(n.id,s),this._shouldRender=!0},e.prototype._removeFeatureById=function(t){this._nodesToRemove.add(this._features.get(t)),this._features.delete(t),this._shouldRender=!0},e.prototype._updateFeatureById=function(t){var e=this._features.get(t),n=this._dataSource.features.get(t),o=n.feature,i=n.style,r=n.bbox;e.renderer.setModel(new vt(o,i,r)),this._shouldRender=!0},e.prototype._needsFullRender=function(t){if(t===l.a.QUICK)return!1;var e=W.a.convertPixelSizeToWorldSize(this._svgSize,this._renderedZoom),n={minX:this._renderedCenter.x-Math.abs(e.x)/2,maxX:this._renderedCenter.x+Math.abs(e.x)/2,minY:this._renderedCenter.y-Math.abs(e.y)/2,maxY:this._renderedCenter.y+Math.abs(e.y)/2},o=this._computeHalfViewportSize(),i=!_t(n,{minX:this._camera.worldCenter.x-o.x,maxX:this._camera.worldCenter.x+o.x,minY:this._camera.worldCenter.y-o.y,maxY:this._camera.worldCenter.y+o.y}),r=Math.abs(this._renderedZoom-this._camera.zoom);return i||r>=2||t===l.a.FULL&&(this._shouldRender||this._camera.zoom!==this._renderedZoom)},e.prototype._fullRender=function(t){var e=this,n=this._getRenderVariables(t);this._setWillChange(!1),this._shouldRender=!1,this._renderedZoom=this._camera.zoom,this._renderedCenter=this._camera.worldCenter,this._fullWorldRendered=n.fullWorldVisible,this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=performance.now(),this._positionZeroWorld(),this._svg.setAttribute("width",String(this._svgSize.x)),this._svg.setAttribute("height",String(this._svgSize.y)),this._svg.setAttribute("viewBox","0 0 "+this._svgSize.x+" "+this._svgSize.y),this._zeroWorld.setAttribute("transform","translate("+this._halfSvgSize.x+", "+this._halfSvgSize.y+")"),this._dataSource.groups.forEach(function(t){var o=e._groups.get(t.id),i=o.element,r=o.elementCopy;i.setAttribute("opacity",String(t.style.opacity)),r.setAttribute("opacity",String(t.style.opacity)),e._renderChildren(t.children,i,r,n)})},e.prototype._updatePerspective=function(){var t=Object(B.a)(this._size.y,this._fov);this._perspective!==t&&(this._perspective=t,this.element.style.perspective=t+"px")},e.prototype._renderChildren=function(t,e,n,o){for(var i,r,a=null,s=null,u=0,c=(r=function(t,e){return e.style.zIndex-t.style.zIndex},(i=t).map(function(t,e){return e}).sort(function(t,e){var n=i[t],o=i[e],a=r(n,o);return 0!==a?a:t-e}).map(function(t){return i[t]}));u<c.length;u++){var l=c[u],d=void 0,h=void 0;switch(l.type){case"group":var p=this._groups.get(l.id);d=p.element,h=p.elementCopy;break;case"feature":var _=this._features.get(l.id);_.renderer.render(o),d=_.element,h=_.elementCopy}e.insertBefore(d,a),n.insertBefore(h,s),a=d,s=h}},e.prototype._adjustStrokeWidthAndDash=function(t){var e=performance.now(),n=e-this._lastTimeStrokeAdjusted;Math.abs(this._zoomOfAdjustedStoke-this._camera.zoom)>=.5&&n>250?(this._setWillChange(!1),this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=e,this._features.forEach(function(e){e.renderer.adjustStrokeWidthAndDash(50,t)})):this._setWillChange(!0)},e.prototype._cleanupNodesToRemove=function(){0!==this._nodesToRemove.size&&(this._nodesToRemove.forEach(function(t){Yt(t.element),Yt(t.elementCopy)}),this._nodesToRemove.clear())},e.prototype._getSvgPixelBBox=function(){var t=W.a.worldToPixels(this._camera.worldCenter,this._camera.zoom);return{minX:t.x-this._halfSvgSize.x,maxX:t.x+this._halfSvgSize.x,minY:t.y-this._halfSvgSize.y,maxY:t.y+this._halfSvgSize.y}},e.prototype._getClippingWindow=function(t){var e=function(t,e,n){return void 0===n&&(n={minX:0,maxX:0,minY:0,maxY:0}),n.minX=t.minX-e.x,n.maxX=t.maxX+e.x,n.minY=t.minY-e.y,n.maxY=t.maxY+e.y,n}(t,Zt),n=e.minX,o=e.maxX,i=e.minY,r=e.maxY,a=W.a.worldToPixels(this._camera.worldCenter,this._camera.zoom),s=u.sub({x:n,y:i},a);return[u.sub({x:n,y:r},a),s,u.sub({x:o,y:i},a),u.sub({x:o,y:r},a)]},e.prototype._positionZeroWorld=function(t){void 0===t&&(t=1);var e=this._worldOptions.cycledX?W.a.moveCloseToCenter(this._renderedCenter,this._camera.worldCenter):this._renderedCenter,n=this._camera,o=n.zoom,i=n.azimuth,r=n.tilt,a=W.a.worldToRelativePixels(e,o),s=W.a.worldToRelativePixels(this._camera.worldCenter,o),c=u.sub(a,s),l=u.sub(this._halfSize,this._halfSvgSize),d="translate3d("+c.x+"px, "+c.y+"px, 0px)",h=[""+("translate3d("+l.x+"px, "+l.y+"px, 0px)"),"rotateX("+r+"rad)","rotateZ("+i+"rad)",""+d,"scale("+t+")"];this._svg.style.setProperty("transform",h.join(" "))},e.prototype._clearWorldCopies=function(){for(var t=this._svg.querySelectorAll("g[data-world-copy]"),e=0;e<t.length;e++)this._svg.removeChild(t[e]);this._renderedWorldCopies.clear()},e.prototype._renderWorldCopies=function(t,e){void 0===e&&(e=!1),this._worldOptions.cycledX&&(e&&this._clearWorldCopies(),this._fullWorldRendered&&this._makeMissingWorldCopies(t))},e.prototype._makeMissingWorldCopies=function(t){for(var e=W.a.getWorldPixelSize(t),n=0,o=Object(i.c)([-1,1],this._getVisibleWorlds());n<o.length;n++){var r=o[n];if(0!==r&&!this._renderedWorldCopies.has(r)){var a=document.createElementNS(mt,"g");a.setAttribute("data-world-copy",String(r));var s=this._halfSvgSize.x+e*r;a.setAttribute("transform","translate("+s+", "+this._halfSvgSize.y+")"),a.appendChild(this._multiWorldsSource.cloneNode(!0)),this._svg.appendChild(a),this._renderedWorldCopies.add(r)}}},e.prototype._getVisibleWorlds=function(){var t=this._computeHalfViewportSize().x+2/180*10,e=this._camera.worldCenter;return ft(e.x-t,e.x+t)},e.prototype._getRenderVariables=function(t){var e,n,o,i,r,a,s,u,c=W.a.getWorldPixelSize(this._camera.zoom),l=this._getSvgPixelBBox(),d=(e=l,n=this._camera.zoom,o=e.minX,i=e.maxX,r=e.minY,a=e.maxY,s=W.a.pixelsToWorld({x:o,y:a},n),u=W.a.pixelsToWorld({x:i,y:r},n),{minX:s.x,maxX:u.x,minY:s.y,maxY:u.y}),h=d.minX<=-1&&d.maxX>=1;return{pixelCenter:W.a.worldToRelativePixels(this._camera.worldCenter,this._camera.zoom),zoom:this._camera.zoom,worldSize:c,halfWorldSize:c/2,clippingWindow:this._getClippingWindow(l),clippingPadding:50,pointFilterBox:1/c,fullWorldVisible:h,viewportWorldsTranslations:t.map(function(t){return{x:2*t,y:0}}),svgBBox:d}},e.prototype._setWillChange=function(t){this._willChangeFlag!==t&&(this._willChangeFlag=t,this._svg.style.setProperty("will-change",t?"transform":""))},e.prototype._computeHalfViewportSize=function(){var t=W.a.convertPixelSizeToWorldSize(this._size,this._camera.zoom);return u.applyFunction(t,Math.abs,t),u.divn(t,2,t),t},e.prototype._setSizeValues=function(t){this._size=t,this._halfSize=u.divn(t,2),this._svgSize=u.muln(t,2),this._halfSvgSize=u.divn(this._svgSize,2)},e}(Object(f.a)().with());function Yt(t){t.parentNode&&t.parentNode.removeChild(t)}var Ht=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._markers=[],e.markers=e._markers,e}return Object(i.b)(e,t),e.prototype.addMarker=function(t){this._markers.push(t),this._emit("markerAdded",t),this._emit("changed")},e.prototype.removeMarker=function(t){var e=Object(r.arrayFindIndex)(this._markers,function(e){return e===t});-1!==e&&(this._markers.splice(e,1),this._emit("markerRemoved",t),this._emit("changed"))},e}(Object(f.a)().with()),Vt=n(636),Xt=20,qt=new r.WeakMap,Ut=function(t){function e(e,n,o,a,s,u,c,l){var d=t.call(this)||this;return d._layerImplementationsById=new r.Map,d._dataSourceSubscriptions=[],d._dataSources={},d._processingQueue=new et.a(Xt),d.element=Z(),d._createLayerImplementation=function(t){if("customDomLayer"===t.type){if(!t.options.raster.implementation)throw new Error("Implementation not provided");var e=new(0,t.options.raster.implementation)({camera:d._camera,size:d._size,projection:d._projection,layerDescription:t});if(!(e instanceof Vt.a))throw new Error("Implementation must be derived from CustomDomLayer");var n=e.group().on("requestRender",d._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:e,eventGroup:n})}var o=d._dataSources[t.source];return o instanceof Wt?d._createGraphicsLayerImplementation(t,o):o instanceof Ht?d._createMarkersLayerImplementation(t,o):d._createTileLayerImplementation(t,o)},d._destroyLayerImplementation=function(t){d._removeLayerElementFromDom(t.layer),t.layer.destroy(),t.eventGroup.offAll(),d._resetTileHotspotsLayer(t,null),t.tileSourceEventGroup&&t.tileSourceEventGroup.offAll()},d._requestRenderLoopUpdate=function(){return d.renderLoop.update()},d._emitHotspotsChanged=function(){return d._emit("hotspotsChanged")},d._onLayerStateChange=function(){var t=!0,e=!1,n=!0,o=!1;d._layerImplementationsById.forEach(function(i){var r=i.layer,a=qt.get(r),s=a.loaded;a.loaded=r.state.tilesLoaded===r.state.tilesTotal,t=t&&a.loaded,!s&&a.loaded&&(e=!0);var u=a.ready;a.ready=r.state.tilesReady===r.state.tilesTotal,n=n&&a.ready,!u&&a.ready&&(o=!0)}),d._emit("stateChanged"),t&&e&&d._emit("tilesLoaded"),n&&o&&d._emit("tilesReady")},d._size=e,d._camera=n,d._worldOptions=a,d._projection=s,d.renderLoop=o,d._zoomRoundingRule=c,d.animateFirstScreen=l,d._layers=[],d._renderLoopSubscriptions=d.renderLoop.on("render",d._render.bind(d)),d.setDataSources(u),d}return Object(i.b)(e,t),e.prototype.setDataSources=function(t){this._destroyDataSourceSubscriptions(),this._dataSources=Object(i.a)({},t);for(var e=0,n=Object.keys(this._dataSources);e<n.length;e++){var o=n[e];this._dataSourceSubscriptions.push(this._dataSources[o].on("changed",this._requestRenderLoopUpdate))}},e.prototype.setLayers=function(t){var e=[];this._layerImplementationsById.forEach(function(t,n){return e.push(n)});for(var n=new r.Map,o=0,i=t;o<i.length;o++){var a=i[o],s=this._dataSources[a.source];(s instanceof tt.a&&s.rasterSourceDescription&&"ground"===a.type||s instanceof Wt||s instanceof Ht||"customDomLayer"===a.type)&&n.set(a.id,a)}var u=Object(nt.a)(this._layerImplementationsById,n,this._createLayerImplementation,this._destroyLayerImplementation,function(){},function(t,e){return t.source===e.source&&t.type===e.type});this._layerImplementationsById=u.result,this._flattenLayers(),this._layerImplementationsById.forEach(function(t){var e=t.layer;qt.has(e)||qt.set(e,{ready:e.state.tilesReady===e.state.tilesTotal,loaded:e.state.tilesLoaded===e.state.tilesTotal})}),this._addLayerElementsToDom(),0===u.created.length&&0===u.removed.length&&function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,t.map(function(t){return t.id}))||(this._emit("stateChanged"),this.renderLoop.update())},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.getLayerReadyState=function(t){var e=this._layerImplementationsById.get(t);return e?e.layer.state:void 0},e.prototype.destroy=function(){this.setLayers([]),this._destroyDataSourceSubscriptions(),this._renderLoopSubscriptions.offAll(),this._removeLayerElementsFromDom()},e.prototype.update=function(t,e){this._camera=t,this._layers.forEach(function(n){return n.layer.update(t,e)})},e.prototype.resize=function(t){this._size=t,this._layers.forEach(function(e){return e.layer.resize(t)})},e.prototype.findObjectInPosition=function(t){for(var e=this._layers.length-1;e>=0;e--){var n=this._layers[e],o=n.layer,r=n.implementation,a=r.id,s=r.source,u=o.findObjectInPosition(t);if(u)return Object(i.a)({layer:a,source:s},u)}return null},e.prototype.findObjectInPositionEx=function(t){for(var e={layers:[]},n=this._layers.length-1;n>=0;n--){var o=this._layers[n],r=o.layer,a=o.implementation,s=a.id,u=a.source,c=r.findObjectInPosition(t);if(e.layers.push({layer:s,object:c&&Object(i.a)({layer:s,source:u},c)}),c)break}return e},e.prototype.findMarkerByElement=function(t){for(var e=this._layers.length-1;e>=0;e--){var n=this._layers[e],o=n.layer,r=n.implementation,a=r.id,s=r.source;if(o instanceof ht){var u=o.findObjectByElement(t);if(u)return Object(i.a)(Object(i.a)({},u),{layer:a,source:s})}}return null},e.prototype._flattenLayers=function(){var t=this;this._layers=[],this._layerImplementationsById.forEach(function(e){t._layers.push({layer:e.layer,implementation:e}),e.hotspots&&t._layers.push({layer:e.hotspots.layer,implementation:e})})},e.prototype._createGraphicsLayerImplementation=function(t,e){var n=new Bt(this._size,this._camera,this._worldOptions,e),o=n.group().on("requestRender",this._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:n,eventGroup:o})},e.prototype._createMarkersLayerImplementation=function(t,e){var n=new ht({size:this._size,camera:this._camera,worldOptions:this._worldOptions,projection:this._projection,dataSource:e}),o=n.group().on("requestRender",this._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:n,eventGroup:o})},e.prototype.preloadHotspotsInPoint=function(t){this._layerImplementationsById.forEach(function(e){var n=e.hotspots;n&&n.layer.preloadHotspotsInPoint(t)})},e.prototype.preloadHotspotsForViewport=function(){this._layerImplementationsById.forEach(function(t){var e=t.hotspots;e&&e.layer.preloadHotspotsForViewport()})},e.prototype.setObjectFilters=function(t){},e.prototype.setInvisibleCollidingPrimitives=function(t){},e.prototype.setObjectHighlight=function(t){},e.prototype._createTileLayerImplementation=function(t,e){var n=this,o=new ct(this._size,this._camera,e,this._zoomRoundingRule,this.animateFirstScreen,this._processingQueue),r=o.group().on("stateChanged",this._onLayerStateChange).on("requestRender",this._requestRenderLoopUpdate),a=e.group(),s=Object(i.a)(Object(i.a)({},t),{layer:o,eventGroup:r,tileSourceEventGroup:a});return a.on("sourceChanged",function(){n._resetTileHotspotsLayer(s,e.getHotspotTileDataSource())}),this._resetTileHotspotsLayer(s,e.getHotspotTileDataSource()),s},e.prototype._resetTileHotspotsLayer=function(t,e){if(!(!e&&!t.hotspots||e&&t.hotspots&&Object(tt.b)(t.hotspots.source,e))){if(t.hotspots&&(t.hotspots.eventGroup.offAll(),t.hotspots.layer.destroy(),t.hotspots=void 0),e){var n=new lt.a(this._size,this._camera,e,this._processingQueue,this._worldOptions,this._zoomRoundingRule),o=n.on("hotspotsChanged",this._emitHotspotsChanged).on("requestRender",this._requestRenderLoopUpdate);t.hotspots={layer:n,eventGroup:o,source:e}}this._flattenLayers()}},e.prototype._render=function(t){this._processingQueue.pause(),this._layers.forEach(function(e){return e.layer.render(t)}),this._processingQueue.resume()},e.prototype._removeLayerElementFromDom=function(t){t.element&&t.element.parentElement&&t.element.parentElement.removeChild(t.element)},e.prototype._removeLayerElementsFromDom=function(){for(var t=0,e=this._layers;t<e.length;t++){var n=e[t].layer;this._removeLayerElementFromDom(n)}},e.prototype._addLayerElementsToDom=function(){for(var t=new r.Map,e=0,n=this._layers;e<n.length;e++){var o=n[e].layer;if(o.element){var i=this.element,a=t.get(i)||0,s=i.childNodes[a];o.element!==s&&i.insertBefore(o.element,s||null),t.set(i,a+1)}}},e.prototype._destroyDataSourceSubscriptions=function(){for(var t=0,e=this._dataSourceSubscriptions;t<e.length;t++){e[t].offAll()}this._dataSourceSubscriptions=[]},Object.defineProperty(e.prototype,"fov",{get:function(){return m},enumerable:!1,configurable:!0}),e}(Object(f.a)().with());var Qt,Kt=n(672),Jt=Object(Kt.a)("ease"),$t=1e-10;function te(t,e,n,o,i){void 0===i&&(i=Jt);var r=o?W.a.worldToRelativePixels(u.sub(o,t.worldCenter),t.zoom):null,a=oe(i,e-t.zoom,r);return t.animateForDuration(n,a)}function ee(t,e,n,o){return void 0===o&&(o=Jt),u.areFuzzyEqual(e,u.ORIGIN,1e-10)?{complete:Promise.resolve(),isRunning:!1,stop:function(){}}:t.animateForDuration(n,function(t,n,r){var a=o(n)-o(n-r),s=u.muln(e,a),c=u.add(t.worldCenter,s);return Object(i.a)(Object(i.a)({},t),{worldCenter:c})})}function ne(t,e,n,o,r){return void 0===r&&(r=Jt),Math.abs(n-t.zoom)<$t?ee(t,u.sub(e,t.worldCenter),o,r):function(t,e,n,o,r){void 0===r&&(r=Jt);var a=t.worldCenter,s={x:0,y:0},u={x:!1,y:!1},c=oe(r,n-t.zoom,s);return t.animateForDuration(o,function(o,r,l){if(1===r)return Object(i.a)(Object(i.a)({},o),{worldCenter:e,zoom:n});var d=W.a.convertPixelSizeToWorldSize(t.size,o.zoom),h=!t.worldOptions.cycledX&&d.x>2,p=!t.worldOptions.cycledY&&Math.abs(d.y)>2;if(!u.x&&!h){var _=ie(e,n,a,o.zoom).x;s.x=_,u.x=!0}if(!u.y&&!p){var m=ie(e,n,a,o.zoom).y;s.y=m,u.y=!0}return c(o,r,l)})}(t,e,n,o,r)}function oe(t,e,n){return function(o,r,a){var s=t(r)-t(r-a),c=o.zoom+e*s;if(!n)return Object(i.a)(Object(i.a)({},o),{zoom:c});var l=u.sub(W.a.convertPixelSizeToWorldSize(n,o.zoom),W.a.convertPixelSizeToWorldSize(n,c)),d=u.add(o.worldCenter,l);return Object(i.a)(Object(i.a)({},o),{worldCenter:d,zoom:c})}}function ie(t,e,n,o){var i=e-o,a=u.sub(t,n),s=u.muln(a,Object(r.mathSign)(i)/(Math.pow(2,Math.abs(i))-1)),c=i>0?t:n,l=u.add(c,s);return W.a.worldToRelativePixels(u.sub(l,n),o)}!function(t){t[t.ZOOM_TO_CENTER=0]="ZOOM_TO_CENTER",t[t.ZOOM_TO_POINTER=1]="ZOOM_TO_POINTER"}(Qt||(Qt={}));var re=50,ae=function(t){function e(e,n,o,a){var c=t.call(this)||this;return c._deltaAccumulator=0,c._zoomPointCenterOffset=u.ORIGIN,c._onWheel=function(t){var e=Date.now();c._deltaAccumulator=t;var n=c.zoomDuration;if(c._updateWheelTrend(t)&&!(c._state&&e-c._state.startTs<n)){c._zoomPointCenterOffset=u.sub(c._zoomPointSource(),u.divn(c._map.size,2));var o=Object(r.mathSign)(c._deltaAccumulator);c._deltaAccumulator=0;var i=c._computeNewState(c._state,e,o);if(i){var a=!c._state;c._state=i,a&&c._emit("zoomStart")}c._state&&!c.isInAction&&(c._animation=c._map.animate(c._animationStep),Object(s.promiseFinally)(c._animation.complete,function(){return c._emit("zoomEnd")}))}},c._animationStep=function(t){var e=se(c._state,Date.now()),n=e.zoom;if(e.dt>=c._state.duration+re&&(c._animation.stop(),c._animation=void 0,c._state=void 0,c._currentWheelTrend=void 0),n===t.zoom)return t;var o=function(t,e,n){var o=e.zoom,i=e.azimuth,r=W.a.getScale(o,n),a=u.muln(t,r-1);return u.rotate(W.a.convertPixelSizeToWorldSize(a,n,a),i)}(c._zoomPointCenterOffset,t,n),r=u.add(t.worldCenter,o);return Object(i.a)(Object(i.a)({},t),{worldCenter:r,zoom:n})},c._map=e,c._device=n,c._zoomPointSource=o,c.zoomDuration=a,c._init(),c}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e.prototype._computeNewState=function(t,e,n){var o=t?se(t,e).zoom:this._map.zoom,i=o+n;if(t&&(i=Object(Y.b)(i,t.startZoom-4,t.startZoom+4)),i=Object(Y.b)(i,this._map.zoomRange.min,this._map.zoomRange.max),i=Math.round(i),(i=Number(i.toFixed(2)))!==o)return{startZoom:o,targetZoom:i,startTs:e,duration:this.zoomDuration}},e.prototype._updateWheelTrend=function(t){var e=this._currentWheelTrend,n=Object(r.mathSign)(t);return!(Math.abs(n)<1e-10)&&(this._currentWheelTrend=n,!e||n===e)},e}(Object(f.a)().with());function se(t,e){var n=e-t.startTs,o=Object(Y.b)(n/t.duration,0,1);return{zoom:t.startZoom+(t.targetZoom-t.startZoom)*o,dt:n}}var ue=400,ce=.03,le=.25,de=ce/le,he=ce,pe=function(t){function e(e,n,o){var a=t.call(this)||this;return a._wheelAccumulator=0,a._zoomPointCenterOffset=u.ORIGIN,a._deltaZoom=0,a._prevFrameTimestamp=0,a._onWheel=function(t){a._wheelAccumulator+=t,a._zoomPointCenterOffset=u.sub(a._zoomPointSource(),u.divn(a._map.size,2)),a._animation||(a._prevFrameTimestamp=Date.now(),a._animation=a._map.animate(a._animationStep),Object(s.promiseFinally)(a._animation.complete,function(){clearTimeout(a._zoomEndTimer),a._zoomEndTimer=setTimeout(function(){a._emit("zoomEnd"),a._zoomEndTimer=void 0})}),clearTimeout(a._zoomEndTimer),a._zoomEndTimer=void 0,a._emit("zoomStart"))},a._animationStep=function(t){var e,n,o,s,c;a._wheelAccumulator&&(Object(r.mathSign)(a._wheelAccumulator)!==Object(r.mathSign)(a._deltaZoom)&&(a._deltaZoom=0),a._deltaZoom+=(e=a._wheelAccumulator,n=a._deltaZoom,o=Object(r.mathSign)(e),s=Math.min(1,1/Math.abs(5.5*Math.abs(n)-1)),c=Object(Y.b)(Math.abs(e)*s/600,.005,2),o*c),a._wheelAccumulator=0);var l,d=Date.now();if(d-a._prevFrameTimestamp>ue||Math.abs(a._deltaZoom)<=he){var h=t.zoom,p=Object(Y.b)(h+a._deltaZoom,a._map.zoomRange.min,a._map.zoomRange.max);a._deltaZoom=0,a._animation.stop(),a._animation=void 0;var _=_e(a._zoomPointCenterOffset,t,p),m=u.add(t.worldCenter,_);return Object(i.a)(Object(i.a)({},t),{worldCenter:m,zoom:p})}l=Math.abs(a._deltaZoom)>de?le*a._deltaZoom:Object(r.mathSign)(a._deltaZoom)*ce,a._deltaZoom-=l;var f=Object(Y.b)(t.zoom+l,a._map.zoomRange.min,a._map.zoomRange.max),y=_e(a._zoomPointCenterOffset,t,f),g=u.add(t.worldCenter,y);return a._prevFrameTimestamp=d,Object(i.a)(Object(i.a)({},t),{worldCenter:g,zoom:f})},a._map=e,a._device=n,a._zoomPointSource=o,a._init(),a}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e}(Object(f.a)().with());function _e(t,e,n){var o=e.zoom,i=e.azimuth,r=W.a.getScale(o,n),a=u.muln(t,r-1);return u.rotate(W.a.convertPixelSizeToWorldSize(a,n,a),i)}var me=Math.cos(Math.PI/6),fe=Object(Kt.a)("ease-out"),ye=function(){function t(){this._history=[]}return t.prototype.push=function(t){this._history.push({position:t,ts:Date.now()}),this._history.length>=30&&this._history.shift()},t.prototype.computeMovement=function(){var t=Date.now(),e=this._history.filter(function(e){return e.ts>=t-500});if(e.length<2||t-e[e.length-1].ts>=100)return null;var n=u.sub(e[e.length-2].position,e[e.length-1].position);if(u.areFuzzyEqual(n,u.ORIGIN,2))return null;u.normalize(n,n);for(var o=0,i=e.length-1;i>=1;i--){var a=u.sub(e[i-1].position,e[i].position),s=u.length(a);if(u.dot(a,n)/s<=me)break;var c=(t-e[i].ts)/500;o+=s/Object(r.mathLog2)(2+c)}return u.muln(n,Math.min(o,500))},t}(),ge=function(t){function e(e,n){var o=t.call(this)||this;return o._map=e,o._dragger=n,o._dragSubscription=o._initDrag(),o}return Object(i.b)(e,t),e.prototype.destroy=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions()},e.prototype.enable=function(){this._dragSubscription||(this._dragSubscription=this._initDrag())},e.prototype.disable=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions(),this._dragger.isDragging&&this._emit("dragEnd")},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._dragAnimation&&this._dragAnimation.isRunning},enumerable:!1,configurable:!0}),e.prototype._stopAllSubscriptions=function(){this._dragEndSubscription&&(this._dragEndSubscription.offAll(),this._dragEndSubscription=void 0),this._dragSubscription&&(this._dragSubscription.offAll(),this._dragSubscription=void 0)},e.prototype._initDrag=function(){var t=this,e=this._dragger.group();return e.on("dragStart",function(){t._emit("dragStart"),t._stopAnimationIfAny();var n=Object(B.c)(t._dragger.dragStartingPoint,t._map),o=new ye;o.push(t._dragger.pointerPosition),e.on("dragMove",function(){return o.push(t._dragger.pointerPosition)}),t._dragAnimation=t._map.animate(function(e){return Object(i.a)(Object(i.a)({},e),{worldCenter:t._computeWorldCenter(n)})}),t._dragEndSubscription=t._dragger.on("dragEnd",function(){t._dragEndSubscription.offAll();var e={worldCenter:t._computeWorldCenter(n),zoom:t._map.zoom,azimuth:t._map.azimuth,tilt:t._map.tilt};t._map.setCamera(e),t._stopAnimationIfAny();var i=o.computeMovement();if(i){var r=W.a.convertPixelSizeToWorldSize(i,t._map.zoom),a=u.rotate(r,e.azimuth),c=u.add(t._map.worldCenter,a);t._emit("inertiaStart",{targetPositionWcs:c}),t._dragAnimation=ee(t._map,a,400,fe),Object(s.promiseFinally)(t._dragAnimation.complete,function(){return t._emit("dragEnd")})}else t._emit("dragEnd")})}),e},e.prototype._stopAnimationIfAny=function(){this._dragAnimation&&this._dragAnimation.isRunning&&this._dragAnimation.stop()},e.prototype._computeWorldCenter=function(t){var e=Object(B.c)(this._dragger.pointerPosition,this._map),n=u.sub(e,t);return u.sub(this._map.worldCenter,n)},e}(Object(f.a)().with()),ve=function(t){function e(e,n,o){var i=t.call(this)||this;return i._isEnabled=!1,i._onDblClick=function(){i._zoomOn(1)},i._onRightDblClick=function(){i._zoomOn(-1)},i._map=e,i._zoomDuration=n,i._zoomPointSrc=o,i._init(),i}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._map.events.on("dblclick","any",this._onDblClick),this._map.events.on("rightdblclick","any",this._onRightDblClick),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(this._map.events.off("dblclick","any",this._onDblClick),this._map.events.off("rightdblclick","any",this._onRightDblClick)),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1},e.prototype._zoomOn=function(t){var e=this;this._emit("zoomStart");var n=Object(B.b)(this._zoomPointSrc(),this._map);this._animation=te(this._map,this._map.zoom+t,this._zoomDuration,n),Object(s.promiseFinally)(this._animation.complete,function(){return e._emit("zoomEnd")})},e}(Object(f.a)().with()),be=function(t){function e(e,n,o){var a=t.call(this)||this;return a.rotationAllowed=!1,a.tiltAllowed=!1,a._onTiltStart=function(){if(!a.tiltAllowed)return a._onPinchRotateStart();a._stopAnimationIfAny(),a._emit("tiltStart");var t=a._map.tilt,e=a._map.animate(function(e){var n=t+Math.PI*a._gestureRecognizer.panTiltDelta/a._map.size.y;return a._emit("tiltChanged"),Object(i.a)(Object(i.a)({},e),{tilt:n})}),n=a._gestureRecognizer.on("gestureEnd",function(){n.offAll(),e.stop(),a._emit("tiltEnd")})},a._onPinchRotateStart=function(){a._stopAnimationIfAny(),a._emit("zoomStart");var t=a._map.zoom,e=a._map.azimuth,n=a._map.animate(function(n){var o,s=t+Object(r.mathLog2)(a._gestureRecognizer.scale);return o=a.rotationAllowed?e+a._gestureRecognizer.angle:n.azimuth,a._emit("zoomChanged"),Object(i.a)(Object(i.a)({},n),{azimuth:o,zoom:s})}),o=a._gestureRecognizer.on("gestureEnd",function(){o.offAll(),n.stop();var t=Math.round(a._map.zoom),r=[];a.rotationAllowed&&Math.abs(a._gestureRecognizer.angle)<a._rotateThreshold&&(a._stopRotateAnimationIfAny(),a._rotateAnimation=function(t,e,n,o,r){return void 0===r&&(r=Jt),t.animateForDuration(o,function(t,o,a){var s=r(o)-r(o-a),u=t.azimuth+e*s;return 1===o&&(u=n),Object(i.a)(Object(i.a)({},t),{azimuth:u})})}(a._map,-a._gestureRecognizer.angle,e,a._rotateDuration),r.push(a._rotateAnimation.complete)),a.snapToRound&&t!==a._map.zoom&&(a._stopZoomAnimationIfAny(),a._zoomAnimation=te(a._map,t,a._zoomDuration),r.push(a._zoomAnimation.complete)),r.length?Object(s.promiseFinally)(Promise.all(r),function(){return a._emit("zoomEnd")}):a._emit("zoomEnd")})},a._map=e,a.snapToRound=o.snapToRound,a._zoomDuration=o.zoomDuration,a._rotateDuration=o.rotateDuration,a._rotateThreshold=o.rotateThreshold,a._gestureRecognizer=n,a._init(),a}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){var t,e;return Boolean((null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)||(null===(e=this._rotateAnimation)||void 0===e?void 0:e.isRunning))},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._gestureRecognizer.on("pinchRotateStart",this._onPinchRotateStart).on("panTiltStart",this._onTiltStart))},e.prototype._suspend=function(){this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0),this._stopAnimationIfAny()},e.prototype._stopAnimationIfAny=function(){this._stopZoomAnimationIfAny(),this._stopRotateAnimationIfAny()},e.prototype._stopZoomAnimationIfAny=function(){var t;(null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)&&(this._zoomAnimation.stop(),this._zoomAnimation=void 0)},e.prototype._stopRotateAnimationIfAny=function(){var t;(null===(t=this._rotateAnimation)||void 0===t?void 0:t.isRunning)&&(this._rotateAnimation.stop(),this._rotateAnimation=void 0)},e}(Object(f.a)().with()),Se=function(t){function e(e,n,o){var i=t.call(this)||this;return i._element=Z("ymaps3x0--magnifier"),i._backdropElement=Z("ymaps3x0--magnifier-backdrop"),i._onDragStart=function(){i._selectionInfo=i._computeSelectionInfo(),i._map.container.appendChild(i._element),document.body.appendChild(i._backdropElement),i._updateElementDimensions(i._selectionInfo),i._emit("selectionStart")},i._onDragMove=function(){i._selectionInfo&&(i._selectionInfo=i._computeSelectionInfo(),i._updateElementDimensions(i._selectionInfo))},i._onDragEnd=function(){i._selectionInfo&&(i._animation=i._zoomByCurrentSelection(i._selectionInfo),Object(s.promiseFinally)(i._animation.complete,function(){return i._emit("selectionEnd")}),i._cleanupSelection()),setTimeout(function(){return i._detachBackdrop()})},i._onKeyDown=function(t){"Escape"===t.key&&i._selectionInfo&&(i._emit("selectionEnd"),i._cleanupSelection())},i._backdropElement.addEventListener("contextmenu",function(t){return t.preventDefault()}),i._map=e,i._dragger=n,i.snapToRound=o,i._init(),i}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend(),this._detachElement()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._subscriptions||(document.addEventListener("keydown",this._onKeyDown),this._subscriptions=this._dragger.group().on("dragStart",this._onDragStart).on("dragMove",this._onDragMove).on("dragEnd",this._onDragEnd))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),document.removeEventListener("keydown",this._onKeyDown),this._subscriptions&&(this._subscriptions.offAll(),this._subscriptions=void 0),this._detachBackdrop()},e.prototype._cleanupSelection=function(){this._selectionInfo=void 0,this._detachElement()},e.prototype._detachElement=function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)},e.prototype._detachBackdrop=function(){this._backdropElement.parentNode&&this._backdropElement.parentNode.removeChild(this._backdropElement)},e.prototype._updateElementDimensions=function(t){var e=t.point,n=t.offset;this._element.style.left=Math.round(e.x)+"px",this._element.style.top=Math.round(e.y)+"px",this._element.style.width=Math.abs(Math.round(n.x))+"px",this._element.style.height=Math.abs(Math.round(n.y))+"px",this._element.style.transform="scale("+(n.x<0?-1:1)+", "+(n.y<0?-1:1)+")"},e.prototype._zoomByCurrentSelection=function(t){var e=function(t,e,n){var o=t.size,i=t.worldCenter,a=t.zoom,s=t.zoomRange,c=t.azimuth,l=t.tilt,d=t.fov,h=Object(Y.b)(Math.abs(e.offset.x),1e-10,o.x),p=Object(Y.b)(Math.abs(e.offset.y),1e-10,o.y),_=a+Math.min(Object(r.mathLog2)(o.x/h),Object(r.mathLog2)(o.y/p));n&&(_=Math.floor(_));var m=e.point,f=u.add(e.point,e.offset),y=u.divn(u.add(m,f),2);return{zoom:Math.min(Math.max(_,s.min),s.max),center:Object(B.b)(y,{size:o,worldCenter:i,zoom:a,azimuth:c,tilt:l,fov:d})}}(this._map,t,this.snapToRound),n=e.center,o=e.zoom;return ne(this._map,n,o,300)},e.prototype._computeSelectionInfo=function(){var t=this._map.container.getBoundingClientRect(),e=t.left,n=t.top;return{point:u.sub(this._dragger.dragStartingPoint,{x:e,y:n}),offset:this._dragger.dragOffset}},e}(Object(f.a)().with());var xe=300,Oe=function(t){function e(e,n,o,i){var r=t.call(this)||this;return r._isEnabled=!1,r._deviceStateChangedEventGroup=void 0,r._onClick=function(t){if(r._dragEventGroup)r._destroyDragEvents();else{var e=u.create(t.x,t.y);r._dragEventGroup=r._initDragEvents(e),window.clearTimeout(r._clickTimer),r._clickTimer=window.setTimeout(function(){r._destroyDragEvents()},xe)}},r._map=e,r._device=n,r._dragger=o,r.zoomStrategy=i,r._init(),r}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._addListeners(),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(window.clearTimeout(this._clickTimer),this._destroyDragEvents(),this._removeListeners(),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1)},e.prototype._addListeners=function(){var t,e=this;this._deviceStateChangedEventGroup||(this._deviceStateChangedEventGroup=this._device.on("stateChanged",function(){e._device.state!==o.PRIMARY?(t&&u.length(u.sub(t,e._device.pointerPosition))<=7&&e._onClick(t),t=void 0):t=e._device.pointerPosition}))},e.prototype._removeListeners=function(){this._deviceStateChangedEventGroup&&(this._deviceStateChangedEventGroup.offAll(),this._deviceStateChangedEventGroup=void 0)},e.prototype._initDragEvents=function(t){var e=this,n=this._dragger.group();return n.on("dragStart",function(){var o=e._dragger.dragStartingPoint;window.clearTimeout(e._clickTimer),u.length(u.sub(t,o))>20||(e._emit("zoomStart"),n.on("dragMove",function(){var n=e._dragger.pointerPosition,i=u.sub(n,o);o=n;var r=i.y/e._map.size.y*10,a=e._map.zoom+r,s=e._map.zoomRange;if(!(a<s.min||a>s.max)){var c=e.zoomStrategy===Qt.ZOOM_TO_CENTER?e._map.worldCenter:Object(B.c)(t,e._map);e._animation=te(e._map,a,0,c)}}),n.on("dragEnd",function(){e._destroyDragEvents(),e._animation?Object(s.promiseFinally)(e._animation.complete,function(){return e._emit("zoomEnd")}):e._emit("zoomEnd")}))}),n},e.prototype._destroyDragEvents=function(){this._dragEventGroup&&(this._dragEventGroup.offAll(),this._dragEventGroup=void 0)},e}(Object(f.a)().with()),ze=function(t){function e(e,n){var o=t.call(this)||this;return o._state={type:0},o.rotationAllowed=!0,o.tiltAllowed=!0,o._onDragStart=function(){0===o._state.type&&(o._emit("start"),o._state={type:1,animation:o._map.animate(o._onAnimationStep),previousPoint:o._dragger.dragStartingPoint})},o._onDragMove=function(){o._state.type},o._onDragEnd=function(){1===o._state.type&&(o._state.animation.stop(),o._state={type:0},o._emit("end"))},o._onAnimationStep=function(t){if(1!==o._state.type)return t;var e=u.sub(o._state.previousPoint,o._dragger.pointerPosition);o._state.previousPoint=o._dragger.pointerPosition;var n=o.rotationAllowed?Math.PI*e.x/o._map.size.x:0,r=o.tiltAllowed?Math.PI*e.y/o._map.size.y:0;return Object(i.a)(Object(i.a)({},t),{azimuth:t.azimuth+n,tilt:t.tilt+r})},o._map=e,o._dragger=n,o._draggerSubscription=o._dragger.on("dragStart",o._onDragStart).on("dragMove",o._onDragMove).on("dragEnd",o._onDragEnd),o.enable(),o}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return 1===this._state.type},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._state={type:0}},e.prototype.disable=function(){this.stop(),this._state={type:2}},e.prototype.stop=function(){1===this._state.type&&(this._state.animation.stop(),this._emit("end"),this._state={type:0})},e.prototype.destroy=function(){this.disable(),this._draggerSubscription.offAll()},e}(Object(f.a)().with()),Ee=200,we=200,Te=18*p,Re=function(t){function e(e,n,i){var a=t.call(this)||this;a._subscriptions=[],a._zoomStrategy=Qt.ZOOM_TO_POINTER,a._userEnabled=[],a._mapEnabledRotation=!0,a._restoreDrag=function(){-1!==a._userEnabled.indexOf("drag")&&a.drag.enable()};var s=T(e.container);a._snapToRoundZoom=i,a._map=e,a._zoomPointSrc=function(){if(a._zoomStrategy===Qt.ZOOM_TO_CENTER)return u.divn(a._map.size,2);var t=s.pointerPosition,n=e.container.getBoundingClientRect();return{x:t.x-n.left,y:t.y-n.top}},a._leftButtonDragger=new j(s),a._rightButtonDragger=new j(s,{listenToButtons:new r.Set([o.SECONDARY])}),a.magnifier=new Se(e,a._rightButtonDragger,i),a._proxyEvents(a.magnifier,"magnifier",["selectionStart","selectionEnd"]),a.drag=new ge(e,a._leftButtonDragger),a._proxyEvents(a.drag,"drag",["dragStart","dragEnd"]),a.dblClick=new ve(e,Ee,a._zoomPointSrc),a._proxyEvents(a.dblClick,"dblClick",["zoomStart","zoomEnd"]),a.magnifier.disable();var c={zoomDuration:Ee,rotateDuration:we,rotateThreshold:Te,snapToRound:i};a._twoFingersGesture=new k(s),a.pinchZoom=new be(e,a._twoFingersGesture,c),a._proxyEvents(a.pinchZoom,"pinchZoom",["zoomStart","zoomEnd"]);var l=a.pinchZoom.on("zoomStart",function(){a._zoomStrategy===Qt.ZOOM_TO_CENTER&&a.drag.disable()}).on("zoomEnd",a._restoreDrag).on("tiltStart",function(){return a.drag.disable()}).on("tiltEnd",a._restoreDrag);a._subscriptions.push(l),a._wheelDevice=new M(a._map.container),a._roundScrollZoom=new ae(a._map,a._wheelDevice,a._zoomPointSrc,Ee),a._proxyEvents(a._roundScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),a._smoothScrollZoom=new pe(a._map,a._wheelDevice,a._zoomPointSrc),a._proxyEvents(a._smoothScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),a.oneFingerZoom=new Oe(e,s,a._leftButtonDragger,a._zoomStrategy),a._proxyEvents(a.oneFingerZoom,"oneFingerZoom",["zoomStart","zoomEnd"]);var d=a.oneFingerZoom.on("zoomStart",function(){return a.drag.disable()}).on("zoomEnd",a._restoreDrag);a._subscriptions.push(d);var h=new j(s,{listenToButtons:new r.Set([o.CTRL_PRIMARY])});return a.rotate=new ze(a._map,h),a._behaviorsRegistry={drag:a.drag,pinchZoom:a.pinchZoom,scrollZoom:a._snapToRoundZoom?a._roundScrollZoom:a._smoothScrollZoom,dblClick:a.dblClick,magnifier:a.magnifier,oneFingerZoom:a.oneFingerZoom,mouseRotate:!1,mouseTilt:!1,pinchRotate:!1,panTilt:!1},a.setEnabled(n),a._selectScrollZoom(),a}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){for(var t=0,e=Object.keys(this._behaviorsRegistry);t<e.length;t++){var n=e[t];if("pinchRotate"!==n&&"panTilt"!==n&&"mouseRotate"!==n&&"mouseTilt"!==n&&this._behaviorsRegistry[n].isInAction)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapToRoundZoom",{get:function(){return this._snapToRoundZoom},set:function(t){this._snapToRoundZoom!==t&&(this._snapToRoundZoom=t,this.magnifier.snapToRound=t,this.pinchZoom.snapToRound=t,this._selectScrollZoom())},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._subscriptions.forEach(function(t){return t.offAll()}),this.drag.destroy(),this.pinchZoom.destroy(),this.dblClick.destroy(),this.magnifier.destroy(),this.oneFingerZoom.destroy(),this.rotate.destroy(),this._roundScrollZoom.destroy(),this._smoothScrollZoom.destroy(),this._leftButtonDragger.destroy(),this._rightButtonDragger.destroy(),this._twoFingersGesture.destroy(),this._wheelDevice.destroy()},e.prototype.setEnabled=function(t){var e;(e=this._userEnabled).splice.apply(e,Object(i.c)([0,1/0],t));for(var n=0,o=Object.keys(this._behaviorsRegistry);n<o.length;n++){var r=o[n];this._setEnabledSingle(r,-1!==t.indexOf(r))}},e.prototype.setZoomStrategy=function(t){this._zoomStrategy=t,this.oneFingerZoom.zoomStrategy=t},e.prototype.mapToggleRotation=function(t){this._mapEnabledRotation=t,this.setEnabled(this._userEnabled)},e.prototype._setEnabledSingle=function(t,e){"pinchRotate"===t?this._behaviorsRegistry.pinchZoom.rotationAllowed=this._mapEnabledRotation&&e:"panTilt"===t?this._behaviorsRegistry.pinchZoom.tiltAllowed=this._mapEnabledRotation&&e:"mouseRotate"===t?this.rotate.rotationAllowed=this._mapEnabledRotation&&e:"mouseTilt"===t?this.rotate.tiltAllowed=this._mapEnabledRotation&&e:e?this._behaviorsRegistry[t].enable():this._behaviorsRegistry[t].disable()},e.prototype._proxyEvents=function(t,e,n){var o=this;this._subscriptions.push(t.on(n[0],function(){return o._emit("actionStart",e)}).on(n[1],function(){return o._emit("actionEnd",e)}))},e.prototype._selectScrollZoom=function(){this._snapToRoundZoom?(this._roundScrollZoom.enable(),this._smoothScrollZoom.disable(),this._behaviorsRegistry.scrollZoom=this._roundScrollZoom):(this._roundScrollZoom.disable(),this._smoothScrollZoom.enable(),this._behaviorsRegistry.scrollZoom=this._smoothScrollZoom)},e}(Object(f.a)().with()),Ce=function(){function t(t,e){void 0===t&&(t=6378137),void 0===e&&(e=.0818191908426),this.radius=t,this.e=e,this._e2=this.e*this.e,this._e4=this._e2*this._e2,this._e6=this._e4*this._e2,this._e8=this._e4*this._e4,this._subradius=1/t,this._d2=this._e2/2+5*this._e4/24+this._e6/12+13*this._e8/360,this._d4=7*this._e4/48+29*this._e6/240+811*this._e8/11520,this._d6=7*this._e6/120+81*this._e8/1120,this._d8=4279*this._e8/161280}return t.prototype.mercatorToGeo=function(t){return[this.xToLongitude(t.x),this.yToLatitude(t.y)]},t.prototype.geoToMercator=function(t){return{x:this.longitudeToX(t[0]),y:this.latitudeToY(t[1])}},t.prototype.xToLongitude=function(t){return _*Object(Y.a)(t*this._subradius,-Math.PI,Math.PI)},t.prototype.yToLatitude=function(t){var e=.5*Math.PI-2*Math.atan(1/Math.exp(t*this._subradius)),n=e+this._d2*Math.sin(2*e)+this._d4*Math.sin(4*e)+this._d6*Math.sin(6*e)+this._d8*Math.sin(8*e);return _*n},t.prototype.longitudeToX=function(t){var e=Object(Y.a)(p*t,-Math.PI,Math.PI);return this.radius*e},t.prototype.latitudeToY=function(t){var e=p*Object(Y.b)(t,1e-10-90,90-1e-10),n=this.e*Math.sin(e),o=Math.tan(.25*Math.PI+.5*e)/Math.pow(Math.tan(.25*Math.PI+.5*Math.asin(n)),this.e);return this.radius*Math.log(o)},t}(),je=new(function(){function t(t,e){this._mercator=new Ce(t,e),this._halfEquator=Math.PI*this._mercator.radius}return t.prototype.toGlobalCoordinates=function(t){var e=this._mercator.geoToMercator(t);return{x:(this._halfEquator+e.x)/this._halfEquator-1,y:1-(this._halfEquator-e.y)/this._halfEquator}},t.prototype.fromGlobalCoordinates=function(t){var e=this._mercator.yToLatitude(this._halfEquator-(1-t.y)*this._halfEquator);return[_*Object(Y.a)(Math.PI*t.x,-Math.PI,Math.PI),e]},t}()),Ae="none",Me="any",Pe=Math.pow(15,2),Le=["touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointercancel","click","dblclick","mouseup","mousedown","mouseenter","mouseleave","mousemove","contextmenu"],De=["mousedown","touchstart","pointerdown","contextmenu"],Ie=function(){},ke=function(){function t(t,e){var n=this;this._previousRightClickTimestamp=0,this._stopWaitingHotspots=Ie,this._handlers={},this._activeObject=null,this.clickTimeout=300,this.waitHotspotsTimeout=1e3,this._onEvent=function(t){if("dblclick"!==t.type&&!n._map.isInAction&&!t.ctrlKey){var e,o,i=t.target instanceof HTMLElement?n._map.findMarkerByElement(t.target):null;if(!i||!i.marker.options.blockEvents)if(De.indexOf(t.type)>=0&&n._stopWaitingHotspots(!1),"click"===t.type)if(n._processEvent("fastclick",t),t.preventDefault(),void 0!==n._clickTimer){window.clearTimeout(n._clickTimer),n._clickTimer=void 0;var r=Ge(t);e=n._previousClickPosition,o=r,Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)<Pe&&n._processEvent("dblclick",t)}else n._previousClickPosition=Ge(t),n._clickTimer=window.setTimeout(function(){n._clickTimer=void 0,n._map.isInAction||n._waitHotspots(t).then(function(e){e&&!n._map.isInAction&&n._processEvent("click",t)})},n.clickTimeout);else if("contextmenu"===t.type){var a=Date.now();a-n._previousRightClickTimestamp<n.clickTimeout?(n._previousRightClickTimestamp=0,n._processEvent("rightdblclick",t)):n._previousRightClickTimestamp=a}else n._processEvent(t.type,t)}},this._waitHotspots=function(t){return new Promise(function(e){var o=n._computeAllCoordinates(t);if(o){var i=o[1],a=function(){var t=n._map.findObjectInWorldPositionEx(i),e=Object(r.arrayFind)(t.layers,function(t){return null!==t.object});e&&void 0===e.object||n._stopWaitingHotspots(!0)},s=window.setTimeout(function(){return n._stopWaitingHotspots(!0)},n.waitHotspotsTimeout),u=n._map.on("hotspotsChanged",a);n._stopWaitingHotspots=function(t){window.clearTimeout(s),u.offAll(),e(t),n._stopWaitingHotspots=Ie},a()}else e(!1)})},this._computeAllCoordinates=function(t){var e=Ge(t);if(!isFinite(e.x)||!isFinite(e.y))return null;var o=Object(B.c)(e,n._map);return[e,o,n._map.projection.fromGlobalCoordinates(o)]},this._processEvent=function(t,e){var o=n._computeAllCoordinates(e);if(o){var i=o[0],r=o[1],a=o[2],s=n._map.findObjectInWorldPosition(r);n._eventObjectsFilter&&!n._eventObjectsFilter(s)&&(s=null);var u={coordinates:a,screenCoordinates:[i.x,i.y]};if("mousemove"===e.type){var c=n._activeObject;c&&s&&Fe(c,s)?n._emitLayerEvent("mousemove",c,u,e):c&&s&&Fe(c,s)||(c&&n._emitLayerEvent("mouseleave",c,u,e),s&&n._emitLayerEvent("mouseenter",s,u,e)),n._activeObject=s}else s&&n._emitLayerEvent(t,s,u,e);s||(n._initHandlers(t,Ae),n._handlers[t][Ae].forEach(function(t){return t(null,u,e)}),n._initHandlers(t,Me),n._handlers[t][Me].forEach(function(t){return t(null,u,e)}))}},this._emitLayerEvent=function(t,e,o,i){n._initHandlers(t,e.layer),n._handlers[t][e.layer].forEach(function(t){return t(e,o,i)}),n._initHandlers(t,Me),n._handlers[t][Me].forEach(function(t){return t(e,o,i)})},this._initHandlers=function(t,e){n._handlers[t]=n._handlers[t]||{},n._handlers[t][e]=n._handlers[t][e]||[]},this._map=t,this._eventObjectsFilter=e,Le.forEach(function(t){return n._map.container.addEventListener(t,n._onEvent)})}return t.prototype.destroy=function(){var t=this;this._stopWaitingHotspots(!1),window.clearInterval(this._clickTimer),Le.forEach(function(e){return t._map.container.removeEventListener(e,t._onEvent)})},t.prototype.on=function(t,e,n){this._initHandlers(t,e),this._handlers[t][e].push(n)},t.prototype.off=function(t,e,n){this._initHandlers(t,e);var o=this._handlers[t][e].indexOf(n);-1!==o&&this._handlers[t][e].splice(o,1)},t}();function Fe(t,e){return t.type===e.type&&t.layer===e.layer&&("hotspot"===t.type&&t.feature.id===e.feature.id||"feature"===t.type&&t.feature.id===e.feature.id||"marker"===t.type&&t.marker===e.marker)}function Ge(t){if("touches"in t){var e=t.touches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY}}return{x:t.clientX,y:t.clientY}}var We=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.element=Z(),e}return Object(i.b)(e,t),e.prototype.getLayerReadyState=function(){},e.prototype.destroy=function(){},e.prototype.update=function(){},e.prototype.resize=function(){},e.prototype.setLayers=function(){},e.prototype.setObjectFilters=function(){},e.prototype.setInvisibleCollidingPrimitives=function(){},e.prototype.findObjectInPosition=function(){return null},e.prototype.findObjectInPositionEx=function(){return{layers:[]}},e.prototype.preloadHotspotsInPoint=function(){},e.prototype.preloadHotspotsForViewport=function(){},e.prototype.setDataSources=function(){},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.setObjectHighlight=function(){},Object.defineProperty(e.prototype,"fov",{get:function(){return m},enumerable:!1,configurable:!0}),e}(Object(f.a)().with()),Ze=Math.round,Ne="ymaps3x0--top-engine-container",Be="ymaps3x0--main-engine-container",Ye="ymaps3x0--hide",He=function(t){function e(e){var n=e.element,o=e.center,a=e.zoom,s=e.dataSources,u=e.topRasterLayers,c=e.mainLayers,p=e.mode,_=e.margin,m=e.zoomRange,f=e.behaviors,y=void 0===f?["drag","scrollZoom","pinchZoom","dblClick","magnifier"]:f,g=e.manageZoomRounding,v=void 0===g||g,b=e.projection,S=void 0===b?je:b,x=e.worldOptions,O=void 0===x?{cycledX:!0,cycledY:!1}:x,z=e.eventObjectsFilter,E=e.disableRasterPreload,w=e.experiments,T=void 0===w?{}:w,R=e.nonRotatableRasterSources,C=void 0===R?[]:R,j=t.call(this)||this;j._renderLoop=new l.b,j._dataSources={},j._filters=new r.Set,j._invisibleCollidingPrimitives=new r.Map,j._topRasterLayers=[],j._mainLayers=[],j._vectorFailed=!1,j._featuresByDataSource=new r.Map,j._destroyed=!1,j.container=Z("ymaps3x0--map"),j._onVectorError=function(t){j._vectorFailed=!0,j._applyMode(),j._emit("vectorError"),function(t){Q?Q(t):window.console.error("There is no error logger to log the error:",t)}(t),console.error(t)},j._experiments=T,j.projection=S,j.worldOptions=O,j._manageZoomRounding=v,j._nonRotatableRasterSources=new r.Set(C),j._topEngineContainer=Z(Ne),j._mainEngineContainer=Z(Be),j.container.appendChild(j._mainEngineContainer),j.container.appendChild(j._topEngineContainer),n.appendChild(j.container);var A=Ve(j.container),M=A.size,P=A.offset;j._size=M,j._offset=P,j._zoomRange=m?Object(i.a)({},m):Object(d.c)(),j._margin=_;var L=q(S,o,a,_),D=W.a.restrictToZeroWorld(L,j.worldOptions);j._camera=j._restrictCamera({zoom:a,worldCenter:D,azimuth:0,tilt:0}),j._effectiveMode=null,j._desiredMode=p,j._disableRasterPreload=Boolean(E),j._dataSourceDescriptions={};for(var I=0,k=Object.keys(s);I<k.length;I++){var F=k[I];j._dataSourceDescriptions[F]=Object(h.d)(s[F]);var G=j._createDataSource(j._dataSourceDescriptions[F]);null!==G&&(j._dataSources[F]=G)}qe(j._zoomRange,j._dataSourceDescriptions),j._mainLayers=Xe(c,s),j._topRasterLayers=Xe(u,s),j._assertLayersIsValid(j._topRasterLayers,j._mainLayers);var N=j._createTopEngine(),B=N.topEngine,Y=N.eventGroup;return j._topRasterEngine=B,j._topRasterEngineEventGroup=Y,j._applyMode(),j.events=new ke(j,z),j.behaviors=new Re(j,y,!0),j._subscribeToDomEvents(),j._handleRotatability(),j._update(),j.on("ready",function(){j._topRasterEngine.animateFirstScreen=!0,"raster"===j._mainEngine.type&&(j._mainEngine.engine.animateFirstScreen=!0)}),j}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this.calculateCenter(this._camera.worldCenter)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldCenter",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._mainEngine.engine.fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){for(var t,e,n=Object(d.c)(),o=0,r=Object(i.c)(this._topRasterLayers,this._mainLayers);o<r.length;o++){var a=r[o];if(a.source&&a.source!==K.a){var s=this._dataSourceDescriptions[a.source];"tile"===s.type&&s.clampMapZoom&&Object(d.b)(n,s.zoomRange||Object(d.c)(),n)}}return t=this._zoomRange,e=n,{min:Math.max(t.min,e.min),max:Math.min(t.max,e.max)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInAction",{get:function(){return Boolean(this._animateHandler&&this._animateHandler.isRunning||this.behaviors&&this.behaviors.isInAction)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSnapToRoundZoom",{get:function(){return!this._manageZoomRounding||this.behaviors&&this.behaviors.snapToRoundZoom},enumerable:!1,configurable:!0}),e.prototype.addObjectFilter=function(t){this._filters.add(t),this._applyFilters()},e.prototype.removeObjectFilter=function(t){this._filters.delete(t),this._applyFilters()},e.prototype.getInvisibleCollidingPrimitives=function(){return this._invisibleCollidingPrimitives},e.prototype.addInvisibleCollidingPrimitives=function(t){var e=this;t.forEach(function(t,n){e._invisibleCollidingPrimitives.set(n,{anchor:e.projection.toGlobalCoordinates(t.anchor),rect:t.rect})}),this._applyInvisibleCollidingPrimitives()},e.prototype.removeInvisibleCollidingPrimitives=function(t){var e=this;t.forEach(function(t){e._invisibleCollidingPrimitives.delete(t)}),this._applyInvisibleCollidingPrimitives()},e.prototype.setObjectHighlight=function(t){this._mainEngine.engine.setObjectHighlight(t),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setObjectHighlight(t)},e.prototype.calculateCenter=function(t){return function(t,e,n,o){if(o){var i=W.a.worldToPixels(e,n),r=u.add(i,U(o));e=W.a.pixelsToWorld(r,n)}return t.fromGlobalCoordinates(e)}(this.projection,t,this._camera.zoom,this._margin)},e.prototype.setCamera=function(t){var e=t.worldCenter,n=t.zoom;if(!isFinite(e.x)||!isFinite(e.y))throw new Error("Trying to set non-finite center");if(!isFinite(n))throw new Error("Trying to set non-finite zoom");this._camera=this._restrictCamera(Object(i.a)(Object(i.a)({},t),{zoom:n})),this._update()},e.prototype.animate=function(t){var e=this;return this._renderLoop.animate(function(n){var o=e._camera,i=t(o,n);i!==o&&e.setCamera(i)})},e.prototype.animateForDuration=function(t,e){var n=this,o=0;return this._renderLoop.animateForDuration(function(t){var i=t-o;o=t;var r=n._camera,a=e(r,t,i);a!==r&&n.setCamera(a)},t)},e.prototype.setZoomRange=function(t){qe(t,this._dataSourceDescriptions),this._zoomRange=Object(i.a)({},t),this._emit("zoomRangeChange")},e.prototype.getMode=function(){return this._desiredMode},e.prototype.getEffectiveMode=function(){return this._effectiveMode},e.prototype.setMode=function(t){this._desiredMode!==t&&(this._desiredMode=t,this._applyMode())},Object.defineProperty(e.prototype,"margin",{get:function(){if(this._margin)return this._margin},enumerable:!1,configurable:!0}),e.prototype.setMargin=function(t){this._margin=t,this._emit("update")},e.prototype.setCenter=function(t){var e=this._camera.zoom,n=q(this.projection,t,e,this._margin);u.areEqual(n,this._camera.worldCenter)||this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{worldCenter:n,zoom:e,azimuth:0,tilt:0}))},e.prototype.setZoom=function(t){var e=this._restrictZoom(t);e!==this._camera.zoom&&(this._camera=this._restrictCamera(Object(i.a)(Object(i.a)({},this._camera),{zoom:e})),this._update())},e.prototype.animateCenterAndZoom=function(t,e,n){var o=this;this._animateHandler&&this._animateHandler.isRunning&&this._animateHandler.stop();var i=this.zoomRange,r=Object(Y.b)(e,i.min,i.max),a=q(this.projection,t,e,this._margin),s=W.a.moveCloseToCenter(a,this._camera.worldCenter);return this._animateHandler=ne(this,s,r,n),this._animateHandler.complete.then(function(){return o._emit("update")})},e.prototype.getLayerReadyState=function(t){var e=this._topRasterEngine.getLayerReadyState(t),n=this._mainEngine.engine.getLayerReadyState(t);return e||n},e.prototype.destroy=function(){this._destroyed||(this._emit("beforeDestroy"),this.events.destroy(),this.behaviors.destroy(),this._destroyMainEngine(),this._topRasterEngineEventGroup.offAll(),this._topRasterEngine.destroy(),this.container.removeChild(this._topEngineContainer),this.container.removeChild(this._mainEngineContainer),this.container.parentElement.removeChild(this.container),this._destroyed=!0)},e.prototype.resize=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var n=Ve(this.container),o=n.size,r=n.offset;if(!u.areEqual(o,this._size)){var a=this._camera.worldCenter;if(t){var s=u.divn(u.sub(o,this._size),2);u.rotate(s,this._camera.azimuth,s);var c=W.a.convertPixelSizeToWorldSize({x:s.x,y:-s.y},this._camera.zoom);a=u.sub(this._camera.worldCenter,c)}var l=W.a.convertPixelSizeToWorldSize(u.divn(o,2),this._camera.zoom);a={x:a.x,y:Object(Y.b)(a.y,-1-l.y,1+l.y)},u.areEqual(a,this._camera.worldCenter)||this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{worldCenter:a})),this._size=o,this._offset=r,this._topRasterEngine.resize(this._size),this._mainEngine.engine.resize(this._size),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.resize(this._size),this._emit("resize"),e?this.renderImmediately():this._renderLoop.update()}},e.prototype.addGroup=function(t,e,n,o){void 0===n&&(n={}),void 0===o&&(o=Gt),this._assertDataSourceExistance(t),this._dataSources[t].addGroup(e,n,o)},e.prototype.removeGroupAndChildren=function(t,e){this._assertDataSourceExistance(t),this._dataSources[t].removeGroupAndChildren(e)},e.prototype.addFeature=function(t,e,n,o){void 0===n&&(n={}),void 0===o&&(o=Gt),this._assertDataSourceExistance(t);var i=this._dataSources[t],r=this._convertFeatureToWorld(e),a=r.feature,s=r.bbox;i.addFeature(a,n,s,o),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.removeFeatureById=function(t,e){this._assertDataSourceExistance(t),this._dataSources[t].removeFeatureById(e),this._getFeaturesForDataSource(t).delete(e)},e.prototype.updateFeature=function(t,e,n){void 0===n&&(n={}),this._assertDataSourceExistance(t);var o=this._dataSources[t],i=this._convertFeatureToWorld(e),r=i.feature,a=i.bbox;o.updateFeature(r,n,a),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.moveFeatureToGroup=function(t,e,n){void 0===n&&(n=Gt),this._assertDataSourceExistance(t),this._dataSources[t].moveFeatureToGroup(e,n)},e.prototype.hasFeature=function(t,e){return this._assertDataSourceExistance(t),this._dataSources[t].hasFeatureWithId(e)},e.prototype.createMarker=function(t){return new H(t)},e.prototype.addMarker=function(t,e){this._assertDataSourceExistance(t);var n=this._dataSources[t];if(!(n instanceof Ht))throw new Error('Data source "'+t+'" must be instanceof MarkersDataSource');n.addMarker(e)},e.prototype.removeMarker=function(t,e){this._assertDataSourceExistance(t);var n=this._dataSources[t];if(!(n instanceof Ht))throw new Error('Data source "'+t+'" must be instanceof MarkersDataSource');n.removeMarker(e)},e.prototype.setLayers=function(t){var e=t.topRasterLayers,n=t.mainLayers;e&&(this._topRasterLayers=Xe(e,this._dataSourceDescriptions)),n&&(this._mainLayers=Xe(n,this._dataSourceDescriptions)),this._assertLayersIsValid(this._topRasterLayers,this._mainLayers),this._topRasterEngine.setLayers(this._topRasterLayers),this._mainEngine.engine.setLayers(this._mainLayers),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.engine.setLayers(this._mainLayers),this._chooseZoomRounding(),this._handleRotatability(),this._emit("update"),this._emit("copyrightsChange")},e.prototype.getLayers=function(){return{topRasterLayers:this._topRasterLayers.map(Ue),mainLayers:this._mainLayers.map(Ue)}},e.prototype.getDataSource=function(t){var e=this._dataSourceDescriptions[t];return e?Object(h.d)(e):void 0},e.prototype.addDataSource=function(t,e){this._dataSourceDescriptions[t]=Object(h.d)(e);var n=this._createDataSource(this._dataSourceDescriptions[t]);null!==n&&(this._dataSources[t]=n),this._topRasterEngine.setDataSources(this._dataSources),this._mainEngine.engine.setDataSources(this._dataSources),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setDataSources(this._dataSources)},e.prototype.removeDataSource=function(t){if(Object(i.c)(this._mainLayers,this._topRasterLayers).some(function(e){return e.source===t}))throw new Error("Can't remove, data source with id=\""+t+' is used"');delete this._dataSourceDescriptions[t],delete this._dataSources[t],this._topRasterEngine.setDataSources(this._dataSources),this._mainEngine.engine.setDataSources(this._dataSources),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setDataSources(this._dataSources)},e.prototype.updateTileDataSource=function(t,e){this._assertDataSourceExistance(t);var n=this._dataSources[t];if(!(n instanceof tt.a))throw new Error('Data source "'+t+'" must be instanceof "TileDataSource"');var o=Object(h.d)(e);this._dataSourceDescriptions[t]=o,n.setSource(o),qe(this._zoomRange,this._dataSourceDescriptions),this._emit("zoomRangeChange"),this._emit("copyrightsChange")},e.prototype.provideVectorMapEngineFactory=function(t){this._vectorMapEngineFactory=t,this._emit("vectorLoad"),"vector"===this._desiredMode&&this._applyMode()},e.prototype.isVectorMapEngineFactoryProvided=function(){return Boolean(this._vectorMapEngineFactory)},e.prototype.findMarkerByElement=function(t){var e=this._topRasterEngine.findMarkerByElement(t);return e?Object(i.a)(Object(i.a)({},e),{layer:e.layer,source:e.source,marker:e.marker}):null},e.prototype.findObjectInWorldPosition=function(t){var e=this._topRasterEngine.findObjectInPosition(t)||this._mainEngine.engine.findObjectInPosition(t);return this._toMapObject(e)||null},e.prototype.findObjectInWorldPositionEx=function(t){var e=this,n=this._topRasterEngine.findObjectInPositionEx(t),o=Object(r.arrayFind)(n.layers,function(t){return t.object})?{layers:[]}:this._mainEngine.engine.findObjectInPositionEx(t);return{layers:Object(i.c)(n.layers.map(function(t){var n=t.layer,o=t.object;return{layer:n,object:e._toMapObject(o)}}),o.layers.map(function(t){var n=t.layer,o=t.object;return{layer:n,object:e._toMapObject(o)}}))}},e.prototype.renderImmediately=function(t){void 0===t&&(t=l.a.FULL),this._renderLoop.renderImmediately(t)},e.prototype.preloadHotspotsInPoint=function(t){var e=W.a.restrictToZeroWorld(t,this.worldOptions);this._topRasterEngine.preloadHotspotsInPoint(e),this._mainEngine.engine.preloadHotspotsInPoint(e),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsInPoint(t)},e.prototype.preloadHotspotsForViewport=function(){this._topRasterEngine.preloadHotspotsForViewport(),this._mainEngine.engine.preloadHotspotsForViewport(),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsForViewport()},e.prototype.getIndoorPlans=function(){return"vector"===this._mainEngine.type?this._mainEngine.engine.getIndoorPlans():"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getIndoorPlans():null},e.prototype.getVisibleObjects=function(t){return"vector"===this._mainEngine.type?this._mainEngine.engine.getVisibleObjects(t):"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getVisibleObjects(t):null},e.prototype.startTileSourceAnimation=function(t){var e=this._dataSources[t];e.isTileAnimationStarted||e.startTileAnimation()},e.prototype.stopTileSourceAnimation=function(t){var e=this._dataSources[t];e.isTileAnimationStarted&&e.stopTileAnimation()},e.prototype._applyMode=function(){var t=this,e=Boolean(this._vectorMapEngineFactory),n=e&&!this._vectorFailed,o="vector"===this._desiredMode&&!e&&!this._vectorFailed&&this._disableRasterPreload?"preVector":n?this._desiredMode:"raster";if(this._effectiveMode===o)return this._mainEngine.engine.setLayers(this._mainLayers),void this._renderLoop.update();if(this._effectiveMode=o,"preVector"===this._effectiveMode){var i=new We;this._mainEngine={type:"preVector",engine:i,eventGroup:i.group()}}else if("raster"===this._effectiveMode){this._destroyMainEngine();i=new Ut(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,Ze,this._topRasterEngine.animateFirstScreen);this._mainEngineContainer.appendChild(i.element),i.setLayers(this._mainLayers),i.setObjectFilters(this._filters);var r=i.group().on("tilesReady",function(){return t._emit("ready")}).on("tilesLoaded",function(){return t._emit("loaded")}).on("stateChanged",function(){return t._emit("stateChanged")}).on("hotspotsChanged",function(){return t._emit("hotspotsChanged")});this._mainEngine={type:"raster",engine:i,eventGroup:r},this._emit("mainEngineChanged"),this._chooseZoomRounding(),this._handleRotatability(),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov)}else{var a,s={init:performance.now(),duration:-1};try{a=this._vectorMapEngineFactory(this._size,this._camera,this._dataSources,this._renderLoop,this.worldOptions)}catch(d){return void this._onVectorError(new Error("ymaps3: failed to create vector engine: "+d))}if("preVector"===this._mainEngine.type){var u=this._switchMainEngineToVector(a);u.initLayersTimer=setTimeout(function(){var e=a.on("stateChanged",function(){t._isReadyToShowVector(a)&&(e.offAll(),t._mainEngineContainer.appendChild(a.element),t._emit("vectorStart",{duration:s.duration}))});t._setVectorLayers(u,s)})}else{var c=a.on("internalError",function(){return t._onVectorError(new Error("vector: internal error"))}).on("indoorPlansChanged",function(){return t._emit("indoorPlansChanged")}).on("hotspotsChanged",function(){return t._emit("hotspotsChanged")}),l={type:"vector",engine:a,eventGroup:c};this._mainEngine={engine:this._mainEngine.engine,eventGroup:this._mainEngine.eventGroup,type:"transitionToVector",vector:l},this._mainEngine.vector.initLayersTimer=setTimeout(function(){"transitionToVector"===t._mainEngine.type?(c.on("stateChanged",function(){t._isReadyToShowVector(a,t._mainEngine.engine)&&(c.offAll(),t._finalizeSwitchingToVector(s.duration))}),t._setVectorLayers(l,s)):t._onVectorError(new Error("ymaps3: unexpected main engine state: "+t._mainEngine.type))})}}this._renderLoop.update(),this._emit("indoorPlansChanged")},e.prototype._setVectorLayers=function(t,e){var n=this;return new Promise(function(o){var i=t.engine,r=function(t){n._onVectorError(new Error("ymaps3: failed to set vector layers: "+t))},s=function(){i.setObjectFilters(n._filters),i.setInvisibleCollidingPrimitives(n._invisibleCollidingPrimitives),e.duration=performance.now()-e.init,o()};try{if(i.initLayersAsync){t.setLayersAbortController=new a.AbortController;var u=t.setLayersAbortController.signal;i.initLayersAsync(n._mainLayers,u).then(s).catch(r)}else i.setLayers(n._mainLayers),s()}catch(c){r(c)}})},e.prototype._switchMainEngineToVector=function(t){var e=this;return this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy(),this._mainEngine={type:"vector",engine:t,eventGroup:t.group().on("internalError",function(){return e._onVectorError(new Error("vector: internal error"))}).on("tilesReady",function(){return e._emit("ready")}).on("tilesLoaded",function(){return e._emit("loaded")}).on("stateChanged",function(){return e._emit("stateChanged")}).on("indoorPlansChanged",function(){return e._emit("indoorPlansChanged")})},this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._emit("indoorPlansChanged"),this._emit("mainEngineChanged"),this._chooseZoomRounding(),this._handleRotatability(),this._mainEngine},e.prototype._isReadyToShowVector=function(t,e){var n=0,o=0,i=0,r=0;return this._mainLayers.forEach(function(a){var s=t.getLayerReadyState(a.id);s&&(r+=s.tilesTotal,i+=s.tilesReady);var u=null==e?void 0:e.getLayerReadyState(a.id);u&&(o+=u.tilesTotal,n+=u.tilesReady)}),0!==r&&0!==i&&(0===o||i>=.75*r||i/r>=n/o)},e.prototype._finalizeSwitchingToVector=function(t){var e=this;if("transitionToVector"===this._mainEngine.type){var n=this._mainEngine.vector.engine;this._mainEngine.vector.animationAbortController=new a.AbortController;var o=this._mainEngine.vector.animationAbortController.signal,i=this._mainEngineContainer;this._mainEngineContainer=Z(Be),this._mainEngineContainer.appendChild(n.element),this._emit("vectorStart",{duration:t}),function(t,e,n){return new Promise(function(o,i){t.parentElement.insertBefore(e,t),n.addEventListener("abort",function(){i()}),t.addEventListener("transitionend",function(){Qe(t),o()}),t.classList.add(Ye),getComputedStyle(t).opacity})}(i,this._mainEngineContainer,o).then(function(){"transitionToVector"===e._mainEngine.type?e._switchMainEngineToVector(n):e._onVectorError(new Error("ymaps3: unexpected main engine state: "+e._mainEngine.type))}).catch(function(t){e._onVectorError(new Error("ymaps3: switch to vector aborted: "+t))})}else this._onVectorError(new Error("ymaps3: unexpected main engine state: "+this._mainEngine.type))},e.prototype._handleRotatability=function(){var t,e=this,n=Object(i.c)(this._topRasterLayers,"vector"!==this._mainEngine.type?this._mainLayers:[]),o=Boolean(this._experiments.ymaps3MapRotate)&&n.every(function(t){return!e._nonRotatableRasterSources.has(t.source)});null===(t=this.behaviors)||void 0===t||t.mapToggleRotation(o),!o&&(0!==this._camera.azimuth||this._camera.tilt>0)&&(this._camera=Object(i.a)(Object(i.a)({},this._camera),{azimuth:0,tilt:0}),this._update())},e.prototype._assertLayersIsValid=function(t,e){for(var n=0,o=e;n<o.length;n++){var a=o[n].source,s=this._dataSourceDescriptions[a];if(!s)throw new Error("Unknown data source "+a);if("tile"!==s.type)throw new Error('Only "tile" data source can be in main engine');if(!s.hasOwnProperty("vector"))throw new Error('Source "'+a+'" in main engine does not have vector field');if(!("indoor"!==a||"tile"===s.type&&s.vector&&s.vector.indoorPlanUrl))throw new Error('Source "indoor" has a special meaning and must be a vector indoor data source.')}var u=Object(i.c)(e,t).map(function(t){return t.id});new r.Set(u)},e.prototype._destroyMainEngine=function(){this._mainEngine&&("vector"===this._mainEngine.type&&(this._mainEngine.setLayersAbortController&&this._mainEngine.setLayersAbortController.abort(),clearTimeout(this._mainEngine.initLayersTimer),Qe(this._mainEngine.engine.element)),"transitionToVector"===this._mainEngine.type&&(this._mainEngine.vector.animationAbortController&&this._mainEngine.vector.animationAbortController.abort(),this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.setLayersAbortController.abort(),clearTimeout(this._mainEngine.vector.initLayersTimer),this._mainEngine.vector.eventGroup.offAll(),Qe(this._mainEngine.vector.engine.element),this._mainEngine.vector.engine.destroy()),this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy())},e.prototype._createTopEngine=function(){var t=this,e=new Ut(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,function(e){return t._mainEngine&&"vector"===t._mainEngine.type?function(t){var e=Math.floor(t);return t-e<.5?e:e+1}(e):Ze(e)},!1);this._topEngineContainer.appendChild(e.element);var n=e.group().on("tilesReady",function(){return t._emit("ready")}).on("tilesLoaded",function(){return t._emit("loaded")}).on("stateChanged",function(){return t._emit("stateChanged")}).on("hotspotsChanged",function(){return t._emit("hotspotsChanged")});return e.setLayers(this._topRasterLayers),e.setObjectFilters(this._filters),{topEngine:e,eventGroup:n}},e.prototype._update=function(){this._mainEngine.engine.update(this._camera,m),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.update(this._camera,m),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._renderLoop.update(),this._emit("update")},e.prototype._subscribeToDomEvents=function(){this.container.addEventListener("contextmenu",function(t){return t.preventDefault()})},e.prototype.convertScreenToWorldCoordinates=function(t){var e=t.clientX,n=t.clientY,o=Object(B.c)({x:e,y:n},this);return{worldCoordinates:o,coordinates:this.projection.fromGlobalCoordinates(o)}},e.prototype._restrictZoom=function(t){var e=this.zoomRange,n=e.min,o=e.max;return Object(Y.b)(t,n,o)},e.prototype._convertFeatureToWorld=function(t){var e=this,n=1/0,o=-1/0,i=1/0,r=-1/0;return{feature:Object(c.c)(t,function(t){var a=e.projection.toGlobalCoordinates(t);if(e.worldOptions.cycledX){var s=t[0]<-180||t[0]>180?Math.round(t[0]/360):0;a.x+=2*s}return n=a.x<n?a.x:n,o=a.x>o?a.x:o,i=a.y<i?a.y:i,r=a.y>r?a.y:r,a}),bbox:{minX:n,maxX:o,minY:i,maxY:r}}},e.prototype._getFeaturesForDataSource=function(t){return this._featuresByDataSource.has(t)||this._featuresByDataSource.set(t,new r.Map),this._featuresByDataSource.get(t)},e.prototype._assertDataSourceExistance=function(t){},e.prototype._createDataSource=function(t){var e=t.type;return"geojson"===e?new Wt:"tile"===e?new tt.a(t,this.worldOptions):"markers"===e?new Ht:null},e.prototype._chooseZoomRounding=function(){var t=this.isSnapToRoundZoom;if(this.behaviors&&this._manageZoomRounding&&(this.behaviors.snapToRoundZoom="vector"!==this._mainEngine.type||0===this._mainLayers.length,this.behaviors.snapToRoundZoom)){var e=Ze(this._camera.zoom);this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{zoom:e}))}t!==this.isSnapToRoundZoom&&this._emit("zoomRoundingChanged")},e.prototype._applyFilters=function(){this._mainEngine.engine.setObjectFilters(this._filters),this._topRasterEngine.setObjectFilters(this._filters)},e.prototype._applyInvisibleCollidingPrimitives=function(){this._mainEngine.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives)},e.prototype._toMapObject=function(t){var e=this;if(!t)return t;if("raw-hotspot"===t.type){var n=Object(i.a)(Object(i.a)({},t.feature),{geometry:t.feature.geometry&&Object(c.d)(t.feature.geometry,function(t){var e=t[0];return[t[1],e]})});return{type:"hotspot",layer:t.layer,source:t.source,feature:n}}if("hotspot"===t.type){var n=Object(i.a)(Object(i.a)({},t.feature),{geometry:t.feature.geometry&&Object(c.d)(t.feature.geometry,function(t){return e.projection.fromGlobalCoordinates(t)})});return{type:"hotspot",layer:t.layer,source:t.source,feature:n}}return"feature"===t.type?(n=this._getFeaturesForDataSource(t.source).get(t.featureId))?{type:"feature",layer:t.layer,source:t.source,feature:n}:null:"marker"===t.type?Object(i.a)(Object(i.a)({},t),{marker:t.marker}):"empty-object"===t.type?Object(i.a)({},t):null},e.prototype._restrictCamera=function(t){var e=this._restrictZoom(t.zoom);return{zoom:e,worldCenter:W.a.fitViewportToWorld(t.worldCenter,{zoom:e,worldOptions:this.worldOptions,size:this.size}),azimuth:Object(Y.a)(t.azimuth,0,2*Math.PI),tilt:Object(Y.b)(t.tilt,0,ut.a)}},e}(Object(f.a)().with());function Ve(t){var e=t.getBoundingClientRect(),n=e.top,o=e.left;return{size:{x:t.offsetWidth,y:t.offsetHeight},offset:{top:n,left:o}}}function Xe(t,e){var n={};return t.map(function(t){var o="string"==typeof t?Object(K.c)(t):t,i=Object(K.b)(o);if(i.source!==K.a&&!e[i.source])throw new Error('Nonexistent data source "'+i.source+'" in "'+o.id+'"');if(i.source!==K.a&&"markers"===e[i.source].type){if(n[i.source]){var r='Marker data source "'+i.source+'" is already used in layer "'+o.id+'". ';throw new Error(r+="Marker data source can be used to construct only one layer")}n[i.source]=!0}return i})}function qe(t,e){Object(d.a)(t);for(var n=Object(i.a)({},t),o=0,r=Object.keys(e);o<r.length;o++){var a=e[r[o]];if("tile"===a.type&&(a.zoomRange&&Object(d.a)(a.zoomRange),a.clampMapZoom)){var s=a.zoomRange||Object(d.c)();Object(d.b)(n,s,n)}}Object(d.a)(n)}function Ue(t){return t.id}function Qe(t){t.parentElement&&t.parentElement.removeChild(t)}function Ke(t){var e,n=function(){if(!t.behaviors.isInAction&&e){var n={x:e.clientX,y:e.clientY},o=Object(B.c)(n,t);t.preloadHotspotsInPoint(o)}},o=function(t){e=t,n()},i=t.behaviors.on("actionEnd",function(){n()}),r=t.on("beforeDestroy",function(){r.offAll(),i.offAll(),t.container.removeEventListener("mousemove",o)});t.container.addEventListener("mousemove",o)}function Je(t){var e,n=t.behaviors.on("actionStart",function(){e&&(e.offAll(),e=void 0)}).on("actionEnd",function(){e||t.behaviors.isInAction||(t.preloadHotspotsForViewport(),e=t.on("update",function(){return t.preloadHotspotsForViewport()}))}),o=t.on("beforeDestroy",function(){o.offAll(),n.offAll(),e&&(e.offAll(),e=void 0)});e=t.on("update",function(){return t.preloadHotspotsForViewport()})}n.d(e,"polyfills",function(){return $e}),n.d(e,"YaMap",function(){return He}),n.d(e,"MarkersDataSource",function(){return Ht}),n.d(e,"eventify",function(){return f.a}),n.d(e,"worldUtils",function(){return W.a}),n.d(e,"QualityHint",function(){return l.a}),n.d(e,"screenToWorldCoordinates",function(){return B.c}),n.d(e,"transformFeatureCoordinates",function(){return c.c}),n.d(e,"transformGeometryCoordinates",function(){return c.d}),n.d(e,"flattenFeatures",function(){return c.b}),n.d(e,"assertFeatureOrCollectionIdIsString",function(){return c.a}),n.d(e,"computeStrokeStyle",function(){return Dt}),n.d(e,"computeDrawingStyle",function(){return It}),n.d(e,"computeGroupStyle",function(){return Ft}),n.d(e,"createDevice",function(){return T}),n.d(e,"DeviceActiveState",function(){return o}),n.d(e,"Dragger",function(){return j}),n.d(e,"WheelDevice",function(){return M}),n.d(e,"ZoomDirection",function(){return R}),n.d(e,"TwoFingersGestureRecognizer",function(){return k}),n.d(e,"getDefaultZoomRange",function(){return d.c}),n.d(e,"DblClickBehavior",function(){return ve}),n.d(e,"DragBehavior",function(){return ge}),n.d(e,"PinchTiltRotateBehavior",function(){return be}),n.d(e,"RoundScrollZoomBehavior",function(){return ae}),n.d(e,"SmoothScrollZoomBehavior",function(){return pe}),n.d(e,"Magnifier",function(){return Se}),n.d(e,"Behaviors",function(){return Re}),n.d(e,"OneFingerZoomBehavior",function(){return Oe}),n.d(e,"ZoomStrategy",function(){return Qt}),n.d(e,"RotateBehavior",function(){return ze}),n.d(e,"EventsManager",function(){return ke}),n.d(e,"loadHotspotsByPointerPosition",function(){return Ke}),n.d(e,"loadHotspotsForViewport",function(){return Je}),n.d(e,"vec2",function(){return u}),n.d(e,"CustomDomLayer",function(){return Vt.a}),n.d(e,"provideErrorLogger",function(){return J});var $e=Object(i.a)(Object(i.a)(Object(i.a)({},r),a),s)},312:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"d",function(){return r}),n.d(e,"b",function(){return a}),n.d(e,"a",function(){return s});var o=n(34);function i(t,e){return Object(o.a)(Object(o.a)({},t),{geometry:t.geometry&&r(t.geometry,e)})}function r(t,e){switch(t.type){case"Point":return Object(o.a)(Object(o.a)({},t),{coordinates:e(t.coordinates)});case"LineString":return Object(o.a)(Object(o.a)({},t),{coordinates:t.coordinates.map(e)});case"MultiLineString":return Object(o.a)(Object(o.a)({},t),{coordinates:t.coordinates.map(function(t){return t.map(e)})});case"Polygon":return Object(o.a)(Object(o.a)({},t),{coordinates:t.coordinates.map(function(t){return t.map(e)})});case"MultiPolygon":return Object(o.a)(Object(o.a)({},t),{coordinates:t.coordinates.map(function(t){return t.map(function(t){return t.map(e)})})});default:throw new Error("Unexpected geometry type: "+t.type)}}function a(t){var e;return"FeatureCollection"===t.type?(e=[]).concat.apply(e,t.features.map(function(t){return a(t)})):[t]}function s(t){if("string"!=typeof t.id)throw new Error("Feature or collection id must be a string")}},402:function(t,e,n){"use strict";function o(t,e,n){return{x:t,y:e,z:n}}n.d(e,"e",function(){return o}),n.d(e,"a",function(){return i}),n.d(e,"d",function(){return r}),n.d(e,"c",function(){return a}),n.d(e,"m",function(){return s}),n.d(e,"i",function(){return u}),n.d(e,"j",function(){return c}),n.d(e,"g",function(){return l}),n.d(e,"f",function(){return d}),n.d(e,"k",function(){return h}),n.d(e,"l",function(){return p}),n.d(e,"b",function(){return _}),n.d(e,"h",function(){return m});var i=o(0,0,0);function r(t,e){return void 0===e&&(e=o(0,0,0)),e.x=t.x,e.y=t.y,e.z=t.z,e}function a(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n}function s(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n}function u(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n}function c(t,e){return void 0===e&&(e=o(0,0,0)),function(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n}(t,function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}(t),e)}function l(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function d(t,e,n){void 0===n&&(n=o(0,0,0));var i=t.y*e.z-t.z*e.y,r=t.z*e.x-t.x*e.z,a=t.x*e.y-t.y*e.x;return n.x=i,n.y=r,n.z=a,n}function h(t,e,n){void 0===n&&(n=o(0,0,0));var i=Math.cos(e),r=Math.sin(e),a=t.y;return n.x=t.x,n.y=a*i-t.z*r,n.z=a*r+t.z*i,n}function p(t,e,n){void 0===n&&(n=o(0,0,0));var i=Math.cos(e),a=Math.sin(e);return t=t===n?r(t):t,n.x=t.x*i-t.y*a,n.y=t.x*a+t.y*i,n.z=t.z,n}var _={normal:o(0,0,1),distance:0};function m(t,e,n){void 0===n&&(n=o(0,0,0));var i=l(e.direction,t.normal);if(0===i)return null;var s=(t.distance-l(t.normal,e.origin))/i;return s<0?null:(r(e.direction,n),function(t,e,n){void 0===n&&(n=o(0,0,0)),n.x=t.x*e,n.y=t.y*e,n.z=t.z*e}(n,s,n),a(n,e.origin,n),n)}},434:function(t,e,n){"use strict";n.r(e),n.d(e,"AbortController",function(){return o});var o,i=n(34),r=n(74),a=window;if(a.AbortController)o=a.AbortController;else{var s=function(t){function e(e){var n=t.call(this)||this;return n.onabort=null,n._controller=e,n}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"aborted",{get:function(){return this._controller.aborted},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(t,e){this.on(String(t),e)},e.prototype.removeEventListener=function(t,e){this.offSingle(String(t),e)},e.prototype.dispatchEvent=function(t){return this.onabort&&this.onabort(t),this._emit(t.type,t),!1},e}(Object(r.a)().with());o=function(){function t(){this._aborted=!1,this.signal=new s(this)}return t.prototype.abort=function(){if(!this._aborted){this._aborted=!0;var t=document.createEvent("Event");t.initEvent("abort",!1,!1),this.signal.dispatchEvent(t)}},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},enumerable:!1,configurable:!0}),t}()}},435:function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return a});var o=n(434),i=n(192),r=n(565),a=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},s=function(){function t(t){var e=this;this._queue=[],this._processing=[],this._paused=!1,this._changed=!1,this._onTaskAbort=function(t,n){var o=e._processing.indexOf(t);if(-1!==o)e._processing.splice(o,1);else{var i=e._queue.indexOf(t);-1!==i&&e._queue.splice(i,1),n.reject(new r.a)}},this._maxConcurrency=t}return t.prototype.enqueue=function(t,e){var n=this;void 0===e&&(e=0);var i=new o.AbortController,r=new a,s={task:t,abortController:i,process:function(){return t(i.signal).then(r.resolve,r.reject)},priority:e};return i.signal.addEventListener("abort",function(){return n._onTaskAbort(s,r)}),this._queue.push(s),this._changed=!0,this._paused||this._process(),{abortController:i,promise:r.promise,updatePriority:function(){s.priority=e,n._changed=!0}}},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1,this._process()},t.prototype._process=function(){var t,e=this;if(!(this._processing.length>=this._maxConcurrency)){this._changed&&this._queue.sort(function(t,e){return t.priority-e.priority});var n=this._queue.splice(0,this._maxConcurrency-this._processing.length);(t=this._processing).push.apply(t,n);for(var o=function(t){Object(i.promiseFinally)(t.process(),function(){var n=e._processing.indexOf(t);-1!==n&&e._processing.splice(n,1),e._process()})},r=0,a=n;r<a.length;r++){o(a[r])}}},t}()},436:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"b",function(){return r});var o=function(){return{min:0,max:21}},i=function(t){if(t.min>=t.max)throw new Error("Invalid zoom range, min >= max ("+t.min+" >= "+t.max+")");if(t.min<0||t.max<0)throw new Error("Invalid zoom range, min or max is less than zero (min="+t.min+" max="+t.max+")")},r=function(t,e,n){return void 0===n&&(n=o()),n.min=Math.max(t.min,e.min),n.max=Math.min(t.max,e.max),n}},437:function(t,e,n){"use strict";n.d(e,"a",function(){return l}),n.d(e,"c",function(){return d}),n.d(e,"b",function(){return h}),n.d(e,"f",function(){return m}),n.d(e,"h",function(){return _}),n.d(e,"d",function(){return f}),n.d(e,"e",function(){return y}),n.d(e,"g",function(){return p});var o=n(34),i=n(75),r=n(125),a=n(76),s=n(155),u=n(566),c=n(402);function l(t,e,n,o){var i=a.divn(e,2*n),r=a.sub(t,i);a.divn(r,o,r),a.applyFunction(r,Math.floor,r);var s=a.add(t,i);return a.divn(s,o,s),a.applyFunction(s,Math.floor,s),{minX:r.x,minY:r.y,maxX:s.x,maxY:s.y}}function d(t,e,n,o,i){var r=a.divn(n,2*o);return[{x:r.x,y:r.y},{x:r.x,y:-r.y},{x:-r.x,y:-r.y},{x:-r.x,y:r.y}].map(function(t){return a.rotate(t,-e)}).map(function(e){return a.sub(t,e)}).map(function(t){return a.divn(t,i)})}function h(t,e,n,s,u,l,d){var h={worldCenter:t,zoom:Object(i.mathLog2)(Math.pow(2,s)*u),azimuth:e,tilt:n},p=function(t,e,n,i,s){var u=e.worldCenter,l=e.tilt,d=e.azimuth,h=e.zoom,p={x:0,y:0,z:.5*-r.a.convertPixelSizeToWorldSize(n,h).y/Math.tan(.5*t)};c.k(p,l,p),c.l(p,d,p),c.c(p,Object(o.a)(Object(o.a)({},u),{z:0}),p);for(var _=Math.tan(.5*t),m=n.x/n.y,f=c.e(_*m,_,1),y=[c.d(c.a),c.d(c.a),c.d(c.a),c.d(c.a)],v=c.e(0,0,0),b={origin:p,direction:v},S=0;S<4;++S){if(c.i(g[S],f,v),c.k(v,l,v),c.l(v,d,v),!c.h(c.b,b,y[S]))throw new Error("Visible quadrilateral is unbounded, engine can't handle that case (yet)")}return y.map(function(t){var e=r.a.worldToPixels(t,i);return a.divn(e,s)})}(Math.PI/6,h,l,s,d),_=function(t){for(var e=1/0,n=-1/0,o=[],i=0,r=1;i<t.length;++i,r=++r%t.length){var a=[t[i],t[(i+1)%t.length]].sort(function(t,e){return t.y-e.y}),s=a[0],u=a[1],c=Math.floor(s.y),l=Math.ceil(u.y);e=Math.min(e,c),n=Math.max(n,l);var d=(u.x-s.x)/(u.y-s.y),h=s.x-(isFinite(d)?d*(s.y-c):0);o.push({firstRow:c,lastRow:l,startX:s.x,endX:u.x,x:h,k:d})}for(var p=[],_=e;_<n;_++){for(var m=1/0,f=-1/0,y=0,g=o;y<g.length;y++){var v=g[y];if(!(_<v.firstRow||_>=v.lastRow)){var b=v.x+v.k,S=v.k>=0?Math.max(v.x,v.startX):Math.min(v.x,v.startX),x=v.k>=0?Math.min(b,v.endX):Math.max(b,v.endX);m=Math.floor(Math.min(m,S,x)),f=Math.ceil(Math.max(f,S,x)),v.x=b}}for(h=m;h<f;h++)p.push({x:h,y:_})}return p}(p),m=new i.Map;return _.forEach(function(t){return m.set(y(t,s),Object(o.a)(Object(o.a)({},t),{border:!1}))}),{tiles:m,tileBounds:p}}function p(t,e){return t.every(function(t){return Object(u.b)(e,t)})}function _(t,e){return{x:Object(s.a)(t.x,0,e),y:Object(s.a)(t.y,0,e)}}function m(t,e,n){var o=t.x,i=t.y;return(n.cycledX||o<e&&o>=0)&&(n.cycledY||i<e&&i>=0)}function f(t,e){return Math.ceil(Math.pow(2,t+8)/e)}function y(t,e){return t.x+"."+t.y+"."+e}var g=[c.e(-1,1,-1),c.e(1,1,-1),c.e(1,-1,-1),c.e(-1,-1,-1)]},565:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=n(34),i=function(t){function e(n){var o=t.call(this,void 0===n?"Aborted":n)||this;return o.name="AbortError",o.__proto__=e.prototype,o}return Object(o.b)(e,t),e}(Error)},566:function(t,e,n){"use strict";function o(t,e){for(var n=e.x,o=e.y,i=t.length-1,r=!1,a=0;a<t.length;a++){var s=t[a].y<=o&&t[i].y>o||t[i].y<=o&&t[a].y>o,u=n>(t[i].x-t[a].x)*(o-t[a].y)/(t[i].y-t[a].y)+t[a].x;s&&u&&(r=!r),i=a}return r}function i(t,e){for(var n=1;n<t.length;n++)if(o(t[n],e))return!1;return o(t[0],e)}function r(t,e){if("Point"===t.type)return!1;if("LineString"===t.type)return!1;if("Polygon"===t.type)return i(t.coordinates,e);if("MultiPolygon"===t.type){for(var n=0,o=t.coordinates;n<o.length;n++){if(i(o[n],e))return!0}return!1}return!1}n.d(e,"b",function(){return o}),n.d(e,"a",function(){return r})},602:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o="hidden"},633:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=n(155);function i(){return Object(o.b)(devicePixelRatio,1,3)}},634:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=n(75);function i(t,e,n,i,r,a){void 0===i&&(i=function(){}),void 0===r&&(r=function(){}),void 0===a&&(a=function(){return!0});var s=new o.Map,u=[],c=[],l=[];function d(t,e){i(t,e),l.push(t)}return e.forEach(function(e,o){var i=t.get(o);if(i&&a(i,e)?(r(i,e),c.push(i)):i&&(d(i,o),i=void 0),!i){var l=n(e);u.push(l),i=l}s.set(o,i)}),t.forEach(function(t,n){e.has(n)||d(t,n)}),{result:s,created:u,updated:c,removed:l}}},635:function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i});var o=n(76),i=40*Math.PI/180;function r(t,e){return o.areFuzzyEqual(t.worldCenter,e.worldCenter)&&t.zoom===e.zoom&&t.azimuth===e.azimuth&&t.tilt===e.tilt}},636:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var o=n(34),i=n(74),r=n(902),a=function(t){function e(e){var n=t.call(this)||this;return n.state=r.a,n}return Object(o.b)(e,t),e.prototype.findObjectInPosition=function(t){return null},e.prototype._requestRender=function(){this._emit("requestRender")},e.prototype.update=function(t){},e.prototype.resize=function(t){},e.prototype.render=function(t){},e}(Object(i.a)().with())},656:function(t,e,n){"use strict";var o=n(34);function i(t,e){return t===e?null:{old:t,new:e}}var r=n(455),a=n(436),s=n(437),u=n(74);n(248);n.d(e,"a",function(){return c}),n.d(e,"b",function(){return l});var c=function(t){function e(e,n){var o=t.call(this)||this;return o._isTileAnimationStarted=!1,o._makeFields=function(t,e){return{tileSize:e.size||r.c,transparent:Boolean(e.transparent),clampMapZoom:Boolean(t.clampMapZoom),zoomRange:t.zoomRange||Object(a.c)(),fetchHotspots:e.fetchHotspots,hotspotAbortRadius:e.hotspotAbortRadius||r.a,vectorHotspots:t.vector&&t.vector.hotspots||{},awaitAllTilesOnFirstDisplay:Boolean(e.awaitAllTilesOnFirstDisplay)}},o.setSource(e),o.worldOptions=n,o}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"isTileAnimationStarted",{get:function(){return this._isTileAnimationStarted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rasterSourceDescription",{get:function(){return this._source.raster},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorSourceDescription",{get:function(){return this._source.vector},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorHotspots",{get:function(){return this._fields.vectorHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){return this._fields.zoomRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampMapZoom",{get:function(){return this._fields.clampMapZoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._fields.transparent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileSize",{get:function(){return this._fields.tileSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fetchHotspots",{get:function(){return this._fields.fetchHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hotspotAbortRadius",{get:function(){return this._fields.hotspotAbortRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"awaitAllTilesOnFirstDisplay",{get:function(){return this._fields.awaitAllTilesOnFirstDisplay},enumerable:!1,configurable:!0}),e.prototype.getHotspotTileDataSource=function(){return this._rasterSource.fetchHotspots?{fetchHotspots:this._rasterSource.fetchHotspots,hotspotAbortRadius:this._rasterSource.hotspotAbortRadius||r.a,tileSize:this._rasterSource.size||r.c,inset:void 0===this._rasterSource.hotspotInset?r.b:this._rasterSource.hotspotInset,padding:this._rasterSource.hotspotPadding||0,zoomRange:this.zoomRange}:null},e.prototype.setSource=function(t){if(!t.raster)return this._source=t,this._emit("changed"),void this._emit("sourceChanged",{clampMapZoom:null,fetchHotspots:null,hotspotAbortRadius:null,tileSize:null,fetchTile:null,vectorHotspots:null,transparent:null,zoomRange:null,awaitAllTilesOnFirstDisplay:null});this._source=t;var e,n=this._makeFields(t,t.raster),r=Object(o.a)(Object(o.a)({},function(t,e){for(var n={},o=0,r=Object.keys(t);o<r.length;o++){var a=r[o];n[a]=i(t[a],e[a])}return n}(this._fields||{},n)),{fetchTile:i(this._rasterSource&&this._rasterSource.tileUrl,t.raster.tileUrl)});this._rasterSource=t.raster,this._fields=n,"string"==typeof this._rasterSource.tileUrl&&(this._tileUrlGenerator=(e=this._rasterSource.tileUrl,function(t,n,o,i){return e.replace("{{x}}",String(t)).replace("{{y}}",String(n)).replace("{{z}}",String(o)).replace("{{scale}}",String(i)).replace(/\{\{d\|(\d+)\}\}/,function(e,i){var r=(t+n+o)%Number(i)+1;return String(r)})})),this._emit("changed"),this._emit("sourceChanged",r)},e.prototype.generateTileUrl=function(t,e,n,o){var i=Object(s.d)(n,this.tileSize);if(!Object(s.f)({x:t,y:e},i,this.worldOptions))return null;var r=Object(s.h)({x:t,y:e},i),a=r.x,u=r.y;return this._tileUrlGenerator(a,u,n,o)},e.prototype.startTileAnimation=function(){this._isTileAnimationStarted=!0,this._emit("tileAnimationStarted")},e.prototype.stopTileAnimation=function(){this._isTileAnimationStarted=!1},e}(Object(u.a)().with());function l(t,e){return t.fetchHotspots===e.fetchHotspots&&t.hotspotAbortRadius===e.hotspotAbortRadius&&t.tileSize===e.tileSize}},74:function(t,e,n){"use strict";var o=n(34),i=n(75),r=(n(248),Object(i.Symbol)("EventEmitter")),a=Object(i.Symbol)("EventEmitter.MixinConstructor"),s=Object(i.Symbol)("EventEmitter.MixinPrototype"),u=function(){function t(){}return t[a]=function(t){t._eventListenersHash={}},t[s]=function(e){e[r]=t.prototype[r],e.group=t.prototype.group,e.on=t.prototype.on,e.offSingle=t.prototype.offSingle,e._emit=t.prototype._emit},t.prototype.on=function(t,e){return this.group().on(t,e)},t.prototype.offSingle=function(t,e){var n=this._eventListenersHash[t];n&&n.delete(e)},t.prototype.group=function(){return new t._eventGroupImpl(this)},t.prototype._emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this._eventListenersHash[t];if(o){var i=[];o.forEach(function(t){return i.push(t)});for(var r=0,a=i;r<a.length;r++){var s=a[r];s(e[0])}}},t._eventGroupImpl=function(){function t(t){this._listeners=[],this._emitter=t}return t.prototype.on=function(t,e){var n=this._emitter._eventListenersHash[t];return n?n.add(e):(this._emitter._eventListenersHash[t]=new i.Set,this._emitter._eventListenersHash[t].add(e)),this._listeners.push([t,e]),this},t.prototype.offAll=function(){for(var t=0,e=this._listeners;t<e.length;t++){var n=e[t],o=n[0],i=n[1];this._emitter._eventListenersHash[o].delete(i)}this._listeners=[]},t}(),t}();u.prototype[r]=!0,n.d(e,"a",function(){return l});var c=function(){},l=function(t){return void 0===t&&(t=c),{with:function(){if(e=t.prototype,Boolean(e&&e[r]))return t;var e,n=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=t.apply(this,e)||this;return u[a](o),o}return Object(o.b)(e,t),e}(t);return u[s](n.prototype),n}}}},75:function(t,e,n){"use strict";n.r(e),n.d(e,"mathSign",function(){return i}),n.d(e,"mathLog2",function(){return r}),n.d(e,"mathLog10",function(){return a}),n.d(e,"arrayFindIndex",function(){return p}),n.d(e,"arrayFind",function(){return _}),n.d(e,"arrayFrom",function(){return m}),n.d(e,"arraySome",function(){return v}),n.d(e,"Symbol",function(){return u}),n.d(e,"Map",function(){return l}),n.d(e,"Set",function(){return h}),n.d(e,"WeakMap",function(){return d}),n.d(e,"MAX_SAFE_INTEGER",function(){return s});var o={},i=Math.sign?Math.sign.bind(Math):function(t){return t<0?-1:0===t?0:1},r=Math.log2?Math.log2.bind(Math):function(t){return Math.log(t)*Math.LOG2E},a=Math.log10?Math.log10.bind(Math):function(t){return Math.log(t)/Math.LN10},s=Number.MAX_SAFE_INTEGER||9007199254740991,u="undefined"==typeof Symbol?function(t){return"__Symbol_"+t+"_"+Date.now()+"_"+Math.random()}:Symbol,c=function(t){return new t([[o,1]]).has(o)?function(e){return new t(e)}:function(e){var n=new t;if(void 0!==e)for(var o=0,i=e;o<i.length;o++){var r=i[o],a=r[0],s=r[1];n.set(a,s)}return n}},l=c(Map),d=c(WeakMap),h=new Set([o]).has(o)?function(t){return new Set(t)}:function(t){var e=new Set;if(void 0!==t)for(var n=0,o=t;n<o.length;n++){var i=o[n];e.add(i)}return e};l.prototype=Map.prototype,d.prototype=WeakMap.prototype,h.prototype=Set.prototype;var p=Boolean(Array.prototype.findIndex)?function(t,e,n){return t.findIndex(e,n)}:function(t,e,n){for(var o=0;o<t.length;o++)if(e.call(n,t[o],o,t))return o;return-1},_=Boolean(Array.prototype.find)?function(t,e,n){return t.find(e,n)}:function(t,e,n){var o=p(t,e,n);return-1===o?void 0:t[o]},m=Array.from?Array.from:function(t){var e=this,n=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(void 0!==o&&!y(o))throw new TypeError("Array.from: when provided, the second argument must be a function");for(var r=g(n.length),a=y(e)?Object(new e(r)):new Array(r),s=0;s<r;){var u=n[s];a[s]=o?void 0===i?o(u,s):o.call(i,u,s):u,s+=1}return a.length=r,a},f=Object.prototype.toString;function y(t){return"function"==typeof t||"[object Function]"===f.call(t)}function g(t){var e=Number(t);return isNaN(e)||e<=0?0:Math.min(e,s)}var v=function(t,e,n){return-1!==p(t,e,n)}},76:function(t,e,n){"use strict";n.r(e),n.d(e,"create",function(){return i}),n.d(e,"add",function(){return r}),n.d(e,"sub",function(){return a}),n.d(e,"muln",function(){return s}),n.d(e,"divn",function(){return l}),n.d(e,"mulv",function(){return u}),n.d(e,"divv",function(){return c}),n.d(e,"applyFunction",function(){return d}),n.d(e,"areEqual",function(){return p}),n.d(e,"areFuzzyEqual",function(){return h}),n.d(e,"normalize",function(){return _}),n.d(e,"length",function(){return m}),n.d(e,"length2",function(){return f}),n.d(e,"dot",function(){return y}),n.d(e,"avg",function(){return g}),n.d(e,"rotate",function(){return S}),n.d(e,"ORIGIN",function(){return o});var o=i(0,0);function i(t,e){return{x:t,y:e}}function r(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x+e.x,n.y=t.y+e.y,n}function a(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x-e.x,n.y=t.y-e.y,n}function s(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x*e,n.y=t.y*e,n}function u(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x*e.x,n.y=t.y*e.y,n}function c(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x/e.x,n.y=t.y/e.y,n}function l(t,e,n){return void 0===n&&(n=i(0,0)),n.x=t.x/e,n.y=t.y/e,n}function d(t,e,n){return void 0===n&&(n=i(0,0)),n.x=e(t.x,1),n.y=e(t.y,2),n}function h(t,e,n){void 0===n&&(n=1e-6);var o=a(t,e);return-n<o.x&&o.x<n&&-n<o.y&&o.y<n}function p(t,e){return t.x===e.x&&t.y===e.y}function _(t,e){return void 0===e&&(e=i(0,0)),l(t,m(t),e)}function m(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function f(t){return Math.pow(t.x,2)+Math.pow(t.y,2)}function y(t,e){return t.x*e.x+t.y*e.y}function g(t,e){return void 0===e&&(e=i(0,0)),e.x=t.reduce(function(t,e){return t+e.x},0)/t.length,e.y=t.reduce(function(t,e){return t+e.y},0)/t.length,e}var v=Math.cos,b=Math.sin;function S(t,e,n){void 0===n&&(n=i(0,0));var o=t.x,r=t.y,a=v(e),s=b(e);return n.x=a*o-s*r,n.y=s*o+a*r,n}},901:function(t,e,n){"use strict";n.d(e,"a",function(){return m});var o=n(34),i=n(75),r=n(192),a=n(437),s=n(74),u=n(268),c=n(566),l=n(125),d=n(312),h=n(155),p=n(76),_=function(){},m=function(t){function e(e,n,o,r,a,s){var u=t.call(this)||this;return u._newTiles=new i.Map,u._loadingTiles=new i.Map,u._readyTiles=new i.Map,u._size=e,u._camera=n,u._tileSource=o,u._zoomRoundingRule=s,u._worldOptions=a,u._queue=r,u}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return{tilesLoaded:0,tilesReady:0,tilesTotal:0,borderTotal:0,borderLoaded:0,borderReady:0}},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._loadingTiles.forEach(function(t){t.abortController.abort()})},e.prototype.preloadHotspotsInPoint=function(t){for(var e=this._zoomRoundingRule(this._camera.zoom),n=!1,o=0,i=this._computeAffectedTiles(t,e);o<i.length;o++){var r=i[o],s=Object(a.e)(r,r.zoom);this._isTileDataReadyOrLoading(s)||this._newTiles.has(s)||(this._newTiles.set(s,{id:r}),n=!0)}var u=this._stopLoadingTilesOutsideRadius(t);(n||u)&&this._emit("hotspotsChanged"),n&&this._emit("requestRender")},e.prototype.preloadHotspotsForViewport=function(){for(var t=this,e=!1,n=0,o=this._getTilesForViewport().filter(function(e){return!t._isTileDataReadyOrLoading(Object(a.e)(e,e.zoom))});n<o.length;n++){var i=o[n],r=Object(a.e)(i,i.zoom);this._isTileDataReadyOrLoading(r)||this._newTiles.has(r)||(this._newTiles.set(r,{id:i}),e=!0)}e&&(this._emit("hotspotsChanged"),this._emit("requestRender"))},e.prototype.resize=function(t){p.areEqual(t,this._size)||(this._size=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.update=function(t,e){var n=t.worldCenter,o=t.zoom;n===this._camera.worldCenter&&o===this._camera.zoom||(this._camera=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.render=function(t){var e=this;t.qualityHint<u.a.FULL||this._camera.zoom<this._tileSource.zoomRange.min||this._camera.zoom>this._tileSource.zoomRange.max||(this._newTiles.forEach(function(t){var n=Object(a.e)(t.id,t.id.zoom),i=e._loadTile(t);e._loadingTiles.set(n,i),Object(r.promiseFinally)(i.promise.then(function(r){var a=r.map(function(n){return"world"===n.type?n:function(t,e,n){var o=p.muln(e,n);return{type:"world",feature:t.feature,geometry:Object(d.d)(t.geometry,function(t){return l.a.pixelsToWorld(p.add(t,o),e.zoom)})}}(n,t.id,e._tileSource.tileSize)}),s=e._zoomRoundingRule(e._camera.zoom),u=e._tileSource.padding/l.a.getWorldPixelSize(s),c=0===e._tileSource.padding?a:a.map(function(t){return Object(o.a)(Object(o.a)({},t),{geometry:y(t.geometry,u)})});e._readyTiles.set(n,{id:i.id,hotspots:c}),e._emit("hotspotsChanged")}),function(){return e._loadingTiles.delete(n)}).catch(function(t){if(!t||"AbortError"!==t.name)throw t})}),this._newTiles.clear())},e.prototype.findObjectInPosition=function(t){for(var e=l.a.restrictToZeroWorld(t,this._worldOptions),n=this._zoomRoundingRule(this._camera.zoom),o=!0,i=0,r=this._computeAffectedTiles(e,n);i<r.length;i++){var s=r[i],u=this._readyTiles.get(Object(a.e)(s,n));if(u)for(var d=u.hotspots.length-1;d>=0;d--){var h=u.hotspots[d];if(Object(c.a)(h.geometry,e))return{type:"raw-hotspot",feature:h.feature}}else o=!1}return o?null:void 0},e.prototype._stopLoadingTilesOutsideRadius=function(t){var e=this._zoomRoundingRule(this._camera.zoom),n=p.divn(l.a.worldToPixels(t,e),this._tileSource.tileSize),o=Math.max(this._tileSource.hotspotAbortRadius,this._tileSource.inset)/this._tileSource.tileSize;return f(this._loadingTiles,function(t){return function(t,e,n){var o=p.create(Object(h.b)(e.x,t.x,t.x+1),Object(h.b)(e.y,t.y,t.y+1));return p.sub(o,e,o),p.length2(o)<=Math.pow(n,2)}(t.id,n,o)},function(t){return t.abortController.abort()})},e.prototype._removeTilesOutsideViewport=function(){var t=this._zoomRoundingRule(this._camera.zoom),e=l.a.getScale(t,this._camera.zoom),n=p.create(this._size.x+2*this._tileSource.inset,this._size.y+2*this._tileSource.inset),o=l.a.worldToPixels(this._camera.worldCenter,t),i=Object(a.a)(o,n,e,this._tileSource.tileSize),r=function(e){var n=e.id;return n.zoom===t&&n.x<=i.maxX&&n.x+1>=i.minX&&n.y<=i.maxY&&n.y+1>=i.minY},s=f(this._newTiles,r),u=f(this._loadingTiles,r,function(t){return t.abortController.abort()}),c=f(this._readyTiles,r);return s||u||c},e.prototype._isTileDataReadyOrLoading=function(t){return this._loadingTiles.has(t)||this._readyTiles.has(t)},e.prototype._getTilesForViewport=function(){for(var t=this._zoomRoundingRule(this._camera.zoom),e=l.a.getScale(t,this._camera.zoom),n=l.a.worldToPixels(this._camera.worldCenter,t),o=Object(a.a)(n,this._size,e,this._tileSource.tileSize),i=[],r=o.minX;r<=o.maxX;r++)for(var s=o.minY;s<=o.maxY;s++)i.push({x:r,y:s,zoom:t});return i},e.prototype._loadTile=function(t){var e=this,n=Object(a.d)(t.id.zoom,this._tileSource.tileSize),o=p.applyFunction(t.id,function(t){return Object(h.a)(t,0,n)}),i=this._queue.enqueue(function(n){var i=e._tileSource.fetchHotspots;return!n.aborted&&i?Promise.resolve(i(o.x,o.y,t.id.zoom,n)):Promise.resolve([])}),r=i.promise,s=i.abortController;return{id:t.id,abortController:s,promise:r}},e.prototype._computeAffectedTiles=function(t,e){var n=l.a.worldToTile(t,e,this._tileSource.tileSize),o=p.applyFunction(n,Math.floor),i=p.sub(n,o);p.muln(i,this._tileSource.tileSize,i);var r=i.x<this._tileSource.inset,a=i.x>this._tileSource.tileSize-this._tileSource.inset,s=i.y<this._tileSource.inset,u=i.y>this._tileSource.tileSize-this._tileSource.inset,c=[{x:o.x,y:o.y,zoom:e}];return r&&c.push({x:o.x-1,y:o.y,zoom:e}),a&&c.push({x:o.x+1,y:o.y,zoom:e}),s&&c.push({x:o.x,y:o.y-1,zoom:e}),u&&c.push({x:o.x,y:o.y+1,zoom:e}),r&&s&&c.push({x:o.x-1,y:o.y-1,zoom:e}),r&&u&&c.push({x:o.x-1,y:o.y+1,zoom:e}),a&&s&&c.push({x:o.x+1,y:o.y-1,zoom:e}),a&&u&&c.push({x:o.x+1,y:o.y+1,zoom:e}),c},e}(Object(s.a)().with());function f(t,e,n){void 0===n&&(n=_);var o=!1;return t.forEach(function(i,r){e(i)||(n(i),t.delete(r),o=!0)}),o}function y(t,e){if("Polygon"!==t.type)return t;for(var n=t.coordinates[0],o=n.reduce(function(t,e){return p.add(t,e,t)},p.create(0,0)),i=p.divn(o,n.length),r=1+e/n.reduce(function(t,e){return Math.max(t,p.length(p.sub(e,i)))},0),a=0,s=n;a<s.length;a++){var u=s[a],c=p.sub(u,i);p.muln(c,r,c),p.add(c,i,u)}return t}},902:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o={tilesLoaded:0,tilesReady:0,tilesTotal:0,borderLoaded:0,borderReady:0,borderTotal:0}}}]);